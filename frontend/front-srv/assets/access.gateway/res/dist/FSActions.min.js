/*! For license information please see FSActions.min.js.LICENSE.txt */
(()=>{"use strict";var e={455:e=>{e.exports=require("material-ui")},757:e=>{e.exports=require("pydio")},880:e=>{e.exports=require("pydio/http/api")},603:e=>{e.exports=require("pydio/model/data-model")},262:e=>{e.exports=require("pydio/util/dom")},180:e=>{e.exports=require("pydio/util/func")},763:e=>{e.exports=require("pydio/util/lang")},689:e=>{e.exports=require("react")}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,o),i.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{function e(e){return function(t,o){var r=o&&o.length?o[0]:null;e.UI.openCurrentSelectionInEditor(r)}}o.r(r),o.d(r,{Callbacks:()=>ze,CrossWsDropDialog:()=>Re,Listeners:()=>ot,OtherEditorPickerDialog:()=>m,TreeDialog:()=>G,UploadDialog:()=>oe});const t=require("create-react-class");var n=o.n(t);const i=require("prop-types");var a=o.n(i),s=o(689),l=o(455),c=l.FontIcon,u=l.ListItem,d=l.List,p=l.FlatButton,f=o(757),g=o(603),h=o(763),y=f.requireLib("boot").ActionDialogMixin,m=n()({displayName:"OtherEditorPickerDialog",propTypes:{pydio:a().instanceOf(f),selection:a().instanceOf(g)},mixins:[y],getButtons:function(e){var t=[],o=this.props.pydio.MessageHash;return t.push(s.createElement(p,{key:"clear",label:MessageHash["openother.5"],primary:!1,onClick:this.clearAssociations})),t.push(s.createElement(p,{label:o[54],primary:!0,keyboardFocused:!0,onClick:this.props.onDismiss})),t},getDefaultProps:function(){return{dialogTitleId:"openother.2",dialogIsModal:!1,dialogSize:"sm",dialogPadding:0}},findActiveEditors:function(e){var t=[],o=!1,r=this.props.pydio;return null==this.user||this.user.canWrite()||(o=!0),r.Registry.getActiveExtensionByType("editor").forEach((function(e){o&&e.write||e.openable&&t.push(e)})),t},clearAssociations:function(){var e,t,o=this.props.selection.getUniqueNode().getAjxpMime();try{t=(e=this.props.pydio.user.getPreference("gui_preferences",!0)).other_editor_extensions}catch(e){}if(t&&t[o]){var r,n=t[o];this.props.pydio.Registry.getActiveExtensionByType("editor").forEach((function(e){e.editorClass===n&&(r=e)})),r&&-1!==r.mimes.indexOf(o)&&(r.mimes=h.arrayWithout(r.mimes,r.mimes.indexOf(o))),delete t[o],e.other_editor_extensions=t,this.props.pydio.user.setPreference("gui_preferences",e,!0),this.props.pydio.user.savePreference("gui_preferences")}this.props.onDismiss()},selectEditor:function(t,o){var r=this.props,n=r.pydio,i=r.selection.getUniqueNode().getAjxpMime();t.mimes.push(i);var a=n.user;if(a){var s=a.getPreference("gui_preferences",!0)||{},l=s.other_editor_extensions||{};l[i]=t.editorClass,s.other_editor_extensions=l,a.setPreference("gui_preferences",s,!0),a.savePreference("gui_preferences"),e(n)(null,[t]),this.dismiss()}},render:function(){var e=this,t=this.findActiveEditors("*").map((function(t){var o=s.createElement(c,{className:t.icon_class});return s.createElement(u,{onClick:e.selectEditor.bind(e,t),primaryText:t.text,secondaryText:t.title,leftIcon:o})}));return s.createElement(d,{style:{maxHeight:320,overflowY:"scroll",width:"100%",borderTop:"1px solid #e0e0e0"}},t)}}),v=o(689),b=o.n(v),w=o(757),x=o.n(w),C=o(763),E=o.n(C);const S=require("cells-sdk");var P=o(603),R=o.n(P),O=o(455);const _=require("material-ui/styles");function T(e){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T(e)}function N(e){return function(e){if(Array.isArray(e))return D(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||U(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function I(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?M(Object(o),!0).forEach((function(t){j(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):M(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function j(e,t,o){return(t=function(e){var t=function(e,t){if("object"!==T(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,"string");if("object"!==T(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===T(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function L(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var r,n,i,a,s=[],l=!0,c=!1;try{if(i=(o=o.call(e)).next,0===t){if(Object(o)!==o)return;l=!1}else for(;!(l=(r=i.call(o)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=o.return&&(a=o.return(),Object(a)!==a))return}finally{if(c)throw n}}return s}}(e,t)||U(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(e,t){if(e){if("string"==typeof e)return D(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?D(e,t):void 0}}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}var k=x().requireLib("hoc"),A=k.ModernTextField,F=k.ModernSelectField,H=x().requireLib("components").FoldersTree,q=x().requireLib("boot"),B=q.ActionDialogMixin,W=q.CancelButtonProviderMixin,z=q.SubmitButtonProviderMixin,V=function(e){var t=e.pydio,o=e.recentPlaces,r=e.submitValue,n=e.dismiss,i=e.muiTheme,a=t.user,s={};return"material"===i.userTheme?(s.root={borderBottom:"1px solid #e0e0e0",padding:"3px 7px 1px",backgroundColor:"#F6F6F8"},s.hint={color:"rgba(0,0,0,.3)",fontSize:12}):(s.root={backgroundColor:i.palette.mui3["surface-variant"]},s.hint={color:i.palette.mui3["on-surface-variant"],fontSize:12},s.chipBG=i.palette.mui3["inverse-primary"],s.avatarBG=i.palette.mui3["primary-container"],s.avatarColor=i.palette.mui3["on-primary-container"]),b().createElement("div",{style:s.root},b().createElement("div",{style:s.hint},t.MessageHash["action.copymove.recent"]),b().createElement("div",{style:{display:"flex",flexWrap:"wrap",paddingTop:2}},o.map((function(e){var t,o=L(e.split(":"),2),i=o[0],l=o[1],c=l;if(a&&a.getRepositoriesList().has(i)){var u=a.getRepositoriesList().get(i);t=b().createElement(O.Avatar,{backgroundColor:s.avatarBG,color:s.avatarColor,style:{fontSize:12,height:24,width:24,fontWeight:500}},u.getLettersBadge()),c=u.getLabel()+l}return b().createElement(O.Chip,{style:{margin:"0 3px 4px 0"},labelStyle:{lineHeight:"24px"},backgroundColor:s.chipBG,title:c,onClick:function(){r(l,i),n()}},t,l)}))))};V=(0,_.muiThemeable)()(V);var G=n()({displayName:"TreeDialog",propTypes:{isMove:a().bool.isRequired,submitValue:a().func.isRequired},mixins:[B,W,z],getDefaultProps:function(){return{dialogTitle:"Copy/Move",dialogIsModal:!0,dialogScrollBody:!0}},submit:function(){var e=this.props,t=e.pydio,o=e.submitValue,r=this.state,n=r.dataModel,i=r.wsId,a=n.getContextNode().getPath();o(a,"__CURRENT__"===i?null:i);var s=("__CURRENT__"===i?t.user.activeRepository:i)+":"+a;G.RecentPlaces=G.RecentPlaces.filter((function(e){return e!==s})),G.RecentPlaces.unshift(s),G.RecentPlaces=G.RecentPlaces.slice(0,5),this.dismiss()},getInitialState:function(){var e=this.getCurrentDataModel();return{dataModel:e,wsId:e.getRootNode().getMetadata().get("repository_id")||"__CURRENT__"}},handleRepositoryChange:function(e,t,o){var r=this,n=this.getCurrentDataModel(o),i=n.getRootNode();i.observeOnce("loaded",(function(){r.forceUpdate()})),i.load(),this.setState({dataModel:n,wsId:o})},getCurrentDataModel:function(){var e,t,o=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=this.props.pydio,i=n.user,a=i.getRepositoriesList().get(i.activeRepository).getLabel();null!==r&&"__CURRENT__"!==r?(e=r,a=i.getCrossRepositories().get(r).getLabel()):null===r&&(!i.canWrite()&&i.canCrossRepositoryCopy()&&i.hasCrossRepositories()&&(e=i.getCrossRepositories().keys().next().value,a=i.getCrossRepositories().get(e).getLabel()),n.getContextHolder().getContextNode().isRoot()||(t=n.getContextHolder().getContextNode().getPath()));var s={filters:{type:"COLLECTION"}},l=R().RemoteDataModelFactory(e?I(I({},s),{},{tmp_repository_id:e}):s,a),c=l.getRootNode();return e&&c.getMetadata().set("repository_id",e),t?(n.getContextHolder().getRootNode().getChildren().forEach((function(e){c.addChild(e)})),l.loadPathInfoAsync(t,function(e){l.requireContextChange(e)}.bind(this))):(c.observeOnce("loaded",(function(){o.forceUpdate()})),c.load(l.getAjxpNodeProvider())),l.observe("context_changed",(function(){o.forceUpdate()})),l},onNodeSelected:function(e){var t=this.state.dataModel;t.setContextNode(e),e.load(t.getAjxpNodeProvider())},createNewFolder:function(){var e=this,t=this.props.pydio,o=this.state,r=o.dataModel,n=o.newFolderInput,i=r.getContextNode(),a=t.user.getActiveRepositoryObject().getSlug();"__CURRENT__"!==this.state.wsId&&(a=t.user.getRepositoriesList().get(this.state.wsId).getSlug());var s=new S.TreeServiceApi(PydioApi.getRestClient()),l=new S.RestCreateNodesRequest,c=a+E().trimRight(i.getPath(),"/")+"/"+n,u=new S.TreeNode;u.Path=c,u.Type=S.TreeNodeType.constructFromObject("COLLECTION"),l.Nodes=[u],s.createNodes(l).then((function(t){i.observeOnce("loaded",(function(){var e=("/"===i.getPath()?"":i.getPath())+"/"+n,t=i.getChildren().get(e);t&&r.setContextNode(t)})),setTimeout((function(){return i.reload(r.getAjxpNodeProvider())}),1e3),e.setState({newFolderFormOpen:!1,newFolderInput:""})}))},toggleNewFolderForm:function(){var e=this,t=!this.state.newFolderFormOpen;this.setState({newFolderFormOpen:t},(function(){t&&e.refs.newfolder_input.focus()}))},buildWsSelector:function(){var e=this.props.pydio,t=e.user,o=this.state.wsId,r=b().createElement("div",{style:{height:30}});if(t&&t.canCrossRepositoryCopy()&&t.hasCrossRepositories()){var n=[],i=[];if(t.canWrite()){var a=t.getActiveRepositoryObject();n.push(b().createElement(O.MenuItem,{key:"current",value:"__CURRENT__",primaryText:a.getLabel()+" - "+e.MessageHash[372],leftIcon:b().createElement(O.FontIcon,{style:{fontSize:20,height:20,top:a.getOwner()?5:1},className:a.getOwner()?"icomoon-cells":"mdi mdi-folder"})})),n.push(b().createElement(O.Divider,null))}t.getCrossRepositories().forEach((function(e,t){i.push({label:e.getLabel(),owner:!!e.getOwner(),item:b().createElement(O.MenuItem,{key:t,value:t,primaryText:e.getLabel(),leftIcon:b().createElement(O.FontIcon,{style:{fontSize:20,height:20,top:e.getOwner()?5:1},className:e.getOwner()?"icomoon-cells":"mdi mdi-folder"})})})})),i.sort((function(e,t){return e.owner===t.owner?e.label.localeCompare(t.label,void 0,{numeric:!0}):e.owner?1:-1})),n=[].concat(N(n),N(i.map((function(e){return e.item})))),r=b().createElement("div",null,b().createElement(F,{fullWidth:!0,variant:"v2",floatingLabelText:e.MessageHash[455],value:o,onChange:this.handleRepositoryChange.bind(this)},n))}return r},buildRecentLocations:function(){var e,t=this,o=this.props.pydio,r=o.user;if(!G.RecentPlaces||!G.RecentPlaces.length)return e;var n=this.props.submitValue;return b().createElement("div",{style:{borderBottom:"1px solid #e0e0e0",padding:"3px 7px 1px",backgroundColor:"#F6F6F8"}},b().createElement("div",{style:{color:"rgba(0,0,0,.3)",fontSize:12}},o.MessageHash["action.copymove.recent"]),b().createElement("div",{style:{display:"flex",flexWrap:"wrap",paddingTop:2}},G.RecentPlaces.map((function(e){var o,i=L(e.split(":"),2),a=i[0],s=i[1],l=s;if(r&&r.getRepositoriesList().has(a)){var c=r.getRepositoriesList().get(a);o=b().createElement(O.Avatar,{style:{fontSize:12,height:24,width:24,fontWeight:500}},c.getLettersBadge()),l=c.getLabel()+s}return b().createElement(O.Chip,{style:{margin:"0 3px 4px 0"},labelStyle:{lineHeight:"24px"},title:l,onClick:function(){n(s,a),t.dismiss()}},o,s)}))))},render:function(){var e=this,t=this.props,o=t.pydio,r=t.submitValue,n=this.state,i=n.newFolderFormOpen,a=n.dataModel,s=n.newFolderInput,l=this.buildWsSelector();return b().createElement("div",{style:{width:"100%"}},G.RecentPlaces&&G.RecentPlaces.length>0&&b().createElement(V,{recentPlaces:G.RecentPlaces,pydio:o,submitValue:r,dismiss:function(){return e.dismiss()}}),l,b().createElement(O.Paper,{zDepth:0,style:{height:300,overflowX:"auto",color:"var(--md-sys-color-on-surface-variant)",fontSize:14,padding:"6px 0px",backgroundColor:"var(--md-sys-color-surface-variant)",marginTop:4,borderBottom:"1px solid #e0e0e0",borderRadius:"2px 2px 0 0"}},b().createElement("div",{style:{marginTop:-6,marginLeft:-5}},b().createElement(H,{pydio:o,dataModel:a,onNodeSelected:this.onNodeSelected.bind(this),showRoot:!0,draggable:!1,rootLabel:o.MessageHash["action.copymove.root"],getItemStyle:function(e){return a.getContextNode()===e?{fontWeight:500,backgroundColor:"var(--md-sys-color-secondary)",color:"var(--md-sys-color-on-secondary)"}:{}},getRightIcon:function(t){return a.getContextNode()===t?b().createElement(O.IconButton,{iconClassName:"mdi mdi-folder-plus",style:{height:18,width:18,padding:0,marginRight:0},iconStyle:{opacity:.5,fontSize:18},tooltip:o.MessageHash[154],tooltipPosition:"bottom-left",onClick:function(){return e.toggleNewFolderForm()}}):null}}))),b().createElement(O.Paper,{className:"bezier-transitions",zDepth:0,style:{position:"relative",height:i?60:0,overflow:i?"visible":"hidden",opacity:i?1:0,padding:0,marginTop:i?0:4}},b().createElement(A,{fullWidth:!0,floatingLabelText:o.MessageHash[173],ref:"newfolder_input",variant:"v2",value:s,onKeyDown:function(t){"Enter"===t.key&&s&&e.createNewFolder()},onChange:function(t,o){return e.setState({newFolderInput:o})}}),b().createElement("div",{style:{position:"absolute",bottom:-2,right:0}},b().createElement(O.IconButton,{iconClassName:"mdi mdi-check",iconStyle:{color:"#546E7A"},tooltip:this.props.pydio.MessageHash[48],onClick:function(){e.createNewFolder()}}),b().createElement(O.IconButton,{iconClassName:"mdi mdi-close",iconStyle:{color:"#546E7A"},tooltip:this.props.pydio.MessageHash[54],onClick:function(){return e.toggleNewFolderForm()}}))))}});function J(e){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J(e)}function Y(){return Y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},Y.apply(this,arguments)}function K(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,n=function(e,t){if("object"!==J(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,"string");if("object"!==J(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===J(n)?n:String(n)),r)}var n}function X(e,t){return X=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},X(e,t)}function $(e){return $=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},$(e)}G.RecentPlaces=[];var Q=x().requireLib("boot"),Z=Q.ActionDialogMixin,ee=Q.AsyncComponent,te=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&X(e,t)}(a,e);var t,o,r,n,i=(r=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=$(r);if(n){var o=$(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===J(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),i.apply(this,arguments)}return t=a,(o=[{key:"render",value:function(){var e=this.props,t=e.tabs,o=e.dismiss,r=e.muiTheme,n=r.borderRadius,i=r.palette.mui3;return b().createElement("div",{style:{display:"flex",borderRadius:"".concat(n,"px ").concat(n,"px 0 0"),overflow:"hidden",borderBottom:"1px solid "+i["outline-variant-50"]}},b().createElement(O.Tabs,{style:{flex:1},inkBarStyle:{backgroundColor:r.tabs.selectedTextColor}},t),b().createElement(O.IconButton,{iconStyle:{color:r.tabs.selectedTextColor},iconClassName:"mdi mdi-close",onClick:o,tooltip:"Close"}))}}])&&K(t.prototype,o),Object.defineProperty(t,"prototype",{writable:!1}),a}(b().Component);te=(0,_.muiThemeable)()(te);var oe=n()({displayName:"UploadDialog",mixins:[Z],getDefaultProps:function(){return{dialogTitle:"",dialogSize:x().getInstance().UI.MOBILE_EXTENSIONS?"md":"lg",dialogPadding:!1,dialogIsModal:!1}},getInitialState:function(){var e,t=this.props.pydio.Registry.getActiveExtensionByType("uploader").filter((function(e){return e.moduleName}));return t.sort((function(e,t){return e.order-t.order})),t.length&&(e=t[0]),{uploaders:t,current:e,loaded:!1}},render:function(){var e=this,t=[],o=b().createElement("div",{style:{height:360}}),r=function(){e.dismiss()},n=this.state,i=n.uploaders,a=n.current,s=n.loaded;if(i.map((function(o){t.push(b().createElement(O.Tab,{label:o.xmlNode.getAttribute("label"),key:o.id,onActive:function(){e.setState({current:o})},style:{textTransform:"none"}}))})),a){var l=a.moduleName.split(".");o=b().createElement(ee,Y({pydio:this.props.pydio,namespace:l[0],componentName:l[1],onDismiss:r,showDismiss:1===t.length,onLoad:function(){e.setState({loaded:!0})}},this.props.uploaderProps))}return b().createElement("div",{style:{width:"100%"}},t.length>1&&b().createElement(te,{tabs:t,dismiss:r}),o,!s&&b().createElement("div",{style:{padding:"100px 40px",textAlign:"center",color:"rgba(0,0,0,.5)"}},this.props.pydio.MessageHash[466]))}});const re=require("pydio/model/meta-node-provider");var ne=o.n(re),ie=o(880),ae=o.n(ie);const se=require("pydio/model/cell");var le=o.n(se),ce=o(880);function ue(e){return function(t,o,r,n){var i=e.user.getActiveRepositoryObject().getSlug(),a=i;if(n){var s=e.user.getRepositoriesList().get(n);s&&(a=s.getSlug())}var l=o.getSelectedNodes(),c={nodes:l.map((function(e){return i+e.getPath()})),target:a+r,targetParent:!0};ce.getRestClient().userJob(t,c).then((function(o){"move"===t?l.forEach((function(t){var r=e.MessageHash["background.move."+(t.isLeaf()?"file":"folder")];t.getMetadata().set("pending_operation",r),t.getMetadata().set("pending_operation_uuid",o.JobUuid),t.notify("meta_replaced",t)})):e.UI.displayMessage("SUCCESS",e.MessageHash["background.copy.selection"]),e.getContextHolder().setSelectedNodes([])})).catch((function(t){var o=t.Detail||t.message||t;e.UI.displayMessage("ERROR",o)}))}}function de(e){return de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},de(e)}function pe(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,n=function(e,t){if("object"!==de(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,"string");if("object"!==de(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===de(n)?n:String(n)),r)}var n}function fe(e,t){return fe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},fe(e,t)}function ge(e){return ge=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ge(e)}var he=o(689),ye=o(455),me=ye.FontIcon,ve=ye.ListItem,be=ye.List,we=ye.FlatButton,xe=ye.Subheader,Ce=o(757),Ee=o(603),Se=Ce.requireLib("boot").ActionDialogMixin,Pe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fe(e,t)}(a,e);var t,o,r,n,i=(r=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ge(r);if(n){var o=ge(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===de(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e)).state={roots:[]},t}return t=a,o=[{key:"componentDidMount",value:function(){var e=this,t=this.props.cellWs,o=new S.MetaServiceApi(ae().getRestClient()),r=new S.RestGetBulkMetaRequest,n=t.getSlug();console.log(n),r.NodePaths=[n,n+"/*"],o.getBulkMeta(r).then((function(t){var o=t.Nodes||[],r=null,i=[];o.forEach((function(e){if(e.Path===n+"/")r=ne().parseTreeNode(e,n);else{var t=ne().parseTreeNode(e,n);t.isLeaf()||i.push(t)}})),r.getMetadata().has("virtual_root")?(console.log(i),e.setState({roots:i})):(console.log(r),e.setState({roots:[r]}))}))}},{key:"move",value:function(e){var t=this.props,o=t.source,r=t.cellWs,n=t.pydio,i=t.dropEffect,a=ue(Ce.getInstance()),s=n.getContextHolder();if(-1===s.getSelectedNodes().indexOf(o)){var l=new Ee;l.setContextNode(s.getContextNode()),l.setSelectedNodes([o]),a(i,l,e.getPath(),r.getId())}else a(i,s,e.getPath(),r.getId());this.props.onDismiss()}},{key:"share",value:function(){var e=this,t=this.props,o=t.source,r=t.cellWs,n=t.pydio,i=new(le());i.load(r.getId()).then((function(){i.addRootNode(o),i.save().then((function(){e.props.onDismiss(),n.triggerRepositoryChange(r.getId())}))}))}},{key:"render",value:function(){var e=this,t=this.props,o=t.source,r=t.cellWs,n=t.dropEffect,i=t.pydio,a=t.muiTheme,s=this.state.roots,l=function(e){return i.MessageHash["openother.drop.cell."+e]||e},c=[];c.push(he.createElement(ve,{onClick:function(){e.share()},primaryText:o.isLeaf()?l("file.share"):l("folder.share"),secondaryText:l("share.legend").replace("%s",r.getLabel()),leftIcon:he.createElement(me,{style:{color:a.palette.primary1Color},className:"mdi mdi-share-variant"})}));var u=o.isLeaf()?"file":"folder",d=l(u+"."+n);return s.forEach((function(t){var o=l("copymove.legend").replace("%s",r.getLabel());"/"!==t.getPath()&&""!==t.getPath()&&(o+="/"+t.getLabel()),c.push(he.createElement(ve,{onClick:function(){e.move(t)},primaryText:d,secondaryText:o,leftIcon:he.createElement(me,{style:{color:a.palette.primary1Color},className:"mdi mdi-folder-"+("copy"===n?"plus":"move")})}))})),he.createElement(be,{style:{maxHeight:320,overflowY:"scroll",width:"100%",borderTop:"1px solid #e0e0e0"}},he.createElement(xe,{style:{overflow:"hidden",whiteSpace:"nowrap",paddingRight:16,textOverflow:"ellipsis"}},l("picker").replace("%s",o.getLabel())),c)}}],o&&pe(t.prototype,o),Object.defineProperty(t,"prototype",{writable:!1}),a}(he.Component);Pe=(0,_.muiThemeable)()(Pe);var Re=n()({displayName:"CrossWsDropDialog",propTypes:{pydio:a().instanceOf(Ce),selection:a().instanceOf(Ee)},mixins:[Se],getButtons:function(e){var t=[],o=this.props.pydio.MessageHash;return t.push(he.createElement(we,{label:o[54],primary:!0,keyboardFocused:!0,onClick:this.props.onDismiss})),t},getDefaultProps:function(){return{dialogIsModal:!1,dialogSize:"sm",dialogPadding:0}},render:function(){return he.createElement(Pe,this.props)}}),Oe=Pydio.requireLib("boot").PromptValidators;function _e(e){return _e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_e(e)}function Te(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,n=function(e,t){if("object"!==_e(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,"string");if("object"!==_e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===_e(n)?n:String(n)),r)}var n}function Ne(e,t){return Ne=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ne(e,t)}function Me(e){return Me=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Me(e)}var Ie=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ne(e,t)}(a,e);var t,o,r,n,i=(r=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Me(r);if(n){var o=Me(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===_e(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e)).state={},t}return t=a,(o=[{key:"render",value:function(){var e=this,t=this.props,o=t.onChange,r=t.messages,n=this.state.checked,i=": "+r["action.delete.permanently.warning"];return b().createElement("div",{style:{marginTop:16}},b().createElement(O.Checkbox,{onCheck:function(t,r){e.setState({checked:r}),o("removePermanently",r)},label:r["action.delete.permanently"]+(n?i:""),labelPosition:"right",labelStyle:n?{color:"#f44336"}:{color:"inherit"}}))}}])&&Te(t.prototype,o),Object.defineProperty(t,"prototype",{writable:!1}),a}(b().Component);const je=require("pydio/util/path");var Le=o.n(je),Ue=function(e,t){var o=x().getInstance();if(e||(e=o.getUserSelection().getUniqueNode()),-1!==t.indexOf("/"))throw new Error(o.MessageHash["filename.forbidden.slash"]);var r=o.user.getActiveRepositoryObject().getSlug()+e.getPath(),n={nodes:[r],target:Le().getDirname(r)+"/"+t,targetParent:!1};ae().getRestClient().userJob("move",n).then((function(r){var n=o.MessageHash["rename.processing"].replace("%1",e.getLabel()).replace("%2",t);o.UI.displayMessage("SUCCESS",n),e.getMetadata().set("pending_operation",n),e.getMetadata().set("pending_operation_uuid",r.JobUuid),e.notify("meta_replaced",e),o.getContextHolder().setSelectedNodes([])})).catch((function(e){var t=e.Detail||e.message||e;o.UI.displayMessage("ERROR",t)}))},De=o(757).requireLib("components").DNDActionParameter,ke=o(880);function Ae(e){return function(){var t=e.getUserSelection();ke.getClient().downloadSelection(t)}}var Fe=o(180),He=o(262),qe=o(763);function Be(e){return function(){e.UI.openComponentInModal("FSActions","OtherEditorPickerDialog",{selection:e.getUserSelection(),pydio:e})}}var We=o.g.pydio,ze={ls:function(e){return function(){e.goTo(e.getUserSelection().getUniqueNode())}}(We),mkdir:function(e){return function(){var t=[Oe.Empty,Oe.NoSlash,Oe.MustDifferSiblings()];e.UI.openComponentInModal("PydioReactUI","PromptDialog",{dialogTitleId:154,legendId:155,fieldLabelId:173,dialogSize:"sm",submitValue:function(t){if(-1!==t.indexOf("/")){var o=e.MessageHash["filename.forbidden.slash"];throw e.UI.displayMessage("ERROR",o),new Error(o)}var r=new S.TreeServiceApi(ae().getRestClient()),n=new S.RestCreateNodesRequest,i=e.user.getActiveRepositoryObject().getSlug()+E().trimRight(e.getContextNode().getPath(),"/")+"/"+t,a=new S.TreeNode;a.Path=i,a.Type=S.TreeNodeType.constructFromObject("COLLECTION"),n.Nodes=[a],r.createNodes(n).then((function(e){console&&console.debug("Created nodes",e.Children)}))},warnSpace:!0,validate:function(e){t.forEach((function(t){return t(e)}))}})}}(We),deleteAction:function(e){var t=e.MessageHash;return function(){var o,r=t[176],n=e.getPluginConfigs("access.gateway").get("DELETE_ALLOW_PERMANENT");"true"===e.getContextHolder().getRootNode().getMetadata().get("ws_skip_recycle")||0===e.getContextHolder().getContextNode().getPath().indexOf("/recycle_bin")?r=t[177]:n&&(o={removePermanently:function(e){return b().createElement(Ie,{onChange:e,messages:t})}}),e.UI.openComponentInModal("PydioReactUI","ConfirmDialog",{message:r,dialogTitleId:7,moreComponents:o,validCallback:function(t){var o=e.getContextHolder().getSelectedNodes(),r=e.user.getActiveRepositoryObject().getSlug(),n=new S.RestDeleteNodesRequest,i=new S.TreeServiceApi(ae().getRestClient());n.Nodes=o.map((function(e){var t=new S.TreeNode;return t.Path=r+e.getPath(),t})),t&&t.removePermanently&&(n.RemovePermanently=!0),i.deleteNodes(n).then((function(t){t.DeleteJobs&&t.DeleteJobs.length&&o.forEach((function(e){e.getMetadata().set("pending_operation",t.DeleteJobs[0].Label),e.getMetadata().set("pending_operation_uuid",t.DeleteJobs[0].Uuid),e.notify("meta_replaced",e)})),e.getContextHolder().setSelectedNodes([])})).catch((function(t){e.UI.displayMessage("ERROR",t.Title||t.message)}))}})}}(We),rename:function(){var e=x().getInstance().getUserSelection().getSelectedNodes()[0];if(e){var t=e.notify("node_action",{type:"prompt-rename",callback:function(t){Ue(e,t)}});t&&!0===t[0]||!e.getParent()||e.getParent().notify("child_node_action",{type:"prompt-rename",child:e,callback:function(t){Ue(e,t)}})}},renameCallback:Ue,applyCopyOrMove:ue(We),copy:function(e){var t=e.MessageHash;return function(){var o=e.getUserSelection();e.UI.openComponentInModal("FSActions","TreeDialog",{isMove:!1,dialogTitle:t[159],submitValue:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;ue(e)("copy",o,t,r)}})}}(We),move:function(e){var t=e.MessageHash,o=function(e,t){var o=t.getMetadata().has("repository_id");if(t.getMetadata().has("local:dropFunc"))t.getMetadata().has("local:canDropFunc")&&t.getMetadata().get("local:canDropFunc")(e,t);else{if(t.isLeaf()||t.getPath()===e.getPath()||!o&&E().trimRight(t.getPath(),"/")===Le().getDirname(e.getPath()))throw new Error("Cannot drop on leaf or on same path");if(t.getMetadata().has("virtual_root"))throw new Error("Cannot drop on virtual root");if(e.getMetadata().has("ws_root"))throw new Error("Cannot move roots around");if("true"===t.getMetadata().get("node_readonly")||t.getMetadata().has("workspaceEntry")&&!t.getMetadata().get("workspaceEntry").allowCrossRepositoryCopy)throw new Error("Cannot drop on this branch (readonly)")}};return function(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(n&&n instanceof Array&&n.length&&n[0]instanceof De&&(n=n[0]),n&&n instanceof De){if(n.getStep()===De.STEP_CAN_DROP){var i=n.getTarget(),a=n.getSource();return o(a,i),!1}if(n.getStep()===De.STEP_END_DRAG){try{o(n.getSource(),n.getTarget())}catch(e){return}var s=r.getDataModel(),l=n.getTarget().getPath(),c=null;if(n.getTarget().getMetadata().has("repository_id")){c=n.getTarget().getMetadata().get("repository_id");var u=n.getTarget().getMetadata().get("workspaceEntry");if(u&&"cell"===u.getRepositoryType())return void e.UI.openComponentInModal("FSActions","CrossWsDropDialog",{target:n.getTarget(),source:n.getSource(),dropEffect:n.getDropEffect()||"move",cellWs:u})}else if(n.getTarget().getMetadata().has("local:dropFunc"))return void n.getTarget().getMetadata().get("local:dropFunc")("dnd",n.getSource(),n.getTarget());var d=ue(e),p=n.getSource();if(-1===s.getSelectedNodes().indexOf(p)){var f=new PydioDataModel;f.setContextNode(s.getContextNode()),f.setSelectedNodes([n.getSource()]),d(n.getDropEffect()||"move",f,l,c)}else d(n.getDropEffect()||"move",s,l,c)}}else{var g=e.getUserSelection();e.UI.openComponentInModal("FSActions","TreeDialog",{isMove:!0,dialogTitle:t[160],submitValue:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;ue(e)("move",g,t,o)}})}}}(We),upload:function(e){return function(t,o){var r={};o&&o.length&&(r={uploaderProps:o[0]}),e.UI.openComponentInModal("FSActions","UploadDialog",r)}}(We),download:Ae(We),downloadPDF:function(e){return function(){var t=e.getUserSelection().getUniqueNode(),o=ae().getClient(),r=Le().getBasename(t.getPath()).replace(t.getAjxpMime(),"pdf"),n=navigator.userAgent||"",i=-1!==n.indexOf("iPhone")||-1!==n.indexOf("iPod")||-1!==n.indexOf("iPad")||-1!==n.indexOf("iOs"),a=e.UI&&e.UI.hasHiddenDownloadForm();o.buildPresignedGetUrl(t,null,"",{Bucket:"io",Key:"pydio-thumbstore/"+t.getMetadata().get("PDFPreview"),Expires:600},r).then((function(t){i||!a?document.location.href=t:e.UI.sendDownloadToHiddenForm(e.getUserSelection(),{presignedUrl:t})}))}}(We),downloadAll:function(e){return function(){var t=e.getContextHolder();t.setSelectedNodes([t.getRootNode()]),Ae(e)()}}(We),emptyRecycle:function(e){var t=e.MessageHash;return function(){e.UI.openComponentInModal("PydioReactUI","ConfirmDialog",{message:t[177],dialogTitleId:220,validCallback:function(){var t=e.user.getActiveRepositoryObject().getSlug(),o=new S.RestDeleteNodesRequest,r=new S.TreeServiceApi(ae().getRestClient()),n=new S.TreeNode;n.Path=t+"/recycle_bin",o.Nodes=[n],r.deleteNodes(o).then((function(t){t.DeleteJobs&&t.DeleteJobs.forEach((function(t){e.UI.displayMessage("SUCCESS",t.Label)})),e.getContextHolder().requireContextChange(e.getContextHolder().getRootNode())})).catch((function(t){e.UI.displayMessage("ERROR",t.Title||t.message)}))}})}}(We),restore:function(e){return function(){var t=e.getContextHolder().getSelectedNodes(),o=e.user.getActiveRepositoryObject().getSlug(),r=new S.RestRestoreNodesRequest,n=new S.TreeServiceApi(ae().getRestClient());r.Nodes=t.map((function(e){var t=new S.TreeNode;return t.Path=o+e.getPath(),t})),n.restoreNodes(r).then((function(o){o.RestoreJobs&&o.RestoreJobs.length&&t.forEach((function(e){o.RestoreJobs.forEach((function(t){t.NodeUuid===e.getMetadata().get("uuid")&&(e.getMetadata().set("pending_operation",t.Label),e.getMetadata().set("pending_operation_uuid",t.Uuid),e.notify("meta_replaced",e))}))})),e.getContextHolder().setSelectedNodes([])}))}}(We),openInEditor:e(We),ajxpLink:function(e){return function(){var t,o=He.getUrlFromBase(),r=e.repositoryId||(e.user?e.user.activeRepository:null);if(e.user){var n=e.user.repositories.get(r).getSlug();n&&(r="ws-"+n)}t=qe.trimRight(o,"/")+"/"+r+e.getUserSelection().getUniqueNode().getPath(),e.UI.openComponentInModal("PydioReactUI","PromptDialog",{dialogTitleId:369,fieldLabelId:296,defaultValue:t,submitValue:Fe.Empty})}}(We),openOtherEditorPicker:Be(We),lock:function(e){return function(){var t=new S.UserMetaServiceApi(ae().getRestClient()),o=new S.IdmUpdateUserMetaRequest,r=e.getContextHolder().getUniqueNode(),n=new S.IdmUserMeta;n.NodeUuid=r.getMetadata().get("uuid"),n.Namespace="content_lock",n.JsonValue=e.user.id;var i=r.getMetadata().get("sl_locked");o.Operation=i?"DELETE":"PUT",o.MetaDatas=[n],t.updateUserMeta(o).then((function(t){e.getContextHolder().requireNodeReload(r)}))}}(We),goTo:function(e){return function(){var t=e.getContextHolder().getUniqueNode();e.goTo(t)}}(We)};function Ve(e){return Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ve(e)}function Ge(){Ge=function(){return e};var e={},t=Object.prototype,o=t.hasOwnProperty,r=Object.defineProperty||function(e,t,o){e[t]=o.value},n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",s=n.toStringTag||"@@toStringTag";function l(e,t,o){return Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,o){return e[t]=o}}function c(e,t,o,n){var i=t&&t.prototype instanceof p?t:p,a=Object.create(i.prototype),s=new P(n||[]);return r(a,"_invoke",{value:x(e,o,s)}),a}function u(e,t,o){try{return{type:"normal",arg:e.call(t,o)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var d={};function p(){}function f(){}function g(){}var h={};l(h,i,(function(){return this}));var y=Object.getPrototypeOf,m=y&&y(y(R([])));m&&m!==t&&o.call(m,i)&&(h=m);var v=g.prototype=p.prototype=Object.create(h);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function n(r,i,a,s){var l=u(e[r],e,i);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==Ve(d)&&o.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(d).then((function(e){c.value=e,a(c)}),(function(e){return n("throw",e,a,s)}))}s(l.arg)}var i;r(this,"_invoke",{value:function(e,o){function r(){return new t((function(t,r){n(e,o,t,r)}))}return i=i?i.then(r,r):r()}})}function x(e,t,o){var r="suspendedStart";return function(n,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===n)throw i;return{value:void 0,done:!0}}for(o.method=n,o.arg=i;;){var a=o.delegate;if(a){var s=C(a,o);if(s){if(s===d)continue;return s}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===r)throw r="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);r="executing";var l=u(e,t,o);if("normal"===l.type){if(r=o.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:o.done}}"throw"===l.type&&(r="completed",o.method="throw",o.arg=l.arg)}}}function C(e,t){var o=t.method,r=e.iterator[o];if(void 0===r)return t.delegate=null,"throw"===o&&e.iterator.return&&(t.method="return",t.arg=void 0,C(e,t),"throw"===t.method)||"return"!==o&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+o+"' method")),d;var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function R(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(o.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:O}}function O(){return{value:void 0,done:!0}}return f.prototype=g,r(v,"constructor",{value:g,configurable:!0}),r(g,"constructor",{value:f,configurable:!0}),f.displayName=l(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,l(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(w.prototype),l(w.prototype,a,(function(){return this})),e.AsyncIterator=w,e.async=function(t,o,r,n,i){void 0===i&&(i=Promise);var a=new w(c(t,o,r,n),i);return e.isGeneratorFunction(o)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(v),l(v,s,"Generator"),l(v,i,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),o=[];for(var r in t)o.push(r);return o.reverse(),function e(){for(;o.length;){var r=o.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(o,r){return a.type="throw",a.arg=e,t.next=o,r&&(t.method="next",t.arg=void 0),!!r}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(s&&l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var o=this.tryEntries[t];if(o.finallyLoc===e)return this.complete(o.completion,o.afterLoc),S(o),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var o=this.tryEntries[t];if(o.tryLoc===e){var r=o.completion;if("throw"===r.type){var n=r.arg;S(o)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,o){return this.delegate={iterator:R(e),resultName:t,nextLoc:o},"next"===this.method&&(this.arg=void 0),d}},e}function Je(e,t,o,r,n,i,a){try{var s=e[i](a),l=s.value}catch(e){return void o(e)}s.done?t(l):Promise.resolve(l).then(r,n)}function Ye(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,n=function(e,t){if("object"!==Ve(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,"string");if("object"!==Ve(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===Ve(n)?n:String(n)),r)}var n}var Ke,Xe,$e,Qe=x().requireLib("boot").PromptValidators;x().getInstance().observe("reload_node_templates",(function(){console.log("reload_node_templates"),Ke=null,$e=null,clearTimeout(Xe),x().getInstance().getController().fireContextChange()}));var Ze=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,o;return t=e,o=[{key:"dynamicBuilder",value:function(){var e=this,t=x().getInstance();if(null!==Ke&&($e=Ke),$e){var o={doc:"file-word",docx:"file-word",odt:"file-word",odg:"file-chart",odp:"file-powerpoint",ods:"file-excel",pot:"file-powerpoint",pptx:"file-powerpoint",rtf:"file-word",xls:"file-excel",xlsx:"file-excel"};return $e.map((function(r){var n;n=r.UUID&&Le().getFileExtension(r.UUID)?Le().getFileExtension(r.UUID):Le().getFileExtension(r.Label)?Le().getFileExtension(r.Label):"txt";var i="file";o[n]&&(i=o[n]);var a=r.Label;return r.Editable&&(a=React.createElement("div",{style:{display:"flex"}},React.createElement("span",{style:{flex:1}},r.Label),React.createElement("span",{onClick:function(e){e.stopPropagation(),ot.deleteTemplateByUuid(r.UUID)},className:"mdi mdi-delete",style:{opacity:.3}}))),{name:a,alt:r.Label,icon_class:"mdi mdi-"+i,callback:function(){var e,o=(e=Ge().mark((function e(o){var i,a,s,l,c,u,d,p,f,g;return Ge().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=t.user.getRepositoriesList(),a=t.getContextHolder().getContextNode(),s=i.get(t.user.activeRepository).getSlug(),l=t.MessageHash["mkfile.untitled.document"]||"Untitled",c=(c=s+a.getPath()+"/"+l+"."+n).replace("//","/"),u=Le().getDirname(c),d=et(a,Le().getBasename(c)),p=[],a.getChildren().forEach((function(e){return p.push(Le().getBasename(e.getPath()).toLowerCase())})),f=[Qe.Empty,Qe.NoSlash,Qe.MustDifferSiblings(p)],g=function(e){var t=new S.TreeServiceApi(PydioApi.getRestClient()),o=new S.RestCreateNodesRequest,n=new S.TreeNode;n.Path=u+"/"+e,n.Type=S.TreeNodeType.constructFromObject("LEAF"),o.Nodes=[n],o.TemplateUUID=r.UUID,t.createNodes(o).then((function(e){}))},t.UI.openComponentInModal("PydioReactUI","PromptDialog",{dialogTitleId:156,legendId:r.Label,fieldLabelId:174,dialogSize:"sm",defaultValue:d,defaultInputSelection:!0,submitValue:g,warnSpace:!0,validate:function(e){f.forEach((function(t){return t(e)}))}});case 13:case"end":return e.stop()}}),e)})),function(){var t=this,o=arguments;return new Promise((function(r,n){var i=e.apply(t,o);function a(e){Je(i,r,n,a,s,"next",e)}function s(e){Je(i,r,n,a,s,"throw",e)}a(void 0)}))});return function(e){return o.apply(this,arguments)}}().bind(e)}}))}return Xe&&clearTimeout(Xe),new S.TemplatesServiceApi(PydioApi.getRestClient()).listTemplates().then((function(e){$e=e.Templates.filter((function(e){return"LEAF"===e.Node.Node.Type}));var o=new S.RestTemplate;o.Label=t.MessageHash["mkfile.empty.template.label"]||"Empty File",o.UUID="",$e.unshift(o),$e.sort((function(e,t){return e.Editable?-1:t.Editable?1:e<=t})),Ke=$e,Xe=setTimeout((function(){Ke=null}),2e3),x().getInstance().getController().fireContextChange()})),[]}}],null&&Ye(t.prototype,null),o&&Ye(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function et(e,t){for(var o=e.getChildren(),r=function(e){var t=!1;return o.forEach((function(o){o.getLabel()===e&&(t=!0)})),t},n=t.lastIndexOf("."),i=t.substring(0,n),a=t.substring(n),s=t,l=1,c=r(s);c;)s=i+"-"+l+a,l++,c=r(s);return s}var tt=o.g.pydio,ot={mkfileDynamicBuilder:Ze.dynamicBuilder,downloadSelectionChange:function(e){return function(){var t=e.getUserSelection();e.Parameters.get("zipEnabled")&&e.Parameters.get("multipleFilesDownloadEnabled")||t.hasDir()&&(this.selectionContext.dir=!1)}}(tt),downloadAllInit:function(e){return function(){e.Parameters.get("zipEnabled")&&e.Parameters.get("multipleFilesDownloadEnabled")||(this.hide(),e.Controller.actions.delete("download_all"))}}(tt),compressUiSelectionChange:function(e){return function(){var t=e.getUserSelection();e.Parameters.get("zipEnabled")&&e.Parameters.get("multipleFilesDownloadEnabled")||(t.isUnique()?this.selectionContext.multipleOnly=!0:this.selectionContext.unique=!0)}}(tt),copyContextChange:function(e){return function(){this.rightsContext.write=!0;var t=e.user;t&&t.canRead()&&t.canCrossRepositoryCopy()&&t.hasCrossRepositories()&&(this.rightsContext.write=!1,t.canWrite()||(e.getController().defaultActions.delete("ctrldragndrop"),e.getController().defaultActions.delete("dragndrop"))),t&&t.canWrite()&&e.getContextNode().hasAjxpMimeInBranch("ajxp_browsable_archive")&&(this.rightsContext.write=!1),e.getContextNode().hasAjxpMimeInBranch("ajxp_browsable_archive")?this.setLabel(247,248):this.setLabel(66,159)}}(tt),openWithDynamicBuilder:function(e){var t=Be(e),o=e.MessageHash;return function(){var r=[];if(e.getUserSelection().isEmpty())return r;var n=e.getUserSelection().getUniqueNode(),i=Le().getAjxpMimeType(n),a="true"===n.getMetadata().get("node_readonly"),s=e.user;if(s&&s.getPreference("gui_preferences",!0)&&s.getPreference("gui_preferences",!0).other_editor_extensions){var l=s.getPreference("gui_preferences",!0).other_editor_extensions;Object.keys(l).forEach(function(t){var o;e.Registry.getActiveExtensionByType("editor").forEach((function(e){e.editorClass===l[t]&&(o=e)})),o&&-1===o.mimes.indexOf(t)&&o.mimes.push(t)}.bind(this))}var c=e.Registry.findEditorsForMime(i),u=0,d=!1;return c.length&&c.forEach(function(e){!e.openable||e.write&&a||(e.mimes.indexOf("*")>-1&&(!d&&u>0&&r.push({separator:!0}),d=!0),r.push({name:e.text,alt:e.title,isDefault:0===u,icon_class:e.icon_class,callback:function(t){this.apply([e])}.bind(this)}),u++)}.bind(this)),r.length&&!d&&r.push({separator:!0}),r.push({name:o["openother.1"],alt:o["openother.2"],isDefault:0===u,icon_class:"mdi mdi-view-list",callback:t}),r}}(tt),lockSelectionChange:function(e){return function(){var t=e.getController().getActionByName("sl_lock"),o=e.getUserSelection().getUniqueNode();t&&o&&(t.selectionContext.allowedMimes=[],o.getMetadata().get("sl_locked")?(t.setIconClassName("mdi mdi-lock-outline"),t.setLabel("meta.simple_lock.3"),o.getMetadata().get("sl_mylock")||(t.selectionContext.allowedMimes=["fake_extension_that_never_exists"])):(t.setIconClassName("mdi mdi-lock-outline"),t.setLabel("meta.simple_lock.1")))}}(tt),deleteTemplateByUuid:function(){}}})(),window.FSActions=r})();