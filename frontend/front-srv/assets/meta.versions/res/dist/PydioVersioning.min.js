(()=>{"use strict";var e={880:e=>{e.exports=require("pydio/http/api")},6:e=>{e.exports=require("pydio/model/node")}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{r.r(n),r.d(n,{Callbacks:()=>T,HistoryDialog:()=>q,InfoPanel:()=>V});const e=require("pydio");var t=r.n(e);const o=require("react");var i=r.n(o);const a=require("create-react-class");var s=r.n(a);const c=require("pydio/model/meta-node-provider");var l=r.n(c);const u=require("react-markdown");var f=r.n(u);const p=require("pydio/util/path");var d=r.n(p);const y=require("lodash.debounce");var v=r.n(y);function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==b(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==b(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===b(o)?o:String(o)),n)}var o}function g(e,t){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},g(e,t)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e){return w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},w(e)}var O=r(880),P=r(6),S=t().requireLib("components"),j=S.Timeline,_=S.UserAvatar,E=t().requireLib("boot").moment,M=function(e){var r=e.href,n=e.children;if(r.startsWith("user://")){var o=r.replace("user://","");return i().createElement(_,{userId:o,displayAvatar:!1,richOnClick:!1,style:{display:"inline-block",fontWeight:500},pydio:t().getInstance()})}return i().createElement("span",null,n)},k=function(e){var t=e.children;return i().createElement("span",null,t)};const C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&g(e,t)}(c,e);var r,n,o,a,s=(o=c,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=w(o);if(a){var r=w(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}(this,e)});function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=s.call(this,e)).state={loading:!0,revs:[],selection:e.preselection},t._bload=v()(t.load.bind(h(t)),1500),t.load(),t}return r=c,(n=[{key:"componentDidUpdate",value:function(e,t,r){e.node!==this.props.node&&(e.node&&e.node.stopObserving("node_replaced",this._bload),this.props.node&&this.props.node.observe("node_replaced",this._bload),this.load())}},{key:"getMessage",value:function(e){return t().getMessages()["meta.versions."+e]||e}},{key:"load",value:function(){var e=this,t=this.props.node,r=new(l())({versions:"true",file:t.getPath(),silent:!0}),n=new P("/",!1,"Versions","folder.png",r);this.setState({empty:!1}),r.loadNode(n,(function(t){var r=[];t.getChildren().forEach((function(e){return r.push(e)})),e.setState({loading:!1,revs:r,empty:!r.length})}))}},{key:"applyAction",value:function(e,t){var r=this.props,n=r.node,o=r.onRequestClose;switch(e){case"dl":O.getClient().openVersion(n,t.getMetadata().get("versionId"));break;case"revert":if(!confirm(this.getMessage("13")))return;O.getClient().revertToVersion(n,t.getMetadata().get("versionId"),(function(){o&&o()}))}}},{key:"itemActions",value:function(e,t,r){var n=this;return t?[{onClick:function(){return n.applyAction("dl",e)},label:this.getMessage("3")},{onClick:function(){return n.applyAction("revert",e)},label:this.getMessage("7")}]:[]}},{key:"itemAnnotations",value:function(e,t,r){var n,o=parseInt(e.getMetadata().get("bytesize"));if(r){var a=parseInt(r.getMetadata().get("bytesize"));n=a===o?"right":a>o?"bottom-right":"top-right"}return i().createElement("div",{className:"tl-annotation"},n&&i().createElement("span",{className:"tl-annotation-dir mdi mdi-arrow-"+n}),d().roundFileSize(o))}},{key:"render",value:function(){var e=this.state,r=e.loading,n=e.revs,o=e.selection,a=e.empty;if(r)return i().createElement("div",{style:{textAlign:"center",fontWeight:500,opacity:.3,padding:20}},t().getMessages()[466]);if(a)return i().createElement("div",{style:{textAlign:"center",fontWeight:500,opacity:.3,padding:20,paddingBottom:30}},this.getMessage("14"));var s=this.props,c=s.className,l=void 0===c?"":c,u=s.onClick;return i().createElement(j,{items:n,className:l,useSelection:!0,preSelection:o,onItemSelect:u,itemUuid:function(e){return e.getMetadata().get("versionId")},itemMoment:function(e){return E(1e3*e.getMetadata().get("ajxp_modiftime"))},itemDesc:function(e){return i().createElement(f(),{source:e.getMetadata().get("versionDescription"),renderers:{link:M,paragraph:k}})},itemActions:this.itemActions.bind(this),itemAnnotations:this.itemAnnotations.bind(this),color:"#2196f3"})}}])&&m(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),c}(o.Component);var x=t().requireLib("boot"),q=s()({displayName:"HistoryDialog",mixins:[x.ActionDialogMixin,x.SubmitButtonProviderMixin],getDefaultProps:function(){return{dialogTitle:t().getMessages()["meta.versions.2"],dialogIsModal:!1,dialogSize:"lg",dialogPadding:!1}},submit:function(){this.dismiss()},render:function(){var e,t=this.props,r=t.node,n=t.args;return n&&n.length>0&&(e=n[0]),i().createElement("div",{style:{width:"100%"},className:"layout-fill vertical-layout"},i().createElement("div",{style:{display:"flex",flexDirection:"column",color:"rgba(0,0,0,.87)"},className:"version-history"},i().createElement(C,{node:r,preselection:e,onRequestClose:this.dismiss.bind(this)})))}});function A(e){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(e)}function I(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==A(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==A(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===A(o)?o:String(o)),n)}var o}var T=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var r,n;return r=e,n=[{key:"loadHistoryBrowser",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];pydio.UI.openComponentInModal("PydioVersioning","HistoryDialog",{node:t().getInstance().getContextHolder().getUniqueNode(),args:r})}}],null&&I(r.prototype,null),n&&I(r,n),Object.defineProperty(r,"prototype",{writable:!1}),e}();function R(e){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R(e)}function D(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==R(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==R(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===R(o)?o:String(o)),n)}var o}function N(e,t){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},N(e,t)}function B(e){return B=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},B(e)}var H=t().requireLib("boot").PydioContextConsumer,L=t().requireLib("workspaces").InfoPanelCard,U=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&N(e,t)}(c,e);var r,n,o,a,s=(o=c,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=B(o);if(a){var r=B(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===R(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function c(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),s.apply(this,arguments)}return r=c,(n=[{key:"render",value:function(){var e=this.props.node;return e&&e.getMetadata().has("datasource_versioning")?i().createElement(L,{identifier:"meta-versions",style:this.props.style,title:t().getMessages()["meta.versions.1"]},i().createElement(C,{node:e,className:"small",onClick:function(e){return t().getInstance().Controller.fireAction("versions_history",e)}})):null}}])&&D(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),c}(o.Component);const V=U=H(U)})(),window.PydioVersioning=n})();