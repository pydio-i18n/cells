(()=>{"use strict";var e={n:t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return e.d(i,{a:i}),i},d:(t,i)=>{for(var r in i)e.o(i,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:i[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Dashboard:()=>M});const i=require("prop-types");var r=e.n(i);const n=require("pydio");var a=e.n(n);const s=require("pydio/model/data-model");var o=e.n(s);const l=require("pydio/model/node");var d=e.n(l);const c=require("react");var p=e.n(c);const u=require("create-react-class");var m=e.n(u);const h=require("pydio/http/api");var f=e.n(h);const g=require("cells-sdk"),y=require("material-ui");function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},v.apply(this,arguments)}p().Component;var S=a().requireLib("components").MaterialTable,b=["gateway","datasource","data","idm","scheduler","broker","frontend","discovery"];const E=m()({displayName:"ServicesList",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:r().instanceOf(PydioDataModel).isRequired,rootNode:r().instanceOf(AjxpNode).isRequired,currentNode:r().instanceOf(AjxpNode).isRequired,filter:r().string,peerFilter:r().string,details:r().bool,onUpdatePeers:r().func},getInitialState:function(){return{services:[]}},componentDidMount:function(){this.load()},reload:function(){this.load()},load:function(){var e=this,t=new g.ConfigServiceApi(f().getRestClient());a().startLoading(),this.setState({loading:!0}),t.listServices().then((function(t){if(a().endLoading(),e.setState({loading:!1}),e.setState({services:t.Services}),e.props.onUpdatePeers){var i=(r=t.Services,n={},r.filter((function(e){return!!e.RunningPeers})).map((function(e){e.RunningPeers.map((function(e){e.Address&&(n[e.Address]=e.Address)}))})),Object.keys(n));e.props.onUpdatePeers(i)}var r,n})).catch((function(){a().endLoading(),e.setState({loading:!1})}))},renderListItem:function(e){var t=[],i=this.props,r=i.details,n=i.pydio;if(r){e.Description&&t.push(e.Description);var a=e.RunningPeers;if(a&&a.length){var s=[];a.map((function(e){s.push(e.Address)})),t.push(n.MessageHash["ajxp_admin.services.service.ip"].replace("%s",s.join(",")))}}return p().createElement(y.ListItem,{primaryText:e.Name,secondaryText:t.join(" - "),leftCheckbox:p().createElement(y.Checkbox,{defaultChecked:"STARTED"===e.Status,checked:"STARTED"===e.Status})})},filterNodes:function(e){var t=this;return!(-1!==e.Name.indexOf(".(.+)")||this.props.filter&&e.Status!==this.props.filter||this.props.inputFilter&&e.Name.indexOf(this.props.inputFilter)<=0||!(!this.props.peerFilter||!!e.RunningPeers&&e.RunningPeers.filter((function(e){return e.Address===t.props.peerFilter})).length>0))},render:function(){var e=this,t=this.props.pydio,i=this.state,r=i.services,n=void 0===r?[]:r,a=i.loading,s=function(e){return t.MessageHash["ajxp_admin.services.tag."+e]||e},o=function(e){return t.MessageHash["ajxp_admin.services.column."+e]||e},l=function(e){var t={};return e.sort((function(e,t){return e.Name>t.Name?1:e.Name===t.Name?0:-1})),b.forEach((function(i){t[i]={services:{}},e.map((function(e){if(i===e.Tag){var r=e.Name;if(r.startsWith("pydio.grpc.")?r=r.replace("pydio.grpc.",""):r.startsWith("pydio.rest.")&&(r=r.replace("pydio.rest.","")),"datasource"===i&&r.startsWith("data."))if("index"===(r=r.replace("data.",""))||"sync"===r||"objects"===r)r="main - "+r;else{var n=r.split(".").shift();r=r.split(".").pop(),r="objects"===n?"objects - "+r:"datasource - "+r}t[i].services[r]||(t[i].services[r]=[]),t[i].services[r].push(e)}}))})),t}(n.filter((function(t){return e.filterNodes(t)}))),d=[],c=[{name:"Status",label:"",style:{width:56,paddingLeft:12,paddingRight:12,textOverflow:"inherit"},headerStyle:{width:56},renderCell:function(e){var t="STARTED"===e.Status?"#33691e":"#d32f2f",i="STARTED"===e.Status?"Running":"Stopped";return"STARTED"!==e.Status&&e.Metadata&&e.Metadata.unique&&(t="#9E9E9E",i="Standby"),{element:p().createElement(y.FontIcon,{style:{margin:"0 9px 0 4px",fontSize:20},className:"mdi-traffic-light",color:t}),text:i}}},{name:"Name",label:o("name"),style:{paddingLeft:0},headerStyle:{paddingLeft:0}},{name:"Description",label:o("description"),style:{width:"40%"},headerStyle:{width:"40%"},hideSmall:!0},{name:"Version",label:o("version"),style:{width:110},headerStyle:{width:110},hideSmall:!0},{name:"Type",label:o("tag"),style:{width:120},headerStyle:{width:120},hideSmall:!0,renderCell:function(e){var i=e.Name.startsWith("pydio.grpc.")?"Grpc":"Rest",r=function(e){return t.MessageHash["ajxp_admin.services.service."+e]||e};return"gateway"===e.Tag?i=e.Name.split(".").pop():"datasource"===e.Tag&&(e.Name.startsWith("pydio.grpc.data.sync.")?i=r("datasource.sync"):e.Name.startsWith("pydio.grpc.data.objects.")?i=r("datasource.objects"):e.Name.startsWith("pydio.grpc.data.index.")&&(i=r("datasource.index"))),i}},{name:"RunningPeers",label:o("peers"),hideSmall:!0,renderCell:function(e){var t=[];return"STARTED"===e.Status&&e.RunningPeers?t=e.RunningPeers.map((function(e){return e.Metadata&&e.Metadata["non-addressable"]?e.Metadata["non-addressable"]:e.Port?e.Address+":"+e.Port:e.Address})):t.push("N/A"),t.join(",")}}];Object.keys(l).forEach((function(e){var t=[],i=l[e].services;Object.keys(i).forEach((function(e){i[e].forEach((function(e){t.push(e)}))})),t.length&&(t.unshift({Subheader:p().createElement("span",null,p().createElement("span",{style:{textTransform:"uppercase"}},s(e+".title"))," - ",s(e+".description"))}),d.push.apply(d,t))}));var u=AdminComponents.AdminStyles().body,m=u.tableMaster,h=u.block.props,f=u.block.container;return p().createElement("div",{className:this.props.className,style:this.props.style},p().createElement(y.Paper,v({},h,{style:f}),p().createElement(S,{data:d,columns:c,deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:t.MessageHash["ajxp_admin.services.empty."+(a?"loading":"noservice")],masterStyles:m})))}});var x=a().requireLib("hoc"),N=x.ModernSelectField,T=x.ModernTextField;const M=m()({displayName:"Dashboard",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:r().instanceOf(o()).isRequired,rootNode:r().instanceOf(d()).isRequired,currentNode:r().instanceOf(d()).isRequired,openEditor:r().func.isRequired,openRightPane:r().func.isRequired,closeRightPane:r().func.isRequired,pydio:r().instanceOf(a())},getInitialState:function(){return{filter:"",peers:[],peerFilter:""}},onDetailsChange:function(e,t){this.setState({details:t}),localStorage.setItem("console.services.details",t?"true":"false")},onFilterChange:function(e,t,i){this.setState({filter:i})},onPeerFilterChange:function(e,t,i){this.setState({peerFilter:i})},reloadList:function(){this.refs.servicesList.reload()},onUpdatePeers:function(e){this.setState({peers:e})},render:function(){var e=this,t=this.props.pydio,i=this.state,r=i.peers,n=i.peerFilter,a=i.filter,s=i.inputFilter,o=void 0===s?"":s,l=function(e){return t.MessageHash["ajxp_admin.services."+e]||e},d=p().createElement("div",{style:{display:"flex",alignItems:"center",width:"100%"}},p().createElement("div",{style:{width:150,marginRight:8},className:"media-small-hide"},p().createElement(T,{fullWidth:!0,value:o,onChange:function(t,i){return e.setState({inputFilter:i})},hintText:l("text-filter.hint")})),r.length>0&&p().createElement("div",{style:{width:150,height:14,marginRight:8}},p().createElement(N,{fullWidth:!0,className:"media-small-hide",style:{marginTop:-10},underlineStyle:{display:"none"},value:n,onChange:this.onPeerFilterChange},p().createElement(y.MenuItem,{value:"",primaryText:l("peerfilter.title")}),r.map((function(e){return p().createElement(y.MenuItem,{value:e,primaryText:e})})))),p().createElement("div",{style:{width:150,height:14}},p().createElement(N,{fullWidth:!0,className:"media-small-hide",style:{marginTop:-10},underlineStyle:{display:"none"},value:a,onChange:this.onFilterChange},p().createElement(y.MenuItem,{value:"",primaryText:l("filter.nofilter")}),p().createElement(y.MenuItem,{value:"STARTED",primaryText:l("filter.started")}),p().createElement(y.MenuItem,{value:"STOPPED",primaryText:l("filter.stopped")})))),c=this.props.toolsAbsolute;return p().createElement("div",{className:"main-layout-nav-to-stack workspaces-board"},p().createElement("div",{className:"vertical-layout",style:{width:"100%"}},p().createElement(AdminComponents.Header,{title:c?"":this.context.getMessage("172","settings"),icon:c?"":"mdi mdi-access-point-network",legend:this.context.getMessage("173","settings"),actions:[d],reloadAction:this.reloadList.bind(this),style:c?{position:"absolute",top:0,right:0}:null}),p().createElement(E,{ref:"servicesList",pydio:t,className:"layout-fill",style:{paddingBottom:16},dataModel:this.props.dataModel,rootNode:this.props.rootNode,currentNode:this.props.rootNode,filter:a,peerFilter:n,inputFilter:o,onUpdatePeers:this.onUpdatePeers.bind(this)})))}});window.AdminServices=t})();