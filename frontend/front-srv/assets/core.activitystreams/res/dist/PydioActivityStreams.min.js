(()=>{"use strict";var e={305:e=>{e.exports=require("lodash.debounce")},455:e=>{e.exports=require("material-ui")},757:e=>{e.exports=require("pydio")},727:e=>{e.exports=require("pydio/model/meta-node-provider")}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{r.r(n),r.d(n,{ASClient:()=>d,Activity:()=>pe,ActivityList:()=>xe,Callbacks:()=>nt,InfoPanel:()=>Ie,Listener:()=>et,OverlayPanel:()=>Ct,UserPanel:()=>Qe,WatchSelector:()=>ut,WatchSelectorMui3:()=>wt});const e=require("react");var t=r.n(e),o=r(455);const i=require("prop-types");var a=r.n(i),c=r(757),l=r.n(c);const u=require("pydio/http/api");var s=r.n(u);const f=require("cells-sdk");function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==p(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===p(o)?o:String(o)),n)}var o}var d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"loadActivityStreams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"USER_ID",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"outbox",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1;if(!t)return Promise.resolve([]);var a=new f.ActivityServiceApi(s().getRestClient()),c=new f.ActivityStreamActivitiesRequest;return c.Context=e,c.ContextData=t,c.BoxName=r,o>-1&&(c.Offset=o),i>-1&&(c.Limit=i),c.Language=l().getInstance().user.getPreference("lang")||"",n&&(c.PointOfView=n),a.stream(c)}},{key:"UnreadInbox",value:function(e){var t=new f.ActivityServiceApi(s().getRestClient()),r=new f.ActivityStreamActivitiesRequest;return r.Context="USER_ID",r.ContextData=e,r.BoxName="inbox",r.UnreadCountOnly=!0,t.stream(r).then((function(e){return e.totalItems||0}))}}],null&&y(t.prototype,null),r&&y(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();const m=require("react-markdown");var b=r.n(m);const v=require("material-ui/styles"),h=require("pydio/util/path");var g=r.n(h);function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){j(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function j(e,t,r){return(t=C(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function P(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,C(n.key),n)}}function _(e,t,r){return t&&E(e.prototype,t),r&&E(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function C(e){var t=function(e,t){if("object"!==w(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===w(t)?t:String(t)}function T(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&x(e,t)}function x(e,t){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},x(e,t)}function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=k(e);if(t){var o=k(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function k(e){return k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},k(e)}var M=r(455),R=M.Paper,D=M.IconButton,H=M.FlatButton,I=M.Divider,L=r(757),W=r(305),N=r(727),B=L.requireLib("boot").PydioContextConsumer,q=(L.requireLib("workspaces").FilePreview,L.requireLib("hoc").ThemedContainers.Popover);function U(e,t){var r=[],n=t.user.getActiveRepository();if(!(e&&e.partOf&&e.partOf.items&&e.partOf.items.length))return r;for(var o=0;o<e.partOf.items.length;o++){var i=e.partOf.items[o],a=i.rel.split("/");a.shift();var c=a.join("/");0!==c.indexOf("/")&&(c="/"+c);var l=new AjxpNode(c,"Document"===e.type);if(l.getMetadata().set("repository_id",i.id),l.getMetadata().set("repository_label",i.name),l.getMetadata().set("filename",c),i.id===n)return[l];r.push(l)}return r}var F=function(e){T(n,e);var r=A(n);function n(e){var t;P(this,n),t=r.call(this,e);var o=U(e.activity.object,e.pydio);return o.length&&!o[0].isLeaf()?t.state={previewLoaded:!0,previewFailed:!1,nodes:o}:t.state={previewLoaded:!1,previewFailed:!1,nodes:o},t}return _(n,[{key:"render",value:function(){var e=this,r=this.props.pydio,n=this.state,o=n.previewLoaded,i=n.nodes,a=n.previewFailed,c=i.length?i[0]:null,l={height:200,display:"flex",alignItems:"center",justifyContent:"center",fontSize:70};if(c&&c.isLeaf())if(o&&!a);else if(o&&a)S(S({},l),{},{flexDirection:"column"});else{var u=c.getMetadata().get("repository_id"),s=c.getMetadata().get("repository_label"),f=new N;c.observeOnce("error",(function(){e.setState({previewLoaded:!0,previewFailed:!0})})),f.loadLeafNodeSync(c,(function(t){t.getMetadata().set("repository_id",u),t.getMetadata().set("repository_label",s),i[0]=t,e.setState({previewLoaded:!0,nodes:i})}),!0,{tmp_repository_id:u})}for(var p,y=[],d=r.user.getActiveRepository(),m=function(){var e=i[b],n=t().createElement("div",{style:{display:"flex",alignItems:"center",paddingLeft:10}},t().createElement("div",{style:{flex:1,fontSize:13,fontWeight:500,color:"rgba(0,0,0,0.33)"}},r.MessageHash["notification_center.16"]," ",e.getMetadata().get("repository_label")),t().createElement(D,{iconClassName:"mdi mdi-open-in-new",tooltip:r.MessageHash["notification_center.6"],tooltipPosition:"top-center",onClick:function(){r.goTo(e)}}));if(e.getMetadata().get("repository_id")===d)return p=t().createElement("div",{style:{display:"flex",alignItems:"center"}},t().createElement("span",{style:{flex:1}})," ",t().createElement(H,{label:r.MessageHash["notification_center.6"],iconClassName:"mdi mdi-open-in-new",tooltip:"Open",tooltipPosition:"top-right",onClick:function(){r.goTo(e)}})),"break";y.push(n),b<i.length-1&&y.push(t().createElement(I,null))},b=0;b<i.length&&"break"!==m();b++);return p&&(y=[p]),t().createElement("div",null,!a&&t().createElement("div",{style:{padding:6}},y))}}]),n}(t().Component),z=function(e){T(n,e);var r=A(n);function n(e){var t;return P(this,n),(t=r.call(this,e)).state={showPopover:!1,popoverAnchor:null},t}return _(n,[{key:"render",value:function(){var e=this,r=this.props,n=r.pydio,o=r.activity,i=r.children,a=r.linkStyle;o.object.name||(o.object.name="");var c,l,u,s,f=U(o.object,n),p=o.object.name.replace("doc://","").split("/");p.shift();var y="/"+p.join("/");return f.length>1?(c=function(){n.goTo(f[0])},u=W((function(){e.setState({showPopover:!1})}),350),l=function(t){e.setState({showPopover:!0,popoverAnchor:t.currentTarget}),u.cancel()},s=t().createElement(q,{open:this.state.showPopover,anchorEl:this.state.popoverAnchor,onRequestClose:function(t){"clickAway"!==t&&e.setState({showPopover:!1})},anchorOrigin:{horizontal:"left",vertical:"bottom"},targetOrigin:{horizontal:"left",vertical:"top"},useLayerForClickAway:!1},t().createElement(R,{zDepth:2,style:{width:200,height:"auto",overflowY:"auto"},onMouseOver:function(t){e.setState({showPopover:!0}),u.cancel()},onMouseOut:u},t().createElement(F,{pydio:n,activity:o})))):1===f.length&&(c=function(){n.goTo(f[0])}),t().createElement("span",null,t().createElement("a",{title:y,style:S({cursor:"pointer",color:"rgb(66, 140, 179)"},a),onMouseOver:l,onMouseOut:u,onClick:c},i),s)}}]),n}(t().Component);function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}function V(){return V=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},V.apply(this,arguments)}function Y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function $(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(r),!0).forEach((function(t){J(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function J(e,t,r){return(t=Z(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function K(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Z(n.key),n)}}function X(e,t,r){return t&&Q(e.prototype,t),r&&Q(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Z(e){var t=function(e,t){if("object"!==G(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==G(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===G(t)?t:String(t)}function ee(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&te(e,t)}function te(e,t){return te=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},te(e,t)}function re(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=oe(e);if(t){var o=oe(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===G(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ne(e)}(this,r)}}function ne(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oe(e){return oe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},oe(e)}z.PropTypes={activity:a().object,pydio:a().instanceOf(L)},z=B(z);var ie=l().requireLib("components").UserAvatar,ae=l().requireLib("boot").PydioContextConsumer,ce=l().requireLib("workspaces").FilePreview,le=l().requireLib("boot").moment,ue=function(e){ee(n,e);var r=re(n);function n(){return K(this,n),r.apply(this,arguments)}return X(n,[{key:"render",value:function(){return t().createElement("span",null,this.props.children)}}]),n}(t().Component);function se(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return function(o){ee(a,o);var i=re(a);function a(){return K(this,a),i.apply(this,arguments)}return X(a,[{key:"render",value:function(){var o=this.props,i=o.href,a=o.children,c=$({cursor:"pointer",color:"rgb(66, 140, 179)",fontWeight:500},n),l=null;if(i.startsWith("doc://"))return"Delete"===r.type?t().createElement("a",{style:{textDecoration:"line-through"}},a):t().createElement(z,{pydio:e,activity:r,linkStyle:c},a);if(i.startsWith("user://")){var u=i.replace("user://","");return t().createElement(ie,{userId:u,displayAvatar:!1,richOnClick:!0,style:$($({},c),{},{display:"inline-block"}),pydio:e})}if(i.startsWith("workspaces://")){var s=i.replace("workspaces://","");e.user&&e.user.getRepositoriesList().get(s)&&(l=function(){e.triggerRepositoryChange(s)})}return t().createElement("a",{title:"",style:c,onClick:l},a)}}]),a}(t().Component)}var fe=function(r){ee(o,r);var n=re(o);function o(){return K(this,o),n.apply(this,arguments)}return X(o,[{key:"render",value:function(){var r=this.props,n=r.activity,o=r.listContext,i=r.inlineActor;if(!n.summary)return t().createElement("span",null,n.type," ",n.actor?" - "+n.actor.name:"");var a,c={paragraph:ue,link:se(pydio,n,{color:"inherit"})};return"NODE-LEAF"===o&&(c.link=function(){return null}),i&&n.actor&&(a=t().createElement(ie,{userId:n.actor.id,userLabel:n.actor.name,displayLocalLabel:!0,userType:"user",pydio:l().getInstance(),style:{display:"inline-block"},labelStyle:{display:"inline-block"},displayAvatar:!1,richOnHover:!1})),t().createElement(e.Fragment,null,a,a?" - ":null,t().createElement(b(),{source:n.summary,renderers:c,style:{display:"inline"},containerTagName:i?"span":"div"}))}}]),o}(t().Component),pe=function(e){ee(n,e);var r=re(n);function n(){var e;K(this,n);for(var t=arguments.length,o=new Array(t),i=0;i<t;i++)o[i]=arguments[i];return J(ne(e=r.call.apply(r,[this].concat(o))),"state",{hover:!1}),e}return X(n,[{key:"computeIcon",value:function(e){var t,r="";switch(e.type){case"Create":r="Document"===e.object.type?"file-plus":"folder-plus",t="Created";break;case"Delete":r="delete",t="Deleted";break;case"Edit":case"Update":r="pencil",t="Modified";break;case"UpdateMeta":r="tag-multiple",t="Modified";break;case"UpdateComment":r="message-outline",t="Commented";break;case"Read":r="eye",t="Accessed";break;case"Move":r="file-send",t="Moved";break;case"Share":r="share-variant","Cell"===e.object.type?r="icomoon-cells":"Workspace"===e.object.type&&(r="folder"),t="Shared"}return-1===r.indexOf("icomoon-")&&(r="mdi mdi-"+r),{title:t,className:r}}},{key:"render",value:function(){var e,r=this,n=this.props,i=n.pydio,a=n.activity,c=n.listContext,l=n.oneLiner,u=n.muiTheme,s=n.onRequestClose,f=void 0===s?function(){}:s,p=this.state.hover,y=this.computeIcon(a).className,d=u.palette.mui3.outline,m={margin:0,padding:"10px 0"};p&&(m=$($({},m),{},{backgroundColor:u.hoverBackgroundColor}));var b,v,h,w=U(a.object,i);if(w.length?(b=t().createElement("div",{style:{padding:"12px 20px 12px 20px",position:"relative"}},t().createElement(ce,V({pydio:i,node:w[0],loadThumbnail:!0},{style:{height:40,width:40},mimeFontStyle:{fontSize:20,lineHeight:"36px",textAlign:"center"}})),t().createElement("span",{className:y,style:{position:"absolute",bottom:8,right:12,fontSize:18,color:d}})),v=w[0].getLabel()||g().getBasename(w[0].getPath())):(b=t().createElement("div",{style:{margin:"8px 20px",backgroundColor:"var(--md-sys-color-primary-container)",alignItems:"initial",height:36,width:36,borderRadius:"50%",textAlign:"center"}},t().createElement(o.FontIcon,{className:y,style:{lineHeight:"36px"}})),v=a.object?a.object.name:a.name),e=t().createElement("div",{style:{display:"flex",alignItems:"flex-start",overflow:"hidden",paddingBottom:8}},b,t().createElement("div",{style:{flex:1,overflow:"hidden",paddingRight:16}},t().createElement("div",{style:{marginBottom:4,fontSize:14,fontWeight:500,whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",color:"var(--md-sys-color-on-surface)"}},v),t().createElement("div",{style:{opacity:1}},t().createElement(fe,{activity:a,listContext:c})))),"Delete"!==a.type&&a.object&&"Folder"===a.object.type||"Document"===a.object.type){var O=U(a.object,i);O.length&&(h=function(){i.goTo(O[0]),f()},m.cursor="pointer")}return t().createElement("div",{style:m,onMouseEnter:function(){return r.setState({hover:!0})},onMouseLeave:function(){return r.setState({hover:!1})},onClick:h},!l&&t().createElement("div",{style:{display:"flex",alignItems:"center"}},a.actor&&t().createElement(ie,{useDefaultAvatar:!0,userId:a.actor.id,userLabel:a.actor.name,displayLocalLabel:!0,userType:"user",pydio:i,style:{display:"flex",alignItems:"center",maxWidth:"60%"},labelStyle:{fontSize:14,fontWeight:500,paddingLeft:10,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},avatarStyle:{flexShrink:0},avatarSize:28,richOnHover:!0}),t().createElement("span",{style:{fontSize:13,display:"inline-block",flex:1,height:18,color:"rgba(0,0,0,0.23)",fontWeight:500,paddingLeft:8,whiteSpace:"nowrap"}},le(a.updated).fromNow())),e)}}]),n}(t().Component);function ye(e){return ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(e)}function de(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function me(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?de(Object(r),!0).forEach((function(t){be(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):de(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function be(e,t,r){return(t=we(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ve(e){return function(e){if(Array.isArray(e))return he(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return he(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?he(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ge(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,we(n.key),n)}}function we(e){var t=function(e,t){if("object"!==ye(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==ye(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===ye(t)?t:String(t)}function Oe(e,t){return Oe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Oe(e,t)}function Se(e){return Se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Se(e)}pe.PropTypes={activity:a().object,listContext:a().string,displayContext:a().oneOf(["infoPanel","popover"])},pe=ae(pe=(0,v.muiThemeable)()(pe));var je=l().requireLib("boot"),Pe=je.PydioContextConsumer,Ee=je.moment,_e=l().requireLib("components"),Ce=_e.EmptyStateView,Te=_e.Timeline,xe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Oe(e,t)}(l,e);var r,n,i,a,c=(i=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Se(i);if(a){var r=Se(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===ye(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),t=c.call(this,e),e.items?t.state={data:{items:e.items},offset:0,loadMore:!1,loading:!1}:t.state={data:[],offset:0,loadMore:!0,loading:!1},t}return r=l,(n=[{key:"mergeMoreFeed",value:function(e,t){var r=e.items.map((function(e){return e.id})),n=t.items.filter((function(e){return-1===r.indexOf(e.id)}));if(!n.length)return this.setState({loadMore:!1}),e;var o=e;return o.items=[].concat(ve(e.items),ve(n)),o.totalItems=o.items.length,o}},{key:"loadForProps",value:function(e){var t=this,r=e.context,n=e.pointOfView,o=e.contextData,i=e.limit,a=this.state,c=a.offset,l=a.data;void 0===i&&(i=-1),c>0&&(i=100),this.setState({loading:!0,error:null}),d.loadActivityStreams(r,o,"outbox",n,c,i).then((function(e){c>0&&l&&l.items?e&&e.items&&t.setState({data:t.mergeMoreFeed(l,e)}):t.setState({data:e}),e&&e.items&&e.items.length||t.setState({loadMore:!1}),t.setState({loading:!1})})).catch((function(e){t.setState({loading:!1,error:e})}))}},{key:"componentWillMount",value:function(){var e=this.props,t=e.items,r=e.contextData;t||r&&this.loadForProps(this.props)}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.items?this.setState({data:{items:e.items},offset:0,loadMore:!1}):e.contextData===this.props.contextData&&e.context===this.props.context||this.setState({offset:0,loadMore:!0},(function(){t.loadForProps(e)}))}},{key:"render",value:function(){var e,r=this,n=[],i=this.props,a=i.listContext,c=i.groupByDate,l=i.displayContext,u=i.pydio,s=i.onRequestClose,f=this.state,p=f.data,y=f.loadMore,d=f.loading,m=f.error,b="mdi mdi-pulse",v=d?u.MessageHash["notification_center.17"]:u.MessageHash["notification_center.18"];m&&(v=m.Detail||m.msg||m,b="mdi mdi-alert-circle-outline");var h=function(){r.setState({offset:p.items.length+1},(function(){r.loadForProps(r.props)}))},g=d?u.MessageHash["notification_center.20"]:u.MessageHash["notification_center.19"];if(!p||!p.items||0===p.items.length){var w,O,S={backgroundColor:"transparent"};return"popover"===l?S=me(me({},S),{},{minHeight:250}):"infoPanel"===l&&(S=me(me({},S),{},{paddingBottom:20,paddingTop:10}),w={fontSize:40},O={fontSize:13}),t().createElement(Ce,{pydio:this.props.pydio,iconClassName:b,primaryTextId:v,style:S,iconStyle:w,legendStyle:O})}if("infoPanel"===l)return t().createElement(Te,{items:p.items,className:"small",useSelection:!1,itemUuid:function(e){return e.id},itemMoment:function(e){return Ee(e.updated)},itemDesc:function(e){return t().createElement(fe,{activity:e,listContext:a,inlineActor:!0})},itemActions:function(){return[]},itemAnnotations:function(){return null},color:"#2196f3",loadMoreAction:p.items.length&&y?h:null,loadMoreLabel:g,loadMoreDisabled:d});var j={fontSize:13,color:"var(--md-sys-color-outline)",fontWeight:500};return p.items.forEach((function(r,o){var i=Ee(r.updated).fromNow();c&&i!==e&&(n.length?n.push(t().createElement("div",{style:me({padding:"20px 16px 8px"},j)},i)):n.push(t().createElement("div",{style:me({padding:"0 16px 8px"},j)},i))),n.push(t().createElement(pe,{key:r.id,activity:r,listContext:a,oneLiner:c,displayContext:l,onRequestClose:s})),c&&(e=i)})),n.length&&y&&n.push(t().createElement("div",{style:{paddingLeft:16}},t().createElement(o.FlatButton,{primary:!0,label:g,disabled:d,onClick:h}))),t().createElement(o.List,{style:this.props.style},n)}}])&&ge(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),l}(t().Component);function Ae(e){return Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ae(e)}function ke(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Ae(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Ae(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Ae(o)?o:String(o)),n)}var o}function Me(e,t){return Me=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Me(e,t)}function Re(e){return Re=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Re(e)}xe.PropTypes={context:a().string,contextData:a().string,boxName:a().string,pointOfView:a().oneOf(["GENERIC","ACTOR","SUBJECT"]),displayContext:a().oneOf(["mainList","infoPanel","popover"])},xe=Pe(xe);var De=Pydio.requireLib("boot").PydioContextConsumer,He=Pydio.requireLib("workspaces").InfoPanelCard,Ie=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Me(e,t)}(c,e);var r,n,o,i,a=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Re(o);if(i){var r=Re(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Ae(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function c(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),a.apply(this,arguments)}return r=c,(n=[{key:"render",value:function(){var e=this.props,r=e.node,n=e.pydio,o=e.popoverPanel;if(!1===n.getPluginConfigs("core.activitystreams").get("ACTIVITY_SHOW_ACTIVITIES"))return null;var i=r.isLeaf()?"activity.leaf":"activity.folder",a=!r.isLeaf(),c=r.isLeaf()?n.MessageHash["notification_center.11"]:n.MessageHash["notification_center.10"];return t().createElement(He,{key:i,identifier:i,defaultOpen:a,title:c,popoverPanel:o},t().createElement(xe,{context:"NODE_ID",contextData:r.getMetadata().get("uuid"),boxName:"outbox",style:{overflowY:"scroll",maxHeight:380,padding:"8px 12px"},listContext:"NODE-"+(r.isLeaf()?"LEAF":"COLLECTION"),pointOfView:"ACTOR",displayContext:"infoPanel"}))}}])&&ke(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),c}(t().Component);Ie=De(Ie);var Le=r(305),We=r.n(Le);const Ne=require("color");var Be=r.n(Ne);function qe(e){return qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qe(e)}function Ue(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Fe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ue(Object(r),!0).forEach((function(t){ze(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ue(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ze(e,t,r){return(t=Ve(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ge(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ve(n.key),n)}}function Ve(e){var t=function(e,t){if("object"!==qe(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==qe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===qe(t)?t:String(t)}function Ye(e,t){return Ye=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ye(e,t)}function $e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Je(e){return Je=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Je(e)}var Ke=l().requireLib("hoc").ThemedContainers.Popover,Qe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ye(e,t)}(l,e);var r,n,i,a,c=(i=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Je(i);if(a){var r=Je(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===qe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return $e(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=c.call(this,e)).state={unreadStatus:0,open:!1,data:[]},t.reloadData=We()(t.reloadData.bind($e(t)),500),t.reloadUnread=We()(t.reloadUnread.bind($e(t)),500),t}return r=l,(n=[{key:"reloadData",value:function(){var e=this;d.loadActivityStreams("USER_ID",this.props.pydio.user.id,"inbox").then((function(t){e.setState({data:t})})).catch((function(t){e.setState({error:t})}))}},{key:"reloadUnread",value:function(){var e=this;d.UnreadInbox(this.props.pydio.user.id).then((function(t){e.setState({unreadStatus:t})})).catch((function(e){}))}},{key:"onStatusChange",value:function(){this.props.onUnreadStatusChange&&this.props.onUnreadStatusChange(this.state.unreadStatus)}},{key:"handleTouchTap",value:function(e){e.preventDefault(),this.reloadData(),this.setState({open:!0,anchorEl:e.currentTarget,unreadStatus:0},this.onStatusChange.bind(this))}},{key:"handleRequestClose",value:function(){this.setState({open:!1})}},{key:"componentWillMount",value:function(){var e=this;this.reloadUnread(),this.props.pydio.observe("websocket_event:activity",(function(t){e.state.open?e.reloadData():e.reloadUnread()}))}},{key:"render",value:function(){var e=this.props,r=e.pydio,n=e.iconStyle,i=e.muiTheme,a=this.state,c=a.open,l=a.anchorEl,u=a.unreadStatus,s={borderRadius:"50%"};return c&&n&&n.color&&(s=Fe(Fe({},s),{},{backgroundColor:Be()(n.color).fade(.9).toString()})),t().createElement("span",null,t().createElement("div",{style:{position:"relative",display:"inline-block"},badgeContent:this.state.unreadStatus,secondary:!0,badgeStyle:this.state.unreadStatus?null:{display:"none"}},t().createElement(o.IconButton,{onClick:this.handleTouchTap.bind(this),iconClassName:this.props.iconClassName||"mdi mdi-bell",tooltip:(u?u+" ":"")+this.props.pydio.MessageHash["notification_center.4"],className:"userActionButton alertsButton",iconStyle:n,style:s}),u>0&&t().createElement("div",{style:{width:6,height:6,borderRadius:"50%",top:9,right:6,position:"absolute",backgroundColor:i.palette.accent1Color}})),t().createElement(Ke,{open:c,anchorEl:l,anchorOrigin:{horizontal:"left",vertical:"top"},targetOrigin:{horizontal:"left",vertical:"top"},onRequestClose:this.handleRequestClose.bind(this),style:{width:320},zDepth:3,panelTitle:r.MessageHash["notification_center.1"],panelIconClassName:"mdi mdi-bell"},this.state.data&&t().createElement(xe,{items:this.state.data.items,style:{overflowY:"scroll",maxHeight:420,paddingTop:20},groupByDate:!0,displayContext:"popover"})))}}])&&Ge(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),l}(t().Component);function Xe(e){return Xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xe(e)}function Ze(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Xe(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Xe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Xe(o)?o:String(o)),n)}var o}Qe=(0,v.muiThemeable)()(Qe);var et=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"dynamicBuilder",value:function(e){var t=r.g.pydio,n=t.MessageHash,o=t.getUserSelection().getUniqueNode();if(!o)return[];var i,a=[];return o.getMetadata().get("meta_watched")&&(i=o.getMetadata().get("meta_watched")),a.push({name:n["meta.watch.11"],alt:n["meta.watch."+(o.isLeaf()?"12":"12b")],icon_class:i&&"META_WATCH_CHANGE"===i?"mdi mdi-checkbox-marked-circle-outline":"mdi mdi-checkbox-blank-circle-outline",callback:function(e){this.apply("watch_change")}.bind(this)}),a.push({name:n["meta.watch.9"],alt:n["meta.watch."+(o.isLeaf()?"10":"10b")],icon_class:i&&"META_WATCH_READ"===i?"mdi mdi-checkbox-marked-circle-outline":"mdi mdi-checkbox-blank-circle-outline",callback:function(e){this.apply("watch_read")}.bind(this)}),a.push({name:n["meta.watch.13"],alt:n["meta.watch."+(o.isLeaf()?"14":"14b")],icon_class:i&&"META_WATCH_BOTH"===i?"mdi mdi-checkbox-marked-circle-outline":"mdi mdi-checkbox-blank-circle-outline",callback:function(e){this.apply("watch_both")}.bind(this)}),i&&(a.push({separator:!0}),a.push({name:n["meta.watch.3"],alt:n["meta.watch."+(o.isLeaf()?"8":"4")],icon_class:"mdi mdi-close-circle-outline",callback:function(e){this.apply("watch_stop")}.bind(this)})),a}}],null&&Ze(t.prototype,null),n&&Ze(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function tt(e){return tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tt(e)}function rt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==tt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==tt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===tt(o)?o:String(o)),n)}var o}var nt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"toggleWatch",value:function(e,t){if(t){var r=pydio.getUserSelection().getUniqueNode(),n=r.getMetadata().get("uuid"),o=pydio.user.id,i=new f.ActivitySubscription,a=new f.ActivityOwnerType;i.UserId=o,i.ObjectId=n,i.ObjectType=a.NODE;var c=[];"watch_change"!==t&&"watch_both"!==t||c.push("change"),"watch_read"!==t&&"watch_both"!==t||c.push("read"),i.Events=c,new f.ActivityServiceApi(s().getRestClient()).subscribe(i).then((function(e){var n=r.getMetadata().get("overlay_class")||"";if("watch_stop"===t)r.getMetadata().delete("meta_watched"),r.getMetadata().set("overlay_class",n.replace("mdi mdi-bell",""));else{r.getMetadata().set("meta_watched","META_"+t.toUpperCase());var o=n.replace("mdi mdi-bell","").split(",");o.push("mdi mdi-bell"),r.getMetadata().set("overlay_class",o.join(","))}r.notify("node_replaced")}))}}}],null&&rt(t.prototype,null),r&&rt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ot(e){return ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ot(e)}function it(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==ot(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==ot(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===ot(o)?o:String(o)),n)}var o}function at(e,t){return at=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},at(e,t)}function ct(e){return ct=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ct(e)}var lt=l().requireLib("hoc").ModernSelectField;const ut=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&at(e,t)}(u,e);var r,n,i,a,c=(i=u,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ct(i);if(a){var r=ct(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===ot(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function u(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var r=(t=c.call(this,e)).props.nodes;return t.state=t.valueFromNodes(r),t}return r=u,n=[{key:"valueFromNodes",value:function(){var e=!1,t=void 0;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(r){var n=r.getMetadata().get("meta_watched")||"";void 0!==t&&n!==t&&(e=!0),t=n})),{value:t,mixed:e}}},{key:"onSelectorChange",value:function(e){var t=this;if("mixed"!==e){var r=this.props,n=r.pydio,o=r.nodes;this.setState({saving:!0});var i=o.map((function(t){var r=t.getMetadata().get("uuid"),o=n.user.id,i=new f.ActivitySubscription,a=new f.ActivityOwnerType;i.UserId=o,i.ObjectId=r,i.ObjectType=a.NODE;var c=[];return"META_WATCH_CHANGE"!==e&&"META_WATCH_BOTH"!==e||c.push("change"),"META_WATCH_READ"!==e&&"META_WATCH_BOTH"!==e||c.push("read"),i.Events=c,new f.ActivityServiceApi(s().getRestClient()).subscribe(i).then((function(r){var n=t.getMetadata().get("overlay_class")||"";if(""===e)t.getMetadata().delete("meta_watched"),t.getMetadata().set("overlay_class",n.replace("mdi mdi-bell",""));else{t.getMetadata().set("meta_watched",e);var o=n.replace("mdi mdi-bell","").split(",");o.push("mdi mdi-bell"),t.getMetadata().set("overlay_class",o.join(","))}t.notify("node_replaced")}))}));Promise.all(i).then((function(){t.setState({value:e,mixed:!1}),window.setTimeout((function(){t.setState({saving:!1})}),250)})).catch((function(){t.setState({saving:!1})}))}}},{key:"render",value:function(){var e=this,r=this.props.fullWidth,n=this.state,i=n.value,a=n.mixed,c=n.saving,u=l().getInstance().MessageHash;return c?t().createElement(lt,{value:"saving",onChange:function(e,t,r){},disabled:!0,fullWidth:r},t().createElement(o.MenuItem,{value:"saving",primaryText:u["meta.watch.selector.saving"]+"..."})):t().createElement(lt,{value:a?"mixed":i,onChange:function(t,r,n){e.onSelectorChange(n)},fullWidth:r},a&&t().createElement(o.MenuItem,{value:"mixed",primaryText:u["meta.watch.selector.mixed"]+"..."}),t().createElement(o.MenuItem,{value:"",primaryText:u["meta.watch.selector.ignore"]}),t().createElement(o.MenuItem,{value:"META_WATCH_READ",primaryText:u["meta.watch.selector.read"]}),t().createElement(o.MenuItem,{value:"META_WATCH_CHANGE",primaryText:u["meta.watch.selector.change"]}),t().createElement(o.MenuItem,{value:"META_WATCH_BOTH",primaryText:u["meta.watch.selector.both"]}))}}],n&&it(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),u}(t().Component);function st(e){return st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},st(e)}function ft(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function pt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ft(Object(r),!0).forEach((function(t){yt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ft(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function yt(e,t,r){return(t=bt(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function mt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,bt(n.key),n)}}function bt(e){var t=function(e,t){if("object"!==st(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==st(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===st(t)?t:String(t)}function vt(e,t){return vt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},vt(e,t)}function ht(e){return ht=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ht(e)}var gt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&vt(e,t)}(c,e);var r,n,o,i,a=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ht(o);if(i){var r=ht(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===st(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function c(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);var r=(t=a.call(this,e)).props.nodes;return t.state=t.valueFromNodes(r),t}return r=c,n=[{key:"valueFromNodes",value:function(){var e=!1,t=void 0;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(r){var n=r.getMetadata().get("meta_watched")||"";void 0!==t&&n!==t&&(e=!0),t=n})),{value:t,mixed:e}}},{key:"onSelectorChange",value:function(e){var t=this;if("mixed"!==e){var r=this.props,n=r.pydio,o=r.nodes;this.setState({saving:!0});var i=o.map((function(t){var r=t.getMetadata().get("uuid"),o=n.user.id,i=new f.ActivitySubscription,a=new f.ActivityOwnerType;i.UserId=o,i.ObjectId=r,i.ObjectType=a.NODE;var c=[];return"META_WATCH_CHANGE"!==e&&"META_WATCH_BOTH"!==e||c.push("change"),"META_WATCH_READ"!==e&&"META_WATCH_BOTH"!==e||c.push("read"),i.Events=c,new f.ActivityServiceApi(s().getRestClient()).subscribe(i).then((function(r){var n=t.getMetadata().get("overlay_class")||"";if(""===e)t.getMetadata().delete("meta_watched"),t.getMetadata().set("overlay_class",n.replace("mdi mdi-bell",""));else{t.getMetadata().set("meta_watched",e);var o=n.replace("mdi mdi-bell","").split(",");o.push("mdi mdi-bell"),t.getMetadata().set("overlay_class",o.join(","))}t.notify("node_replaced")}))}));Promise.all(i).then((function(){t.setState({value:e,mixed:!1}),setTimeout((function(){t.setState({saving:!1})}),50)})).catch((function(){t.setState({saving:!1})}))}}},{key:"render",value:function(){var e=this,r=this.props,n=r.fullWidth,o=r.muiTheme,i=this.state,a=i.value,c=(i.mixed,i.saving),u=l().getInstance().MessageHash,s=[];a&&(s=[a],"META_WATCH_BOTH"===a&&(s=["META_WATCH_READ","META_WATCH_CHANGE"]));var f=[{value:"META_WATCH_READ",primaryText:u["meta.watch.selector.read.mui"],iconClass:"mdi mdi-eye"},{value:"META_WATCH_CHANGE",primaryText:u["meta.watch.selector.change.mui"],iconClass:"mdi mdi-pencil"}],p={root:{borderRadius:o.borderRadius,display:"flex",border:"1px solid "+o.palette.mui3.outline,overflow:"hidden"},separator:{width:1,backgroundColor:o.palette.mui3.outline},item:{flex:1,padding:"6px 16px",textAlign:"center",cursor:c?"progress":"pointer",whiteSpace:"nowrap"},itemSelected:{backgroundColor:o.palette.mui3["secondary-container"],color:o.palette.mui3["on-secondary-container"]},icon:{marginRight:10,fontSize:12},primaryText:{fontWeight:500,fontSize:12}},y=[];f.forEach((function(e,t){y.push(e),t<f.length-1&&y.push({separator:!0})}));var d=t().createElement("div",{style:p.root},y.map((function(r){if(r.separator)return t().createElement("div",{style:p.separator});var n=pt({},p.item);return s.indexOf(r.value)>-1&&(n=pt(pt({},n),p.itemSelected)),t().createElement("div",{style:n,onClick:function(){return n=r.value,void(c||(2===(o=s.indexOf(n)>-1?s.filter((function(e){return e!==n})):[].concat((t=s,function(e){if(Array.isArray(e))return dt(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return dt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?dt(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),[n])).length?e.onSelectorChange("META_WATCH_BOTH"):1===o.length?e.onSelectorChange(o[0]):e.onSelectorChange("")));var t,n,o}},r.iconClass&&t().createElement("span",{className:r.iconClass,style:p.icon}),t().createElement("span",{style:p.primaryText},r.primaryText))})));return n?d:t().createElement("div",{style:{display:"flex"}},d,t().createElement("div",{style:{flex:1}}))}}],n&&mt(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),c}(t().Component);const wt=gt=(0,v.muiThemeable)()(gt);function Ot(e){return Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ot(e)}function St(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Ot(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Ot(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Ot(o)?o:String(o)),n)}var o}function jt(e,t){return jt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},jt(e,t)}function Pt(e){return Pt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Pt(e)}var Et=l().requireLib("workspaces").InfoPanelCard,_t=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&jt(e,t)}(c,e);var r,n,o,i,a=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Pt(o);if(i){var r=Pt(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Ot(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function c(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),a.apply(this,arguments)}return r=c,(n=[{key:"render",value:function(){var e=this.props,r=e.pydio,n=e.node,o=e.style,i=e.popoverPanel,a="mui3"===e.muiTheme.userTheme?wt:ut;return t().createElement(Et,{identifier:"meta-user",style:o,title:r.MessageHash["meta.watch.selector.legend.mui"],popoverPanel:i},t().createElement("div",{style:{padding:"0 16px 16px"}},t().createElement(a,{fullWidth:!0,pydio:r,nodes:[n]})))}}])&&St(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),c}(e.Component);const Ct=(0,v.muiThemeable)()(_t)})(),window.PydioActivityStreams=n})();