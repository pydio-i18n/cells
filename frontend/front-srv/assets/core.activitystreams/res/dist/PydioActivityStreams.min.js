(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};e.r(t),e.d(t,{ASClient:()=>d,Activity:()=>Z,ActivityList:()=>pe,Callbacks:()=>Ce,InfoPanel:()=>we,Listener:()=>Ee,OverlayPanel:()=>nt,UserPanel:()=>ht,WatchSelector:()=>Re,WatchSelectorMui3:()=>$e});const r=require("react");var n=e.n(r);const o=require("material-ui"),i=require("prop-types");var a=e.n(i);const c=require("pydio");var l=e.n(c);const u=require("pydio/http/api");var s=e.n(u);const f=require("cells-sdk");function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==p(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===p(o)?o:String(o)),n)}var o}var d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"loadActivityStreams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"USER_ID",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"outbox",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1;if(!t)return Promise.resolve([]);var a=new f.ActivityServiceApi(s().getRestClient()),c=new f.ActivityStreamActivitiesRequest;return c.Context=e,c.ContextData=t,c.BoxName=r,o>-1&&(c.Offset=o),i>-1&&(c.Limit=i),c.Language=l().getInstance().user.getPreference("lang")||"",n&&(c.PointOfView=n),a.stream(c)}},{key:"UnreadInbox",value:function(e){var t=new f.ActivityServiceApi(s().getRestClient()),r=new f.ActivityStreamActivitiesRequest;return r.Context="USER_ID",r.ContextData=e,r.BoxName="inbox",r.UnreadCountOnly=!0,t.stream(r).then((function(e){return e.totalItems||0}))}}],null&&y(t.prototype,null),r&&y(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();const m=require("react-markdown");var b=e.n(m);const v=require("material-ui/styles"),h=require("pydio/util/path");var g=e.n(h);function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(Object(r),!0).forEach((function(t){E(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function E(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==O(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==O(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===O(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var P=l().requireLib("boot").PydioContextConsumer;function _(e,t){var r=[],n=t.user.getActiveRepository();if(!(e&&e.partOf&&e.partOf.items&&e.partOf.items.length))return r;for(var o=0;o<e.partOf.items.length;o++){var i=e.partOf.items[o],a=i.rel.split("/");a.shift();var c=a.join("/");0!==c.indexOf("/")&&(c="/"+c);var l=new AjxpNode(c,"Document"===e.type);if(l.getMetadata().set("repository_id",i.id),l.getMetadata().set("repository_label",i.name),l.getMetadata().set("filename",c),i.id===n)return[l];r.push(l)}return r}var C=function(e){var t=e.pydio,o=e.activity,i=e.children,a=e.linkStyle;o.object.name||(o.object.name="");var c=_(o.object,t);if(0===c.length)return null;var l=o.object.name.replace("doc://","").split("/");l.shift();var u,s="/"+l.join("/");if(c.length>1){var f=[" (",n().createElement("span",null,t.MessageHash["bookmark.secondary.inside"].toLowerCase()," ")];c.sort((function(e,t){return e.getMetadata().get("repository_label").localeCompare(t.getMetadata().get("repository_label"))}));var p=c.map((function(e,r){var o=n().createElement("a",{style:j({},a),onClick:function(r){r.stopPropagation(),t.goTo(e)}},e.getMetadata().get("repository_label"));return r===c.length-1?o:n().createElement("span",null,o,", ")}));return f.push.apply(f,(u=p,function(e){if(Array.isArray(e))return w(e)}(u)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(u)||function(e,t){if(e){if("string"==typeof e)return w(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?w(e,t):void 0}}(u)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).concat([")"])),n().createElement(r.Fragment,null,n().createElement("span",{title:s},i)," ",f)}return n().createElement("a",{title:s,style:j({cursor:"pointer",color:"rgb(66, 140, 179)"},a),onClick:function(){t.goTo(c[0])}},i)};function T(e){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T(e)}C.PropTypes={activity:a().object,pydio:a().instanceOf(l())},C=P(C);var x=["node"],A=["node"],k=["node"],M=["node"];function R(){return R=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},R.apply(this,arguments)}function D(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function I(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function H(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(Object(r),!0).forEach((function(t){W(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function W(e,t,r){return(t=q(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function B(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,q(n.key),n)}}function L(e,t,r){return t&&N(e.prototype,t),r&&N(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function q(e){var t=function(e,t){if("object"!==T(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==T(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===T(t)?t:String(t)}function U(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&F(e,t)}function F(e,t){return F=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},F(e,t)}function z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=V(e);if(t){var o=V(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===T(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return G(e)}(this,r)}}function G(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function V(e){return V=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},V(e)}var Y=l().requireLib("components").UserAvatar,$=l().requireLib("boot").PydioContextConsumer,J=l().requireLib("workspaces").FilePreview,K=(l().requireLib("boot").moment,function(e){U(r,e);var t=z(r);function r(){return B(this,r),t.apply(this,arguments)}return L(r,[{key:"render",value:function(){return n().createElement("span",null,this.props.children)}}]),r}(n().Component)),Q=function(e){var t=e.pydio,r=e.activity,o=e.href,i=e.children,a=e.style,c=H({cursor:"pointer",color:"rgb(66, 140, 179)",fontWeight:500},void 0===a?void 0:a),l=null;if(o.startsWith("doc://"))return"Delete"===r.type?n().createElement("a",{style:{textDecoration:"line-through"}},i):n().createElement(C,{pydio:t,activity:r,linkStyle:c},i);if(o.startsWith("user://")){var u=o.replace("user://","");return n().createElement(Y,{userId:u,displayAvatar:!1,richOnClick:!0,style:H(H({},c),{},{display:"inline-block"}),pydio:t})}if(o.startsWith("workspaces://")){var s=o.replace("workspaces://","");t.user&&t.user.getRepositoriesList().get(s)&&(l=function(){t.triggerRepositoryChange(s)})}return n().createElement("a",{title:"",style:c,onClick:l},i)},X=function(e){U(o,e);var t=z(o);function o(e){var r;return B(this,o),(r=t.call(this,e)).memoizeCustomComponents(e),r}return L(o,[{key:"componentWillReceiveProps",value:function(e,t){this.memoizeCustomComponents(e)}},{key:"memoizeCustomComponents",value:function(e){var t=e.activity,r=e.listContext,o=l().getInstance();this.customComponents="NODE-LEAF"===r?{p:function(e){e.node;var t=D(e,x);return n().createElement(K,t)},a:function(e){return e.node,D(e,A),null}}:{p:function(e){e.node;var t=D(e,k);return n().createElement(K,t)},a:function(e){e.node;var r=D(e,M);return n().createElement(Q,R({pydio:o,activity:t,style:{color:"inherit"}},r))}}}},{key:"render",value:function(){var e,t=this.props,o=t.activity,i=t.inlineActor;return o.summary?(i&&o.actor&&(e=n().createElement(Y,{userId:o.actor.id,userLabel:o.actor.name,displayLocalLabel:!0,userType:"user",pydio:l().getInstance(),style:{display:"inline-block"},labelStyle:{display:"inline-block"},displayAvatar:!1,richOnHover:!1})),n().createElement(r.Fragment,null,e,e?" - ":null,n().createElement(b(),{components:this.customComponents,style:{display:"inline"},urlTransform:function(e){return e},containerTagName:i?"span":"div"},o.summary))):n().createElement("span",null,o.type," ",o.actor?" - "+o.actor.name:"")}}]),o}(n().Component),Z=function(e){U(r,e);var t=z(r);function r(){var e;B(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return W(G(e=t.call.apply(t,[this].concat(o))),"state",{hover:!1}),e}return L(r,[{key:"computeIcon",value:function(e){var t,r,n="";switch(e.type){case"Create":n="Document"===e.object.type?"file-plus":"folder-plus",t="Created";break;case"Delete":n="delete",t="Deleted";break;case"Edit":case"Update":n="pencil",t="Modified";break;case"UpdateMeta":n="tag-multiple",t="Modified";break;case"UpdateComment":n="message-outline",t="Commented";break;case"Read":n="eye",t="Accessed";break;case"Move":n="file-send",t="Moved";break;case"Event":n="bell-outline",t="Event";break;case"Share":n="share-variant","Cell"===e.object.type?n="icomoon-cells":"Workspace"===e.object.type&&(n="folder"),t="Shared",r="mdi mdi-share-variant"}return-1===n.indexOf("icomoon-")&&(n="mdi mdi-"+n),{title:t,className:n,actionIcon:r}}},{key:"render",value:function(){var e,t=this,r=this.props,i=r.pydio,a=r.activity,c=r.listContext,l=r.muiTheme,u=r.styles,s=r.onRequestClose,f=void 0===s?function(){}:s,p=this.state.hover,y=this.computeIcon(a),d=y.className,m=y.actionIcon,b={margin:0,padding:"10px 0"};p&&(b=H(H({},b),{},{backgroundColor:l.hoverBackgroundColor}));var v,h,O,w=_(a.object,i);if(w.length?(v=n().createElement("div",{style:{padding:"12px 20px 12px 20px",position:"relative"}},n().createElement(J,{pydio:i,node:w[0],loadThumbnail:!0,style:u.mFontContainer,mimeFontStyle:u.mFont}),n().createElement("span",{className:d,style:H(H({},u.actionIcon),{},{bottom:10,right:18})})),h=w[0].getLabel()||g().getBasename(w[0].getPath())):(v=n().createElement("div",{className:"mimefont-container",style:H({margin:"8px 20px",position:"relative"},u.mFontContainer)},n().createElement(o.FontIcon,{className:d,style:u.mFont}),m&&n().createElement("span",{className:m,style:u.actionIcon})),h=a.object?a.object.name:a.name),e=n().createElement("div",{style:{display:"flex",alignItems:"flex-start",overflow:"hidden",paddingBottom:8}},v,n().createElement("div",{style:{flex:1,overflow:"hidden",paddingRight:16}},n().createElement("div",{style:{marginBottom:4,fontSize:14,fontWeight:500,whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",color:"var(--md-sys-color-on-surface)"}},h),n().createElement("div",{style:{opacity:1}},n().createElement(X,{activity:a,listContext:c})))),"Delete"!==a.type&&a.object&&("Folder"===a.object.type||"Document"===a.object.type)){var S=_(a.object,i);S.length&&(O=function(){i.goTo(S[0]),f()},b.cursor="pointer")}return n().createElement("div",{style:b,onMouseEnter:function(){return t.setState({hover:!0})},onMouseLeave:function(){return t.setState({hover:!1})},onClick:O},e)}}]),r}(n().Component);function ee(e){return ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ee(e)}function te(e){return function(e){if(Array.isArray(e))return re(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return re(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?re(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ne(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==ee(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==ee(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===ee(o)?o:String(o)),n)}var o}function oe(e,t){return oe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},oe(e,t)}function ie(e){return ie=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ie(e)}Z.PropTypes={activity:a().object,listContext:a().string,displayContext:a().oneOf(["infoPanel","popover"])},Z=$(Z=(0,v.muiThemeable)()(Z));var ae=l().requireLib("boot"),ce=ae.PydioContextConsumer,le=ae.moment,ue=l().requireLib("components"),se=ue.EmptyStateView,fe=ue.Timeline,pe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oe(e,t)}(c,e);var t,r,o,i,a=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ie(o);if(i){var r=ie(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===ee(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),t=a.call(this,e),e.items?t.state={data:{items:e.items},offset:0,loadMore:!1,loading:!1}:t.state={data:[],offset:0,loadMore:!0,loading:!1},t}return t=c,(r=[{key:"mergeMoreFeed",value:function(e,t){var r=e.items.map((function(e){return e.id})),n=t.items.filter((function(e){return-1===r.indexOf(e.id)}));if(!n.length)return this.setState({loadMore:!1}),e;var o=e;return o.items=[].concat(te(e.items),te(n)),o.totalItems=o.items.length,o}},{key:"loadForProps",value:function(e){var t=this,r=e.context,n=e.pointOfView,o=e.contextData,i=e.limit,a=this.state,c=a.offset,l=a.data;void 0===i&&(i=-1),c>0&&(i=100),this.setState({loading:!0,error:null}),d.loadActivityStreams(r,o,"outbox",n,c,i).then((function(e){c>0&&l&&l.items?e&&e.items&&t.setState({data:t.mergeMoreFeed(l,e)}):t.setState({data:e}),e&&e.items&&e.items.length||t.setState({loadMore:!1}),t.setState({loading:!1})})).catch((function(e){t.setState({loading:!1,error:e})}))}},{key:"componentWillMount",value:function(){var e=this.props,t=e.items,r=e.contextData;t||r&&this.loadForProps(this.props)}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.items?this.setState({data:{items:e.items},offset:0,loadMore:!1}):e.contextData===this.props.contextData&&e.context===this.props.context||this.setState({offset:0,loadMore:!0},(function(){t.loadForProps(e)}))}},{key:"render",value:function(){var e=this,t=this.props,r=t.listContext,o=t.pydio,i=this.state,a=i.data,c=i.loadMore,l=i.loading,u=i.error,s="mdi mdi-pulse",f=l?o.MessageHash["notification_center.17"]:o.MessageHash["notification_center.18"];u&&(f=u.Detail||u.msg||u,s="mdi mdi-alert-circle-outline");var p=l?o.MessageHash["notification_center.20"]:o.MessageHash["notification_center.19"];return a&&a.items&&0!==a.items.length?n().createElement(fe,{items:a.items,className:"small",useSelection:!1,itemUuid:function(e){return e.id},itemMoment:function(e){return le(e.updated)},itemDesc:function(e){return n().createElement(X,{activity:e,listContext:r,inlineActor:!0})},itemActions:function(){return[]},itemAnnotations:function(){return null},color:"#2196f3",loadMoreAction:a.items.length&&c?function(){e.setState({offset:a.items.length+1},(function(){e.loadForProps(e.props)}))}:null,loadMoreLabel:p,loadMoreDisabled:l}):n().createElement(se,{pydio:this.props.pydio,iconClassName:s,primaryTextId:f,style:{backgroundColor:"transparent",paddingBottom:20,paddingTop:10},iconStyle:{fontSize:40},legendStyle:{fontSize:13}})}}])&&ne(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(n().Component);function ye(e){return ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(e)}pe.PropTypes={context:a().string,contextData:a().string,boxName:a().string,pointOfView:a().oneOf(["GENERIC","ACTOR","SUBJECT"])},pe=ce(pe);var de=["node","pydio","popoverPanel"];function me(){return me=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},me.apply(this,arguments)}function be(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==ye(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==ye(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===ye(o)?o:String(o)),n)}var o}function ve(e,t){return ve=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ve(e,t)}function he(e){return he=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},he(e)}var ge=Pydio.requireLib("boot").PydioContextConsumer,Oe=Pydio.requireLib("workspaces").InfoPanelCard,we=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ve(e,t)}(c,e);var t,r,o,i,a=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=he(o);if(i){var r=he(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===ye(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function c(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),a.apply(this,arguments)}return t=c,(r=[{key:"render",value:function(){var e=this.props,t=e.node,r=e.pydio,o=e.popoverPanel,i=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,de);if(!1===r.getPluginConfigs("core.activitystreams").get("ACTIVITY_SHOW_ACTIVITIES"))return null;var a=t.isLeaf()?"activity.leaf":"activity.folder",c=!t.isLeaf(),l=t.isLeaf()?r.MessageHash["notification_center.11"]:r.MessageHash["notification_center.10"],u=r.MessageHash["notification_center.11b"];return n().createElement(Oe,me({},i,{key:a,identifier:a,defaultOpen:c,title:l,shrinkTitle:u,icon:"mdi mdi-pulse",popoverPanel:o}),n().createElement(pe,{context:"NODE_ID",contextData:t.getMetadata().get("uuid"),boxName:"outbox",style:{overflowY:"scroll",maxHeight:380,padding:"8px 12px"},listContext:"NODE-"+(t.isLeaf()?"LEAF":"COLLECTION"),pointOfView:"ACTOR",displayContext:"infoPanel"}))}}])&&be(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(n().Component);function Se(e){return Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Se(e)}function je(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Se(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Se(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Se(o)?o:String(o)),n)}var o}we=ge(we);var Ee=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t)}var r,n;return r=t,n=[{key:"dynamicBuilder",value:function(t){var r=e.g.pydio,n=r.MessageHash,o=r.getUserSelection().getUniqueNode();if(!o)return[];var i,a=[];return o.getMetadata().get("meta_watched")&&(i=o.getMetadata().get("meta_watched")),a.push({name:n["meta.watch.11"],alt:n["meta.watch."+(o.isLeaf()?"12":"12b")],icon_class:i&&"META_WATCH_CHANGE"===i?"mdi mdi-checkbox-marked-circle-outline":"mdi mdi-checkbox-blank-circle-outline",callback:function(e){this.apply("watch_change")}.bind(this)}),a.push({name:n["meta.watch.9"],alt:n["meta.watch."+(o.isLeaf()?"10":"10b")],icon_class:i&&"META_WATCH_READ"===i?"mdi mdi-checkbox-marked-circle-outline":"mdi mdi-checkbox-blank-circle-outline",callback:function(e){this.apply("watch_read")}.bind(this)}),a.push({name:n["meta.watch.13"],alt:n["meta.watch."+(o.isLeaf()?"14":"14b")],icon_class:i&&"META_WATCH_BOTH"===i?"mdi mdi-checkbox-marked-circle-outline":"mdi mdi-checkbox-blank-circle-outline",callback:function(e){this.apply("watch_both")}.bind(this)}),i&&(a.push({separator:!0}),a.push({name:n["meta.watch.3"],alt:n["meta.watch."+(o.isLeaf()?"8":"4")],icon_class:"mdi mdi-close-circle-outline",callback:function(e){this.apply("watch_stop")}.bind(this)})),a}}],null&&je(r.prototype,null),n&&je(r,n),Object.defineProperty(r,"prototype",{writable:!1}),t}();function Pe(e){return Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pe(e)}function _e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Pe(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Pe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Pe(o)?o:String(o)),n)}var o}var Ce=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"toggleWatch",value:function(e,t){if(t){var r=pydio.getUserSelection().getUniqueNode(),n=r.getMetadata().get("uuid"),o=pydio.user.id,i=new f.ActivitySubscription,a=new f.ActivityOwnerType;i.UserId=o,i.ObjectId=n,i.ObjectType=a.NODE;var c=[];"watch_change"!==t&&"watch_both"!==t||c.push("change"),"watch_read"!==t&&"watch_both"!==t||c.push("read"),i.Events=c,new f.ActivityServiceApi(s().getRestClient()).subscribe(i).then((function(e){var n=r.getMetadata().get("overlay_class")||"";if("watch_stop"===t)r.getMetadata().delete("meta_watched"),r.getMetadata().set("overlay_class",n.replace("mdi mdi-bell",""));else{r.getMetadata().set("meta_watched","META_"+t.toUpperCase());var o=n.replace("mdi mdi-bell","").split(",");o.push("mdi mdi-bell"),r.getMetadata().set("overlay_class",o.join(","))}r.notify("node_replaced")}))}}}],null&&_e(t.prototype,null),r&&_e(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Te(e){return Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Te(e)}function xe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Te(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Te(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Te(o)?o:String(o)),n)}var o}function Ae(e,t){return Ae=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ae(e,t)}function ke(e){return ke=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ke(e)}var Me=l().requireLib("hoc").ModernSelectField;const Re=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ae(e,t)}(u,e);var t,r,i,a,c=(i=u,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(i);if(a){var r=ke(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Te(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function u(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var r=(t=c.call(this,e)).props.nodes;return t.state=t.valueFromNodes(r),t}return t=u,r=[{key:"valueFromNodes",value:function(){var e=!1,t=void 0;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(r){var n=r.getMetadata().get("meta_watched")||"";void 0!==t&&n!==t&&(e=!0),t=n})),{value:t,mixed:e}}},{key:"onSelectorChange",value:function(e){var t=this;if("mixed"!==e){var r=this.props,n=r.pydio,o=r.nodes;this.setState({saving:!0});var i=o.map((function(t){var r=t.getMetadata().get("uuid"),o=n.user.id,i=new f.ActivitySubscription,a=new f.ActivityOwnerType;i.UserId=o,i.ObjectId=r,i.ObjectType=a.NODE;var c=[];return"META_WATCH_CHANGE"!==e&&"META_WATCH_BOTH"!==e||c.push("change"),"META_WATCH_READ"!==e&&"META_WATCH_BOTH"!==e||c.push("read"),i.Events=c,new f.ActivityServiceApi(s().getRestClient()).subscribe(i).then((function(r){var n=t.getMetadata().get("overlay_class")||"";if(""===e)t.getMetadata().delete("meta_watched"),t.getMetadata().set("overlay_class",n.replace("mdi mdi-bell",""));else{t.getMetadata().set("meta_watched",e);var o=n.replace("mdi mdi-bell","").split(",");o.push("mdi mdi-bell"),t.getMetadata().set("overlay_class",o.join(","))}t.notify("node_replaced")}))}));Promise.all(i).then((function(){t.setState({value:e,mixed:!1}),window.setTimeout((function(){t.setState({saving:!1})}),250)})).catch((function(){t.setState({saving:!1})}))}}},{key:"render",value:function(){var e=this,t=this.props.fullWidth,r=this.state,i=r.value,a=r.mixed,c=r.saving,u=l().getInstance().MessageHash;return c?n().createElement(Me,{value:"saving",onChange:function(e,t,r){},disabled:!0,fullWidth:t},n().createElement(o.MenuItem,{value:"saving",primaryText:u["meta.watch.selector.saving"]+"..."})):n().createElement(Me,{value:a?"mixed":i,onChange:function(t,r,n){e.onSelectorChange(n)},fullWidth:t},a&&n().createElement(o.MenuItem,{value:"mixed",primaryText:u["meta.watch.selector.mixed"]+"..."}),n().createElement(o.MenuItem,{value:"",primaryText:u["meta.watch.selector.ignore"]}),n().createElement(o.MenuItem,{value:"META_WATCH_READ",primaryText:u["meta.watch.selector.read"]}),n().createElement(o.MenuItem,{value:"META_WATCH_CHANGE",primaryText:u["meta.watch.selector.change"]}),n().createElement(o.MenuItem,{value:"META_WATCH_BOTH",primaryText:u["meta.watch.selector.both"]}))}}],r&&xe(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),u}(n().Component),De=require("pydio/util/dom");var Ie=e.n(De);function He(e){return He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},He(e)}function We(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Fe(n.key),n)}}function Be(e,t){return Be=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Be(e,t)}function Ne(e){return Ne=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ne(e)}function Le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function qe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Le(Object(r),!0).forEach((function(t){Ue(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Le(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ue(e,t,r){return(t=Fe(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Fe(e){var t=function(e,t){if("object"!==He(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==He(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===He(t)?t:String(t)}function ze(e,t){if(e){if("string"==typeof e)return Ge(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ge(e,t):void 0}}function Ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ve=function(e){var t,o,i=e.baseWidth,a=e.open,c=e.style,l=e.children,u=(0,r.useRef)(null),s=(t=(0,r.useState)(i),o=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,c=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(c.push(n.value),c.length!==t);l=!0);}catch(e){u=!0,o=e}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return c}}(t,o)||ze(t,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),f=s[0],p=s[1];return(0,r.useLayoutEffect)((function(){a&&u.current?p(u.current.scrollWidth+5):p(i)}),[a,l]),n().createElement("div",{ref:u,style:qe(qe({},c),{},{opacity:a?1:0,overflow:"hidden",transition:Ie().getBeziersTransition(),width:f})},l)},Ye=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Be(e,t)}(u,e);var t,r,i,a,c=(i=u,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ne(i);if(a){var r=Ne(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===He(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function u(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var r=(t=c.call(this,e)).props.nodes;return t.state=t.valueFromNodes(r),t}return t=u,r=[{key:"valueFromNodes",value:function(){var e=!1,t=void 0;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(r){var n=r.getMetadata().get("meta_watched")||"";void 0!==t&&n!==t&&(e=!0),t=n})),{value:t,mixed:e}}},{key:"onSelectorChange",value:function(e){var t=this;if("mixed"!==e){var r=this.props,n=r.pydio,o=r.nodes;this.setState({saving:!0});var i=o.map((function(t){var r=t.getMetadata().get("uuid"),o=n.user.id,i=new f.ActivitySubscription,a=new f.ActivityOwnerType;i.UserId=o,i.ObjectId=r,i.ObjectType=a.NODE;var c=[];return"META_WATCH_CHANGE"!==e&&"META_WATCH_BOTH"!==e||c.push("change"),"META_WATCH_READ"!==e&&"META_WATCH_BOTH"!==e||c.push("read"),i.Events=c,new f.ActivityServiceApi(s().getRestClient()).subscribe(i).then((function(r){var n=t.getMetadata().get("overlay_class")||"";if(""===e)t.getMetadata().delete("meta_watched"),t.getMetadata().set("overlay_class",n.replace("mdi mdi-bell",""));else{t.getMetadata().set("meta_watched",e);var o=n.replace("mdi mdi-bell","").split(",");o.push("mdi mdi-bell"),t.getMetadata().set("overlay_class",o.join(","))}t.notify("node_replaced")}))}));Promise.all(i).then((function(){t.setState({value:e,mixed:!1}),setTimeout((function(){t.setState({saving:!1,animOpen:!1})}),50)})).catch((function(){t.setState({saving:!1})}))}}},{key:"render",value:function(){var e=this,t=this.props,r=t.fullWidth,i=t.muiTheme,a=t.animatedButton,c=t.readPermissionOnly,u=void 0!==c&&c,s=this.state,f=s.value,p=(s.mixed,s.saving),y=s.animOpen,d=void 0!==y&&y,m=l().getInstance().MessageHash,b=[];f&&(b=[f],"META_WATCH_BOTH"===f&&(b=["META_WATCH_READ","META_WATCH_CHANGE"]));var v=function(t){var r,n;p||(2===(r=b.indexOf(t)>-1?b.filter((function(e){return e!==t})):[].concat((n=b,function(e){if(Array.isArray(e))return Ge(e)}(n)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||ze(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),[t])).length?e.onSelectorChange("META_WATCH_BOTH"):1===r.length?e.onSelectorChange(r[0]):e.onSelectorChange(""))},h=[{value:"META_WATCH_READ",primaryText:m["meta.watch.selector.read.mui"],iconClass:"mdi mdi-eye"}];u||h.push({value:"META_WATCH_CHANGE",primaryText:m["meta.watch.selector.change.mui"],iconClass:"mdi mdi-pencil"});var g,O={root:{borderRadius:i.borderRadius,display:"flex",border:"1px solid "+(a&&!d?i.palette.mui3.primary:i.palette.mui3.outline),overflow:a?null:"hidden",alignItems:"center",margin:a?"0 6px":null,height:a?36:null},separator:{width:1,height:"100%",backgroundColor:i.palette.mui3.outline},item:{flex:1,padding:a?"7px 16px":"6px 16px",textAlign:"center",cursor:p?"progress":"pointer",whiteSpace:"nowrap"},itemSelected:{backgroundColor:i.palette.mui3["secondary-container"],color:i.palette.mui3["on-secondary-container"]},icon:{marginRight:10,fontSize:a?14:12},primaryText:{fontWeight:500,fontSize:a?13:12},animButton:{root:{borderRadius:"50%",border:0,backgroundColor:"transparent",width:36,height:36,padding:"8px 6px",margin:"0 -1px",zIndex:0},icon:{color:i.palette.mui3.primary,fontSize:20,lineHeight:"20px"}}},w=[];return h.forEach((function(e,t){w.push(e),t<h.length-1&&w.push({separator:!0})})),g=a?n().createElement("div",{style:O.root},a&&n().createElement(o.IconButton,{style:O.animButton.root,iconStyle:O.animButton.icon,iconClassName:"mdi mdi-bell"+(b.length?"":"-outline"),tooltip:m["meta.watch.selector.legend.mui"],onClick:function(){return e.setState({animOpen:!d})}}),n().createElement(Ve,{style:qe(qe({},O.root),{},{border:0,margin:0,height:34}),baseWidth:0,open:d||!a},w.map((function(e){if(e.separator)return n().createElement("div",{style:O.separator});var t=qe({},O.item);return b.indexOf(e.value)>-1&&(t=qe(qe({},t),O.itemSelected)),n().createElement("div",{style:t,onClick:function(){return v(e.value)}},e.iconClass&&n().createElement("span",{className:e.iconClass,style:O.icon}),n().createElement("span",{style:O.primaryText},e.primaryText))})))):n().createElement("div",{style:O.root},w.map((function(e){if(e.separator)return n().createElement("div",{style:O.separator});var t=qe({},O.item);return b.indexOf(e.value)>-1&&(t=qe(qe({},t),O.itemSelected)),n().createElement("div",{style:t,onClick:function(){return v(e.value)}},e.iconClass&&n().createElement("span",{className:e.iconClass,style:O.icon}),n().createElement("span",{style:O.primaryText},e.primaryText))}))),r?g:n().createElement("div",{style:{display:"flex"}},g,n().createElement("div",{style:{flex:1}}))}}],r&&We(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),u}(n().Component);const $e=Ye=(0,v.muiThemeable)()(Ye);function Je(e){return Je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Je(e)}var Ke=["pydio","node","style","popoverPanel","muiTheme"];function Qe(){return Qe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Qe.apply(this,arguments)}function Xe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Je(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Je(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Je(o)?o:String(o)),n)}var o}function Ze(e,t){return Ze=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ze(e,t)}function et(e){return et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},et(e)}var tt=l().requireLib("workspaces").InfoPanelCard,rt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ze(e,t)}(c,e);var t,r,o,i,a=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=et(o);if(i){var r=et(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Je(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function c(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),a.apply(this,arguments)}return t=c,(r=[{key:"render",value:function(){var e=this.props,t=e.pydio,r=e.node,o=e.style,i=e.popoverPanel,a=e.muiTheme,c=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,Ke),l="mui3"===a.userTheme?$e:Re;return n().createElement(tt,Qe({},c,{identifier:"activity-stream",style:o,title:t.MessageHash["meta.watch.selector.legend.mui"],popoverPanel:i}),n().createElement("div",{style:{padding:"0 16px 16px"}},n().createElement(l,{fullWidth:!0,pydio:t,nodes:[r]})))}}])&&Xe(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(r.Component);const nt=(0,v.muiThemeable)()(rt),ot=require("lodash.debounce");var it=e.n(ot);const at=require("color");var ct=e.n(at);function lt(e){return lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lt(e)}function ut(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function st(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ut(Object(r),!0).forEach((function(t){ft(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ut(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ft(e,t,r){return(t=yt(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,yt(n.key),n)}}function yt(e){var t=function(e,t){if("object"!==lt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==lt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===lt(t)?t:String(t)}function dt(e,t){return dt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},dt(e,t)}function mt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bt(e){return bt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},bt(e)}var vt=l().requireLib("hoc").ThemedContainers.Popover,ht=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&dt(e,t)}(l,e);var t,r,i,a,c=(i=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=bt(i);if(a){var r=bt(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===lt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return mt(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=c.call(this,e)).state={unreadStatus:0,open:!1,data:[]},t.reloadData=it()(t.reloadData.bind(mt(t)),500),t.reloadUnread=it()(t.reloadUnread.bind(mt(t)),500),t}return t=l,(r=[{key:"reloadData",value:function(){var e=this;d.loadActivityStreams("USER_ID",this.props.pydio.user.id,"inbox").then((function(t){e.setState({data:t})})).catch((function(t){e.setState({error:t})}))}},{key:"reloadUnread",value:function(){var e=this;d.UnreadInbox(this.props.pydio.user.id).then((function(t){e.setState({unreadStatus:t})})).catch((function(e){}))}},{key:"onStatusChange",value:function(){this.props.onUnreadStatusChange&&this.props.onUnreadStatusChange(this.state.unreadStatus)}},{key:"handleTouchTap",value:function(e){e.preventDefault(),this.reloadData(),this.setState({open:!0,anchorEl:e.currentTarget,unreadStatus:0},this.onStatusChange.bind(this))}},{key:"handleRequestClose",value:function(){this.setState({open:!1})}},{key:"componentWillMount",value:function(){var e=this;this.reloadUnread(),this.props.pydio.observe("websocket_event:activity",(function(t){e.state.open?e.reloadData():e.reloadUnread()}))}},{key:"render",value:function(){var e=this.props,t=e.pydio,r=e.iconStyle,i=e.muiTheme,a=this.state,c=a.open,l=a.anchorEl,u=a.unreadStatus,s={borderRadius:"50%"};return c&&r&&r.color&&(s=st(st({},s),{},{backgroundColor:ct()(r.color).fade(.9).toString()})),n().createElement("span",null,n().createElement("div",{style:{position:"relative",display:"inline-block"},badgeContent:this.state.unreadStatus,secondary:!0,badgeStyle:this.state.unreadStatus?null:{display:"none"}},n().createElement(o.IconButton,{onClick:this.handleTouchTap.bind(this),iconClassName:this.props.iconClassName||"mdi mdi-bell",tooltip:(u?u+" ":"")+this.props.pydio.MessageHash["notification_center.4"],className:"userActionButton alertsButton",iconStyle:r,style:s}),u>0&&n().createElement("div",{style:{width:6,height:6,borderRadius:"50%",top:9,right:6,position:"absolute",backgroundColor:i.palette.accent1Color}})),n().createElement(vt,{open:c,anchorEl:l,anchorOrigin:{horizontal:"left",vertical:"top"},targetOrigin:{horizontal:"left",vertical:"top"},onRequestClose:this.handleRequestClose.bind(this),style:{width:320},zDepth:3,panelTitle:t.MessageHash["notification_center.1"],panelIconClassName:"mdi mdi-bell"},this.state.data&&n().createElement(pe,{items:this.state.data.items,style:{overflowY:"scroll",maxHeight:420,paddingTop:20},groupByDate:!0,displayContext:"popover"})))}}])&&pt(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),l}(n().Component);ht=(0,v.muiThemeable)()(ht),window.PydioActivityStreams=t})();