(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Controls:()=>o,Editor:()=>k,Panel:()=>G});var o={};e.r(o),e.d(o,{LocalisationControls:()=>l,SelectionControls:()=>a});const n=require("pydio");var r=e.n(n),i=r().requireLib("hoc"),a=i.SelectionControls,l=i.LocalisationControls;const c=require("react");var u=e.n(c);const s=require("react-redux"),f=require("redux"),p=require("material-ui"),d=require("material-ui/styles");function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}var m;function h(){return h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},h.apply(this,arguments)}function b(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==y(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,"string");if("object"!==y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===y(r)?r:String(r)),n)}var r}function v(e,t){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},v(e,t)}function g(e){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},g(e)}var w=r().requireLib("hoc"),E=w.withSelection,O=w.withMenu,P=w.withErrors,j=w.EditorActions,S=(0,f.compose)(O,P)((function(e){return u().createElement("div",e)})),C=function(e){return"1"===e.getMetadata().get("is_image")},x=(0,d.muiThemeable)()((function(e){var t=e.keyName,o=e.data,n=e.muiTheme;return u().createElement(p.Card,{style:{margin:10,overflow:"auto",backgroundColor:n.palette.mui3.surface}},u().createElement(p.CardTitle,{key:t+"-head"},t),u().createElement(p.CardText,null,u().createElement(p.Table,{selectable:!1},u().createElement(p.TableBody,{displayRowCheckbox:!1,style:{backgroundColor:n.palette.mui3.surface}},Object.keys(o).map((function(e){return u().createElement(p.TableRow,{key:"".concat(t,"-").concat(e)},u().createElement(p.TableRowColumn,null,e),u().createElement(p.TableRowColumn,null,o[e]))}))))))}));const k=E((function(e){return new Promise((function(t,o){var n=[];e.getParent().getChildren().forEach((function(e){return n.push(e)})),t({selection:n=n.filter(C),currentIndex:n.reduce((function(t,o,n){return o===e&&n||t}),0)})}))}))(m=(0,s.connect)(null,j)(m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}(l,e);var t,o,n,r,i,a=(r=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=g(r);if(i){var o=g(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===y(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this,e)).state={data:{}},t}return t=l,n=[{key:"controls",get:function(){return{options:{locate:function(e){return u().createElement(p.IconButton,{onClick:e,iconClassName:"mdi mdi-crosshairs-gps",tooltip:"Locate on a map"})}}}}}],(o=[{key:"componentDidMount",value:function(){this.props.node&&this.loadNodeContent(this.props);var e=this.props.editorModify;this.props.isActive&&e({fixedToolbar:!0})}},{key:"componentWillReceiveProps",value:function(e){e.node&&e.node!==this.props.node&&this.loadNodeContent(e);var t=this.props.editorModify;e.isActive&&t({fixedToolbar:!0})}},{key:"loadNodeContent",value:function(e){var t=e.node,o={};t.getMetadata().has("ImageExif")&&(o.ImageExif=t.getMetadata().get("ImageExif")),t.getMetadata().has("GeoLocation")&&(o.GeoLocation=t.getMetadata().get("GeoLocation")),this.setState({data:o})}},{key:"render",value:function(){var e=this,t=this.props.showControls,o=this.state.data;return o?u().createElement(S,h({},this.props,{onLocate:t&&o.GeoLocation?function(){return e.openGpsLocator()}:null,style:{display:"flex",justifyContent:"space-around",flexFlow:"row wrap"}}),Object.keys(o).map((function(e){return u().createElement(x,{keyName:e,data:o[e]})}))):null}}])&&b(t.prototype,o),n&&b(t,n),Object.defineProperty(t,"prototype",{writable:!1}),l}(c.Component))||m)||m,_=require("pydio/http/resources-manager");var M=e.n(_);function L(e){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(e)}function R(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==L(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,"string");if("object"!==L(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===L(r)?r:String(r)),n)}var r}function T(e,t){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},T(e,t)}function I(e){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},I(e)}var q=r().requireLib("boot").AsyncComponent,N=r().requireLib("workspaces").InfoPanelCard,B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&T(e,t)}(a,e);var t,o,n,r,i=(n=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=I(n);if(r){var o=I(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===L(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),i.apply(this,arguments)}return t=a,o=[{key:"parseValues",value:function(e){var t=this,o=this.props.pydio.getPluginConfigs("meta.exif");if(o.has("exif_meta_fields")&&o.has("exif_meta_labels")){var n={},r=o.get("exif_meta_fields").split(","),i=o.get("exif_meta_labels").split(",");r.map((function(e,t){n[e]=i[t]}));var a=e.getMetadata(),l=r.map((function(e){return e.split(".")})).filter((function(e){return 2===e.length&&a.has(e[0])&&a.get(e[0])[e[1]]})).map((function(e){return{key:e.join("."),label:n[e.join(".")],value:a.get(e[0])[e[1]]}}));a.has("GeoLocation")&&a.get("GeoLocation").lat&&a.get("GeoLocation").lon&&M().loadClassesAndApply(["PydioMaps"],(function(){return t.setState({gpsData:!0})})),this.setState({items:l})}}},{key:"componentDidMount",value:function(){this.parseValues(this.props.node)}},{key:"componentWillReceiveProps",value:function(e){e.node!==this.props.node&&(this.setState({gpsData:null}),this.parseValues(e.node))}},{key:"mapLoaded",value:function(e,t){t&&console&&console.log(t)}},{key:"openInExifEditor",value:function(){var e=this.props,t=e.pydio,o=e.node,n=t.Registry.findEditorById("editor.exif");n&&t.UI.openCurrentSelectionInEditor(n,o)}},{key:"openInMapEditor",value:function(){var e=this.props,t=e.pydio,o=e.node,n=t.Registry.findEditorsForMime("ol_layer");n.length&&t.UI.openCurrentSelectionInEditor(n[0],o)}},{key:"render",value:function(){var e=this,t=[],o=[],n={overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"};if(this.state&&this.state.items&&this.state.items.length){var r=this.state.items.map((function(e){return u().createElement("div",{key:e.key,className:"infoPanelRow",style:{float:"left",width:"50%",padding:"0 4px 12px",whiteSpace:"nowrap"}},u().createElement("div",{className:"infoPanelLabel"},e.label),u().createElement("div",{className:"infoPanelValue",title:e.value,style:n},e.value))}));t.push(u().createElement("div",{style:{padding:"0 12px"}},r)),t.push(u().createElement("div",{style:{clear:"left"}})),o.push(u().createElement(p.FlatButton,{onClick:function(){return e.openInExifEditor()},label:this.props.pydio.MessageHash[456]}))}return this.state&&this.state.gpsData&&(t.push(u().createElement(q,{namespace:"PydioMaps",componentName:"OLMap",key:"map",style:{height:170,marginBottom:0,padding:0},centerNode:this.props.node,mapLoaded:this.mapLoaded})),o.push(u().createElement(p.FlatButton,{onClick:function(){return e.openInMapEditor()},label:this.props.pydio.MessageHash["meta.exif.2"]}))),t.length?u().createElement(N,{identifier:"meta-exif",style:this.props.style,title:this.props.pydio.MessageHash["meta.exif.3"],actions:o,icon:"camera"},t):null}}],o&&R(t.prototype,o),Object.defineProperty(t,"prototype",{writable:!1}),a}(c.Component);const G=B;window.PydioExif=t})();