(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var i in r)e.o(r,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:r[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Callbacks:()=>C,CompressionDialog:()=>S});const r=require("pydio");var i=e.n(r);const o=require("react");var n=e.n(o);const a=require("create-react-class");var s=e.n(a);const l=require("pydio/http/api");var u=e.n(l);const c=require("cells-sdk"),p=require("pydio/util/path");var m=e.n(p);const d=require("material-ui");function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function g(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==f(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!==f(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key),"symbol"===f(o)?o:String(o)),i)}var o}var h=i().requireLib("hoc"),y=h.ModernTextField,b=h.ModernSelectField,v=i().requireLib("boot").ActionDialogMixin,S=s()({displayName:"CompressionDialog",mixins:[v],getDefaultProps:function(){var e=["zip","tar","tar.gz"];return pydio.Parameters.get("multipleFilesDownloadEnabled")||e.pop(),{dialogTitleId:313,legendId:314,dialogIsModal:!0,formats:e}},getInitialState:function(){var e,t=this.props.userSelection;t.isUnique()?(e=m().getBasename(t.getUniqueFileName()),t.hasDir()||(e=e.substr(0,e.lastIndexOf(".")))):""===(e=m().getBasename(t.getContextNode().getPath()))&&(e="Archive");var r=this.props.formats[0];return{archiveBase:e,compression:r,fileName:this.buildUniqueFileName(e,r),loading:!1}},getButtons:function(e){return this._updater=e,this.makeButtons()},makeButtons:function(){var e=this,t=this.state.loading;return[n().createElement(d.FlatButton,{key:"cancel",label:this.props.pydio.MessageHash[54],primary:!1,onClick:function(){return e.dismiss()}}),n().createElement(d.FlatButton,{label:this.props.pydio.MessageHash[48],primary:!0,keyboardFocused:!0,disabled:t,onClick:function(){return e.submit()}})]},buildUniqueFileName:function(e,t){for(var r=0,i=e,o=e;this.props.userSelection.fileNameExists(i+"."+t,!0);)r>0&&(i=o+"-"+r),r++;return i},textFieldChange:function(e,t){this.setState({archiveBase:t,fileName:this.buildUniqueFileName(t,this.state.compression)})},selectFieldChange:function(e,t,r){this.setState({compression:r,fileName:this.buildUniqueFileName(this.state.archiveBase,r)})},submit:function(){var e=this,t=this.props.userSelection.getFileNames(),r=this.props.pydio.user.getActiveRepositoryObject().getSlug(),i=r+this.props.userSelection.getContextNode().getPath()+"/"+this.state.fileName+"."+this.state.compression;i=i.replace("//","/");var o=c.RestUserJobRequest.constructFromObject({JobName:"compress",JsonParameters:JSON.stringify({archiveName:i,format:this.state.compression,nodes:t.map((function(e){return r+e}))})}),n=new c.JobsServiceApi(u().getRestClient());this.setState({loading:!0},(function(){return e._updater(e.makeButtons())})),n.userCreateJob("compress",o).then((function(t){e.dismiss(),e.setState({loading:!1},(function(){return e._updater(e.makeButtons())}))})).catch((function(t){e.setState({loading:!1,err:t.message},(function(){return e._updater(e.makeButtons())}))}))},render:function(){var e=this.props.formats.map((function(e){return n().createElement(d.MenuItem,{value:e,primaryText:"."+e})})),t=this.props.pydio.MessageHash,r=this.state,i=r.compression,o=r.fileName,a=r.err,s={whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"};return n().createElement("div",null,n().createElement("div",{style:{display:"flex"}},n().createElement(y,{style:{width:210,marginRight:10},onChange:this.textFieldChange,value:o,floatingLabelText:t["compression.4"],floatingLabelStyle:s,variant:"v2"}),n().createElement(b,{style:{width:160},onChange:this.selectFieldChange,value:i,floatingLabelText:t["compression.3"],floatingLabelStyle:s,variant:"v2"},e)),a&&n().createElement("div",{style:{color:"#e53935"}},a))}}),C=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"compressUI",value:function(e){var t=e.getPydio(),r=t.getUserSelection();t.Parameters.get("multipleFilesDownloadEnabled")&&t.UI.openComponentInModal("CompressionActions","CompressionDialog",{userSelection:r})}},{key:"extract",value:function(e){var t=e.getPydio(),r=t.getUserSelection();if(!r.isEmpty()){var i=r.getUniqueFileName(),o=m().getFileExtension(i);"gz"===o&&(o="tar.gz");var n=t.user.getActiveRepositoryObject().getSlug(),a=c.RestUserJobRequest.constructFromObject({JobName:"extract",JsonParameters:JSON.stringify({node:n+i,format:o,target:""})});new c.JobsServiceApi(u().getRestClient()).userCreateJob("extract",a)}}}],null&&g(t.prototype,null),r&&g(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();window.CompressionActions=t})();