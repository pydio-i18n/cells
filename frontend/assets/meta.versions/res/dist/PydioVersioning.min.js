(()=>{"use strict";var e={880:e=>{e.exports=require("pydio/http/api")},6:e=>{e.exports=require("pydio/model/node")}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{r.r(n),r.d(n,{Callbacks:()=>D,HistoryDialog:()=>T,InfoPanel:()=>G});const e=require("pydio");var t=r.n(e);const o=require("react");var i=r.n(o);const a=require("create-react-class");var l=r.n(a);const c=require("pydio/model/meta-node-provider");var s=r.n(c);const u=require("react-markdown");var f=r.n(u);const p=require("pydio/util/path");var y=r.n(p);const d=require("lodash.debounce");var b=r.n(d);function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}var m=["node"],g=["node"];function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==v(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==v(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===v(o)?o:String(o)),n)}var o}function O(e,t){return O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},O(e,t)}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e){return j=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},j(e)}function P(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var S=r(880),E=r(6),_=t().requireLib("components"),M=_.Timeline,k=_.UserAvatar,x=t().requireLib("boot").moment,C={a:function(e){return e.node,function(e){var r=e.href,n=e.children;if(r.startsWith("user://")){var o=r.replace("user://","");return i().createElement(k,{userId:o,displayAvatar:!1,richOnClick:!1,style:{display:"inline-block",fontWeight:500},pydio:t().getInstance()})}return i().createElement("span",null,n)}(P(e,m))},p:function(e){var t;return e.node,t=P(e,g).children,i().createElement("span",null,t)}};const q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&O(e,t)}(c,e);var r,n,o,a,l=(o=c,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=j(o);if(a){var r=j(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===v(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return w(e)}(this,e)});function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=l.call(this,e)).state={loading:!0,revs:[],selection:e.preselection},t._bload=b()(t.load.bind(w(t)),1500),t.load(),t}return r=c,(n=[{key:"componentDidUpdate",value:function(e,t,r){e.node!==this.props.node&&(e.node&&e.node.stopObserving("node_replaced",this._bload),this.props.node&&this.props.node.observe("node_replaced",this._bload),this.load())}},{key:"getMessage",value:function(e){return t().getMessages()["meta.versions."+e]||e}},{key:"load",value:function(){var e=this,t=this.props.node,r=new(s())({versions:"true",file:t.getPath(),silent:!0}),n=new E("/",!1,"Versions","folder.png",r);this.setState({empty:!1}),r.loadNode(n,(function(t){var r=[];t.getChildren().forEach((function(e){return r.push(e)})),e.setState({loading:!1,revs:r,empty:!r.length})}))}},{key:"applyAction",value:function(e,t){var r=this.props,n=r.node,o=r.onRequestClose;switch(e){case"dl":S.getClient().openVersion(n,t.getMetadata().get("versionId"));break;case"revert":if(!confirm(this.getMessage("13")))return;S.getClient().revertToVersion(n,t.getMetadata().get("versionId"),(function(){o&&o()}))}}},{key:"itemActions",value:function(e,t,r){var n=this;return t?[{onClick:function(){return n.applyAction("dl",e)},label:this.getMessage("3")},{onClick:function(){return n.applyAction("revert",e)},label:this.getMessage("7")}]:[]}},{key:"itemAnnotations",value:function(e,t,r){var n,o=parseInt(e.getMetadata().get("bytesize"));if(r){var a=parseInt(r.getMetadata().get("bytesize"));n=a===o?"right":a>o?"bottom-right":"top-right"}return i().createElement("div",{className:"tl-annotation"},n&&i().createElement("span",{className:"tl-annotation-dir mdi mdi-arrow-"+n}),y().roundFileSize(o))}},{key:"render",value:function(){var e=this.state,r=e.loading,n=e.revs,o=e.selection,a=e.empty;if(r)return i().createElement("div",{style:{textAlign:"center",fontWeight:500,opacity:.3,padding:20}},t().getMessages()[466]);if(a)return i().createElement("div",{style:{textAlign:"center",fontWeight:500,opacity:.3,padding:20,paddingBottom:30}},this.getMessage("14"));var l=this.props,c=l.className,s=void 0===c?"":c,u=l.onClick;return i().createElement(M,{items:n,className:s,useSelection:!0,preSelection:o,onItemSelect:u,itemUuid:function(e){return e.getMetadata().get("versionId")},itemMoment:function(e){return x(1e3*e.getMetadata().get("ajxp_modiftime"))},itemDesc:function(e){return i().createElement(f(),{urlTransform:function(e){return e},components:C},e.getMetadata().get("versionDescription"))},itemActions:this.itemActions.bind(this),itemAnnotations:this.itemAnnotations.bind(this),color:"#2196f3"})}}])&&h(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),c}(o.Component);var I=t().requireLib("boot"),T=l()({displayName:"HistoryDialog",mixins:[I.ActionDialogMixin,I.SubmitButtonProviderMixin],getDefaultProps:function(){return{dialogTitle:t().getMessages()["meta.versions.2"],dialogIsModal:!1,dialogSize:"lg",dialogPadding:!1}},submit:function(){this.dismiss()},render:function(){var e,t=this.props,r=t.node,n=t.args;return n&&n.length>0&&(e=n[0]),i().createElement("div",{style:{width:"100%"},className:"layout-fill vertical-layout"},i().createElement("div",{style:{display:"flex",flexDirection:"column",color:"rgba(0,0,0,.87)"},className:"version-history"},i().createElement(q,{node:r,preselection:e,onRequestClose:this.dismiss.bind(this)})))}});function A(e){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(e)}function R(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==A(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==A(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===A(o)?o:String(o)),n)}var o}var D=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var r,n;return r=e,n=[{key:"loadHistoryBrowser",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];pydio.UI.openComponentInModal("PydioVersioning","HistoryDialog",{node:t().getInstance().getContextHolder().getUniqueNode(),args:r})}}],null&&R(r.prototype,null),n&&R(r,n),Object.defineProperty(r,"prototype",{writable:!1}),e}();function N(e){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N(e)}var B=["node"];function H(){return H=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},H.apply(this,arguments)}function L(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==N(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==N(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===N(o)?o:String(o)),n)}var o}function U(e,t){return U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},U(e,t)}function V(e){return V=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},V(e)}var z=t().requireLib("boot").PydioContextConsumer,W=t().requireLib("workspaces").InfoPanelCard,F=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&U(e,t)}(c,e);var r,n,o,a,l=(o=c,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=V(o);if(a){var r=V(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===N(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function c(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),l.apply(this,arguments)}return r=c,(n=[{key:"render",value:function(){var e=this.props,r=e.node,n=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,B);return r&&r.getMetadata().has("datasource_versioning")?i().createElement(W,H({},n,{identifier:"meta-versions",icon:"mdi mdi-history",style:this.props.style,title:t().getMessages()["meta.versions.1"]}),i().createElement(q,{node:r,className:"small",onClick:function(e){return t().getInstance().Controller.fireAction("versions_history",e)}})):null}}])&&L(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),c}(o.Component);const G=F=z(F)})(),window.PydioVersioning=n})();