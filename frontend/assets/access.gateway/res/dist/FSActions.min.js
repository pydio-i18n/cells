/*! For license information please see FSActions.min.js.LICENSE.txt */
(()=>{"use strict";var e={146:e=>{e.exports=require("material-ui")},217:e=>{e.exports=require("pydio")},81:e=>{e.exports=require("pydio/http/api")},528:e=>{e.exports=require("pydio/model/data-model")},462:e=>{e.exports=require("pydio/util/dom")},117:e=>{e.exports=require("pydio/util/func")},919:e=>{e.exports=require("pydio/util/lang")},15:e=>{e.exports=require("react")}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,o),i.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};function n(e){return function(t,o){var r=o&&o.length?o[0]:null;e.UI.openCurrentSelectionInEditor(r)}}o.r(r),o.d(r,{Callbacks:()=>Qe,CrossWsDropDialog:()=>_e,Listeners:()=>dt,OtherEditorPickerDialog:()=>b,TreeDialog:()=>Y,UploadDialog:()=>ae});const i=require("create-react-class");var a=o.n(i);const l=require("prop-types");var s=o.n(l),c=o(15),u=o(146),d=u.FontIcon,p=u.ListItem,f=u.List,g=u.FlatButton,h=o(217),y=o(528),m=o(919),v=h.requireLib("boot").ActionDialogMixin,b=a()({displayName:"OtherEditorPickerDialog",propTypes:{pydio:s().instanceOf(h),selection:s().instanceOf(y)},mixins:[v],getButtons:function(e){var t=[],o=this.props.pydio.MessageHash;return t.push(c.createElement(g,{key:"clear",label:MessageHash["openother.5"],primary:!1,onClick:this.clearAssociations})),t.push(c.createElement(g,{label:o[54],primary:!0,keyboardFocused:!0,onClick:this.props.onDismiss})),t},getDefaultProps:function(){return{dialogTitleId:"openother.2",dialogIsModal:!1,dialogSize:"sm",dialogPadding:0}},findActiveEditors:function(e){var t=[],o=!1,r=this.props.pydio;return null==this.user||this.user.canWrite()||(o=!0),r.Registry.getActiveExtensionByType("editor").forEach((function(e){o&&e.write||e.openable&&t.push(e)})),t},clearAssociations:function(){var e=this.props,t=e.pydio,o=e.selection.getUniqueNode().getAjxpMime(),r=t.user&&t.user.getLayoutPreference("Editor.Associations",{})||{};if(r[o]){var n,i=r[o];t.Registry.getActiveExtensionByType("editor").forEach((function(e){e.editorClass===i&&(n=e)})),n&&-1!==n.mimes.indexOf(o)&&(n.mimes=m.arrayWithout(n.mimes,n.mimes.indexOf(o))),delete r[o],t.user&&t.user.setLayoutPreference("Editor.Associations",r)}this.props.onDismiss()},selectEditor:function(e,t){var o=this.props,r=o.pydio,i=o.selection.getUniqueNode().getAjxpMime();e.mimes.push(i);var a=r.user;if(a){var l=a.getLayoutPreference("Editor.Associations",{});l[i]=e.editorClass,a.setLayoutPreference("Editor.Associations",l),n(r)(null,[e]),this.dismiss()}},render:function(){var e=this,t=this.findActiveEditors("*").map((function(t){var o=c.createElement(d,{className:t.icon_class});return c.createElement(p,{onClick:e.selectEditor.bind(e,t),primaryText:t.text,secondaryText:t.title,leftIcon:o})}));return c.createElement(f,{style:{maxHeight:320,overflowY:"scroll",width:"100%",borderTop:"1px solid #e0e0e0"}},t)}}),w=o(15),C=o.n(w),E=o(217),x=o.n(E),S=o(919),P=o.n(S);const R=require("cells-sdk");var O=o(528),T=o.n(O),N=o(146);const M=require("material-ui/styles");function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function _(e){return function(e){if(Array.isArray(e))return A(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||k(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function j(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?L(Object(o),!0).forEach((function(t){U(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):L(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function U(e,t,o){return(t=function(e){var t=function(e){if("object"!=I(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!=I(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==I(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function D(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var r,n,i,a,l=[],s=!0,c=!1;try{if(i=(o=o.call(e)).next,0===t){if(Object(o)!==o)return;s=!1}else for(;!(s=(r=i.call(o)).done)&&(l.push(r.value),l.length!==t);s=!0);}catch(e){c=!0,n=e}finally{try{if(!s&&null!=o.return&&(a=o.return(),Object(a)!==a))return}finally{if(c)throw n}}return l}}(e,t)||k(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){if(e){if("string"==typeof e)return A(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?A(e,t):void 0}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=Array(t);o<t;o++)r[o]=e[o];return r}var F=x().requireLib("hoc"),H=F.ModernTextField,q=F.ModernSelectField,B=x().requireLib("components").FoldersTree,W=x().requireLib("boot"),z=W.ActionDialogMixin,V=W.CancelButtonProviderMixin,G=W.SubmitButtonProviderMixin,J=function(e){var t=e.pydio,o=e.recentPlaces,r=e.submitValue,n=e.dismiss,i=e.muiTheme,a=t.user,l={};return"material"===i.userTheme?(l.root={borderBottom:"1px solid #e0e0e0",padding:"3px 7px 1px",backgroundColor:"#F6F6F8"},l.hint={color:"rgba(0,0,0,.3)",fontSize:12}):(l.root={backgroundColor:i.palette.mui3["surface-variant"]},l.hint={color:i.palette.mui3["on-surface-variant"],fontSize:12},l.chipBG=i.palette.mui3["inverse-primary"],l.avatarBG=i.palette.mui3["primary-container"],l.avatarColor=i.palette.mui3["on-primary-container"]),C().createElement("div",{style:l.root},C().createElement("div",{style:l.hint},t.MessageHash["action.copymove.recent"]),C().createElement("div",{style:{display:"flex",flexWrap:"wrap",paddingTop:2}},o.map((function(e){var t,o=D(e.split(":"),2),i=o[0],s=o[1],c=s;if(a&&a.getRepositoriesList().has(i)){var u=a.getRepositoriesList().get(i);t=C().createElement(N.Avatar,{backgroundColor:l.avatarBG,color:l.avatarColor,style:{fontSize:12,height:24,width:24,fontWeight:500}},u.getLettersBadge()),c=u.getLabel()+s}return C().createElement(N.Chip,{style:{margin:"0 3px 4px 0"},labelStyle:{lineHeight:"24px"},backgroundColor:l.chipBG,title:c,onClick:function(){r(s,i),n()}},t,s)}))))};J=(0,M.muiThemeable)()(J);var Y=a()({displayName:"TreeDialog",propTypes:{isMove:s().bool.isRequired,submitValue:s().func.isRequired},mixins:[z,V,G],getDefaultProps:function(){return{dialogTitle:"Copy/Move",dialogIsModal:!0,dialogScrollBody:!0}},submit:function(){var e=this.props,t=e.pydio,o=e.submitValue,r=this.state,n=r.dataModel,i=r.wsId,a=n.getContextNode().getPath();o(a,"__CURRENT__"===i?null:i);var l=("__CURRENT__"===i?t.user.activeRepository:i)+":"+a;Y.RecentPlaces=Y.RecentPlaces.filter((function(e){return e!==l})),Y.RecentPlaces.unshift(l),Y.RecentPlaces=Y.RecentPlaces.slice(0,5),this.dismiss()},getInitialState:function(){var e=this.getCurrentDataModel();return{dataModel:e,wsId:e.getRootNode().getMetadata().get("repository_id")||"__CURRENT__"}},handleRepositoryChange:function(e,t,o){var r=this,n=this.getCurrentDataModel(o),i=n.getRootNode();i.observeOnce("loaded",(function(){r.forceUpdate()})),i.load(),this.setState({dataModel:n,wsId:o})},getCurrentDataModel:function(){var e,t,o=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=this.props.pydio,i=n.user,a=i.getRepositoriesList().get(i.activeRepository).getLabel();null!==r&&"__CURRENT__"!==r?(e=r,a=i.getCrossRepositories().get(r).getLabel()):null===r&&(!i.canWrite()&&i.canCrossRepositoryCopy()&&i.hasCrossRepositories()&&(e=i.getCrossRepositories().keys().next().value,a=i.getCrossRepositories().get(e).getLabel()),n.getContextHolder().getContextNode().isRoot()||(t=n.getContextHolder().getContextNode().getPath()));var l={filters:{type:"COLLECTION"}},s=T().RemoteDataModelFactory(e?j(j({},l),{},{tmp_repository_id:e}):l,a),c=s.getRootNode();return e&&c.getMetadata().set("repository_id",e),t?(n.getContextHolder().getRootNode().getChildren().forEach((function(e){c.addChild(e)})),s.loadPathInfoAsync(t,function(e){s.requireContextChange(e)}.bind(this))):(c.observeOnce("loaded",(function(){o.forceUpdate()})),c.load(s.getAjxpNodeProvider())),s.observe("context_changed",(function(){o.forceUpdate()})),s},onNodeSelected:function(e){var t=this.state.dataModel;t.setContextNode(e),e.load(t.getAjxpNodeProvider())},createNewFolder:function(){var e=this,t=this.props.pydio,o=this.state,r=o.dataModel,n=o.newFolderInput,i=r.getContextNode(),a=t.user.getActiveRepositoryObject().getSlug();"__CURRENT__"!==this.state.wsId&&(a=t.user.getRepositoriesList().get(this.state.wsId).getSlug());var l=new R.TreeServiceApi(PydioApi.getRestClient()),s=new R.RestCreateNodesRequest,c=a+P().trimRight(i.getPath(),"/")+"/"+n,u=new R.TreeNode;u.Path=c,u.Type=R.TreeNodeType.constructFromObject("COLLECTION"),s.Nodes=[u],l.createNodes(s).then((function(t){i.observeOnce("loaded",(function(){var e=("/"===i.getPath()?"":i.getPath())+"/"+n,t=i.getChildren().get(e);t&&r.setContextNode(t)})),setTimeout((function(){return i.reload(r.getAjxpNodeProvider())}),1e3),e.setState({newFolderFormOpen:!1,newFolderInput:""})}))},toggleNewFolderForm:function(){var e=this,t=!this.state.newFolderFormOpen;this.setState({newFolderFormOpen:t},(function(){t&&e.refs.newfolder_input.focus()}))},buildWsSelector:function(){var e=this.props.pydio,t=e.user,o=this.state.wsId,r=C().createElement("div",{style:{height:30}});if(t&&t.canCrossRepositoryCopy()&&t.hasCrossRepositories()){var n=[],i=[];if(t.canWrite()){var a=t.getActiveRepositoryObject();n.push(C().createElement(N.MenuItem,{key:"current",value:"__CURRENT__",primaryText:a.getLabel()+" - "+e.MessageHash[372],leftIcon:C().createElement(N.FontIcon,{style:{fontSize:20,height:20,top:a.getOwner()?5:1},className:a.getOwner()?"icomoon-cells":"mdi mdi-folder"})})),n.push(C().createElement(N.Divider,null))}t.getCrossRepositories().forEach((function(e,t){i.push({label:e.getLabel(),owner:!!e.getOwner(),item:C().createElement(N.MenuItem,{key:t,value:t,primaryText:e.getLabel(),leftIcon:C().createElement(N.FontIcon,{style:{fontSize:20,height:20,top:e.getOwner()?5:1},className:e.getOwner()?"icomoon-cells":"mdi mdi-folder"})})})})),i.sort((function(e,t){return e.owner===t.owner?e.label.localeCompare(t.label,void 0,{numeric:!0}):e.owner?1:-1})),n=[].concat(_(n),_(i.map((function(e){return e.item})))),r=C().createElement("div",null,C().createElement(q,{fullWidth:!0,variant:"v2",floatingLabelText:e.MessageHash[455],value:o,onChange:this.handleRepositoryChange.bind(this)},n))}return r},buildRecentLocations:function(){var e,t=this,o=this.props.pydio,r=o.user;if(!Y.RecentPlaces||!Y.RecentPlaces.length)return e;var n=this.props.submitValue;return C().createElement("div",{style:{borderBottom:"1px solid #e0e0e0",padding:"3px 7px 1px",backgroundColor:"#F6F6F8"}},C().createElement("div",{style:{color:"rgba(0,0,0,.3)",fontSize:12}},o.MessageHash["action.copymove.recent"]),C().createElement("div",{style:{display:"flex",flexWrap:"wrap",paddingTop:2}},Y.RecentPlaces.map((function(e){var o,i=D(e.split(":"),2),a=i[0],l=i[1],s=l;if(r&&r.getRepositoriesList().has(a)){var c=r.getRepositoriesList().get(a);o=C().createElement(N.Avatar,{style:{fontSize:12,height:24,width:24,fontWeight:500}},c.getLettersBadge()),s=c.getLabel()+l}return C().createElement(N.Chip,{style:{margin:"0 3px 4px 0"},labelStyle:{lineHeight:"24px"},title:s,onClick:function(){n(l,a),t.dismiss()}},o,l)}))))},render:function(){var e=this,t=this.props,o=t.pydio,r=t.submitValue,n=this.state,i=n.newFolderFormOpen,a=n.dataModel,l=n.newFolderInput,s=this.buildWsSelector();return C().createElement("div",{style:{width:"100%"}},Y.RecentPlaces&&Y.RecentPlaces.length>0&&C().createElement(J,{recentPlaces:Y.RecentPlaces,pydio:o,submitValue:r,dismiss:function(){return e.dismiss()}}),s,C().createElement(N.Paper,{zDepth:0,style:{height:300,overflowX:"auto",color:"var(--md-sys-color-on-surface-variant)",fontSize:14,padding:"6px 0px",backgroundColor:"var(--md-sys-color-surface-variant)",marginTop:4,borderBottom:"1px solid #e0e0e0",borderRadius:"2px 2px 0 0"}},C().createElement("div",{style:{marginTop:-6,marginLeft:-5}},C().createElement(B,{pydio:o,dataModel:a,onNodeSelected:this.onNodeSelected.bind(this),showRoot:!0,draggable:!1,rootLabel:o.MessageHash["action.copymove.root"],getItemStyle:function(e){return a.getContextNode()===e?{fontWeight:500,backgroundColor:"var(--md-sys-color-secondary)",color:"var(--md-sys-color-on-secondary)"}:{}},getRightIcon:function(t){return a.getContextNode()===t?C().createElement(N.IconButton,{iconClassName:"mdi mdi-folder-plus",style:{height:18,width:18,padding:0,marginRight:0},iconStyle:{opacity:.5,fontSize:18},tooltip:o.MessageHash[154],tooltipPosition:"bottom-left",onClick:function(){return e.toggleNewFolderForm()}}):null}}))),C().createElement(N.Paper,{className:"bezier-transitions",zDepth:0,style:{position:"relative",height:i?60:0,overflow:i?"visible":"hidden",opacity:i?1:0,padding:0,marginTop:i?0:4}},C().createElement(H,{fullWidth:!0,floatingLabelText:o.MessageHash[173],ref:"newfolder_input",variant:"v2",value:l,onKeyDown:function(t){"Enter"===t.key&&l&&e.createNewFolder()},onChange:function(t,o){return e.setState({newFolderInput:o})}}),C().createElement("div",{style:{position:"absolute",bottom:-2,right:0}},C().createElement(N.IconButton,{iconClassName:"mdi mdi-check",iconStyle:{color:"#546E7A"},tooltip:this.props.pydio.MessageHash[48],onClick:function(){e.createNewFolder()}}),C().createElement(N.IconButton,{iconClassName:"mdi mdi-close",iconStyle:{color:"#546E7A"},tooltip:this.props.pydio.MessageHash[54],onClick:function(){return e.toggleNewFolderForm()}}))))}});function K(e){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(e)}function X(){return X=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)({}).hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},X.apply(null,arguments)}function $(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Q(r.key),r)}}function Q(e){var t=function(e){if("object"!=K(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!=K(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==K(t)?t:t+""}function Z(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Z=function(){return!!e})()}function ee(e){return ee=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ee(e)}function te(e,t){return te=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},te(e,t)}Y.RecentPlaces=[];var oe=x().requireLib("boot"),re=oe.ActionDialogMixin,ne=oe.AsyncComponent,ie=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t,o){return t=ee(t),function(e,t){if(t&&("object"==K(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Z()?Reflect.construct(t,o||[],ee(e).constructor):t.apply(e,o))}(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&te(e,t)}(t,e),o=t,(r=[{key:"render",value:function(){var e=this.props,t=e.tabs,o=e.dismiss,r=e.muiTheme,n=r.borderRadius,i=r.palette.mui3;return C().createElement("div",{style:{display:"flex",borderRadius:"".concat(n,"px ").concat(n,"px 0 0"),overflow:"hidden",borderBottom:"1px solid "+i["outline-variant-50"]}},C().createElement(N.Tabs,{style:{flex:1},inkBarStyle:{backgroundColor:r.tabs.selectedTextColor}},t),C().createElement(N.IconButton,{iconStyle:{color:r.tabs.selectedTextColor},iconClassName:"mdi mdi-close",onClick:o,tooltip:"Close"}))}}])&&$(o.prototype,r),Object.defineProperty(o,"prototype",{writable:!1}),o;var o,r}(C().Component);ie=(0,M.muiThemeable)()(ie);var ae=a()({displayName:"UploadDialog",mixins:[re],getDefaultProps:function(){return{dialogTitle:"",dialogSize:x().getInstance().UI.MOBILE_EXTENSIONS?"md":"lg",dialogPadding:!1,dialogIsModal:!1}},getInitialState:function(){var e,t=this.props.pydio.Registry.getActiveExtensionByType("uploader").filter((function(e){return e.moduleName}));return t.sort((function(e,t){return e.order-t.order})),t.length&&(e=t[0]),{uploaders:t,current:e,loaded:!1}},render:function(){var e=this,t=[],o=C().createElement("div",{style:{height:360}}),r=function(){e.dismiss()},n=this.state,i=n.uploaders,a=n.current,l=n.loaded;if(i.map((function(o){t.push(C().createElement(N.Tab,{label:o.xmlNode.getAttribute("label"),key:o.id,onActive:function(){e.setState({current:o})},style:{textTransform:"none"}}))})),a){var s=a.moduleName.split(".");o=C().createElement(ne,X({pydio:this.props.pydio,namespace:s[0],componentName:s[1],onDismiss:r,showDismiss:1===t.length,onLoad:function(){e.setState({loaded:!0})}},this.props.uploaderProps))}return C().createElement("div",{style:{width:"100%"}},t.length>1&&C().createElement(ie,{tabs:t,dismiss:r}),o,!l&&C().createElement("div",{style:{padding:"100px 40px",textAlign:"center",color:"rgba(0,0,0,.5)"}},this.props.pydio.MessageHash[466]))}});const le=require("pydio/model/meta-node-provider");var se=o.n(le),ce=o(81),ue=o.n(ce);const de=require("pydio/model/cell");var pe=o.n(de),fe=o(81);function ge(e){return function(t,o,r,n){var i=e.user.getActiveRepositoryObject().getSlug(),a=i;if(n){var l=e.user.getRepositoriesList().get(n);l&&(a=l.getSlug())}var s=o.getSelectedNodes(),c={nodes:s.map((function(e){return i+e.getPath()})),target:a+r,targetParent:!0};fe.getRestClient().userJob(t,c).then((function(o){"move"===t?s.forEach((function(t){var r=e.MessageHash["background.move."+(t.isLeaf()?"file":"folder")];t.getMetadata().set("pending_operation",r),t.getMetadata().set("pending_operation_uuid",o.JobUuid),t.notify("meta_replaced",t)})):e.UI.displayMessage("SUCCESS",e.MessageHash["background.copy.selection"]),e.getContextHolder().setSelectedNodes([])})).catch((function(t){var o=t.Detail||t.message||t;e.UI.displayMessage("ERROR",o)}))}}function he(e){return he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},he(e)}function ye(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,me(r.key),r)}}function me(e){var t=function(e){if("object"!=he(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!=he(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==he(t)?t:t+""}function ve(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ve=function(){return!!e})()}function be(e){return be=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},be(e)}function we(e,t){return we=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},we(e,t)}var Ce=o(15),Ee=o(146),xe=Ee.FontIcon,Se=Ee.ListItem,Pe=Ee.List,Re=Ee.FlatButton,Oe=Ee.Subheader,Te=o(217),Ne=o(528),Me=Te.requireLib("boot").ActionDialogMixin,Ie=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t,o){return t=be(t),function(e,t){if(t&&("object"==he(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ve()?Reflect.construct(t,o||[],be(e).constructor):t.apply(e,o))}(this,t,[e])).state={roots:[]},o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&we(e,t)}(t,e),o=t,r=[{key:"componentDidMount",value:function(){var e=this,t=this.props.cellWs,o=new R.MetaServiceApi(ue().getRestClient()),r=new R.RestGetBulkMetaRequest,n=t.getSlug();console.log(n),r.NodePaths=[n,n+"/*"],o.getBulkMeta(r).then((function(t){var o=t.Nodes||[],r=null,i=[];o.forEach((function(e){if(e.Path===n+"/")r=se().parseTreeNode(e,n);else{var t=se().parseTreeNode(e,n);t.isLeaf()||i.push(t)}})),r.getMetadata().has("virtual_root")?(console.log(i),e.setState({roots:i})):(console.log(r),e.setState({roots:[r]}))}))}},{key:"move",value:function(e){var t=this.props,o=t.source,r=t.cellWs,n=t.pydio,i=t.dropEffect,a=ge(Te.getInstance()),l=n.getContextHolder();if(-1===l.getSelectedNodes().indexOf(o)){var s=new Ne;s.setContextNode(l.getContextNode()),s.setSelectedNodes([o]),a(i,s,e.getPath(),r.getId())}else a(i,l,e.getPath(),r.getId());this.props.onDismiss()}},{key:"share",value:function(){var e=this,t=this.props,o=t.source,r=t.cellWs,n=t.pydio,i=new(pe());i.load(r.getId()).then((function(){i.addRootNode(o),i.save().then((function(){e.props.onDismiss(),n.triggerRepositoryChange(r.getId())}))}))}},{key:"render",value:function(){var e=this,t=this.props,o=t.source,r=t.cellWs,n=t.dropEffect,i=t.pydio,a=t.muiTheme,l=this.state.roots,s=function(e){return i.MessageHash["openother.drop.cell."+e]||e},c=[];c.push(Ce.createElement(Se,{onClick:function(){e.share()},primaryText:o.isLeaf()?s("file.share"):s("folder.share"),secondaryText:s("share.legend").replace("%s",r.getLabel()),leftIcon:Ce.createElement(xe,{style:{color:a.palette.primary1Color},className:"mdi mdi-share-variant"})}));var u=o.isLeaf()?"file":"folder",d=s(u+"."+n);return l.forEach((function(t){var o=s("copymove.legend").replace("%s",r.getLabel());"/"!==t.getPath()&&""!==t.getPath()&&(o+="/"+t.getLabel()),c.push(Ce.createElement(Se,{onClick:function(){e.move(t)},primaryText:d,secondaryText:o,leftIcon:Ce.createElement(xe,{style:{color:a.palette.primary1Color},className:"mdi mdi-folder-"+("copy"===n?"plus":"move")})}))})),Ce.createElement(Pe,{style:{maxHeight:320,overflowY:"scroll",width:"100%",borderTop:"1px solid #e0e0e0"}},Ce.createElement(Oe,{style:{overflow:"hidden",whiteSpace:"nowrap",paddingRight:16,textOverflow:"ellipsis"}},s("picker").replace("%s",o.getLabel())),c)}}],r&&ye(o.prototype,r),Object.defineProperty(o,"prototype",{writable:!1}),o;var o,r}(Ce.Component);Ie=(0,M.muiThemeable)()(Ie);var _e=a()({displayName:"CrossWsDropDialog",propTypes:{pydio:s().instanceOf(Te),selection:s().instanceOf(Ne)},mixins:[Me],getButtons:function(e){var t=[],o=this.props.pydio.MessageHash;return t.push(Ce.createElement(Re,{label:o[54],primary:!0,keyboardFocused:!0,onClick:this.props.onDismiss})),t},getDefaultProps:function(){return{dialogIsModal:!1,dialogSize:"sm",dialogPadding:0}},render:function(){return Ce.createElement(Ie,this.props)}}),Le=Pydio.requireLib("boot").PromptValidators;function je(e){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je(e)}function Ue(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,De(r.key),r)}}function De(e){var t=function(e){if("object"!=je(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!=je(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==je(t)?t:t+""}function ke(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ke=function(){return!!e})()}function Ae(e){return Ae=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ae(e)}function Fe(e,t){return Fe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Fe(e,t)}var He=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t,o){return t=Ae(t),function(e,t){if(t&&("object"==je(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ke()?Reflect.construct(t,o||[],Ae(e).constructor):t.apply(e,o))}(this,t,[e])).state={},o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Fe(e,t)}(t,e),o=t,(r=[{key:"render",value:function(){var e=this,t=this.props,o=t.onChange,r=t.messages,n=this.state.checked,i=": "+r["action.delete.permanently.warning"];return C().createElement("div",{style:{marginTop:16}},C().createElement(N.Checkbox,{onCheck:function(t,r){e.setState({checked:r}),o("removePermanently",r)},label:r["action.delete.permanently"]+(n?i:""),labelPosition:"right",labelStyle:n?{color:"#f44336"}:{color:"inherit"}}))}}])&&Ue(o.prototype,r),Object.defineProperty(o,"prototype",{writable:!1}),o;var o,r}(C().Component);const qe=require("pydio/util/path");var Be=o.n(qe),We=function(e,t){var o=x().getInstance();if(e||(e=o.getUserSelection().getUniqueNode()),-1!==t.indexOf("/"))throw new Error(o.MessageHash["filename.forbidden.slash"]);var r=o.user.getActiveRepositoryObject().getSlug()+e.getPath(),n={nodes:[r],target:Be().getDirname(r)+"/"+t,targetParent:!1};ue().getRestClient().userJob("move",n).then((function(r){var n=o.MessageHash["rename.processing"].replace("%1",e.getLabel()).replace("%2",t);o.UI.displayMessage("SUCCESS",n),e.getMetadata().set("pending_operation",n),e.getMetadata().set("pending_operation_uuid",r.JobUuid),e.notify("meta_replaced",e),o.getContextHolder().setSelectedNodes([])})).catch((function(e){var t=e.Detail||e.message||e;o.UI.displayMessage("ERROR",t)}))},ze=o(217).requireLib("components").DNDActionParameter,Ve=o(81);function Ge(e){return function(){var t=e.getUserSelection();Ve.getClient().downloadSelection(t)}}var Je=o(117),Ye=o(462),Ke=o(919);function Xe(e){return function(){e.UI.openComponentInModal("FSActions","OtherEditorPickerDialog",{selection:e.getUserSelection(),pydio:e})}}var $e=o.g.pydio,Qe={ls:function(e){return function(){e.goTo(e.getUserSelection().getUniqueNode())}}($e),mkdir:function(e){return function(){var t=[Le.Empty,Le.NoSlash,Le.MustDifferSiblings()];e.UI.openComponentInModal("PydioReactUI","PromptDialog",{dialogTitleId:154,legendId:155,fieldLabelId:173,dialogSize:"sm",submitValue:function(t){if(-1!==t.indexOf("/")){var o=e.MessageHash["filename.forbidden.slash"];throw e.UI.displayMessage("ERROR",o),new Error(o)}var r=new R.TreeServiceApi(ue().getRestClient()),n=new R.RestCreateNodesRequest,i=e.user.getActiveRepositoryObject().getSlug()+P().trimRight(e.getContextNode().getPath(),"/")+"/"+t,a=new R.TreeNode;a.Path=i,a.Type=R.TreeNodeType.constructFromObject("COLLECTION"),n.Nodes=[a],r.createNodes(n).then((function(e){console&&console.debug("Created nodes",e.Children)}))},warnSpace:!0,validate:function(e){t.forEach((function(t){return t(e)}))}})}}($e),deleteAction:function(e){var t=e.MessageHash;return function(){var o,r=t[176],n=e.getPluginConfigs("access.gateway").get("DELETE_ALLOW_PERMANENT");"true"===e.getContextHolder().getRootNode().getMetadata().get("ws_skip_recycle")||0===e.getContextHolder().getContextNode().getPath().indexOf("/recycle_bin")?r=t[177]:n&&(o={removePermanently:function(e){return C().createElement(He,{onChange:e,messages:t})}}),e.UI.openComponentInModal("PydioReactUI","ConfirmDialog",{message:r,dialogTitleId:7,moreComponents:o,validCallback:function(t){var o=e.getContextHolder().getSelectedNodes(),r=e.user.getActiveRepositoryObject().getSlug(),n=new R.RestDeleteNodesRequest,i=new R.TreeServiceApi(ue().getRestClient());n.Nodes=o.map((function(e){var t=new R.TreeNode;return t.Path=r+e.getPath(),t})),t&&t.removePermanently&&(n.RemovePermanently=!0),i.deleteNodes(n).then((function(t){t.DeleteJobs&&t.DeleteJobs.length&&o.forEach((function(e){e.getMetadata().set("pending_operation",t.DeleteJobs[0].Label),e.getMetadata().set("pending_operation_uuid",t.DeleteJobs[0].Uuid),e.notify("meta_replaced",e)})),e.getContextHolder().setSelectedNodes([])})).catch((function(t){e.UI.displayMessage("ERROR",t.Title||t.message)}))}})}}($e),rename:function(){var e=x().getInstance(),t=e.getUserSelection().getSelectedNodes()[0];if(t){var o=t.notify("node_action",{type:"prompt-rename",callback:function(e){We(t,e)}});o&&!0===o[0]||e.UI.openComponentInModal("PydioReactUI","PromptDialog",{dialogTitleId:6,legendId:158,fieldLabelId:t.isLeaf()?174:173,dialogSize:"sm",submitValue:function(e){return We(t,e)},warnSpace:!0})}},renameCallback:We,applyCopyOrMove:ge($e),copy:function(e){var t=e.MessageHash;return function(){var o=e.getUserSelection();e.UI.openComponentInModal("FSActions","TreeDialog",{isMove:!1,dialogTitle:t[159],submitValue:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;ge(e)("copy",o,t,r)}})}}($e),move:function(e){var t=e.MessageHash,o=function(e,t){var o=t.getMetadata().has("repository_id");if(t.getMetadata().has("local:dropFunc"))t.getMetadata().has("local:canDropFunc")&&t.getMetadata().get("local:canDropFunc")(e,t);else{if(t.isLeaf()||t.getPath()===e.getPath()||!o&&P().trimRight(t.getPath(),"/")===Be().getDirname(e.getPath()))throw new Error("Cannot drop on leaf or on same path");if(t.getMetadata().has("virtual_root"))throw new Error("Cannot drop on virtual root");if(e.getMetadata().has("ws_root"))throw new Error("Cannot move roots around");if("true"===t.getMetadata().get("node_readonly")||t.getMetadata().has("workspaceEntry")&&!t.getMetadata().get("workspaceEntry").allowCrossRepositoryCopy)throw new Error("Cannot drop on this branch (readonly)")}};return function(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(n&&n instanceof Array&&n.length&&n[0]instanceof ze&&(n=n[0]),n&&n instanceof ze){if(n.getStep()===ze.STEP_CAN_DROP){var i=n.getTarget(),a=n.getSource();return o(a,i),!1}if(n.getStep()===ze.STEP_END_DRAG){try{o(n.getSource(),n.getTarget())}catch(e){return}var l=r.getDataModel(),s=n.getTarget().getPath(),c=null;if(n.getTarget().getMetadata().has("repository_id")){c=n.getTarget().getMetadata().get("repository_id");var u=n.getTarget().getMetadata().get("workspaceEntry");if(u&&"cell"===u.getRepositoryType())return void e.UI.openComponentInModal("FSActions","CrossWsDropDialog",{target:n.getTarget(),source:n.getSource(),dropEffect:n.getDropEffect()||"move",cellWs:u})}else if(n.getTarget().getMetadata().has("local:dropFunc"))return void n.getTarget().getMetadata().get("local:dropFunc")("dnd",n.getSource(),n.getTarget());var d=ge(e),p=n.getSource();if(-1===l.getSelectedNodes().indexOf(p)){var f=new PydioDataModel;f.setContextNode(l.getContextNode()),f.setSelectedNodes([n.getSource()]),d(n.getDropEffect()||"move",f,s,c)}else d(n.getDropEffect()||"move",l,s,c)}}else{var g=e.getUserSelection();e.UI.openComponentInModal("FSActions","TreeDialog",{isMove:!0,dialogTitle:t[160],submitValue:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;ge(e)("move",g,t,o)}})}}}($e),upload:function(e){return function(t,o){var r={};o&&o.length&&(r={uploaderProps:o[0]}),e.UI.openComponentInModal("FSActions","UploadDialog",r)}}($e),download:Ge($e),downloadPDF:function(e){return function(){var t=e.getUserSelection().getUniqueNode(),o=ue().getClient(),r=Be().getBasename(t.getPath()).replace(t.getAjxpMime(),"pdf"),n=navigator.userAgent||"",i=-1!==n.indexOf("iPhone")||-1!==n.indexOf("iPod")||-1!==n.indexOf("iPad")||-1!==n.indexOf("iOs"),a=e.UI&&e.UI.hasHiddenDownloadForm(),l=t.getMetadata().get("PDFPreview");l instanceof Object&&(l=l.Key),o.buildPresignedGetUrl(t,null,"",{Bucket:"io",Key:"pydio-thumbstore/"+l,Expires:600},r).then((function(t){i||!a?document.location.href=t:e.UI.sendDownloadToHiddenForm(e.getUserSelection(),{presignedUrl:t})}))}}($e),downloadAll:function(e){return function(){var t=e.getContextHolder();t.setSelectedNodes([t.getRootNode()]),Ge(e)()}}($e),emptyRecycle:function(e){var t=e.MessageHash;return function(){e.UI.openComponentInModal("PydioReactUI","ConfirmDialog",{message:t[177],dialogTitleId:220,validCallback:function(){var t=e.user.getActiveRepositoryObject().getSlug(),o=new R.RestDeleteNodesRequest,r=new R.TreeServiceApi(ue().getRestClient()),n=new R.TreeNode;n.Path=t+"/recycle_bin",o.Nodes=[n],r.deleteNodes(o).then((function(t){t.DeleteJobs&&t.DeleteJobs.forEach((function(t){e.UI.displayMessage("SUCCESS",t.Label)})),e.getContextHolder().requireContextChange(e.getContextHolder().getRootNode())})).catch((function(t){e.UI.displayMessage("ERROR",t.Title||t.message)}))}})}}($e),restore:function(e){return function(){var t=e.getContextHolder().getSelectedNodes(),o=e.user.getActiveRepositoryObject().getSlug(),r=new R.RestRestoreNodesRequest,n=new R.TreeServiceApi(ue().getRestClient());r.Nodes=t.map((function(e){var t=new R.TreeNode;return t.Path=o+e.getPath(),t})),n.restoreNodes(r).then((function(o){o.RestoreJobs&&o.RestoreJobs.length&&t.forEach((function(e){o.RestoreJobs.forEach((function(t){t.NodeUuid===e.getMetadata().get("uuid")&&(e.getMetadata().set("pending_operation",t.Label),e.getMetadata().set("pending_operation_uuid",t.Uuid),e.notify("meta_replaced",e))}))})),e.getContextHolder().setSelectedNodes([])}))}}($e),openInEditor:n($e),ajxpLink:function(e){return function(){var t,o=Ye.getUrlFromBase(),r=e.repositoryId||(e.user?e.user.activeRepository:null);if(e.user){var n=e.user.repositories.get(r).getSlug();n&&(r="ws-"+n)}t=Ke.trimRight(o,"/")+"/"+r+e.getUserSelection().getUniqueNode().getPath(),e.UI.openComponentInModal("PydioReactUI","PromptDialog",{dialogTitleId:369,fieldLabelId:296,defaultValue:t,submitValue:Je.Empty})}}($e),openOtherEditorPicker:Xe($e),lock:function(e){return function(){var t=new R.UserMetaServiceApi(ue().getRestClient()),o=new R.IdmUpdateUserMetaRequest,r=e.getContextHolder().getUniqueNode(),n=new R.IdmUserMeta;n.NodeUuid=r.getMetadata().get("uuid"),n.Namespace="content_lock",n.JsonValue=e.user.id;var i=r.getMetadata().get("sl_locked");o.Operation=i?"DELETE":"PUT",o.MetaDatas=[n],t.updateUserMeta(o).then((function(t){e.getContextHolder().requireNodeReload(r)}))}}($e),goTo:function(e){return function(){var t=e.getContextHolder().getUniqueNode();e.goTo(t)}}($e)};function Ze(e){return Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ze(e)}function et(){et=function(){return t};var e,t={},o=Object.prototype,r=o.hasOwnProperty,n=Object.defineProperty||function(e,t,o){e[t]=o.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",l=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,o){return Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,o){return e[t]=o}}function u(e,t,o,r){var i=t&&t.prototype instanceof m?t:m,a=Object.create(i.prototype),l=new M(r||[]);return n(a,"_invoke",{value:R(e,o,l)}),a}function d(e,t,o){try{return{type:"normal",arg:e.call(t,o)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var p="suspendedStart",f="suspendedYield",g="executing",h="completed",y={};function m(){}function v(){}function b(){}var w={};c(w,a,(function(){return this}));var C=Object.getPrototypeOf,E=C&&C(C(I([])));E&&E!==o&&r.call(E,a)&&(w=E);var x=b.prototype=m.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function P(e,t){function o(n,i,a,l){var s=d(e[n],e,i);if("throw"!==s.type){var c=s.arg,u=c.value;return u&&"object"==Ze(u)&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){o("next",e,a,l)}),(function(e){o("throw",e,a,l)})):t.resolve(u).then((function(e){c.value=e,a(c)}),(function(e){return o("throw",e,a,l)}))}l(s.arg)}var i;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return i=i?i.then(n,n):n()}})}function R(t,o,r){var n=p;return function(i,a){if(n===g)throw Error("Generator is already running");if(n===h){if("throw"===i)throw a;return{value:e,done:!0}}for(r.method=i,r.arg=a;;){var l=r.delegate;if(l){var s=O(l,r);if(s){if(s===y)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===p)throw n=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=g;var c=d(t,o,r);if("normal"===c.type){if(n=r.done?h:f,c.arg===y)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=h,r.method="throw",r.arg=c.arg)}}}function O(t,o){var r=o.method,n=t.iterator[r];if(n===e)return o.delegate=null,"throw"===r&&t.iterator.return&&(o.method="return",o.arg=e,O(t,o),"throw"===o.method)||"return"!==r&&(o.method="throw",o.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=d(n,t.iterator,o.arg);if("throw"===i.type)return o.method="throw",o.arg=i.arg,o.delegate=null,y;var a=i.arg;return a?a.done?(o[t.resultName]=a.value,o.next=t.nextLoc,"return"!==o.method&&(o.method="next",o.arg=e),o.delegate=null,y):a:(o.method="throw",o.arg=new TypeError("iterator result is not an object"),o.delegate=null,y)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function N(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function I(t){if(t||""===t){var o=t[a];if(o)return o.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function o(){for(;++n<t.length;)if(r.call(t,n))return o.value=t[n],o.done=!1,o;return o.value=e,o.done=!0,o};return i.next=i}}throw new TypeError(Ze(t)+" is not iterable")}return v.prototype=b,n(x,"constructor",{value:b,configurable:!0}),n(b,"constructor",{value:v,configurable:!0}),v.displayName=c(b,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,s,"GeneratorFunction")),e.prototype=Object.create(x),e},t.awrap=function(e){return{__await:e}},S(P.prototype),c(P.prototype,l,(function(){return this})),t.AsyncIterator=P,t.async=function(e,o,r,n,i){void 0===i&&(i=Promise);var a=new P(u(e,o,r,n),i);return t.isGeneratorFunction(o)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(x),c(x,s,"Generator"),c(x,a,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),o=[];for(var r in t)o.push(r);return o.reverse(),function e(){for(;o.length;){var r=o.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=I,M.prototype={constructor:M,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(N),!t)for(var o in this)"t"===o.charAt(0)&&r.call(this,o)&&!isNaN(+o.slice(1))&&(this[o]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var o=this;function n(r,n){return l.type="throw",l.arg=t,o.next=r,n&&(o.method="next",o.arg=e),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],l=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var o=this.tryEntries.length-1;o>=0;--o){var n=this.tryEntries[o];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var o=this.tryEntries[t];if(o.finallyLoc===e)return this.complete(o.completion,o.afterLoc),N(o),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var o=this.tryEntries[t];if(o.tryLoc===e){var r=o.completion;if("throw"===r.type){var n=r.arg;N(o)}return n}}throw Error("illegal catch attempt")},delegateYield:function(t,o,r){return this.delegate={iterator:I(t),resultName:o,nextLoc:r},"next"===this.method&&(this.arg=e),y}},t}function tt(e,t,o,r,n,i,a){try{var l=e[i](a),s=l.value}catch(e){return void o(e)}l.done?t(s):Promise.resolve(s).then(r,n)}function ot(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,rt(r.key),r)}}function rt(e){var t=function(e){if("object"!=Ze(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!=Ze(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ze(t)?t:t+""}var nt,it,at,lt=x().requireLib("boot").PromptValidators;x().getInstance().observe("reload_node_templates",(function(){console.log("reload_node_templates"),nt=null,at=null,clearTimeout(it),x().getInstance().getController().fireContextChange()}));var st=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"dynamicBuilder",value:function(){var e=this,t=x().getInstance();if(null!==nt&&(at=nt),at){var o={doc:"file-word",docx:"file-word",odt:"file-word",odg:"file-chart",odp:"file-powerpoint",ods:"file-excel",pot:"file-powerpoint",pptx:"file-powerpoint",rtf:"file-word",xls:"file-excel",xlsx:"file-excel"};return at.map((function(r){var n;n=r.UUID&&Be().getFileExtension(r.UUID)?Be().getFileExtension(r.UUID):Be().getFileExtension(r.Label)?Be().getFileExtension(r.Label):"txt";var i="file";o[n]&&(i=o[n]);var a=r.Label;return r.Editable&&(a=React.createElement("div",{style:{display:"flex"}},React.createElement("span",{style:{flex:1}},r.Label),React.createElement("span",{onClick:function(e){e.stopPropagation(),dt.deleteTemplateByUuid(r.UUID)},className:"mdi mdi-delete",style:{opacity:.3}}))),{name:a,alt:r.Label,icon_class:"mdi mdi-"+i,callback:function(){var e,o=(e=et().mark((function e(o){var i,a,l,s,c,u,d,p,f,g;return et().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=t.user.getRepositoriesList(),a=t.getContextHolder().getContextNode(),l=i.get(t.user.activeRepository).getSlug(),s=t.MessageHash["mkfile.untitled.document"]||"Untitled",c=(c=l+a.getPath()+"/"+s+"."+n).replace("//","/"),u=Be().getDirname(c),d=ct(a,Be().getBasename(c)),p=[],a.getChildren().forEach((function(e){return p.push(Be().getBasename(e.getPath()).toLowerCase())})),f=[lt.Empty,lt.NoSlash,lt.MustDifferSiblings(p)],g=function(e){var t=new R.TreeServiceApi(PydioApi.getRestClient()),o=new R.RestCreateNodesRequest,n=new R.TreeNode;n.Path=u+"/"+e,n.Type=R.TreeNodeType.constructFromObject("LEAF"),o.Nodes=[n],o.TemplateUUID=r.UUID,t.createNodes(o).then((function(e){}))},t.UI.openComponentInModal("PydioReactUI","PromptDialog",{dialogTitleId:156,legendId:r.Label,fieldLabelId:174,dialogSize:"sm",defaultValue:d,defaultInputSelection:!0,submitValue:g,warnSpace:!0,validate:function(e){f.forEach((function(t){return t(e)}))}});case 13:case"end":return e.stop()}}),e)})),function(){var t=this,o=arguments;return new Promise((function(r,n){var i=e.apply(t,o);function a(e){tt(i,r,n,a,l,"next",e)}function l(e){tt(i,r,n,a,l,"throw",e)}a(void 0)}))});return function(e){return o.apply(this,arguments)}}().bind(e)}}))}return it&&clearTimeout(it),new R.TemplatesServiceApi(PydioApi.getRestClient()).listTemplates().then((function(e){at=e.Templates.filter((function(e){return"LEAF"===e.Node.Node.Type}));var o=new R.RestTemplate;o.Label=t.MessageHash["mkfile.empty.template.label"]||"Empty File",o.UUID="",at.unshift(o),at.sort((function(e,t){return e.Editable?-1:t.Editable?1:e<=t})),nt=at,it=setTimeout((function(){nt=null}),2e3),x().getInstance().getController().fireContextChange()})),[]}}],null&&ot(e.prototype,null),t&&ot(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function ct(e,t){for(var o=e.getChildren(),r=function(e){var t=!1;return o.forEach((function(o){o.getLabel()===e&&(t=!0)})),t},n=t.lastIndexOf("."),i=t.substring(0,n),a=t.substring(n),l=t,s=1,c=r(l);c;)l=i+"-"+s+a,s++,c=r(l);return l}var ut=o.g.pydio,dt={mkfileDynamicBuilder:st.dynamicBuilder,downloadSelectionChange:function(e){return function(){var t=e.getUserSelection();e.Parameters.get("zipEnabled")&&e.Parameters.get("multipleFilesDownloadEnabled")||t.hasDir()&&(this.selectionContext.dir=!1)}}(ut),downloadAllInit:function(e){return function(){e.Parameters.get("zipEnabled")&&e.Parameters.get("multipleFilesDownloadEnabled")||(this.hide(),e.Controller.actions.delete("download_all"))}}(ut),compressUiSelectionChange:function(e){return function(){var t=e.getUserSelection();e.Parameters.get("zipEnabled")&&e.Parameters.get("multipleFilesDownloadEnabled")||(t.isUnique()?this.selectionContext.multipleOnly=!0:this.selectionContext.unique=!0)}}(ut),copyContextChange:function(e){return function(){this.rightsContext.write=!0;var t=e.user;t&&t.canRead()&&t.canCrossRepositoryCopy()&&t.hasCrossRepositories()&&(this.rightsContext.write=!1,t.canWrite()||(e.getController().defaultActions.delete("ctrldragndrop"),e.getController().defaultActions.delete("dragndrop"))),t&&t.canWrite()&&e.getContextNode().hasAjxpMimeInBranch("ajxp_browsable_archive")&&(this.rightsContext.write=!1),e.getContextNode().hasAjxpMimeInBranch("ajxp_browsable_archive")?this.setLabel(247,248):this.setLabel(66,159)}}(ut),openWithDynamicBuilder:function(e){var t=Xe(e),o=e.MessageHash;return function(){var r=[];if(e.getUserSelection().isEmpty())return r;var n=e.getUserSelection().getUniqueNode(),i=Be().getAjxpMimeType(n),a="true"===n.getMetadata().get("node_readonly"),l=e.user;if(l){var s=l.getLayoutPreference("Editor.Associations",{});Object.keys(s).forEach(function(t){var o;e.Registry.getActiveExtensionByType("editor").forEach((function(e){e.editorClass===s[t]&&(o=e)})),o&&-1===o.mimes.indexOf(t)&&o.mimes.push(t)}.bind(this))}var c=e.Registry.findEditorsForMime(i,!1),u=0,d=!1;return c.length&&c.forEach(function(e){!e.openable||e.write&&a||(e.mimes.indexOf("*")>-1&&(!d&&u>0&&r.push({separator:!0}),d=!0),r.push({name:e.text,alt:e.title,isDefault:0===u,icon_class:e.icon_class,callback:function(t){this.apply([e])}.bind(this)}),u++)}.bind(this)),r.length&&!d&&r.push({separator:!0}),r.push({name:o["openother.1"],alt:o["openother.2"],isDefault:0===u,icon_class:"mdi mdi-view-list",callback:t}),r}}(ut),lockSelectionChange:function(e){return function(){var t=e.getController().getActionByName("sl_lock"),o=e.getUserSelection().getUniqueNode();t&&o&&(t.selectionContext.allowedMimes=[],o.getMetadata().get("sl_locked")?(t.setIconClassName("mdi mdi-lock-outline"),t.setLabel("meta.simple_lock.3"),o.getMetadata().get("sl_mylock")||(t.selectionContext.allowedMimes=["fake_extension_that_never_exists"])):(t.setIconClassName("mdi mdi-lock-outline"),t.setLabel("meta.simple_lock.1")))}}(ut),deleteTemplateByUuid:function(){}};window.FSActions=r})();