(()=>{"use strict";var e={173:e=>{e.exports=require("material-ui/styles")}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{r.r(n),r.d(n,{Callbacks:()=>Xt,Dashboard:()=>hr,Editor:()=>ro,Forms:()=>no,PoliciesBoard:()=>rn,RolesDashboard:()=>kr,TreeGroupsDialog:()=>vn});const e=require("react");var t=r.n(e);const o=require("create-react-class");var i=r.n(o);const a=require("prop-types");var s=r.n(a);const l=require("material-ui"),c=require("pydio");var u=r.n(c);const p=require("pydio/lang/observable");var f=r.n(p);const d=require("pydio/http/api");var m=r.n(d);const y=require("cells-sdk");var h="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),g=new Uint8Array(16);function b(){if(!h)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return h(g)}for(var v=[],O=0;O<256;++O)v[O]=(O+256).toString(16).substr(1);const P=function(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||b)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var i=0;i<16;++i)t[n+i]=o[i];return t||function(e,t){var r=t||0,n=v;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")}(o)};function R(e){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R(e)}function S(e){return function(e){if(Array.isArray(e))return w(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return w(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?w(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function E(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function k(e,t){return k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},k(e,t)}function A(e){return A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},A(e)}var j=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(s,e);var t,r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,r,n=A(o);if(i){var a=A(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!==R(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):r});function s(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this)).acls=[],t.dirty=!1,t.parentRoles=r,t.parentAcls={},t.showUniqueRole=void 0,e?t.idmRole=e:(t.idmRole=new y.IdmRole,t.idmRole.Uuid=P()),t.makeSnapshot(),t}return t=s,r=[{key:"load",value:function(){return this.loadAcls()}},{key:"isDirty",value:function(){return this.dirty}},{key:"getIdmRole",value:function(){return this.buildProxy(this.idmRole)}},{key:"makeSnapshot",value:function(){var e=this;this.snapshot=y.IdmRole.constructFromObject(JSON.parse(JSON.stringify(this.idmRole))),this.aclSnapshot=[],this.acls.forEach((function(t){e.aclSnapshot.push(y.IdmACL.constructFromObject(JSON.parse(JSON.stringify(t))))}))}},{key:"updateParentRoles",value:function(e){var t=this;this.parentRoles=e,this.loadAcls(!0).then((function(){t.notify("update")}))}},{key:"setUniqueRoleDisplay",value:function(e){this.showUniqueRole=e,this.notify("update")}},{key:"getUniqueRoleDisplay",value:function(){return this.showUniqueRole}},{key:"loadAcls",value:function(){var e,t=this,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=new y.ACLServiceApi(m().getRestClient()),o=new y.RestSearchACLRequest;o.Queries=[];var i=new y.IdmACLSingleQuery;return i.RoleIDs=[],r||(i.RoleIDs=[this.idmRole.Uuid]),(e=i.RoleIDs).push.apply(e,S(this.parentRoles.map((function(e){return e.Uuid})))),o.Queries.push(i),n.searchAcls(o).then((function(e){var n=s.FormatPolicyAclFromStore(e.ACLs||[]);t.parentRoles.length?(r||(t.acls=n.filter((function(e){return e.RoleID===t.idmRole.Uuid}))),t.parentRoles.forEach((function(e){t.parentAcls[e.Uuid]=n.filter((function(t){return t.RoleID===e.Uuid}))}))):t.acls=n,r||t.makeSnapshot()}))}},{key:"revert",value:function(){this.idmRole=this.snapshot,this.acls=this.aclSnapshot,this.dirty=!1,this.makeSnapshot(),this.notify("update")}},{key:"save",value:function(){var e=this,t=new y.RoleServiceApi(m().getRestClient()),r=new y.ACLServiceApi(m().getRestClient());return t.setRole(this.idmRole.Uuid,this.idmRole).then((function(t){e.idmRole=t;var n=new y.RestSearchACLRequest;n.Queries=[];var o=new y.IdmACLSingleQuery;return o.RoleIDs=[e.idmRole.Uuid],n.Queries.push(o),r.searchAcls(n).then((function(t){var o=t.ACLs||[],i=s.FormatPolicyAclToStore(e.acls),a=e.diffAcls(o,i),l=a.inserts,c=a.deletes;return Promise.all(c.map((function(e){return r.deleteAcl(e)}))).then((function(){return Promise.all(l.map((function(e){return r.putAcl(e)}))).then((function(t){return r.searchAcls(n).then((function(t){e.acls=s.FormatPolicyAclFromStore(t.ACLs||[]),e.makeSnapshot(),e.dirty=!1,e.notify("update")}))}))}))}))}))}},{key:"diffAcls",value:function(e,t){var r=this,n=e.filter((function(e){return!t.find((function(t){return r.equals(e,t)}))}));return{inserts:t.filter((function(t){return!e.find((function(e){return r.equals(t,e)}))})),deletes:n}}},{key:"equals",value:function(e,t){return e.NodeID===t.NodeID&&e.Action.Name===t.Action.Name&&e.Action.Value===t.Action.Value&&e.WorkspaceID===t.WorkspaceID}},{key:"setParameter",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PYDIO_REPO_SCOPE_ALL",o=this.acls.filter((function(t){return t.Action.Name===e&&t.WorkspaceID===n}));if(o.length){var i=o[0],a=void 0;this.parentRoles.forEach((function(t){a=r.getAclValue(r.parentAcls[t.Uuid],e,n,a)})),void 0!==a&&a===t?this.acls=this.acls.filter((function(e){return e!==i})):i.Action.Value=JSON.stringify(t)}else{var s=new y.IdmACL;s.RoleID=this.idmRole.Uuid,s.WorkspaceID=n,s.Action=new y.IdmACLAction,s.Action.Name=e,s.Action.Value=JSON.stringify(t),this.acls.push(s)}this.dirty=!0,this.notify("update")}},{key:"deleteParameter",value:function(e){this.acls=this.acls.filter((function(t){return t!==e})),this.dirty=!0,this.notify("update")}},{key:"getParameterValue",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"PYDIO_REPO_SCOPE_ALL",n=void 0;return this.parentRoles.forEach((function(o){n=t.getAclValue(t.parentAcls[o.Uuid],e,r,n)})),this.getAclValue(this.acls,e,r,n)}},{key:"listParametersAndActions",value:function(){var e=this,t=function(e){return e.Action.Name&&(0===e.Action.Name.indexOf("parameter:")||0===e.Action.Name.indexOf("action:"))},r=this.acls||[];return r=r.filter(t),this.parentRoles.forEach((function(n){var o=e.parentAcls[n.Uuid]||[];o=o.filter(t).filter((function(e){return!r.filter((function(t){return t.Action.Name===e.Action.Name})).length})).map((function(e){var t=y.IdmACL.constructFromObject(JSON.parse(JSON.stringify(e)));return t.INHERITED=!0,t})),r=[].concat(S(r),S(o))})),r}},{key:"getAclValue",value:function(e,t,r,n){if(!e)return n;var o=e.filter((function(e){return e.Action.Name===t&&e.WorkspaceID===r}));try{return JSON.parse(o[0].Action.Value)}catch(e){return n}}},{key:"getAclString",value:function(e,t){var r,n,o,i,a,s=this,l=!1;if(e){var c=e.RootNodes,u=c[Object.keys(c).shift()];r=e.UUID,n=u.Uuid}else n=t;if(this.showUniqueRole?a=this._aclStringForAcls(this.parentAcls[this.showUniqueRole],r,n):(this.parentRoles.forEach((function(e){var t=s._aclStringForAcls(s.parentAcls[e.Uuid],r,n);void 0!==t&&(i=t)})),a=this._aclStringForAcls(this.acls,r,n)),void 0!==a)o=a;else{if(void 0===i)return{aclString:""};o=i,l=!0}return{aclString:Object.keys(o).filter((function(e){return o[e]})).join(","),inherited:l}}},{key:"_aclStringForAcls",value:function(e,t,r){if(e){var n={read:!1,write:!1,deny:!1},o=e.filter((function(e){return e.Action.Name&&0===e.Action.Name.indexOf("policy:")&&(!t||e.WorkspaceID===t)&&e.NodeID===r&&"1"===e.Action.Value}));return o.length?(n[o[0].Action.Name]=!0,n):(Object.keys(n).forEach((function(o){e.filter((function(e){return e.Action.Name===o&&(!t||e.WorkspaceID===t)&&e.NodeID===r&&"1"===e.Action.Value})).length&&(n[o]|=!0)})),n.read||n.write||n.deny?n:void 0)}}},{key:"updateAcl",value:function(e,t,r){var n=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=[],a=!1;t?(i=[t],a=o&&Object.keys(o.RootNodes).indexOf(t)>-1):i=Object.keys(e.RootNodes),this.acls=e?this.acls.filter((function(t){return!(("read"===t.Action.Name||"write"===t.Action.Name||"deny"===t.Action.Name||t.Action.Name&&0===t.Action.Name.indexOf("policy:"))&&t.WorkspaceID===e.UUID&&i.indexOf(t.NodeID)>-1&&"1"===t.Action.Value)})):this.acls.filter((function(e){return!(("read"===e.Action.Name||"write"===e.Action.Name||"deny"===e.Action.Name||e.Action.Name&&0===e.Action.Name.indexOf("policy:"))&&e.NodeID===t&&"1"===e.Action.Value)})),""!==r&&r.split(",").forEach((function(t){i.forEach((function(r){var i=new y.IdmACL;i.NodeID=r,e?i.WorkspaceID=e.UUID:a&&(i.WorkspaceID=o.UUID),i.RoleID=n.idmRole.Uuid,i.Action=y.IdmACLAction.constructFromObject({Name:t,Value:"1"}),n.acls.push(i)}))})),this.dirty=!0,this.notify("update")}},{key:"buildProxy",value:function(e){var t=this;return new Proxy(e,{set:function(e,r,n){return e[r]=n,t.dirty=!0,t.notify("update"),!0},get:function(e,r){var n=e[r];return n instanceof Array?n:n instanceof Object?t.buildProxy(n):n}})}}],n=[{key:"FormatPolicyAclFromStore",value:function(e){return e.map((function(e){return e.Action&&"policy"===e.Action.Name&&(e.Action.Name="policy:"+e.Action.Value,e.Action.Value="1"),e}))}},{key:"FormatPolicyAclToStore",value:function(e){return e.map((function(e){if(e.Action&&0===e.Action.Name.indexOf("policy:")){var t=y.IdmACL.constructFromObject(JSON.parse(JSON.stringify(e)));return t.Action.Name="policy",t.Action.Value=e.Action.Name.split(":")[1],t}return e}))}}],r&&E(t.prototype,r),n&&E(t,n),s}(f());function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}function C(e){return function(e){if(Array.isArray(e))return M(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return M(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?M(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function N(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function I(e,t){return I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},I(e,t)}function _(e){return _=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_(e)}var T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(a,e);var t,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,r,i=_(n);if(o){var a=_(this).constructor;e=Reflect.construct(i,arguments,a)}else e=i.apply(this,arguments);return t=this,!(r=e)||"object"!==x(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):r});function a(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this)).acls=[];var r=[];return e?(t.idmUser=e,t.idmUser.Roles&&(t.idmRole=t.idmUser.Roles.filter((function(e){return e.Uuid===t.idmUser.Uuid}))[0],t.idmUser.IsGroup||(r=t.idmUser.Roles.filter((function(e){return e.Uuid!==t.idmUser.Uuid})))),t.idmUser.Attributes||(t.idmUser.Attributes={})):(t.idmUser=new y.IdmUser,t.idmUser.Uuid=P(),t.idmRole=y.IdmRole.constructFromObject({Uuid:t.idmUser.Uuid}),t.idmUser.Roles=[t.idmRole],t.idmUser.Attributes={}),t.role=new j(t.idmRole,r),t.role.observe("update",(function(){t.dirty|=t.role.isDirty(),t.notify("update")})),t.makeSnapshot(),t}return t=a,r=[{key:"load",value:function(){var e=this;this.role.load().then((function(){e.notify("update")}))}},{key:"isDirty",value:function(){return this.dirty}},{key:"save",value:function(){var e=this;return PydioApi.getRestClient().getIdmApi().updateIdmUser(this.idmUser).then((function(t){return e.idmUser=t,e.role.isDirty()?e.role.save().then((function(){e.makeSnapshot(),e.dirty=!1,e.notify("update")})):(e.makeSnapshot(),e.dirty=!1,e.notify("update"),Promise.resolve(e))}))}},{key:"revert",value:function(){var e=this;if(this.idmUser=this.snapshot,this.makeSnapshot(),this.dirty=!1,this.role.revert(),this.idmUser.Roles&&(this.idmRole=this.idmUser.Roles.filter((function(t){return t.Uuid===e.idmUser.Uuid}))[0],!this.idmUser.IsGroup)){var t=this.idmUser.Roles.filter((function(t){return t.Uuid!==e.idmUser.Uuid}));this.role.updateParentRoles(t)}this.notify("update")}},{key:"makeSnapshot",value:function(){this.snapshot=y.IdmUser.constructFromObject(JSON.parse(JSON.stringify(this.idmUser)))}},{key:"getRole",value:function(){return this.role}},{key:"addRole",value:function(e){var t=this,r=this.idmUser.Roles.filter((function(e){return e.Uuid!==t.idmUser.Uuid}));r=[].concat(C(r.filter((function(t){return t.Uuid!==e.Uuid}))),[e]),this.idmUser.Roles=[].concat(C(r),[this.idmRole]),this.dirty=!0,this.role.setUniqueRoleDisplay(null),this.role.updateParentRoles(r)}},{key:"removeRole",value:function(e){var t=this,r=this.idmUser.Roles.filter((function(r){return r.Uuid!==t.idmUser.Uuid&&r.Uuid!==e.Uuid}));this.idmUser.Roles=[].concat(C(r),[this.idmRole]),this.dirty=!0,this.role.setUniqueRoleDisplay(null),this.role.updateParentRoles(r)}},{key:"switchRoles",value:function(e,t){for(var r,n,o,i=this,a=this.idmUser.Roles.filter((function(e){return e.Uuid!==i.idmUser.Uuid})),s=0;s<a.length;s++)a[s].Uuid===e?(r=s,o=a[s]):a[s].Uuid===t&&(n=s);a[r]=a[n],a[n]=o,this.idmUser.Roles=[].concat(C(a),[this.idmRole]),this.dirty=!0,this.role.setUniqueRoleDisplay(null),this.role.updateParentRoles(a)}},{key:"getIdmUser",value:function(){return this.buildProxy(this.idmUser)}},{key:"buildProxy",value:function(e){var t=this;return new Proxy(e,{set:function(e,r,n){return e[r]=n,t.dirty=!0,t.notify("update"),!0},get:function(e,r){var n=e[r];return n instanceof Array?n:n instanceof Object?t.buildProxy(n):n}})}}],r&&N(t.prototype,r),a}(f());const U=require("pydio/util/lang");var D=r.n(U);function L(e){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(e)}function B(){return B=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},B.apply(this,arguments)}function F(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function q(e,t){return q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},q(e,t)}function H(e){return H=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},H(e)}function W(r){return function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&q(e,t)}(l,e);var n,o,i,a,s=(i=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,r,n=H(i);if(a){var o=H(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!==L(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):r});function l(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),s.apply(this,arguments)}return n=l,o=[{key:"render",value:function(){var e=this.props.pydio;e||(e=u().getInstance());var n=e.MessageHash;return t().createElement(r,B({},this.props,{getMessage:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pydio_role";return n[t+(t?".":"")+e]||e},getPydioRoleMessage:function(e){return n["role_editor."+e]||e},getRootMessage:function(e){return n[e]||e},getAdminMessage:function(e){return n["ajxp_admin."+e]||e}}))}}],o&&F(n.prototype,o),l}(e.Component)}function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}function V(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function z(e,t){return z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},z(e,t)}function K(e){return K=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},K(e)}const J=W(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,r,n=K(o);if(i){var a=K(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!==G(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):r});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={acl:e.acl},t}return r=s,(n=[{key:"componentWillReceiveProps",value:function(e){this.setState({acl:e.acl})}},{key:"getAcl",value:function(){return this.state.acl}},{key:"updateAcl",value:function(){if(!this.props.disabled){var e,t=this.refs.deny&&this.refs.deny.isChecked(),r=!t&&this.refs.read&&this.refs.read.isChecked(),n=!t&&this.refs.write&&this.refs.write.isChecked(),o=[];t?o.push("deny"):(r&&o.push("read"),n&&o.push("write")),e=o.join(","),this.props.onChange&&this.props.onChange(e,this.props.acl),this.setState({acl:e})}}},{key:"handleChangePolicy",value:function(e,t){var r="policy:"+t;this.props.onChange?this.props.onChange(r,this.props.acl):this.setState({acl:r})}},{key:"render",value:function(){var e=this.props,r=e.hideDeny,n=e.hideWrite,o=e.hideLabels,i=e.disabled,a=e.getMessage,s=this.state.acl||"",c=n?92:132;if(s.startsWith("policy:"))return t().createElement("div",{style:{display:"flex",alignItems:"center",width:c,height:33}},"Custom policy");var u={width:44};return t().createElement("div",{style:{display:"flex",alignItems:"center",width:c,height:33}},t().createElement(l.Checkbox,{ref:"read",label:o?"":a("react.5a","ajxp_admin"),value:"read",onCheck:this.updateAcl.bind(this),disabled:i||s.indexOf("deny")>-1,checked:-1===s.indexOf("deny")&&-1!==s.indexOf("read"),style:u}),!n&&t().createElement(l.Checkbox,{ref:"write",label:o?"":a("react.5b","ajxp_admin"),value:"write",onCheck:this.updateAcl.bind(this),disabled:i||s.indexOf("deny")>-1,checked:-1===s.indexOf("deny")&&-1!==s.indexOf("write"),style:u}),!r&&t().createElement(l.Checkbox,{ref:"deny",label:o?"":a("react.5","ajxp_admin"),value:"-",disabled:i,onCheck:this.updateAcl.bind(this),checked:-1!==s.indexOf("deny"),style:u}))}}])&&V(r.prototype,n),s}(t().Component));function Q(e){return Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q(e)}function $(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Y(e,t){return Y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Y(e,t)}function X(e){return X=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},X(e)}var Z=u().requireLib("components").ListEntry;const ee=W(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Y(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,r,n=X(o);if(i){var a=X(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!==Q(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):r});function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),a.apply(this,arguments)}return r=s,(n=[{key:"onAclChange",value:function(e,t){var r=this.props,n=r.role,o=r.workspace;n.updateAcl(o,null,e)}},{key:"render",value:function(){var e=this.props,r=e.workspace,n=e.role,o=e.pageAcl,i=e.getPydioRoleMessage;if(!r.RootNodes||!Object.keys(r.RootNodes).length)return t().createElement(Z,{className:"workspace-acl-entry",firstLine:t().createElement("span",{style:{textDecoration:"line-through",color:"#ef9a9a"}},r.Label+" ("+i("workspace.roots.invalid")+")")});var a=n.getAclString(r),s=a.aclString,l=a.inherited,c=!!n.getUniqueRoleDisplay(),u=t().createElement(J,{acl:s,onChange:this.onAclChange.bind(this),hideLabels:!0,hideWrite:o,disabled:c}),p=r.Label+(l?" ("+i("38")+")":"");return r.Description&&(p=t().createElement("span",{title:r.Description},p)),t().createElement(Z,{className:(l?"workspace-acl-entry-inherited ":"")+"workspace-acl-entry",firstLine:p,actions:u})}}])&&$(r.prototype,n),s}(t().Component));function te(e){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},te(e)}function re(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ne(e,t){return ne=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ne(e,t)}function oe(e){return oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},oe(e)}var ie=u().requireLib("components").MaterialTable,ae=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ne(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,r,n=oe(o);if(i){var a=oe(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!==te(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):r});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={loading:!0,workspaces:[]};var r=new y.WorkspaceServiceApi(m().getRestClient()),n=new y.RestSearchWorkspaceRequest;return n.Queries=[y.IdmWorkspaceSingleQuery.constructFromObject({scope:"ADMIN"})],r.searchWorkspaces(n).then((function(e){var r=e.Workspaces||[];r.sort(D().arraySorter("Label",!1,!0)),t.setState({workspaces:r,loading:!1})})).catch((function(e){t.setState({loading:!1})})),t}return r=s,(n=[{key:"render",value:function(){var e=this.props,r=e.role,n=e.advancedAcl,o=this.state,i=o.workspaces,a=o.loading;if(!r)return t().createElement("div",null);var s=[{name:"acl",label:"",style:{paddingLeft:0,paddingRight:0},renderCell:function(e){return t().createElement(ee,{workspace:e,role:r,advancedAcl:n})}}];return t().createElement("div",{style:{clear:"both"},className:"material-list"},t().createElement(ie,{data:i,columns:s,hideHeaders:!0,paginate:[10,25,50,100],defaultPageSize:25,showCheckboxes:!1,emptyStateString:a?u().getInstance().MessageHash["ajxp_admin.loading"]:""}))}}])&&re(r.prototype,n),s}(t().Component);function se(e){return se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},se(e)}function le(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ce(e,t){return ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ce(e,t)}function ue(e){return ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ue(e)}var pe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ce(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,r,n=ue(o);if(i){var a=ue(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!==se(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):r});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=a.call(this,e);var r=function(t){return e.pydio.MessageHash["pydio_role."+t]||t},n=[],o=new y.IdmWorkspace;o.UUID="homepage",o.Label=r("workspace.statics.home.title"),o.Description=r("workspace.statics.home.description"),o.Slug="homepage",o.RootNodes={"homepage-ROOT":y.TreeNode.constructFromObject({Uuid:"homepage-ROOT"})},n.push(o);var i=new y.IdmWorkspace;if(i.UUID="directory",i.Label=r("workspace.statics.directory.title"),i.Description=r("workspace.statics.directory.description"),i.Slug="directory",i.RootNodes={"directory-ROOT":y.TreeNode.constructFromObject({Uuid:"directory-ROOT"})},n.push(i),e.showSettings){var l=new y.IdmWorkspace;l.UUID="settings",l.Label=r("workspace.statics.settings.title"),l.Description=r("workspace.statics.settings.description"),l.Slug="settings",l.RootNodes={"settings-ROOT":y.TreeNode.constructFromObject({Uuid:"settings-ROOT"})},n.push(l)}return n.sort(D().arraySorter("Label",!1,!0)),t.state={workspaces:n},t}return r=s,n=[{key:"render",value:function(){var e=this.props.role,r=this.state.workspaces;return e?t().createElement("div",{style:{backgroundColor:"white",clear:"both"},className:"material-list"},r.map((function(n,o){var i={};return o<r.length-1&&(i={borderBottom:"1px solid #e0e0e0"}),t().createElement("div",{style:i},t().createElement(ee,{workspace:n,role:e,pageAcl:!0}))}))):t().createElement("div",null)}}],n&&le(r.prototype,n),s}(t().Component);const fe=require("pydio/util/path");var de=r.n(fe),me=r(173);function ye(e){return ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(e)}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ge(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function be(e,t){return be=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},be(e,t)}function ve(e){return ve=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ve(e)}var Oe=u().requireLib("form").FormPanel,Pe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&be(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,r,n=ve(o);if(i){var a=ve(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!==ye(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):r});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={parameters:[]},AdminComponents.PluginsLoader.getInstance(e.pydio).formParameters("//global_param[contains(@scope,'role')]|//param[contains(@scope,'role')]").then((function(e){t.setState({parameters:e})})),t}return r=s,(n=[{key:"getPydioRoleMessage",value:function(e){return this.props.pydio.MessageHash["role_editor."+e]||e}},{key:"onParameterChange",value:function(e,t,r){var n=this.props.role,o=n.getIdmRole();if("applies"===e)o.AutoApplies=t.split(",");else if("roleLabel"===e)o.Label=t;else if("roleForceOverride"===e)o.ForceOverride=t;else if("roleType"===e)o.IsTeam="team"===t;else{var i=this.getParameterByName(e);i.aclKey&&n.setParameter(i.aclKey,t)}}},{key:"getParameterByName",value:function(e){return this.state.parameters.filter((function(t){return t.name===e}))[0]}},{key:"render",value:function(){var e=this.props,r=e.role,n=e.pydio,o=this.state.parameters;if(!o)return t().createElement("div",null,n.MessageHash["ajxp_admin.loading"]);var i,a={admin:"157",standard:"156",shared:"158",anon:"159"},s=Object.keys(a).map((function(e){return e+"|"+n.MessageHash["settings."+a[e]]})).join(","),l={applies:[]},c=!1,u=this.getPydioRoleMessage("roleType.admin.description").replace(",","").replace("|",""),p=this.getPydioRoleMessage("roleType.IsTeam.description").replace(",","").replace("|",""),f={name:"roleType",label:this.getPydioRoleMessage("roleType"),description:this.getPydioRoleMessage("roleType.description"),type:"select",choices:"admin|".concat(u,",team|").concat(p)};if(r){var d=r.getIdmRole();d.GroupRole||d.UserRole?(f.readonly=!0,f.type="string",i=this.getPydioRoleMessage("roleType."+(d.GroupRole?m().RoleTypeGroup:m().RoleTypeUser)+".description"),c=!0):i=d.IsTeam?"team":"admin";var y=d.AutoApplies||[];l={roleId:d.Uuid,applies:y.filter((function(e){return!!e})),roleLabel:d.Label,roleType:i,roleForceOverride:d.ForceOverride||!1},o.map((function(e){e.aclKey&&r.getParameterValue(e.aclKey)&&(l[e.name]=r.getParameterValue(e.aclKey))}))}var h,g=[{name:"roleId",label:this.getPydioRoleMessage("31"),type:"string",readonly:!0,description:this.getPydioRoleMessage("role.id.description")},f,{name:"roleLabel",label:this.getPydioRoleMessage("32"),type:"string",description:this.getPydioRoleMessage("role.label.description")},!c&&{name:"applies",label:this.getPydioRoleMessage("33"),type:"select",multiple:!0,choices:s,description:this.getPydioRoleMessage("role.autoapply.description")},!c&&{name:"roleForceOverride",label:this.getPydioRoleMessage("role.override.label"),type:"boolean",description:this.getPydioRoleMessage("role.override.description")}].concat((h=o,function(e){if(Array.isArray(e))return he(e)}(h)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(h)||function(e,t){if(e){if("string"==typeof e)return he(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?he(e,t):void 0}}(h)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())).filter((function(e){return e}));return t().createElement("div",{className:"paper-right-block"},t().createElement(Oe,{parameters:g,onParameterChange:this.onParameterChange.bind(this),values:l,depth:-2,variant:"v2",variantShowLegend:!0}))}}])&&ge(r.prototype,n),s}(t().Component);function Re(){return Re=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Re.apply(this,arguments)}function Se(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function we(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ee(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?we(Object(r),!0).forEach((function(t){ke(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):we(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ke(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ae(e){return Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ae(e)}function je(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function xe(e,t){return xe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},xe(e,t)}function Ce(e){return Ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ce(e)}Pe.PropTypes={pydio:s().instanceOf(u()).isRequired,pluginsRegistry:s().instanceOf(XMLDocument),role:s().instanceOf(j)};var Me=u().requireLib("form").FormPanel,Ne=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xe(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,r,n=Ce(o);if(i){var a=Ce(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!==Ae(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):r});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={parameters:[]},AdminComponents.PluginsLoader.getInstance(e.pydio).formParameters('//global_param[contains(@scope,"user")]|//param[contains(@scope,"user")]').then((function(e){t.setState({parameters:e})})),t}return r=s,n=[{key:"getBinaryContext",value:function(){var e=this.props.user;return"user_id="+e.getIdmUser().Login+(e.getIdmUser().Attributes&&e.getIdmUser().Attributes.avatar?"?"+e.getIdmUser().Attributes.avatar:"")}},{key:"getPydioRoleMessage",value:function(e){return this.props.pydio.MessageHash["role_editor."+e]||e}},{key:"onParameterChange",value:function(e,t,r){var n=this.props.user,o=this.state.parameters.filter((function(t){return t.name===e})),i=n.getIdmUser(),a=n.getRole();"displayName"===e||"email"===e||"profile"===e||"avatar"===e?i.Attributes[e]=t:o.length&&o[0].aclKey&&a.setParameter(o[0].aclKey,t)}},{key:"buttonCallback",value:function(e){var t=this.props.user;if("update_user_pwd"===e)this.props.pydio.UI.openComponentInModal("AdminPeople","Editor.User.UserPasswordDialog",{user:t});else{var r=t.getIdmUser(),n="user_set_lock-lock"===e?"logout":"pass_change",o=[];if(r.Attributes.locks){var i=JSON.parse(r.Attributes.locks);i&&"object"===Ae(i)&&(o=i)}o.indexOf(n)>-1?(o=o.filter((function(e){return e!==n})),"user_set_lock-lock"===e&&delete r.Attributes.failedConnections):o.push(n),r.Attributes.locks=JSON.stringify(o),t.save()}}},{key:"render",value:function(){var e=this,r=this.props,n=r.user,o=r.pydio,i=r.adminStyles,a=this.state.parameters;if(!a)return t().createElement("div",null,"Loading...");var s,c={profiles:[]},u=[];if(n){var p=n.getIdmUser(),f=n.getRole();if(s="true"===p.Attributes.hidden,p.Attributes.locks&&"object"===Ae(u=JSON.parse(p.Attributes.locks)||[])&&void 0===u.length){var d=[];Object.keys(u).forEach((function(e){!0===u[e]&&d.push(e)})),u=d}var m=p.Attributes||{};c=Ee(Ee({},c),{},{avatar:m.avatar,displayName:m.displayName,email:m.email,profile:m.profile,login:p.Login}),a.map((function(e){e.aclKey&&f.getParameterValue(e.aclKey)&&(c[e.name]=f.getParameterValue(e.aclKey))}))}var y,h=["admin","standard","shared"].map((function(e){return e+"|"+mr(e,(function(e){return o.MessageHash["settings."+e]||e}))})).join(","),g=[{name:"login",label:this.getPydioRoleMessage("21"),description:o.MessageHash["pydio_role.31"],type:"string",readonly:!0},{name:"profile",label:this.getPydioRoleMessage("22"),description:o.MessageHash["pydio_role.32"],type:"select",choices:h}].concat(function(e){if(Array.isArray(e))return Se(e)}(y=a)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(y)||function(e,t){if(e){if("string"==typeof e)return Se(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Se(e,t):void 0}}(y)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());if(s){var b=["login","avatar"];g=g.filter((function(e){return b.indexOf(e.name)>-1}))}var v=n.getIdmUser().Login===o.user.id,O=[{label:"25",callback:"update_user_pwd"},{label:u.indexOf("logout")>-1?"27":"26",callback:"user_set_lock-lock",active:u.indexOf("logout")>-1},{label:u.indexOf("pass_change")>-1?"28b":"28",callback:"user_set_lock-pass_change",active:u.indexOf("pass_change")>-1}];return t().createElement("div",null,t().createElement("h3",{className:"paper-right-title"},o.MessageHash["pydio_role.24"],t().createElement("div",{className:"section-legend"},o.MessageHash["pydio_role.54"])),!v&&t().createElement("div",{style:{padding:"10px 16px 0"}},O.map((function(r){var n=r.active?{backgroundColor:"#e53935"}:{};return t().createElement(l.FlatButton,Re({disabled:v,label:e.getPydioRoleMessage(r.label),onClick:function(){return e.buttonCallback(r.callback)}},i.props.header.flatButton,n))}))),t().createElement("div",{className:"paper-right-block",style:{padding:"6px 6px 2px"}},t().createElement(Me,{parameters:g,onParameterChange:this.onParameterChange.bind(this),values:c,depth:-2,variant:"v2",variantShowLegend:!0,binary_context:this.getBinaryContext()})))}}],n&&je(r.prototype,n),s}(t().Component);function Ie(e){return Ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ie(e)}function _e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Te(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ue(e,t){return Ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ue(e,t)}function De(e){return De=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},De(e)}Ne.PropTypes={pydio:s().instanceOf(u()).isRequired,pluginsRegistry:s().instanceOf(XMLDocument),user:s().instanceOf(T)};var Le=u().requireLib("form").FormPanel,Be=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ue(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,r,n=De(o);if(i){var a=De(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!==Ie(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):r});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={parameters:[]},AdminComponents.PluginsLoader.getInstance(e.pydio).formParameters('//global_param[contains(@scope,"group")]|//param[contains(@scope,"group")]').then((function(e){t.setState({parameters:e})})),t}return r=s,(n=[{key:"getPydioRoleMessage",value:function(e){return this.props.pydio.MessageHash["role_editor."+e]||e}},{key:"onParameterChange",value:function(e,t,r){var n=this.props.group,o=this.state.parameters.filter((function(t){return t.name===e})),i=n.getIdmUser(),a=n.getRole();"displayName"===e||"email"===e||"profile"===e?i.Attributes[e]=t:o.length&&o[0].aclKey&&a.setParameter(o[0].aclKey,t)}},{key:"render",value:function(){var e=this.props,r=e.group,n=(e.pydio,this.state.parameters);if(!n)return t().createElement("div",null,"Loading...");var o={};if(r){var i=r.getIdmUser(),a=r.getRole(),s=i.GroupLabel;i.Attributes&&i.Attributes.displayName&&(s=i.Attributes.displayName),o={groupPath:LangUtils.trimRight(i.GroupPath,"/")+"/"+i.GroupLabel,displayName:s},n.map((function(e){e.aclKey&&a.getParameterValue(e.aclKey)&&(o[e.name]=a.getParameterValue(e.aclKey))}))}var l,c=[{name:"groupPath",label:this.getPydioRoleMessage("34"),type:"string",readonly:!0},{name:"displayName",label:this.getPydioRoleMessage("35"),type:"string"}].concat(function(e){if(Array.isArray(e))return _e(e)}(l=n)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(l)||function(e,t){if(e){if("string"==typeof e)return _e(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_e(e,t):void 0}}(l)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());return t().createElement("div",{className:"paper-right-block"},t().createElement(Le,{parameters:c,onParameterChange:this.onParameterChange.bind(this),values:o,variant:"v2",depth:-2,variantShowLegend:!0}))}}])&&Te(r.prototype,n),s}(t().Component);Be.PropTypes={pydio:s().instanceOf(u()).isRequired,pluginsRegistry:s().instanceOf(XMLDocument),group:s().instanceOf(T)};const Fe=require("pydio/util/xml");var qe=r.n(Fe);function He(e){return He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},He(e)}function We(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ge(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?We(Object(r),!0).forEach((function(t){Ve(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):We(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ve(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ze(){return ze=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ze.apply(this,arguments)}function Ke(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i=[],a=!0,s=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(s)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Je(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Je(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Je(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Qe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $e(e,t){return $e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},$e(e,t)}function Ye(e){return Ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ye(e)}var Xe=u().requireLib("form"),Ze=Xe.Manager,et=Xe.createFormElement;const tt=W(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$e(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,r,n=Ye(o);if(i){var a=Ye(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!==He(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):r});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={editMode:!1},t}return r=s,(n=[{key:"onChangeParameter",value:function(e,t){if(e!==t){var r=this.props,n=r.role,o=r.acl,i=o.Action.Name;n.setParameter(i,e,o.WorkspaceID)}}},{key:"deleteParameter",value:function(){var e=this.props,t=e.role,r=e.acl;t.deleteParameter(r)}},{key:"overrideParameter",value:function(){var e=this.props,t=e.role,r=e.acl,n=r.Action.Name,o=Ke(n.split(":"),3),i=o[0],a=(o[1],o[2],"");"action"===i&&(a=!1),t.setParameter(n,a,r.WorkspaceID)}},{key:"onInputEditMode",value:function(e){this.setState({editMode:e})}},{key:"toggleEditMode",value:function(){this.refs.formElement&&this.refs.formElement.toggleEditMode()}},{key:"toggleActionStatus",value:function(e,t){var r=this.props,n=r.role,o=r.acl;n.setParameter(o.Action.Name,t,o.WorkspaceID)}},{key:"render",value:function(){var e,r=this.props,n=r.acl,o=r.actions,i=r.parameters,a=r.pydio,s=r.getMessage,c=r.getPydioRoleMessage,u=Ke(n.Action.Name.split(":"),3),p=u[0],f=u[1],d=u[2];e="DEFAULT_START_REPOSITORY"===d?n.Action.Value:JSON.parse(n.Action.Value);var m,y,h,g=n.INHERITED,b=d;if("parameter"===p&&i[f]){var v=i[f].filter((function(e){return e.parameter===d}));v.length&&(m=v[0])}else if("action"===p&&o[f]){var O=o[f].filter((function(e){return e.action===d}));O.length&&(m=O[0])}if("parameter"===p){var P={type:"string",label:b,name:d};if(m&&(P=Ze.parameterNodeToHash(m.xmlNode)),"user"===P.scope)return null;b=P.label,y=et({ref:"formElement",attributes:P,name:d,value:e,onChange:this.onChangeParameter.bind(this),disabled:g,onChangeEditMode:this.onInputEditMode.bind(this),displayContext:"grid"})}else m&&(b=qe().XPathGetSingleNodeText(m.xmlNode,"gui/@text")||b,a.MessageHash[b]&&(b=a.MessageHash[b])),y=t().createElement("div",{className:"role-action-toggle"},t().createElement(l.Toggle,{name:this.props.name,onToggle:this.toggleActionStatus.bind(this),toggled:!!e,label:s(e?"2":"3"),labelPosition:"right"}));var R={style:{opacity:.2,zoom:.8},hoveredStyle:{opacity:1}};return"parameter"===p?this.state.editMode?h=t().createElement(l.IconButton,ze({iconClassName:"mdi mdi-content-save",tooltip:s("6"),onClick:this.toggleEditMode.bind(this)},R)):(h=t().createElement(l.IconButton,ze({iconClassName:"mdi mdi-close",tooltip:s("4"),onClick:this.deleteParameter.bind(this)},R)),g&&(h=t().createElement(l.IconButton,ze({iconClassName:"mdi mdi-content-copy",tooltip:s("5"),onClick:this.overrideParameter.bind(this)},R)))):h=g?t().createElement("div",{style:{width:48,height:48}}):t().createElement(l.IconButton,ze({iconClassName:"mdi mdi-close",tooltip:s("4"),onClick:this.deleteParameter.bind(this)},R)),t().createElement("tr",{className:(g?"inherited":"")+(this.state.editMode?" edit-mode":""),style:Ge({},this.props.style)},t().createElement("td",{style:{width:"40%",paddingLeft:12}},g?"["+c("38")+"]":""," ",b),t().createElement("td",{style:{wordBreak:"break-all"}},y),t().createElement("td",{style:{width:50}},h))}}])&&Qe(r.prototype,n),s}(t().Component));function rt(e){return rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rt(e)}function nt(){return nt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},nt.apply(this,arguments)}function ot(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function it(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function at(e,t){return at=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},at(e,t)}function st(e){return st=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},st(e)}var lt=u().requireLib("hoc").ModernSelectField,ct=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&at(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,r,n=st(o);if(i){var a=st(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!==rt(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):r});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={actions:{},parameters:{},workspaces:{}};var r=new y.WorkspaceServiceApi(PydioApi.getRestClient()),n=new y.RestSearchWorkspaceRequest;return n.Queries=[y.IdmWorkspaceSingleQuery.constructFromObject({scope:"ADMIN"})],r.searchWorkspaces(n).then((function(e){var r=e.Workspaces||[],n={};r.forEach((function(e){n[e.UUID]=e})),t.setState({workspaces:n})})),t}return r=s,n=[{key:"componentDidMount",value:function(){var e=this;AdminComponents.PluginsLoader.getInstance(this.props.pydio).allPluginsActionsAndParameters().then((function(t){e.setState({actions:t.ACTIONS,parameters:t.PARAMETERS})}))}},{key:"onCreateParameter",value:function(e,t,r,n,o){var i,a=this.props.role,s=t+":"+r+":"+n;if("action"===t)i=!1;else if(o&&o.xmlNode){var l=o.xmlNode;i=l.getAttribute("default")?l.getAttribute("default"):"","boolean"===l.getAttribute("type")?i="true"===i:"integer"===l.getAttribute("type")&&(i=parseInt(i))}a.setParameter(s,i,e)}},{key:"addParameter",value:function(e){var t=this,r=this.props,n=r.pydio,o=r.roleType,i=this.state,a=i.actions,s=i.parameters;n.UI.openComponentInModal("AdminPeople","Editor.Params.ParameterCreate",{pydio:n,actions:a,parameters:s,workspaceScope:e,createParameter:function(r,n,o,i){t.onCreateParameter(e,r,n,o,i)},roleType:o})}},{key:"render",value:function(){var e=this,r=this.props,n=r.role,o=r.roleType,i=r.pydio;if(!n)return null;var a=this.state.workspaces,s=function(e){return i.MessageHash["pydio_role."+e]||e},c=n.listParametersAndActions(),u={PYDIO_REPO_SCOPE_ALL:{},PYDIO_REPO_SCOPE_SHARED:{}};c.forEach((function(e){u[e.WorkspaceID]||(u[e.WorkspaceID]={});var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i=[],a=!0,s=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(s)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ot(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ot(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e.Action.Name.split(":"),3),r=(t[0],t[1],t[2]);u[e.WorkspaceID][r]=e}));var p=[t().createElement(l.MenuItem,{primaryText:s("parameters.scope.selector.title"),value:1}),t().createElement(l.MenuItem,{primaryText:s("parameters.scope.all"),onClick:function(){e.addParameter("PYDIO_REPO_SCOPE_ALL")}}),t().createElement(l.MenuItem,{primaryText:s("parameters.scope.shared"),onClick:function(){e.addParameter("PYDIO_REPO_SCOPE_SHARED")}}),t().createElement(l.Divider,null)].concat(Object.keys(a).map((function(r){return t().createElement(l.MenuItem,{primaryText:a[r].Label,onClick:function(){e.addParameter(r)}})})));return t().createElement("div",null,t().createElement("h3",{className:"paper-right-title",style:{display:"flex"}},t().createElement("span",{style:{flex:1,paddingRight:20}},s("application-params.title"),t().createElement("div",{className:"section-legend"},s("application-params.legend"),"user"===o&&t().createElement("div",null,t().createElement("span",{className:"mdi mdi-alert"})," ",s("application-params.legend.user-disclaimer")))),t().createElement("div",{style:{width:260}},t().createElement(lt,{variant:"compact",fullWidth:!0,value:1},p))),t().createElement("div",{className:"paper-right-block"},Object.keys(u).map((function(r,o){var c,p,f=!1;return c="PYDIO_REPO_SCOPE_ALL"===r?s("parameters.scope.all"):"PYDIO_REPO_SCOPE_SHARED"===r?s("parameters.scope.shared"):a[r]?s("parameters.scope.workspace").replace("%s",a[r].Label):s("parameters.scope.workspace").replace("%s",r),p=Object.keys(u[r]).length?Object.keys(u[r]).map((function(o){var a={backgroundColor:f?"#FAFAFA":"white"};return f=!f,t().createElement(tt,nt({pydio:i,acl:u[r][o],role:n},e.state,{style:a}))})):t().createElement("tr",null,t().createElement("td",{colSpan:3,style:{padding:"14px 12px"}},s("parameters.empty"))),t().createElement("table",{style:{width:"100%",marginBottom:o<Object.keys(u).length-1?40:0}},t().createElement("tr",{style:{borderBottom:"1px solid #e0e0e0"}},t().createElement("td",{colSpan:2,style:{padding:"16px 12px",fontSize:16}},c),t().createElement("td",{style:{width:50}},t().createElement(l.IconButton,{iconClassName:"mdi mdi-plus",onClick:function(){e.addParameter(r)},tooltip:s("parameters.custom.add"),style:{zoom:.8}}))),p)}))))}}],n&&it(r.prototype,n),s}(t().Component);function ut(e){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ut(e)}function pt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ft(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?pt(Object(r),!0).forEach((function(t){dt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function dt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function yt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ht(e,t,r){return t&&yt(e.prototype,t),r&&yt(e,r),e}function gt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bt(e,t)}function bt(e,t){return bt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},bt(e,t)}function vt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n,o,i=Ot(e);if(t){var a=Ot(this).constructor;r=Reflect.construct(i,arguments,a)}else r=i.apply(this,arguments);return n=this,!(o=r)||"object"!==ut(o)&&"function"!=typeof o?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n):o}}function Ot(e){return Ot=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ot(e)}var Pt=u().requireLib("components").SortableList,Rt=u().requireLib("hoc").ModernAutoComplete,St=function(e){gt(n,e);var r=vt(n);function n(e){var t;return mt(this,n),(t=r.call(this,e)).state={value:"",roles:[]},t.load(),t}return ht(n,[{key:"load",value:function(){var e=this,t=this.state.value,r=this.props.userRoles,n=t?"*"+t+"*":"";m().getRestClient().getIdmApi().listRolesV2(0,50,[m().RoleTypeAdmin,m().RoleTypeTeam],n).then((function(t){e.setState({roles:t.filter((function(e){return 0===r.filter((function(t){return e.Uuid===t.Uuid})).length}))})}))}},{key:"handleNewRequest",value:function(e){var t=this,r=this.props.onAddRole;e&&e.payload&&(r(e.payload),this.setState({value:""},(function(){return t.load()})))}},{key:"render",value:function(){var e,r=this,n=this.props.getMessage,o=this.state,i=o.value,a=o.roles,s=o.focus,c=a.map((function(e){return{value:t().createElement(l.MenuItem,{primaryText:e.Label,onKeyDown:function(t){"Enter"===t.key&&r.handleNewRequest({payload:e})},leftIcon:t().createElement(l.FontIcon,{style:{zoom:.9,top:0},className:"mdi mdi-"+(e.IsTeam?"account-group-outline":"card-account-details-outline")})}),key:e.Uuid,text:e.Label,payload:e}}));return s||(e={backgroundColor:"transparent",cursor:"pointer"}),t().createElement(Rt,{fullWidth:!0,hintText:n(s?"roles.picker.hint":"roles.picker.add"),variant:"compact",onFocus:function(){return r.setState({focus:!0})},onBlur:function(){return r.setState({focus:!1})},inputStyle:ft({paddingLeft:2,borderRadius:2},e),hintStyle:{paddingLeft:2,textTransform:"capitalize",color:s?"#bbb":"rgb(5, 169, 244)",cursor:"pointer"},filter:function(e,t){return!e.indexOf||t.toLowerCase().indexOf(e.toLowerCase())>=0},openOnFocus:!0,dataSource:c,searchText:i,onNewRequest:function(e,t){r.handleNewRequest(e)},onUpdateInput:function(e){r.setState({value:e},(function(){return r.load()}))},desktop:!0,menuProps:{maxHeight:300,overflowY:"auto",desktop:!0}})}}]),n}(e.Component),wt=function(r){gt(o,r);var n=vt(o);function o(e){var t;return mt(this,o),(t=n.call(this,e)).state={open:!1},t}return ht(o,[{key:"onChange",value:function(e,t,r){-1!==r&&this.props.user.addRole(r)}},{key:"remove",value:function(e){var t=this.props.user,r=t.getIdmUser().Roles.filter((function(t){return t.Uuid===e}))[0];t.removeRole(r)}},{key:"orderUpdated",value:function(e,t,r){this.props.user.switchRoles(e,t)}},{key:"displayUniqueRole",value:function(e){var t=this.props.user,r=t.getRole().getUniqueRoleDisplay();t.getRole().setUniqueRoleDisplay(r===e?null:e)}},{key:"render",value:function(){var r=this,n=[],o=[],i=this.props,a=i.user,s=i.loadingMessage,l=i.getMessage,c=i.buildGroupPath,u=this.state.open,p=a.getIdmUser(),f=p.Attributes&&p.Attributes.displayName||p.Login,d=p.Attributes&&p.Attributes.profile||"",m=p.Roles,y=a.getRole().getUniqueRoleDisplay(),h=function(e){var n=e.payload,o=e.icon,i=e.text,a=e.removable,s=void 0!==a&&a,l=e.noClick,c=e.className,u=void 0===c?"":c,p=n===y,f=l?null:function(){return r.displayUniqueRole(n)},d=["role-item"];return u&&d.push(u),s&&d.push("role-item-sortable"),p&&d.push("role-item-selected"),l&&d.push("role-item-noclick"),t().createElement("div",{className:d.join(" "),style:{display:"flex",alignItems:"center"},key:n},o&&t().createElement("span",{onClick:f,className:"left-icon mdi mdi-"+o}),t().createElement("div",{style:{flex:1},onClick:f},i,!l&&t().createElement("span",{className:"toggle-select mdi mdi-pin-"+(p?"off-":"")+"outline",onClick:f})),s&&t().createElement("span",{className:"right-icon mdi mdi-close",onClick:function(){return r.remove(n)}}))};m.forEach((function(e){if(!e.UserRole)if(e.GroupRole){var t="folder-account-outline";if("ROOT_GROUP"===e.Uuid)n.push({payload:e.Uuid,text:"/",icon:t});else{var r=c(e.Uuid);n.push({payload:e.Uuid,text:r||l("user.26","ajxp_admin").replace("%s",e.Label||e.Uuid),icon:t})}}else{var i=e.IsTeam?"account-group-outline":"card-account-details-outline";e.AutoApplies&&-1!==e.AutoApplies.indexOf(d)?n.push({payload:e.Uuid,text:e.Label+" [auto]",icon:i}):o.push({payload:e.Uuid,text:e.Label,removable:!0,icon:i})}}));var g=function(){return r.setState({open:!u})};return t().createElement("div",{className:"user-roles-picker paper-right-block",style:{padding:"8px 0"}},t().createElement("div",{style:{paddingLeft:16,display:"flex",alignItems:"center",height:40}},t().createElement("div",{style:{fontSize:20,cursor:"pointer"},onClick:g,className:"mdi mdi-chevron-"+(u?"down":"right")}),t().createElement("div",{style:{flex:1,fontSize:16,cursor:"pointer"},onClick:g},l("roles.picker.title")," ",s?" ("+l("21")+")":"")),u&&t().createElement(e.Fragment,null,t().createElement("div",{className:"roles-list"+(y?" has-selection":"")+(o.length>1?" has-sortable":""),style:{margin:"0 12px",paddingBottom:1}},n.map((function(e){return h(e)})),t().createElement(Pt,{key:"sortable",values:o,removable:!0,onRemove:this.remove.bind(this),onOrderUpdated:this.orderUpdated.bind(this),renderItem:h}),t().createElement("div",{className:"role-item role-item-add no-click",style:{height:44,padding:"0 8px",display:"flex",alignItems:"center"}},t().createElement("span",{className:"left-icon mdi mdi-account-multiple-plus-outline",style:{color:"rgb(5, 169, 244)",cursor:"pointer"}}),t().createElement(St,{userRoles:m,getMessage:l,onAddRole:function(e){return a.addRole(e)}}))),t().createElement("div",{className:"roles-list"+(y?" has-selection":""),style:{margin:"-2px 10px -8px",padding:"0px 2px 0",borderTop:"2px solid #b3b3b3"}},h({icon:"account-edit-outline",text:l("roles.picker.effective").replace("%s",f),removable:!1,noClick:!0,className:" effective"}))))}}]),o}(e.Component);const Et=wt=W(wt);function kt(e){return kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kt(e)}function At(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function jt(e,t){return jt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},jt(e,t)}function xt(e){return xt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},xt(e)}var Ct=AdminComponents,Mt=Ct.PaperEditorLayout,Nt=Ct.PluginsLoader,It=Ct.AdminStyles,_t=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&jt(e,t)}(c,e);var n,o,i,a,s=(i=c,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,r,n=xt(i);if(a){var o=xt(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!==kt(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):r});function c(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),r=s.call(this,e,t),e.node?r.state=r.nodeToState(e.node):e.idmRole&&(r.state={idmRole:e.idmRole,roleType:"role",currentPane:"workspaces"},r.loadRoleData(!0)),Nt.getInstance(r.props.pydio).loadPlugins().then((function(e){r.setState({pluginsRegistry:e})})),r}return n=c,o=[{key:"componentWillReceiveProps",value:function(e){var t=this,r=this.props,n=r.node,o=r.idmRole;e.node===n&&e.idmRole===o||(e.node?this.setState(this.nodeToState(e.node)):e.idmRole&&this.setState({idmRole:e.idmRole,roleType:"role",currentPane:"workspaces"},(function(){t.loadRoleData(!0)})))}},{key:"componentDidMount",value:function(){var e=this;this.loadRoleData(!0),this.props.registerCloseCallback&&this.props.registerCloseCallback((function(){if(e.state&&e.state.dirty&&!r.g.confirm(e.getPydioRoleMessage("19")))return!1}))}},{key:"componentWillUnmount",value:function(){this._websocketObserver&&this.props.pydio.stopObserving("websocket_event:idm",this._websocketObserver)}},{key:"nodeToState",value:function(e){var t,r=this,n=this.props.pydio,o="group"===e.getAjxpMime()?"group":"user",i=e.getMetadata().get("IdmUser");return(t=new T(i)).observe("update",(function(){r.forceUpdate()})),t.load(),this._websocketObserver&&n.stopObserving("websocket_event:idm",this._websocketObserver),this._websocketObserver=function(e){if(e.User&&"UPDATE"===e.Type&&e.User.Uuid===i.Uuid){if(e.Attributes&&e.Attributes.ctx_username===n.user.id)return;var t=r.state.observableUser;if(t.isDirty()&&!confirm("User was modified externally, you should revert your changes (click OK to reload)"))return void t.save();var o=new T(e.User);o.observe("update",(function(){r.forceUpdate()})),o.load(),r.setState({observableUser:o})}},n.observe("websocket_event:idm",this._websocketObserver),{observableUser:t,roleLabel:de().getBasename(e.getPath()),roleType:o,dirty:!1,currentPane:"user"===o?"info":"workspaces",localModalContent:{}}}},{key:"loadRoleData",value:function(e){var t=this;e&&this.setState({loadingMessage:this.getMessage("loading","ajxp_admin")});var r=this.state.idmRole,n=new j(r);n.load().then((function(){t.setState({loadingMessage:null,observableRole:n}),n.observe("update",(function(){t.forceUpdate()}))}))}},{key:"getChildContext",value:function(){var e=this.context.pydio.MessageHash;return{messages:e,getMessage:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pydio_role";return e[r+(r?".":"")+t]||t},getPydioRoleMessage:function(t){return e["role_editor."+t]||t},getRootMessage:function(t){return e[t]||t}}}},{key:"getMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pydio_role";return this.getChildContext().getMessage(e,t)}},{key:"getPydioRoleMessage",value:function(e){return this.getChildContext().getMessage(e,"role_editor")}},{key:"getRootMessage",value:function(e){return this.getChildContext().getMessage(e,"")}},{key:"setSelectedPane",value:function(e){this.setState({currentPane:e})}},{key:"showModal",value:function(e){this.setState({modal:e})}},{key:"hideModal",value:function(){this.setState({modal:null})}},{key:"logAction",value:function(e){this.setState({snackbar:e,snackOpen:!0})}},{key:"hideSnackBar",value:function(){this.setState({snackOpen:!1})}},{key:"buildGroupPath",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=this.props,r=t.node,n=t.dataModel;if(!r.getParent()&&!(r=r.findInArbo(n.getRootNode())))return"";for(var o=[];r.getParent();){var i=r.getParent();if(e&&i.getMetadata().has("IdmUser")&&i.getMetadata().get("IdmUser").Uuid===e&&(o=[]),"/idm/users"===i.getPath())break;o.push(i.getLabel()),r=i}return o.push(""),o.reverse().join("/")}},{key:"render",value:function(){var e,r,n,o=this,i=this.props,a=i.advancedAcl,s=i.pydio,c=i.node,u=i.dataModel,p=i.muiTheme,f=this.state,d=f.observableRole,m=f.observableUser,y=f.pluginsRegistry,h=f.currentPane,g=f.modal,b=f.roleType,v="",O="",P=!1,R="account-circle";if("user"===b){var S=m.getIdmUser();v=S.Attributes&&S.Attributes.displayName?S.Attributes.displayName:S.Login,n=S.Attributes&&"true"===S.Attributes.hidden,""!==S.GroupPath&&"/"!==S.GroupPath&&(v=t().createElement("div",null,t().createElement("div",null,v),t().createElement("div",{style:{fontSize:13,lineHeight:"18px",opacity:.7}},this.buildGroupPath()))),P="admin"===S.Attributes.profile,r=t().createElement(Ne,{user:m,pydio:s,pluginsRegistry:y,adminStyles:It(p.palette)}),e=[{subHeader:this.getMessage("section.user-info")},{value:"info",label:this.getMessage("24"),icon:"mdi mdi-account-circle"},{value:"workspaces",label:this.getMessage("section.permissions"),icon:"mdi mdi-folder-lock-open-outline"},{subHeader:this.getMessage("section.advanced")},{value:"pages",label:this.getMessage("36"),icon:"mdi mdi-folder-home-outline"},{value:"params",label:this.getMessage("38"),icon:"mdi mdi-book-settings-outline"}],n&&(e=[{subHeader:"User Info"},{value:"info",label:this.getMessage("24"),icon:"mdi mdi-account-circle"}])}else if("group"===b)R="folder-account",O=this.getMessage("26"),v=m.getIdmUser().GroupLabel,m.getIdmUser().Attributes&&m.getIdmUser().Attributes.displayName&&(v=m.getIdmUser().Attributes.displayName),r=t().createElement(Be,{group:m,pydio:s,pluginsRegistry:y,adminStyles:It(p.palette)}),e=[{subHeader:this.getMessage("section.permissions")},{value:"workspaces",label:this.getMessage("35"),icon:"mdi mdi-folder-lock-open-outline"},{value:"pages",label:this.getMessage("36"),icon:"mdi mdi-folder-home-outline"},{value:"params",label:this.getMessage("38"),icon:"mdi mdi-book-settings-outline"},{subHeader:this.getMessage("section.advanced")},{value:"info",label:this.getMessage("27"),icon:"mdi mdi-account-circle"}];else if("role"===b){var w=d&&d.getIdmRole();v=w?w.Label:"...",R="card-account-details-outline",w&&(w.IsTeam?R="account-group-outline":w.UserRole?R="clipboard-account":w.GroupRole&&(R="folder-account")),O=this.getMessage("28"),P=!0,r=t().createElement(Pe,{role:d,pydio:s,pluginsRegistry:y,adminStyles:It(p.palette)}),e=[{subHeader:this.getMessage("section.permissions")},{value:"workspaces",label:this.getMessage("35"),icon:"mdi mdi-folder-lock-open-outline"},{value:"pages",label:this.getMessage("36"),icon:"mdi mdi-folder-home-outline"},{value:"params",label:this.getMessage("38"),icon:"mdi mdi-book-settings-outline"},{subHeader:this.getMessage("section.advanced")},{value:"info",label:this.getMessage("29"),icon:"mdi mdi-account-circle"}]}var E=!0,k=function(){},A=function(){};m?(E=!m.isDirty(),k=function(){m.save().then(o.props.afterSave)},A=function(){m.revert()}):d&&(E=!d.isDirty(),k=function(){d.save(o.props.afterSave)},A=function(){d.revert()});var j=[Mt.actionButton(this.getMessage("plugins.6","ajxp_admin"),"mdi mdi-undo",A,E),Mt.actionButton(this.getRootMessage("53"),"mdi mdi-content-save",k,E)],x=[],C=function(e){return h===e?"layout-fill":""},M=function(e){return h===e?{overflowY:"auto",overflowX:"hidden"}:{height:0,overflow:"hidden"}};x.push(t().createElement("div",{key:"info",className:"avatar-provider "+C("info"),style:M("info")},O&&!this.state.loadingMessage?t().createElement("h3",{className:"paper-right-title"},O):null,r)),"workspaces"===h?x.push(t().createElement("div",{key:"workspaces",className:C("workspaces"),style:M("workspaces")},t().createElement("h3",{className:"paper-right-title"},this.getRootMessage("250"),t().createElement("div",{className:"section-legend"},this.getMessage("permissions.legend."+b))),"user"===b&&m&&m.getIdmUser()&&t().createElement(Et,{node:c,dataModel:u,user:m,buildGroupPath:this.buildGroupPath.bind(this)}),t().createElement("div",{className:"paper-right-block"},t().createElement("div",{className:"read-write-header",style:{textAlign:"right",paddingRight:16}},t().createElement("span",{className:"header-read"},this.getMessage("react.5a","ajxp_admin")),t().createElement("span",{className:"header-write"},this.getMessage("react.5b","ajxp_admin")),t().createElement("span",{className:"header-deny"},this.getMessage("react.5","ajxp_admin"))),t().createElement(ae,{key:"workspaces-list",role:m?m.getRole():d,roleType:this.state.roleType,advancedAcl:a,showModal:this.showModal.bind(this),hideModal:this.hideModal.bind(this)})))):"pages"===h?x.push(t().createElement("div",{key:"pages",className:C("pages"),style:M("pages")},t().createElement("h3",{className:"paper-right-title"},this.getMessage("44"),t().createElement("div",{className:"section-legend"},this.getMessage("45"))),t().createElement("div",{className:"paper-right-block"},t().createElement("div",{className:"read-write-header",style:{textAlign:"right",paddingRight:16}},t().createElement("span",{className:"header-read"},this.getMessage("react.5c","ajxp_admin")),t().createElement("span",{className:"header-deny"},this.getMessage("react.5","ajxp_admin"))),t().createElement(pe,{key:"pages-list",role:m?m.getRole():d,roleType:this.state.roleType,advancedAcl:a,showModal:this.showModal.bind(this),hideModal:this.hideModal.bind(this),showSettings:P,pydio:s})))):"params"===h&&x.push(t().createElement("div",{key:"params",className:C("params"),style:M("params")},t().createElement(ct,{pydio:s,role:m?m.getRole():d,roleType:this.state.roleType})));var N=null;return this.state.loadingMessage&&(N=t().createElement("div",{className:"loader-container layout-fill vertical-layout"},t().createElement("div",{className:"loader-message",style:{margin:"auto",color:"rgba(0,0,0,0.33)",fontWeight:"500",fontSize:16}},this.state.loadingMessage))),t().createElement(Mt,{title:v,titleLeftIcon:"mdi mdi-"+R,titleActionBar:j,closeAction:function(){o.props.onRequestTabClose()},contentFill:!0,leftNavItems:e,leftNavSelected:h,leftNavChange:function(e){o.setSelectedPane(e)},className:"edit-object-"+this.state.roleType},t().createElement(l.Snackbar,{message:this.state.snackbar||"",open:this.state.snackOpen,autoHideDuration:4e3,ref:"snack",action:"Dismiss",onRequestClose:this.hideSnackBar.bind(this)}),g,N,x,It(p.palette).formSimpleCss())}}],o&&At(n.prototype,o),c}(t().Component);_t.contextTypes={pydio:s().instanceOf(u())},_t.childContextTypes={messages:s().object,getMessage:s().func,getPydioRoleMessage:s().func,getRootMessage:s().func},_t.propTypes={node:s().instanceOf(AjxpNode),closeEditor:s().func,registerCloseCallback:s().func},_t=(0,me.muiThemeable)()(_t);const Tt=require("pydio/model/data-model");var Ut=r.n(Tt);const Dt=require("lodash.debounce");var Lt=r.n(Dt);const Bt=require("pydio/model/node");var Ft=r.n(Bt);function qt(e){return qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qt(e)}function Ht(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Wt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ht(Object(r),!0).forEach((function(t){Gt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ht(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Gt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Vt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function zt(e,t){return zt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},zt(e,t)}function Kt(e){return Kt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Kt(e)}var Jt=u().requireLib("hoc").ModernTextField,Qt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zt(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,r,n=Kt(o);if(i){var a=Kt(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!==qt(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):r});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=a.call(this,e);var r=new(Ut());return r.setRootNode(new(Ft())),t.state={dataModel:r,displayResult:e.displayResultsState,crtValue:""},t.searchDebounced=Lt()(t.triggerSearch,350),t}return r=s,(n=[{key:"displayResultsState",value:function(){this.setState({displayResult:!0})}},{key:"hideResultsState",value:function(){this.setState({displayResult:!1}),this.props.hideResults()}},{key:"triggerSearch",value:function(){var e=this,t=this.state.crtValue;if(t){var r=this.state.dataModel,n=this.props,o=n.limit,i=void 0===o?100:o,a=n.filterQueries;r.getRootNode().setChildren([]);var s=m().getRestClient().getIdmApi().listGroups("/",t,!0,0,i),l=m().getRestClient().getIdmApi().listUsers("/",t,!0,0,i,a);Promise.all([s,l]).then((function(n){var o=n[0],i=n[1];o.Groups.map((function(e){var t=e.Attributes&&e.Attributes.displayName?e.Attributes.displayName:e.GroupLabel,n=new(Ft())("/idm/users"+D().trimRight(e.GroupPath,"/")+"/"+e.GroupLabel,!1,t);n.getMetadata().set("IdmUser",e),n.getMetadata().set("ajxp_mime","group"),r.getRootNode().addChild(n)})),i.Users.map((function(e){var t=e.Attributes&&e.Attributes.displayName?e.Attributes.displayName:e.Login,n=new(Ft())("/idm/users/"+e.Login,!0,t);n.getMetadata().set("IdmUser",e),n.getMetadata().set("ajxp_mime","user_editable"),r.getRootNode().addChild(n)})),r.getRootNode().setLoaded(!0),e.displayResultsState(),e.props.displayResults(t,r,(function(){return e.triggerSearch()}),(function(){return e.setState({crtValue:""})}))}))}else{this.hideResultsState();try{this.refs.query.refs.input.blur()}catch(e){}}}},{key:"keyDown",value:function(e){"Enter"===e.key?(e.preventDefault(),this.triggerSearch()):this.searchDebounced()}},{key:"render",value:function(){var e=this,r=this.state.crtValue,n=this.props.filterButton;return t().createElement("div",{className:this.props.className?this.props.className:"",style:Wt({display:"flex",alignItems:"center",justifyContent:"center"},this.props.style)},t().createElement("div",{style:{flex:1,maxWidth:420}},t().createElement("form",{autoComplete:"off"},t().createElement(Jt,{ref:"query",onKeyDown:this.keyDown.bind(this),hintText:this.props.textLabel,fullWidth:!0,value:r,onChange:function(t,r){e.setState({crtValue:r})},variant:"compact"}))),n)}}])&&Vt(r.prototype,n),s}(t().Component);function $t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Qt.PropTypes={textLabel:s().string,displayResults:s().func,hideResults:s().func,displayResultsState:s().bool,limit:s().number,style:s().object};var Yt=u().requireLib("components").DNDActionParameter,Xt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"deleteAction",value:function(e,t,r){var n,o,i=(n=t&&t.length?t[0]:pydio.getUserSelection()).getUniqueNode();switch(i.getMetadata().get("ajxp_mime")){case"user_editable":o="settings.34";break;case"group":o="settings.126"}var a=function(){};if(r)a=r;else if(i.getParent()){var s=i.getParent();a=function(){s.reload(null,!0)}}pydio.UI.openConfirmDialog({message:MessageHash[o],validCallback:function(){var e=n.getSelectedNodes();!function t(){if(e.length){var r=e.shift();m().getRestClient().getIdmApi().deleteIdmUser(r.getMetadata().get("IdmUser")).then((function(){a(),t()})).catch((function(e){u().getInstance().UI.displayMessage("ERROR",e.message),t()}))}}()}})}},{key:"applyDND",value:function(e,t){t.getStep()===Yt.STEP_CAN_DROP?AdminComponents.DNDActionsManager.canDropNodeOnNode(t.getSource(),t.getTarget()):t.getStep()===Yt.STEP_END_DRAG&&AdminComponents.DNDActionsManager.dropNodeOnNode(t.getSource(),t.getTarget())}},{key:"bulkMoveAction",value:function(e,t){var r=u().getInstance(),n=t[0].getSelectedNodes();r.UI.openComponentInModal("AdminPeople","TreeGroupsDialog",{pydio:r,dataModel:r.getContextHolder(),submitValue:function(e,t){!function e(){if(n.length){var r=n.shift();AdminComponents.DNDActionsManager.dropNodeOnNode(r,t),e()}}()}})}}],null&&$t(t.prototype,null),r&&$t(t,r),e}();const Zt=require("pydio/util/func");var er=r.n(Zt);const tr=require("pydio/http/resources-manager");var rr=r.n(tr);function nr(e){return nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nr(e)}function or(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;if(!e)return Promise.resolve(t);var r=e.split("."),n=r.shift(),o=r.join(".");return rr().loadClass(n).then((function(r){var i=er().getFunctionByName(o,r);if(!i){if("object"===nr(r)&&r[n]){var a=er().getFunctionByName(o,r[n]);if(a)return a}if(t)return console.error("Cannot find editor component, using default instead",e,t),t;throw new Error("cannot find editor component")}return i})).catch((function(r){if(t)return console.error("Cannot find editor component, using default instead",e,t),t;throw r}))}function ir(){return ir=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ir.apply(this,arguments)}function ar(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function sr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function lr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?sr(Object(r),!0).forEach((function(t){cr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function cr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ur=u().requireLib("boot").JobsStore,pr=u().requireLib("components"),fr=pr.DNDTreeView,dr=pr.SimpleList,mr=function(e,t){switch(e){case"admin":return t(157,"settings");case"shared":return t(158,"settings");case"standard":return t(156,"settings");default:return e}},yr="#E53934",hr=i()({displayName:"Dashboard",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:s().instanceOf(Ut()).isRequired,rootNode:s().instanceOf(Ft()).isRequired,currentNode:s().instanceOf(Ft()).isRequired,accessByName:s().func.isRequired,openEditor:s().func.isRequired},getInitialState:function(){var e=this.props,t=e.currentNode,r=e.dataModel,n=this.findUsersRoot(t),o={};return n&&n.getMetadata().has("dashboardFilter")&&(o.filter=n.getMetadata().get("dashboardFilter"),o.filterActive=n.getMetadata().get("dashboardFilterActive"),o.filterQueries=n.getMetadata().get("userProfileFilter")),lr({searchResultData:!1,currentNode:t,dataModel:r,showAnon:!1},o)},componentDidMount:function(){var e=this,t=ur.getInstance();this._jStoreObserver=function(r){r&&0===r.indexOf("delete-group-")&&t.getJobs().then((function(t){try{"Finished"===t.get(r).Tasks[0].Status&&e.reloadList()}catch(e){}}))},t.observe("tasks_updated",this._jStoreObserver)},componentWillUnmounnt:function(){ur.getInstance().stopObserving("tasks_updated",this._jStoreObserver)},componentWillReceiveProps:function(e){!this.state.searchResultData&&e.currentNode&&0===e.currentNode.getPath().indexOf("/idm/users")&&this.setState({currentNode:e.currentNode,dataModel:e.dataModel})},reloadList:function(){var e=this.state.searchResultData;e?e.reload():this.refs.mainlist&&this.refs.mainlist.reload()},renderListUserAvatar:function(e){var r={backgroundColor:"#9e9e9e",color:"white",borderRadius:"50%",margin:16,width:33,height:33,fontSize:18,padding:6,textAlign:"center"};if("role"===e.getAjxpMime())return r.backgroundColor="#607d8b",t().createElement(l.FontIcon,{className:"mdi mdi-account-card-details",style:r});var n=e.getMetadata().get("IdmUser"),o=this.props.pydio;if(n.Attributes&&n.Attributes.avatar){var i=o.Parameters.get("ENDPOINT_REST_API")+"/frontend/binaries/USER/"+n.Login+"?"+n.Attributes.avatar+"&dim=33";return t().createElement("div",{style:{width:33,height:33,backgroundImage:"url("+i+")",backgroundSize:"cover",borderRadius:"50%",backgroundPosition:"center",margin:16}})}var a=e.isLeaf()?"mdi mdi-account":"mdi mdi-folder-account";return r.backgroundColor=e.isLeaf()?"#9e9e9e":"#607d8b",t().createElement(l.FontIcon,{className:a,style:r})},renderListEntryFirstLine:function(e){if("role"===e.getAjxpMime())return t().createElement("span",null,e.getMetadata().get("IdmRole").Label);var r,n=e.getMetadata().get("IdmUser"),o=n.Attributes?n.Attributes.profile:"",i=[],a={display:"inline-block",marginLeft:5,fontSize:14};return"shared"===o?i.push(t().createElement("span",{className:"mdi mdi-share-variant",style:lr(lr({},a),{},{color:"#009688"}),title:this.context.getMessage("user.13")})):"admin"===o&&i.push(t().createElement("span",{className:"mdi mdi-security",style:lr(lr({},a),{},{color:"#03a9f4"})})),n.Attributes&&n.Attributes.locks&&n.Attributes.locks.indexOf("logout")>-1&&i.push(t().createElement("span",{className:"mdi mdi-lock",style:lr(lr({},a),{},{color:yr})})),n.Attributes&&"true"===n.Attributes.hidden&&(r=this.context.getMessage("user.type.hidden")+" "),t().createElement("span",null,r,e.getLabel()," ",i)},renderListEntrySecondLine:function(e){var r=this.state.searchResultData;if("role"===e.getAjxpMime())return t().createElement("span",null,this.context.getMessage("user.rootgroup.legend"));var n=e.getMetadata().get("IdmUser");if(e.isLeaf()){if("/idm/users"===e.getPath())return this.context.getMessage("user.8");var o=[];o.push(n.Login),r&&"/"!==n.GroupPath&&o.push(this.context.getMessage("user.12")+": "+de().getDirname(n.GroupPath));var i=n.Attributes||{};i.profile&&o.push(mr(i.profile,this.context.getMessage)),i.last_connection_readable&&o.push(this.context.getMessage("user.9")+" "+i.last_connection_readable);var a=n.Roles;return a&&a.length&&o.push(this.context.getMessage("user.11").replace("%i",a.length)),o.join(" - ")}return this.context.getMessage("user.12")+": "+e.getPath().replace("/idm/users","")},renderListEntrySelector:function(e){return"/idm/users"!==e.getPath()&&"role"!==e.getAjxpMime()&&e.isLeaf()},displaySearchResults:function(e,t,r,n){var o=this;this.setState({searchResultTerm:e,searchResultData:{term:e,toggleState:function(){n(),o.hideSearchResults()},reload:r},currentNode:t.getContextNode(),dataModel:t})},hideSearchResults:function(){var e=this;this.setState({searchResultData:!1,currentNode:this.props.currentNode,dataModel:this.props.dataModel},(function(){return e.reloadList()}))},createUserAction:function(){pydio.UI.openComponentInModal("AdminPeople","Forms.CreateUserForm",{dataModel:this.props.dataModel,openRoleEditor:this.openRoleEditor.bind(this)})},createGroupAction:function(){pydio.UI.openComponentInModal("AdminPeople","Forms.CreateRoleOrGroupForm",{type:"group",openRoleEditor:this.openRoleEditor.bind(this)})},openUsersImporter:function(){pydio.UI.openComponentInModal("EnterprisePeople","UsersImportDialog",{dataModel:this.props.dataModel})},openRoleEditor:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"activity",n=this.props,o=n.pydio,i=n.rolesEditorClass,a=n.rolesEditorProps,s=this.state.dataModel;if(this.refs.editor&&this.refs.editor.isDirty()&&!window.confirm(o.MessageHash["role_editor.19"]))return!1;var l=lr({ref:"editor",node:e,dataModel:s,pydio:o,initialEditSection:r,onRequestTabClose:this.closeRoleEditor,afterSave:function(){t.reloadList()}},a);"role"===e.getAjxpMime()&&(delete l.node,l.idmRole=e.getMetadata().get("IdmRole")),or(i,_t).then((function(e){t.props.openRightPane({COMPONENT:e,PROPS:l})})).catch((function(e){console.log(e)}))},closeRoleEditor:function(){if(this.refs.editor&&this.refs.editor.isDirty()&&!window.confirm(this.props.pydio.MessageHash["role_editor.19"]))return!1;this.props.closeRightPane()},deleteAction:function(e){var t=this,r=new(Ut());r.setSelectedNodes([e]),Xt.deleteAction(null,[r],(function(){t.reloadList()}))},renderNodeActions:function(e){var r=this,n=this.props,o=(n.dataModel,n.rootNode,this.state.searchResultData,e.getAjxpMime());if(e.getMetadata().has("IdmUser")&&!e.getMetadata().get("IdmUser").PoliciesContextEditable)return t().createElement("div",null);var i={color:"inherit",opacity:.5,fontSize:20},a=[];return a.push(t().createElement(l.IconButton,{key:"edit",iconClassName:"mdi mdi-pencil",onClick:function(t){t.stopPropagation(),r.openRoleEditor(e)},iconStyle:i})),"user_editable"===o||"group"===o?a.push(t().createElement(l.IconButton,{key:"delete",iconClassName:"mdi mdi-delete",onClick:function(t){t.stopPropagation(),r.deleteAction(e)},iconStyle:i})):"user"!==o&&"role"!==o||a.push(t().createElement(l.IconButton,{key:"delete",iconClassName:"mdi mdi-delete",disabled:!0,iconStyle:{color:"inherit",opacity:.15,fontSize:20},onClick:function(e){e.stopPropagation()}})),t().createElement("div",null,a)},filterNodes:function(e){if(!e.getMetadata().has("IdmUser"))return!0;var t=this.state,r=t.showAnon;return!(!t.searchResultData&&!r)||"anon"!==(e.getMetadata().get("IdmUser").Attributes||{}).profile},findUsersRoot:function(e){for(var t=e;"/idm/users"!==t.getPath();)if(!(t=t.getParent()))return null;return t},applyFilter:function(e){var t=this,r=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i=[],a=!0,s=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(s)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ar(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ar(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e.split(":"),2),n=r[0],o=r[1],i=this.state,a=i.filter,s=void 0===a?{}:a,l=i.showAnon;switch(n){case"toggle-anon":return void this.setState({showAnon:!l});case"profile":s.profile=o;break;case"attr":s.attrs||(s.attrs={}),s.attrs[o]=!s.attrs[o]}("standard"===s.profile||"admin"===s.profile)&&s.attrs&&s.attrs.hidden&&delete s.attrs.hidden;var c=s.attrs||{},u=s.profile||Object.keys(c).filter((function(e){return c[e]})).length>0,p=this.filterToQueries(s);this.setState({filter:s,filterActive:u,filterQueries:p},(function(){return t.computeFilter(p,s,u)}))},filterToQueries:function(e){var t=e.profile,r=e.attrs,n=[];if(t){var o=!1;"!"===t[0]&&(o=!0,t=t.substring(1)),n.push({name:"profile",value:t,not:o})}return r&&Object.keys(r).length&&Object.keys(r).filter((function(e){return r[e]})).map((function(e){switch(e){case"locks":n.push({name:"locks",value:"*logout*"});break;case"hidden":n.push({name:"hidden",value:"true"})}})),n.length>0&&!n.filter((function(e){return"hidden"===e.name})).length&&n.push({name:"hidden",value:"true",not:!0}),n},computeFilter:function(e,t,r){var n=this,o=this.props.currentNode,i=this.findUsersRoot(o);i&&(i.getMetadata().delete("userProfileFilter"),i.getMetadata().delete("dashboardFilter"),i.getMetadata().delete("dashboardFilterActive"),e.length&&(i.getMetadata().set("userProfileFilter",e),i.getMetadata().set("dashboardFilter",t),i.getMetadata().set("dashboardFilterActive",r)),o.getMetadata().delete("paginationData"),this.setState({currentNode:o},(function(){n.reloadList()})))},render:function(){var e=this,r=this.props,n=r.accessByName,o=r.muiTheme,i=r.rootNode,a=r.pydio,s=this.state,c=s.searchResultData,u=s.currentNode,p=s.dataModel,f=s.showAnon,d=s.filter,m=void 0===d?{}:d,y=s.filterActive,h=void 0!==y&&y,g=s.filterQueries,b=AdminComponents.AdminStyles(o.palette),v=[],O=function(){return[]},P=null,R=[];n("Create")&&(O=this.renderNodeActions.bind(this),R=[a.Controller.getActionByName("move"),a.Controller.getActionByName("delete")],P=this.openRoleEditor.bind(this),v=[t().createElement(l.FlatButton,ir({primary:!0,label:this.context.getMessage("user.1"),onClick:this.createUserAction},b.props.header.flatButton)),t().createElement(l.FlatButton,ir({primary:!0,label:this.context.getMessage("user.2"),onClick:this.createGroupAction},b.props.header.flatButton))]);var S="profile:"+(m.profile||""),w=m.attrs&&m.attrs.locks,E=m.attrs&&m.attrs.hidden,k={zoom:.8,top:0},A=lr({},k),j=lr({},k);w&&(A=lr(lr({},k),{},{color:yr})),f&&(j=lr(lr({},k),{},{color:"#03a9f4"}));var x={};h&&(x={backgroundColor:o.palette.accent1Color});var C=t().createElement(l.IconMenu,{iconButtonElement:t().createElement(l.IconButton,{iconClassName:h?"mdi mdi-filter-variant-plus":"mdi mdi-filter-variant",tooltip:this.context.getMessage("user.filter.tooltip"),tooltipPosition:"bottom-left",style:lr(lr({},b.props.header.iconButton.style),x),iconStyle:b.props.header.iconButton.iconStyle}),anchorOrigin:{horizontal:"right",vertical:"bottom"},targetOrigin:{horizontal:"right",vertical:"top"},value:S,onChange:function(t,r){e.applyFilter(r)},desktop:!0,clickCloseDelay:0},t().createElement(l.Subheader,{style:{lineHeight:"28px"}},this.context.getMessage("22","role_editor")),t().createElement(l.MenuItem,{value:"profile:",primaryText:this.context.getMessage("user.filter.all"),rightIcon:t().createElement(l.FontIcon,{style:k,className:"mdi mdi-"+(E||"profile:"!==S?"checkbox-blank-outline":"checkbox-marked-outline")})}),t().createElement(l.MenuItem,{value:"profile:admin",primaryText:this.context.getMessage("user.filter.admins"),rightIcon:t().createElement(l.FontIcon,{style:k,className:"mdi mdi-"+("profile:admin"===S?"checkbox-marked-outline":"checkbox-blank-outline")})}),t().createElement(l.MenuItem,{value:"profile:standard",primaryText:this.context.getMessage("user.filter.internal"),rightIcon:t().createElement(l.FontIcon,{style:k,className:"mdi mdi-"+("profile:standard"===S?"checkbox-marked-outline":"checkbox-blank-outline")})}),t().createElement(l.MenuItem,{value:"profile:shared",primaryText:this.context.getMessage("user.filter.shared"),rightIcon:t().createElement(l.FontIcon,{style:k,className:"mdi mdi-"+(E||"profile:shared"!==S?"checkbox-blank-outline":"checkbox-marked-outline")})}),t().createElement(l.MenuItem,{value:"attr:hidden",primaryText:this.context.getMessage("user.filter.hidden"),disabled:"profile:standard"===S||"profile:admin"===S,rightIcon:t().createElement(l.FontIcon,{style:k,className:"mdi mdi-"+(E?"checkbox-marked-outline":"checkbox-blank-outline")})}),t().createElement(l.Divider,null),t().createElement(l.Subheader,{style:{lineHeight:"28px"}},this.context.getMessage("user.filter.status")),t().createElement(l.MenuItem,{value:"attr:locks",primaryText:this.context.getMessage("user.filter.locks"),rightIcon:t().createElement(l.FontIcon,{style:lr({},A),className:"mdi mdi-"+(w?"lock-check-outline":"lock-outline")})}),t().createElement(l.MenuItem,{value:"toggle-anon",primaryText:this.context.getMessage("user.filter.anon"),rightIcon:t().createElement(l.FontIcon,{style:j,className:"mdi mdi-"+(f?"incognito":"incognito-off")})})),M=b.body,N=M.block.props,I=M.block.container,_=lr(lr({height:48,lineHeight:"48px",fontSize:14,fontWeight:500},M.block.header),{},{borderBottom:"1px solid "+M.tableMaster.row.borderBottomColor,padding:"0 20px"}),T={width:250,borderRight:"1px solid"+M.tableMaster.row.borderBottomColor,overflowY:"auto",flex:"none"};return!1!==c&&(T=lr(lr({},T),{},{opacity:.6})),t().createElement("div",{className:"main-layout-nav-to-stack vertical-layout people-dashboard"},t().createElement(AdminComponents.Header,{title:this.context.getMessage("2","settings"),icon:"mdi mdi-account-multiple",actions:v,centerContent:t().createElement(Qt,{displayResults:this.displaySearchResults,displayResultsState:c,hideResults:this.hideSearchResults,limit:50,textLabel:this.context.getMessage("user.7"),className:"media-small-hide",filterButton:C,filterQueries:g})}),t().createElement(l.Paper,ir({},N,{style:I,className:"horizontal-layout layout-fill"}),t().createElement("div",{className:"hide-on-vertical-layout vertical-layout tab-vertical-layout",style:T},t().createElement("div",{style:{flex:1}},t().createElement("div",{style:_},this.context.getMessage("user.3")),t().createElement(fr,{showRoot:!0,rootLabel:this.context.getMessage("user.5"),node:i,dataModel:this.props.dataModel,className:"users-groups-tree",paddingOffset:10,noPaginator:!0}))),t().createElement("div",{zDepth:0,className:"layout-fill vertical-layout people-list"},t().createElement(dr,{ref:"mainlist",pydio:a,node:u,dataModel:p,clearSelectionOnReload:!1,openEditor:P,entryRenderIcon:this.renderListUserAvatar.bind(this),entryRenderFirstLine:this.renderListEntryFirstLine.bind(this),entryRenderSecondLine:this.renderListEntrySecondLine.bind(this),entryEnableSelector:this.renderListEntrySelector.bind(this),entryRenderActions:O,searchResultData:c,elementHeight:dr.HEIGHT_TWO_LINES,hideToolbar:!1,toolbarStyle:{backgroundColor:M.block.header.backgroundColor,height:48,borderBottom:_.borderBottom},multipleActions:R,filterNodes:this.filterNodes.bind(this)}))))}});function gr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function br(){return br=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},br.apply(this,arguments)}function vr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Or(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?vr(Object(r),!0).forEach((function(t){Pr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Pr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}hr=(0,me.muiThemeable)()(hr);var Rr=r(173).muiThemeable,Sr=u().requireLib("components").MaterialTable,wr=u().requireLib("hoc").ModernTextField,Er={admin:"card-account-details-outline",IsUserRole:"clipboard-account",IsGroupRole:"folder-account",IsTeam:"account-group-outline"},kr=i()({displayName:"RolesDashboard",mixins:[AdminComponents.MessagesConsumerMixin],getInitialState:function(){return{roles:[],loading:!1,showTechnical:!1,types:[m().RoleTypeAdmin]}},load:function(){var e=this,t=this.state.types;this.setState({loading:!0});var r=m().getRestClient().getIdmApi();u().startLoading(),r.listRolesV2(0,-1,t).then((function(t){u().endLoading(),e.setState({roles:t,loading:!1})})).catch((function(t){u().endLoading(),e.setState({loading:!1})}))},componentDidMount:function(){this.load()},openTableRows:function(e){e.length&&e[0].role.PoliciesContextEditable&&this.openRoleEditor(e[0].role)},openRoleEditor:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"activity",n=this.props,o=n.pydio,i=n.rolesEditorClass,a=n.rolesEditorProps;return!(this.refs.editor&&this.refs.editor.isDirty()&&!window.confirm(o.MessageHash["role_editor.19"])||(or(i,_t).then((function(n){t.props.openRightPane({COMPONENT:n,PROPS:Or({ref:"editor",idmRole:e,pydio:o,initialEditSection:r,onRequestTabClose:t.closeRoleEditor},a)})})).catch((function(e){console.log(e)})),0))},closeRoleEditor:function(){return!(this.refs.editor&&this.refs.editor.isDirty()&&!window.confirm(this.props.pydio.MessageHash["role_editor.19"])||(this.props.closeRightPane(),0))},deleteAction:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=this.props.pydio;n.UI.openConfirmDialog({message:n.MessageHash["settings.126"],destructive:[r||e],validCallback:function(){m().getRestClient().getIdmApi().deleteRole(e).then((function(){t.load()}))}})},createRoleAction:function(){var e=this;pydio.UI.openComponentInModal("AdminPeople","Forms.CreateRoleOrGroupForm",{type:"role",roleNode:this.state.currentNode,openRoleEditor:this.openRoleEditor.bind(this),roles:this.state.roles,reload:function(){e.load()}})},computeTableData:function(e){var r=this,n=this.state.roles,o=[];return n.map((function(n){var i=n.Label;if(!e||-1!==i.toLowerCase().indexOf(e.toLowerCase())){var a=m().RoleTypeAdmin;n.UserRole?a=m().RoleTypeUser:n.GroupRole?a=m().RoleTypeGroup:n.IsTeam&&(a=m().RoleTypeTeam),o.push({role:n,roleId:n.Uuid,roleLabel:t().createElement("span",{style:{display:"flex",alignItems:"flex-end"}},t().createElement("span",{style:{fontSize:22,marginRight:12,marginLeft:-8,opacity:.7},title:r.context.getMessage("roleType."+a,"role_editor"),className:"mdi mdi-"+Er[a]}),i),sorterValue:"ROOT_GROUP"===n.Uuid?"0000000":i,isDefault:n.AutoApplies.join(", ")||"-",lastUpdated:n.LastUpdated,roleType:r.context.getMessage("roleType."+a,"role_editor")})}})),o},render:function(){var e=this,r=this.props,n=r.pydio,o=r.muiTheme,i=r.accessByName,a=AdminComponents.AdminStyles(o.palette),s=this.state,c=s.searchRoleString,u=(s.showTechnical,s.types),p=i("Create"),f=[m().RoleTypeAdmin,m().RoleTypeTeam,m().RoleTypeGroup,m().RoleTypeUser],d=null,y=[];p&&(y.push(t().createElement(l.FlatButton,br({},a.props.header.flatButton,{primary:!0,label:this.context.getMessage("user.6"),onClick:this.createRoleAction.bind(this)}))),d=this.openTableRows.bind(this));var h=t().createElement(l.IconMenu,{iconButtonElement:t().createElement(l.IconButton,br({tooltip:this.context.getMessage("dashboard.filterByType","role_editor"),iconClassName:"mdi mdi-filter-variant"},a.props.header.iconButton)),anchorOrigin:{horizontal:"right",vertical:"bottom"},targetOrigin:{horizontal:"right",vertical:"top"},onChange:function(t,r){var o,i;0!==(o=u.indexOf(r)>-1?u.filter((function(e){return e!==r})):[].concat((i=u,function(e){if(Array.isArray(e))return gr(e)}(i)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(i)||function(e,t){if(e){if("string"==typeof e)return gr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?gr(e,t):void 0}}(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),[r])).length?e.setState({types:o},(function(){e.load()})):n.UI.displayMessage("ERROR",e.context.getMessage("dashboard.filterSelectOne","role_editor"))},desktop:!0,clickCloseDelay:0},f.map((function(r){var n=u.indexOf(r)>-1?"checkbox-marked-outline":"checkbox-blank-outline";return t().createElement(l.MenuItem,{primaryText:e.context.getMessage("dashboard.typeFilter."+r,"role_editor"),value:r,leftIcon:t().createElement(l.FontIcon,{className:"mdi mdi-"+Er[r],style:{zoom:.9,top:0}}),rightIcon:t().createElement(l.FontIcon,{className:"mdi mdi-"+n,style:{zoom:.9,top:0}})})}))),g=t().createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},t().createElement("div",{style:{flex:1,maxWidth:380}},t().createElement(wr,{fullWidth:!0,hintText:this.context.getMessage("47","role_editor")+"...",value:c||"",onChange:function(t,r){return e.setState({searchRoleString:r})},variant:"compact"})),h),b=[{name:"roleLabel",label:this.context.getMessage("32","role_editor"),style:{width:"40%",fontSize:15},headerStyle:{width:"40%"},sorter:{type:"string",default:!0,value:function(e){return e.sorterValue}}},{name:"roleType",label:this.context.getMessage("roleType","role_editor"),style:{width:140},headerStyle:{width:140},hideSmall:!0,sorter:{type:"string"}},{name:"lastUpdated",useMoment:!0,label:this.context.getMessage("last_update","role_editor"),hideSmall:!0,sorter:{type:"number"}},{name:"isDefault",label:this.context.getMessage("114","settings"),style:{width:"15%"},headerStyle:{width:"15%"},hideSmall:!0,sorter:{type:"string"}}],v=[];p&&(v.push({iconClassName:"mdi mdi-pencil",tooltip:"Edit",onClick:function(t){e.openRoleEditor(t.role)},disable:function(e){return!e.role.PoliciesContextEditable}}),v.push({iconClassName:"mdi mdi-delete",tooltip:"Delete",onClick:function(t){e.deleteAction(t.role.Uuid,t.role.Label)},disable:function(e){return!e.role.PoliciesContextEditable}}));var O=this.computeTableData(c),P=AdminComponents.AdminStyles().body,R=P.tableMaster,S=P.block.props,w=P.block.container;return t().createElement("div",{className:"main-layout-nav-to-stack vertical-layout"},t().createElement(AdminComponents.Header,{title:this.context.getMessage("69","settings"),icon:"mdi mdi-account-multiple",actions:y,centerContent:g,reloadAction:function(){e.load()},loading:this.state.loading}),t().createElement("div",{className:"layout-fill"},t().createElement(AdminComponents.SubHeader,{legend:this.context.getMessage("dashboard.description","role_editor")}),t().createElement(l.Paper,br({},S,{style:w}),t().createElement(Sr,{data:O,columns:b,actions:v,onSelectRows:d,deselectOnClickAway:!0,showCheckboxes:!1,masterStyles:R,paginate:[25,50,100],storageKey:"console.roles.list"}))))}});function Ar(e){return Ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ar(e)}function jr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function xr(e,t){return xr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},xr(e,t)}function Cr(e){return Cr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Cr(e)}kr=Rr()(kr);var Mr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xr(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,r,n=Cr(o);if(i){var a=Cr(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!==Ar(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):r});function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),a.apply(this,arguments)}return r=s,n=[{key:"componentDidMount",value:function(){this.props.create&&this.openEditor(!0)}},{key:"openEditor",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=this.props,n=r.pydio,o=r.policy,i=r.rule,a=r.openRightPane,s=r.rulesEditorClass;return!(this.refs.editor&&this.refs.editor.isDirty()&&!window.confirm(n.MessageHash["role_editor.19"])||!s||(or(s,null).then((function(r){a({COMPONENT:r,PROPS:{ref:"editor",policy:o,rule:i,pydio:n,create:t,saveRule:e.props.onRuleChange,onRequestTabClose:e.closeEditor.bind(e)}})})).catch((function(e){console.error(e)})),0))}},{key:"closeEditor",value:function(e){var t=this.props,r=t.pydio,n=t.closeRightPane;if(e&&e.isDirty()){if(e.isCreate())return this.props.onRemoveRule(this.props.rule,!0),n(),!0;if(!window.confirm(r.MessageHash["role_editor.19"]))return!1}return n(),!0}},{key:"removeRule",value:function(){var e=this.props,t=e.pydio,r=e.onRemoveRule,n=e.rule;t.UI.openConfirmDialog({message:t.MessageHash["ajxp_admin.policies.rule.delete.confirm"],destructive:[n.description],validCallback:function(){r(n)}})}},{key:"render",value:function(){var e=this,r=this.props,n=r.rule,o=r.readonly,i=r.isLast,a=r.create,s="allow"===n.effect?"#33691e":"#d32f2f",c=[];return o||(c=[t().createElement("span",{className:"mdi mdi-pencil",style:{fontSize:16,color:"rgba(0,0,0,.33)",cursor:"pointer",marginLeft:12},onClick:function(t){return e.openEditor()}}),t().createElement("span",{className:"mdi mdi-delete",style:{fontSize:16,color:"rgba(0,0,0,.33)",cursor:"pointer",marginLeft:12},onClick:function(t){return e.removeRule()}})]),t().createElement("div",{style:{display:"flex",padding:"6px 0 5px",borderBottom:i?null:"1px solid white"}},t().createElement(l.FontIcon,{className:"mdi mdi-traffic-light",color:s,style:{fontSize:16,marginRight:10}}),t().createElement("div",{style:{flex:1}},a&&t().createElement("span",null,"[NEW] "),n.description,c))}}],n&&jr(r.prototype,n),s}(t().Component);function Nr(e){return Nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nr(e)}function Ir(){return Ir=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ir.apply(this,arguments)}function _r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Tr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_r(Object(r),!0).forEach((function(t){Ur(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_r(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ur(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Dr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Lr(e,t){return Lr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Lr(e,t)}function Br(e){return Br=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Br(e)}var Fr=u().requireLib("hoc").ModernTextField,qr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Lr(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,r,n=Br(o);if(i){var a=Br(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!==Nr(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):r});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={policy:e.policy},t}return r=s,n=[{key:"componentWillReceiveProps",value:function(e){this.setState({policy:e.policy})}},{key:"componentDidMount",value:function(){this.props.newPolicyWithRule&&this.onAddRule(null,this.props.newPolicyWithRule)}},{key:"onNameChange",value:function(e){var t=Tr({},this.state.policy);t.Name=e,this.setState({createRule:null}),this.props.savePolicy(t)}},{key:"onDescriptionChange",value:function(e){var t=Tr({},this.state.policy);t.Description=e,this.setState({createRule:null}),this.props.savePolicy(t)}},{key:"saveLabels",value:function(){var e=this.state,t=e.pName,r=e.pDesc,n=e.policy;t&&(n.Name=t),r&&(n.Description=r),this.setState({pName:null,pDesc:null,createRule:null}),this.props.savePolicy(n)}},{key:"onRuleChange",value:function(e){var t=Tr({},this.state.policy);t.Policies?(t.Policies=t.Policies.filter((function(t){return t.id!==e.id})),t.Policies.push(e)):t.Policies=[e],this.setState({createRule:null}),this.props.savePolicy(t)}},{key:"onRemoveRule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Tr({},this.state.policy);r.Policies=r.Policies.filter((function(t){return t.id!==e.id})),this.setState({createRule:null}),this.props.savePolicy(r,t)}},{key:"onAddRule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=Tr({},this.state.policy);r.Policies||(r.Policies=[]);var n=P(),o=[],i=[];"acl"===r.ResourceGroup?(o=["policy:"+r.Uuid],i=["acl"]):"oidc"===r.ResourceGroup&&(i=["oidc"]),r.Policies.push({id:n,description:t,actions:[],subjects:o,resources:i,effect:"deny"}),this.setState({policy:r,createRule:n},(function(){}))}},{key:"render",value:function(){var e,r=this,n=this.props,o=n.readonly,i=n.pydio,a=this.state,s=a.policy,c=a.createRule,u=function(e){return i.MessageHash["ajxp_admin.policies."+e]||e},p=s.Policies.sort((function(e,t){return e.id===c?-1:t.id===c?1:e.description.localeCompare(t.description)})).map((function(e,n){return t().createElement(Mr,Ir({},r.props,{key:e.description,rule:e,isLast:n===s.Policies.length-1,create:c===e.id,onRuleChange:r.onRuleChange.bind(r),onRemoveRule:r.onRemoveRule.bind(r)}))})),f={iconStyle:{fontSize:18,color:"rgba(0,0,0,.33)"},style:{padding:8,width:36,height:36},tooltipPosition:"top-right"},d=t().createElement("div",{style:{display:"flex",alignItems:"center"}},t().createElement("div",{style:{fontSize:14,fontWeight:500}},"Rules"),!o&&t().createElement(l.IconButton,Ir({iconClassName:"mdi mdi-plus",tooltip:u("rule.create"),onClick:this.onAddRule.bind(this)},f,{tooltipPosition:"bottom-right"})));if(!o){var m=this.state,y=m.showLabels,h=m.pName,g=m.pDesc,b=h&&h!==s.Name||g&&g!==s.Description;e=t().createElement("div",{style:{marginTop:10,paddingTop:10}},t().createElement("div",{style:{display:"flex",alignItems:"center"}},t().createElement("div",{style:{fontSize:14,fontWeight:500}},"Edit Labels"),t().createElement(l.IconButton,Ir({iconClassName:"mdi mdi-chevron-"+(y?"down":"right"),tooltip:u("policy.editLabels"),onClick:function(){return r.setState({showLabels:!y})}},f))),t().createElement("div",{style:{display:y?"flex":"none"}},t().createElement("div",{style:{marginRight:6,flex:1}},t().createElement(Fr,{value:h||s.Name,fullWidth:!0,onChange:function(e,t){r.setState({pName:t})}})),t().createElement("div",{style:{marginLeft:6,flex:1}},t().createElement(Fr,{value:g||s.Description,fullWidth:!0,onChange:function(e,t){r.setState({pDesc:t})}})),t().createElement("div",{style:{width:80}},t().createElement(l.IconButton,{disabled:!b,iconClassName:"mdi mdi-content-save",tooltip:u("policy.saveLabels"),tooltipPosition:"top-center",onClick:function(){r.saveLabels()},iconStyle:{fontSize:20,color:"rgba(0,0,0,"+(b?".43":".10")+")"},style:{padding:14}}))))}return t().createElement("div",{style:{padding:"12px 24px",backgroundColor:"#f5f5f5"}},d,p,e)}}],n&&Dr(r.prototype,n),s}(t().Component);const Hr=[{Icon:"shield-lock-outline",Uuid:"sample-acl-policy",Name:"ACLSample1.Title",Description:"ACLSample1.Description",ResourceGroup:"acl",Policies:[{id:"acl-complex-rule1",description:"ACLSample1.Rule1",subjects:["policy:sample-acl-policy"],resources:["acl"],actions:["write","read"],effect:"allow"},{id:"acl-complex-rule2",description:"ACLSample1.Rule2",subjects:["policy:sample-acl-policy"],resources:["acl"],actions:["write"],effect:"deny",conditions:{NodeMetaName:{type:"StringMatchCondition",jsonOptions:'{"matches":"target"}'},RemoteAddress:{type:"StringNotMatchCondition",jsonOptions:'{"matches":"localhost|127.0.0.1|::1"}'}}},{id:"acl-complex-rule3",description:"ACLSample1.Rule3",subjects:["policy:sample-acl-policy"],resources:["acl"],actions:["read"],effect:"deny",conditions:{NodeMetaName:{type:"StringMatchCondition",jsonOptions:'{"matches":"(.+)\\\\.png"}'},RemoteAddress:{type:"StringNotMatchCondition",jsonOptions:'{"matches":"localhost|127.0.0.1|::1"}'}}}]},{Icon:"wall-fire",Uuid:"no-external-access-acl-policy",Name:"ACLSampleExternalIP.Title",Description:"ACLSampleExternalIP.Description",ResourceGroup:"acl",Policies:[{id:"acl-complex-rule4",description:"ACLSampleExternalIP.Rule1",subjects:["policy:no-external-access-acl-policy"],resources:["acl"],actions:["write","read"],effect:"allow"},{id:"acl-complex-rule5",description:"ACLSampleExternalIP.Rule2",subjects:["policy:no-external-access-acl-policy"],resources:["acl"],actions:["write","read"],effect:"deny",conditions:{RemoteAddress:{type:"StringNotMatchCondition",jsonOptions:'{"matches":"localhost|127.0.0.1|::1"}'}}}]},{Icon:"timer-lock-outline",Uuid:"limited-period-access-acl-policy2",Name:"ACLSamplePeriod.Title",Description:"ACLSamplePeriod.Description",ResourceGroup:"acl",Policies:[{id:"acl-temporary-access2",description:"ACLSamplePeriod.Rule1",subjects:["policy:limited-period-access-acl-policy2"],resources:["acl"],actions:["write","read"],effect:"allow",conditions:{ClientTime:{type:"WithinPeriodCondition",jsonOptions:'{"matches":"2018-02-01T00:00+0100/2018-04-01T00:00+0100"}'}}}]},{Icon:"calendar-lock-outline",Uuid:"no-access-after-acl-policy",Name:"ACLSampleDateDisable.Title",Description:"ACLSampleDateDisable.Description",ResourceGroup:"acl",Policies:[{id:"acl-date-rule1",description:"ACLSampleDateDisable.Rule1",subjects:["policy:no-access-after-acl-policy"],resources:["acl"],actions:["write","read"],effect:"allow"},{id:"acl-date-rule2",description:"ACLSampleDateDisable.Rule2",subjects:["policy:no-access-after-acl-policy"],resources:["acl"],actions:["write","read"],effect:"deny",conditions:{ServerTime:{type:"DateAfterCondition",jsonOptions:'{"matches":"2018-02-28T23:59+0100"}'}}}]},{Icon:"clock-check-outline",Uuid:"office-hours-access-acl-policy",Name:"ACLSampleBusinessHours.Title",Description:"ACLSampleBusinessHours.Description",ResourceGroup:"acl",Policies:[{id:"acl-office-hours-rule",description:"ACLSampleBusinessHours.Rule1",subjects:["policy:office-hours-access-acl-policy"],resources:["acl"],actions:["write","read"],effect:"allow",conditions:{ClientTime:{type:"OfficeHoursCondition",jsonOptions:'{"matches":"Monday-Friday/09:00/18:30"}'}}}]}];var Wr=["Icon"];function Gr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Vr=u().requireLib("components").Stepper,zr=Vr.Dialog,Kr=Vr.PanelBigButtons,Jr=function(r){var n=r.open,o=r.onRequestClose,i=r.onPick,a=r.m,s=function(e){return u().getMessages()["tpl_policies.PolicyGroup."+e]||e},l=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i=[],a=!0,s=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(s)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Gr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Gr(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}((0,e.useState)(""),2),c=l[0],p=l[1],f={Sections:[]},d={title:s("Create.Manual"),Actions:[{title:a("type.acl.title"),description:a("type.acl.legend"),icon:"mdi mdi-folder-lock-open-outline",tint:"#607d8b",value:{manual:!0,ResourceGroup:"acl"}},{title:a("type.rest.title"),description:a("type.rest.legend"),icon:"mdi mdi-api",tint:"#607d8b",value:{manual:!0,ResourceGroup:"rest"}}]};f.Sections.push(d);var m={title:s("Create.Templates"),Actions:Hr.map((function(e){var t=e.Icon,r=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,Wr);return r.Name=s(r.Name),r.Description=s(r.Description),r.Policies.forEach((function(e){e.description=s(e.description)})),{title:r.Name,description:r.Description,icon:"mdi mdi-"+t,tag:"preset",value:{template:r}}})).filter((function(e){return!c||e.title.toLowerCase().indexOf(c.toLowerCase())>-1||e.description.toLowerCase().indexOf(c.toLowerCase())>-1}))};return m.Actions.length&&f.Sections.push(m),t().createElement(zr,{title:s("Create"),open:n,dialogProps:{bodyStyle:{overflowY:"auto"}},onDismiss:function(){o()},onFilter:p,filterHint:s("Filter")},t().createElement(Kr,{model:f,onPick:function(e){i(e)}}))};function Qr(){return Qr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Qr.apply(this,arguments)}function $r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Yr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$r(Object(r),!0).forEach((function(t){Xr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$r(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Xr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Zr=u().requireLib("components").MaterialTable,en=u().requireLib("hoc").ModernTextField,tn=["acl","rest","oidc"],rn=i()({displayName:"PoliciesBoard",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:s().instanceOf(Ut()).isRequired,rootNode:s().instanceOf(Ft()).isRequired,currentNode:s().instanceOf(Ft()).isRequired,openEditor:s().func.isRequired,openRightPane:s().func.isRequired,closeRightPane:s().func.isRequired,readonly:s().bool},componentWillMount:function(){this.listPolicies()},getInitialState:function(){return{policies:{},popoverOpen:!1,anchorEl:null}},groupByResourcesGroups:function(e){var t=[],r=new RegExp("-ro$|-rw$|-wo$");return tn.map((function(n){var o=e.PolicyGroups.filter((function(e){var t=e.ResourceGroup||"rest";return!e.Uuid.match(r)&&t===n}));o.length&&(o.sort((function(e,t){return e.Name.toLowerCase()<t.Name.toLowerCase()?-1:e.Name.toLowerCase()===t.Name.toLowerCase()?0:1})),t[n]=o)})),t},listPolicies:function(){var e=this;this.setState({loading:!0});var t=new y.PolicyServiceApi(m().getRestClient());u().startLoading(),t.listPolicies(new y.IdmListPolicyGroupsRequest).then((function(t){u().endLoading();var r=e.groupByResourcesGroups(t);e.setState({policies:r,loading:!1})})).catch((function(t){u().endLoading(),e.setState({error:t,loading:!1})}))},pickCreatePolicy:function(e){if(e.template){var t=P(),r=Yr(Yr({},e.template),{},{Uuid:t});r.Policies.forEach((function(e){e.id=P(),e.subjects=["policy:"+t]})),this.savePolicy(r,!1)}else this.setState({newPolicyType:e.ResourceGroup})},savePolicy:function(e,t){var r=this;this.setState({newPolicyId:null}),t?this.listPolicies():rr().loadClass("EnterpriseSDK").then((function(t){new t.EnterprisePolicyServiceApi(m().getRestClient()).putPolicy(e).then((function(){r.listPolicies()})).catch((function(e){r.setState({error:e})}))}))},deletePolicy:function(e){var t=this,r=this.props.pydio;r.UI.openConfirmDialog({message:r.MessageHash["ajxp_admin.policies.policy.delete.confirm"],destructive:[e.Name],validCallback:function(){rr().loadClass("EnterpriseSDK").then((function(r){new r.EnterprisePolicyServiceApi(m().getRestClient()).deletePolicy(e.Uuid).then((function(){t.listPolicies()})).catch((function(e){t.setState({error:e})}))}))}})},createPolicy:function(e){var t=this.state,r=t.newPolicyType,n=t.newPolicyName,o=t.newPolicyDescription,i=P(),a={Uuid:i,Name:n,Description:o,ResourceGroup:r,Policies:[]},s=Yr({},this.state.policies);s[r]||(s[r]=[]),s[r].push(a),this.setState({policies:s,popoverOpen:!1,newPolicyId:i,selectedPolicy:i,newPolicyType:null,newPolicyName:"",newPolicyDescription:""})},selectRows:function(e){if(e.length&&e[0]){var t=e[0],r=this.state.selectedPolicy;this.setState({selectedPolicy:r===t.Uuid?null:t.Uuid})}},render:function(){var e=this,r=this.props,n=r.muiTheme,o=r.currentNode,i=r.pydio,a=r.accessByName,s=this.props.readonly;s=s||!a("Create");var c=this.state,u=c.policies,p=c.selectedPolicy,f=c.newPolicyId,d=c.newPolicyName,m=c.newPolicyDescription,y=c.openPicker,h=c.newPolicyType,g=function(e){return i.MessageHash["ajxp_admin.policies."+e]||e},b=AdminComponents.AdminStyles(n.palette),v=[{name:"Name",label:g("policy.name"),style:{fontSize:15},sorter:{type:"string",default:!0}},{name:"Rules",label:g("policy.rules"),style:{width:80,textAlign:"center"},headerStyle:{width:80,textAlign:"center"},renderCell:function(e){return e.Policies.length},sorter:{type:"number"}},{name:"Description",label:g("policy.description"),sorter:{type:"string"}}],O=[];s?O.push({iconClassName:"mdi mdi-eye",tooltip:g("policy.display"),onClick:function(t){return e.setState({selectedPolicy:p===t.Uuid?null:t.Uuid})}}):(O.push({iconClassName:"mdi mdi-pencil",tooltip:g("policy.edit"),onClick:function(t){return e.setState({selectedPolicy:p===t.Uuid?null:t.Uuid})}}),O.push({iconClassName:"mdi mdi-delete",tooltip:g("policy.delete"),onClick:function(t){e.deletePolicy(t)}}));var P=tn.map((function(r){if(s&&"acl"===r)return null;var n=u[r]||[];if(s&&!n.length)return null;var o=n.map((function(r){return r.Uuid===p?Yr(Yr({},r),{},{expandedRow:t().createElement(qr,Qr({},e.props,{readonly:s,key:r.Name,policy:r,savePolicy:e.savePolicy.bind(e),deletePolicy:e.deletePolicy.bind(e),newPolicyWithRule:f===r.Uuid?r.Name:null}))}):r})),i=g("type."+r+".title"),a=g("type."+r+".legend"),c="oidc"===r?O.filter((function(e){return"mdi mdi-delete"!==e.iconClassName})):O;return t().createElement("div",null,t().createElement(AdminComponents.SubHeader,{title:i,legend:a}),t().createElement(l.Paper,Qr({},b.body.block.props,{style:b.body.block.container}),t().createElement(Zr,{data:o,columns:v,actions:c,onSelectRows:function(t){return e.selectRows(t)},deselectOnClickAway:!0,showCheckboxes:!1,masterStyles:b.body.tableMaster,storageKey:"console.policies."+r+".list",emptyStateString:t().createElement("span",{onClick:function(){return e.setState({openPicker:!0})},style:{cursor:"pointer"}},g("acl.empty-string"))})))})),R=t().createElement("div",null,t().createElement(l.FlatButton,Qr({},b.props.header.flatButton,{primary:!0,onClick:function(){return e.setState({openPicker:!0})},label:g("policy.new")})));return t().createElement("div",{className:"vertical-layout",style:{height:"100%"}},t().createElement(AdminComponents.Header,{title:o.getLabel(),icon:o.getMetadata().get("icon_class"),actions:s?null:R,reloadAction:this.listPolicies.bind(this),loading:this.state.loading}),t().createElement("div",{className:"layout-fill"},P),!s&&t().createElement(Jr,{m:g,open:y,onPick:function(t){e.pickCreatePolicy(t),e.setState({openPicker:!1})},onRequestClose:function(){return e.setState({openPicker:!1})}}),!s&&t().createElement(l.Dialog,{title:g("policy.new"),actions:[t().createElement(l.FlatButton,{label:i.MessageHash[54],onClick:function(){return e.setState({newPolicyType:null})}}),t().createElement(l.FlatButton,{label:g("policy.create"),onClick:this.createPolicy.bind(this)})],modal:!1,open:h,contentStyle:{width:320}},t().createElement(en,{fullWidth:!0,hintText:g("policy.name"),value:d,focusOnMount:!0,onChange:function(t,r){return e.setState({newPolicyName:r})},variant:"v2"}),t().createElement(en,{fullWidth:!0,hintText:g("policy.description"),value:m,onChange:function(t,r){return e.setState({newPolicyDescription:r})},variant:"v2"})))}});rn=(0,me.muiThemeable)()(rn);const nn=require("pydio/util/pass");var on=r.n(nn);function an(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function sn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ln=u().requireLib("hoc").ModernTextField,cn=i()({displayName:"CreateUserForm",propTypes:{dataModel:s().instanceOf(PydioDataModel),openRoleEditor:s().func},mixins:[AdminComponents.MessagesConsumerMixin,PydioReactUI.ActionDialogMixin,PydioReactUI.CancelButtonProviderMixin,PydioReactUI.SubmitButtonProviderMixin],getDefaultProps:function(){return{dialogSize:"sm",dialogTitleId:"ajxp_admin.user.19"}},getInitialState:function(){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?an(Object(r),!0).forEach((function(t){sn(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):an(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({step:1},on().getState())},checkPassword:function(){var e=this.refs.pass.getValue(),t=this.refs.passconf.getValue();this.setState(on().getState(e,t,this.state))},checkLogin:function(e,t){var r=on().isValidLogin(t);this.setState({loginErrorText:r})},submit:function(){var e=this;if(this.state.valid&&!this.state.loginErrorText){var t=this.props.dataModel.getUniqueNode()||this.props.dataModel.getContextNode(),r=t.getPath();r.startsWith("/idm/users")&&(r=r.substr(10));var n=this.refs.user_id.getValue(),o=this.refs.pass.getValue();m().getRestClient().getIdmApi().createUser(r,n,o).then((function(o){e.dismiss(),t.reload();var i=new(Ft())(r+"/"+n,!0);i.getMetadata().set("ajxp_mime","user"),i.getMetadata().set("IdmUser",o),e.props.openRoleEditor(i)}))}else this.props.pydio.UI.displayMessage("ERROR",this.state.passErrorText||this.state.confirmErrorText||this.state.loginErrorText)},render:function(){var e,r=(this.props.dataModel.getUniqueNode()||this.props.dataModel.getContextNode()).getPath();return r.startsWith("/idm/users")&&(e=r.substr(10))&&(e=t().createElement("div",null,this.context.getMessage("ajxp_admin.user.20").replace("%s",e))),t().createElement("div",{style:{width:"100%"}},e,t().createElement("form",{autoComplete:"off"},t().createElement("div",{style:{width:"100%"}},t().createElement(ln,{ref:"user_id",onChange:this.checkLogin,fullWidth:!0,floatingLabelText:this.context.getMessage("ajxp_admin.user.21"),errorText:this.state.loginErrorText,autoComplete:"nope",variant:"v2"})),t().createElement("div",null,t().createElement(ln,{ref:"pass",type:"password",floatingLabelText:this.context.getMessage("ajxp_admin.user.22"),onChange:this.checkPassword,fullWidth:!0,errorText:this.state.passErrorText||this.state.passHintText,autoComplete:"new-password",variant:"v2"})),t().createElement("div",null,t().createElement(ln,{ref:"passconf",type:"password",floatingLabelText:this.context.getMessage("ajxp_admin.user.23"),onChange:this.checkPassword,fullWidth:!0,errorText:this.state.confirmErrorText,autoComplete:"confirm-password",variant:"v2"}))))}}),un=u().requireLib("hoc").ModernTextField,pn=i()({displayName:"CreateRoleOrGroupForm",mixins:[AdminComponents.MessagesConsumerMixin,PydioReactUI.CancelButtonProviderMixin,PydioReactUI.SubmitButtonProviderMixin],propTypes:{type:s().oneOf(["group","user","role"]),roleNode:s().instanceOf(Ft()),openRoleEditor:s().func},getTitle:function(){return"group"===this.props.type?this.context.getMessage("ajxp_admin.user.15"):this.context.getMessage("ajxp_admin.user.14")},getPadding:function(){return!0},getSize:function(){return"sm"},dismiss:function(){return this.props.onDismiss()},getInitialState:function(){return{groupId:"",groupIdError:"",groupLabel:"",groupLabelError:"",roleId:"",roleLabel:"",roleLabelError:""}},submit:function(){var e,t=this,r=this.props,n=r.type,o=r.pydio,i=r.reload,a=r.openRoleEditor,s=this.state,l=s.groupId,c=s.groupIdError,u=s.groupLabel,p=s.groupLabelError,f=s.roleId,d=s.roleIdError,y=s.roleLabel,h=s.roleLabelError;if("group"===n){if(c||p)return;var g=(e=o.getContextHolder().getSelectedNodes().length?o.getContextHolder().getSelectedNodes()[0]:o.getContextNode()).getPath().replace("/idm/users",""),b=m().getRestClient().getIdmApi();b.userOrGroupByIdentifier(g,l).then((function(r){r?t.setState({groupIdError:"Found group or user with same identifier!"}):b.createGroup(g||"/",l,u).then((function(){t.dismiss(),e.reload()}))}))}else if("role"===n){if(h||d)return;m().getRestClient().getIdmApi().createRole(y,f).then((function(e){t.dismiss(),i&&i(),a&&a(e)}))}},update:function(e){if(void 0!==e.groupId)new RegExp(/^[0-9A-Z\-_.:\+]+$/i).test(e.groupId)?""===e.groupId?e.groupIdError=this.context.getMessage("ajxp_admin.user.16.empty"):e.groupIdError="":e.groupIdError=this.context.getMessage("ajxp_admin.user.16.format");else if(void 0!==e.groupLabel)if(""===e.groupLabel)e.groupLabelError=this.context.getMessage("ajxp_admin.user.17.empty");else{e.groupLabelError="";var t=this.state,r=t.groupId,n=t.groupLabel;""!==r&&D().computeStringSlug(n)!==r||(e.groupId=D().computeStringSlug(e.groupLabel),e.groupIdError="")}else if(void 0!==e.roleLabel)""===e.roleLabel?e.roleLabelError=this.context.getMessage("ajxp_admin.user.18.empty"):e.roleLabelError="";else if(e.roleId){var o=this.props.roles;(void 0===o?[]:o).filter((function(t){return t.Uuid===e.roleId})).length>0?e.roleIdError=this.context.getMessage("role_editor.31.exists"):e.roleIdError="",e.roleId=D().computeStringSlug(e.roleId)}this.setState(e)},render:function(){var e=this,r=this.state,n=r.groupId,o=r.groupIdError,i=r.groupLabel,a=r.groupLabelError,s=r.roleId,l=r.roleIdError,c=r.roleLabel,u=r.roleLabelError;return"group"===this.props.type?t().createElement("div",{style:{width:"100%"}},t().createElement(un,{value:i,errorText:a,onChange:function(t,r){e.update({groupLabel:r})},fullWidth:!0,floatingLabelText:this.context.getMessage("ajxp_admin.user.17"),onKeyPress:function(t){"Enter"===t.key&&e.submit()},variant:"v2"}),t().createElement(un,{value:n,errorText:o,onChange:function(t,r){e.update({groupId:r})},fullWidth:!0,floatingLabelText:this.context.getMessage("ajxp_admin.user.16"),onKeyDown:function(t){"Enter"===t.key&&e.submit()},variant:"v2"})):t().createElement("div",{style:{width:"100%"}},t().createElement(un,{fullWidth:!0,value:c,errorText:u,onChange:function(t,r){e.update({roleLabel:r})},floatingLabelText:this.context.getMessage("role_editor.32"),onKeyDown:function(t){"Enter"===t.key&&e.submit()},variant:"v2"}),t().createElement(un,{fullWidth:!0,value:s,errorText:l,floatingLabelText:this.context.getMessage("role_editor.31.hint"),onChange:function(t,r){e.update({roleId:r})},onKeyDown:function(t){"Enter"===t.key&&e.submit()},variant:"v2"}))}}),fn=u().requireLib("hoc"),dn=fn.ModernTextField,mn=(fn.ModernSelectField,u().requireLib("components").FoldersTree),yn=u().requireLib("boot"),hn=yn.ActionDialogMixin,gn=yn.CancelButtonProviderMixin,bn=yn.SubmitButtonProviderMixin,vn=i()({displayName:"TreeGroupsDialog",propTypes:{dataModel:s().instanceOf(Ut()),submitValue:s().func.isRequired},mixins:[hn,gn,bn],getDefaultProps:function(){return{dialogTitle:"Move",dialogIsModal:!0,dialogScrollBody:!0}},submit:function(){var e=this.state,t=e.selectedNode,r=e.selectedPath;this.props.submitValue(r,t),this.dismiss()},getInitialState:function(){return{selectedNode:this.props.dataModel.getContextNode(),selectedPath:"/"}},onNodeSelected:function(e){var t=this.props.dataModel;e.load(t.getAjxpNodeProvider());var r=t.getContextNode().getPath(),n=new RegExp("^"+r),o=e.getPath().replace(n,"");this.setState({selectedNode:e,selectedPath:o})},render:function(){var e=this.state.selectedPath;return t().createElement("div",{style:{width:"100%"}},t().createElement("div",{style:{fontSize:13}},u().getMessages()["ajxp_admin.user.moveto.hint"]),t().createElement(l.Paper,{zDepth:0,style:{height:300,overflowX:"auto",color:"#546E7A",fontSize:14,padding:"6px 0px",backgroundColor:"rgb(246, 246, 248)",marginTop:4}},t().createElement("div",{style:{marginTop:-41,marginLeft:-21}},t().createElement(mn,{pydio:this.props.pydio,dataModel:this.props.dataModel,rootNode:this.props.dataModel.getContextNode(),onNodeSelected:this.onNodeSelected,showRoot:!0,draggable:!1}))),t().createElement("div",null,t().createElement(dn,{variant:"v2",fullWidth:!0,hintText:this.props.pydio.MessageHash[373],ref:"input",value:e,disabled:!1,onChange:function(){}})))}});function On(e){return On="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},On(e)}function Pn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Rn(e,t){return Rn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Rn(e,t)}function Sn(e){return Sn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Sn(e)}const wn=W(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Rn(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,r,n=Sn(o);if(i){var a=Sn(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!==On(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):r});function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),a.apply(this,arguments)}return r=s,(n=[{key:"render",value:function(){var e,r=this.props.getMessage;switch(this.props.acl){case"read,write":e=r("8");break;case"read":e=r("9");break;case"write":e=r("10");break;case"PYDIO_VALUE_CLEAR":e=r("11");break;default:e=r("12")}return t().createElement("span",{className:"summary-rights summary"},e)}}])&&Pn(r.prototype,n),s}(t().Component));var En={PagesAcls:pe,RightsSelector:J,RightsSummary:wn,WorkspacesAcls:ae,WorkspaceAcl:ee},kn={GroupInfo:Be,RoleInfo:Pe,UserInfo:Ne},An={Role:j,User:T};function jn(e){return jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jn(e)}function xn(e){return function(e){if(Array.isArray(e))return Cn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Cn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Cn(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Cn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Mn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Nn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Mn(Object(r),!0).forEach((function(t){In(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function In(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Tn(e,t){return Tn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Tn(e,t)}function Un(e){return Un=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Un(e)}var Dn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Tn(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,r,n=Un(o);if(i){var a=Un(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!==jn(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):r});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,Nn({actionsPrefix:"[a] ",parametersPrefix:""},e))).state={filter:null},t.props.initialSelection&&(t.state=Nn({filter:t.props.initialSelection.paramName},t.props.initialSelection)),t}return r=s,(n=[{key:"filter",value:function(e){this.setState({filter:e.target.value.toLowerCase()})}},{key:"select",value:function(e,t,r,n){this.props.onSelection(e,t,r,n),this.setState({pluginName:e,type:t,paramName:r})}},{key:"componentDidMount",value:function(){var e=this;setTimeout((function(){e.refs.input.focus()}),150)}},{key:"render",value:function(){var e=this,r=this.props,n=r.pydio,o=r.allParameters,i=r.allActions,a=this.state.filter,s=this.state.paramName,c=this.state.pluginName,u=this.state.type,p=function(e){return!a||-1!==e.toLowerCase().indexOf(a)},f=function(e){if(!a)return e;var r=e.toLowerCase().indexOf(a),n=e.substr(0,r),o=e.substr(r,a.length),i=e.substr(r+a.length);return t().createElement("span",null,n,t().createElement("span",{className:"highlight"},o),i)},d=[],m={};return Object.keys(o).forEach((function(e){var t;m[e]||(m[e]={name:e,label:e,actions:[],params:[]}),(t=m[e].params).push.apply(t,xn(o[e]))})),Object.keys(i).forEach((function(e){var t;m[e]||(m[e]={name:e,label:e,actions:[],params:[]}),(t=m[e].actions).push.apply(t,xn(i[e]))})),D().objectValues(m).map((function(r){var o=[],i=!1,a=r.label||r.name;(p(a)||p(r.name))&&(i=!0,p(a)?a=f(a):p(r.name)&&(a=t().createElement("span",null,a," (",f(r.name),")"))),r.params.concat(r.actions).map((function(a){var l=a.action||a.parameter,d=a.label||l,m="";a.action?(d=qe().XPathGetSingleNodeText(a.xmlNode,"gui/@text")||d,m=e.props.actionsPrefix):(d=a.xmlNode.getAttribute("label")||d,e.props.parametersPrefix&&(m=e.props.parametersPrefix)),n.MessageHash[d]&&(d=n.MessageHash[d]);var y=p(d),h=p(l);if(y||h||i){var g=("*"===c||c===r.name)&&a[u]&&s===l,b=d;y?b=f(d):h&&(b=t().createElement("span",null,d," (",f(l),") ")),o.push(t().createElement("li",{onClick:function(){return e.select(r.name,a.action?"action":"parameter",l,a)},className:(g?"selected ":"")+"parameters-param",key:r.name+"-"+(a.action?"action":"parameter")+"-"+l},m," ",b))}})),o.length&&d.push(t().createElement("li",{className:"parameters-plugin",key:r.name},a,t().createElement("ul",null,o)))})),t().createElement("div",null,t().createElement("div",{style:{padding:"0 24px",borderBottom:"1px solid #e0e0e0"}},t().createElement(l.TextField,{ref:"input",floatingLabelText:this.props.getMessage("13"),onChange:this.filter.bind(this),fullWidth:!0,underlineShow:!1})),t().createElement("div",{className:"parameters-tree-scroller"},t().createElement("ul",{className:"parameters-tree"},d)))}}])&&_n(r.prototype,n),s}(t().Component);function Ln(e){return Ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ln(e)}function Bn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Fn(e,t){return Fn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Fn(e,t)}function qn(e){return qn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},qn(e)}var Hn=u().requireLib("boot"),Wn=Hn.ActionDialogMixin,Gn=Hn.CancelButtonProviderMixin,Vn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fn(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,r,n=qn(o);if(i){var a=qn(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!==Ln(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):r});function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),a.apply(this,arguments)}return r=s,(n=[{key:"render",value:function(){var e=this.props,r=e.getMessage,n=e.muiTheme,o=n.palette.mui3?n.palette.mui3["secondary-container"]:n.palette.primary1Color,i=n.palette.mui3?n.palette.mui3["on-secondary-container"]:"white",a=n.borderRadius;return t().createElement("div",{style:{backgroundColor:o,color:i,borderRadius:"".concat(a,"px ").concat(a,"px 0 0"),padding:24}},t().createElement("h3",{style:{color:i,fontSize:20,marginBottom:16}},r("14")),t().createElement("div",{className:"legend"},r("15")))}}])&&Bn(r.prototype,n),s}(t().Component);Vn=(0,me.muiThemeable)()(Vn);var zn=i()({displayName:"ParameterCreate",mixins:[Wn,Gn],propTypes:{workspaceScope:s().string,showModal:s().func,hideModal:s().func,pluginsFilter:s().func,roleType:s().oneOf(["user","group","role"]),createParameter:s().func},getDefaultProps:function(){return{dialogPadding:0,dialogTitle:"",dialogSize:"md"}},getInitialState:function(){return{step:1,workspaceScope:this.props.workspaceScope,pluginName:null,paramName:null,actions:{},parameters:{}}},setSelection:function(e,t,r,n){this.setState({pluginName:e,type:t,paramName:r,attributes:n},this.createParameter)},createParameter:function(){this.props.createParameter(this.state.type,this.state.pluginName,this.state.paramName,this.state.attributes),this.props.onDismiss()},render:function(){var e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pydio_role";return n.MessageHash[t+(t?".":"")+e]||e},r=this.props,n=r.pydio,o=r.actions,i=r.parameters;return t().createElement("div",{className:"picker-list"},t().createElement(Vn,{getMessage:e}),t().createElement(Dn,{pydio:n,allActions:o,allParameters:i,onSelection:this.setSelection,getMessage:e}))}}),Kn={ParametersPicker:Dn,ParameterCreate:zn,ParametersPanel:ct,ParameterEntry:tt};function Jn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Qn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var $n=u().requireLib("boot"),Yn=$n.ActionDialogMixin,Xn=$n.CancelButtonProviderMixin,Zn=$n.SubmitButtonProviderMixin,eo=u().requireLib("hoc").ModernTextField;const to=i()({displayName:"UserPasswordDialog",mixins:[AdminComponents.MessagesConsumerMixin,Yn,Xn,Zn],propTypes:{pydio:s().instanceOf(u()),user:s().instanceOf(T)},getDefaultProps:function(){return{dialogTitle:pydio.MessageHash["role_editor.25"],dialogSize:"sm"}},getInitialState:function(){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Jn(Object(r),!0).forEach((function(t){Qn(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},on().getState())},onChange:function(e,t){var r=this.refs.pass.getValue(),n=this.refs.confirm.getValue(),o=on().getState(r,n,this.state);this.setState(o)},submit:function(){var e=this;if(this.state.valid){var t=this.refs.pass.getValue(),r=this.props.user;r.getIdmUser().Password=t,r.save().then((function(){e.dismiss()}))}else this.props.pydio.UI.displayMessage("ERROR",this.state.passErrorText||this.state.confirmErrorText)},render:function(){var e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return r.g.pydio.MessageHash[t+(t?".":"")+e]||e};return t().createElement("div",{style:{width:"100%"}},t().createElement("form",{autoComplete:"off"},t().createElement(eo,{ref:"pass",type:"password",fullWidth:!0,onChange:this.onChange,floatingLabelText:e("523"),errorText:this.state.passErrorText,hintText:this.state.passHintText,variant:"v2",autoComplete:"whatever"}),t().createElement(eo,{ref:"confirm",type:"password",fullWidth:!0,onChange:this.onChange,floatingLabelText:e("199"),errorText:this.state.confirmErrorText,variant:"v2",autoComplete:"no-thanks"})))}});var ro={Model:An,Info:kn,ACL:En,Params:Kn,User:{UserPasswordDialog:to,UserRolesPicker:Et},Util:{EditorCache:{CACHE:null},withRoleMessages:W,loadEditorClass:or}},no={CreateUserForm:cn,CreateRoleOrGroupForm:pn}})(),window.AdminPeople=n})();