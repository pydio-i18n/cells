(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var i in r)e.o(r,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:r[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Dashboard:()=>T});const r=require("prop-types");var i=e.n(r);const n=require("pydio");var a=e.n(n);const s=require("pydio/model/data-model");var o=e.n(s);const l=require("pydio/model/node");var d=e.n(l);const c=require("react");var p=e.n(c);const u=require("create-react-class");var m=e.n(u);const h=require("pydio/http/api");var f=e.n(h);const y=require("cells-sdk"),g=require("material-ui");function v(){return v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},v.apply(this,arguments)}p().Component;var S=a().requireLib("components").MaterialTable,b=["gateway","datasource","data","idm","scheduler","broker","frontend","discovery"];const E=m()({displayName:"ServicesList",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:i().instanceOf(PydioDataModel).isRequired,rootNode:i().instanceOf(AjxpNode).isRequired,currentNode:i().instanceOf(AjxpNode).isRequired,filter:i().string,peerFilter:i().string,details:i().bool,onUpdatePeers:i().func},getInitialState:function(){return{services:[]}},componentDidMount:function(){this.load()},reload:function(){this.load()},load:function(){var e=this,t=new y.ConfigServiceApi(f().getRestClient());a().startLoading(),this.setState({loading:!0}),t.listServices().then((function(t){if(a().endLoading(),e.setState({loading:!1}),e.setState({services:t.Services}),e.props.onUpdatePeers){var r=(i=t.Services,n={},i.filter((function(e){return!!e.RunningPeers})).map((function(e){e.RunningPeers.map((function(e){e.Address&&(n[e.Address]=e.Address)}))})),Object.keys(n));e.props.onUpdatePeers(r)}var i,n})).catch((function(){a().endLoading(),e.setState({loading:!1})}))},renderListItem:function(e){var t=[],r=this.props,i=r.details,n=r.pydio;if(i){e.Description&&t.push(e.Description);var a=e.RunningPeers;if(a&&a.length){var s=[];a.map((function(e){s.push(e.Address)})),t.push(n.MessageHash["ajxp_admin.services.service.ip"].replace("%s",s.join(",")))}}return p().createElement(g.ListItem,{primaryText:e.Name,secondaryText:t.join(" - "),leftCheckbox:p().createElement(g.Checkbox,{defaultChecked:"STARTED"===e.Status,checked:"STARTED"===e.Status})})},filterNodes:function(e){var t=this;return!(-1!==e.Name.indexOf(".(.+)")||this.props.filter&&e.Status!==this.props.filter||this.props.inputFilter&&e.Name.indexOf(this.props.inputFilter)<=0||!(!this.props.peerFilter||!!e.RunningPeers&&e.RunningPeers.filter((function(e){return e.Address===t.props.peerFilter})).length>0))},render:function(){var e=this,t=this.props.pydio,r=this.state,i=r.services,n=void 0===i?[]:i,a=r.loading,s=function(e){return t.MessageHash["ajxp_admin.services.tag."+e]||e},o=function(e){return t.MessageHash["ajxp_admin.services.column."+e]||e},l=function(e){var t={};return e.sort((function(e,t){return e.Name>t.Name?1:e.Name===t.Name?0:-1})),b.forEach((function(r){t[r]={services:{}},e.map((function(e){if(r===e.Tag){var i=e.Name;if(i.startsWith("pydio.grpc.")?i=i.replace("pydio.grpc.",""):i.startsWith("pydio.rest.")&&(i=i.replace("pydio.rest.","")),"datasource"===r&&i.startsWith("data."))if("index"===(i=i.replace("data.",""))||"sync"===i||"objects"===i)i="main - "+i;else{var n=i.split(".").shift();i=i.split(".").pop(),i="objects"===n?"objects - "+i:"datasource - "+i}t[r].services[i]||(t[r].services[i]=[]),t[r].services[i].push(e)}}))})),t}(n.filter((function(t){return e.filterNodes(t)}))),d=[],c=[{name:"Status",label:"",style:{width:56,paddingLeft:12,paddingRight:12,textOverflow:"inherit"},headerStyle:{width:56},renderCell:function(e){var t="STARTED"===e.Status?"#33691e":"#d32f2f",r="STARTED"===e.Status?"Running":"Stopped";return"STARTED"!==e.Status&&e.Metadata&&e.Metadata.unique&&(t="#9E9E9E",r="Standby"),{element:p().createElement(g.FontIcon,{style:{margin:"0 9px 0 4px",fontSize:20},className:"mdi-traffic-light",color:t}),text:r}}},{name:"Name",label:o("name"),style:{paddingLeft:0},headerStyle:{paddingLeft:0}},{name:"Description",label:o("description"),style:{width:"40%"},headerStyle:{width:"40%"},hideSmall:!0},{name:"Version",label:o("version"),style:{width:110},headerStyle:{width:110},hideSmall:!0},{name:"Type",label:o("tag"),style:{width:120},headerStyle:{width:120},hideSmall:!0,renderCell:function(e){var r=e.Name.startsWith("pydio.grpc.")?"Grpc":"Rest",i=function(e){return t.MessageHash["ajxp_admin.services.service."+e]||e};return"gateway"===e.Tag?r=e.Name.split(".").pop():"datasource"===e.Tag&&(e.Name.startsWith("pydio.grpc.data.sync.")?r=i("datasource.sync"):e.Name.startsWith("pydio.grpc.data.objects.")?r=i("datasource.objects"):e.Name.startsWith("pydio.grpc.data.index.")&&(r=i("datasource.index"))),r}},{name:"RunningPeers",label:o("peers"),hideSmall:!0,renderCell:function(e){var t=[];return"STARTED"===e.Status&&e.RunningPeers?t=e.RunningPeers.map((function(e){return e.Metadata&&e.Metadata["non-addressable"]?e.Metadata["non-addressable"]:e.Port?e.Address+":"+e.Port:e.Address})):t.push("N/A"),t.join(",")}}];Object.keys(l).forEach((function(e){var t=[],r=l[e].services;Object.keys(r).forEach((function(e){r[e].forEach((function(e){t.push(e)}))})),t.length&&(t.unshift({Subheader:p().createElement("span",null,p().createElement("span",{style:{textTransform:"uppercase"}},s(e+".title"))," - ",s(e+".description"))}),d.push.apply(d,t))}));var u=AdminComponents.AdminStyles().body,m=u.tableMaster,h=u.block.props,f=u.block.container;return p().createElement("div",{className:this.props.className,style:this.props.style},p().createElement(g.Paper,v({},h,{style:f}),p().createElement(S,{data:d,columns:c,deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:t.MessageHash["ajxp_admin.services.empty."+(a?"loading":"noservice")],masterStyles:m})))}});var x=a().requireLib("hoc"),N=x.ModernSelectField,M=x.ModernTextField;const T=m()({displayName:"Dashboard",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:i().instanceOf(o()).isRequired,rootNode:i().instanceOf(d()).isRequired,currentNode:i().instanceOf(d()).isRequired,openEditor:i().func.isRequired,openRightPane:i().func.isRequired,closeRightPane:i().func.isRequired,pydio:i().instanceOf(a())},getInitialState:function(){return{filter:"",peers:[],peerFilter:""}},onDetailsChange:function(e,t){this.setState({details:t}),localStorage.setItem("console.services.details",t?"true":"false")},onFilterChange:function(e,t,r){this.setState({filter:r})},onPeerFilterChange:function(e,t,r){this.setState({peerFilter:r})},reloadList:function(){this.refs.servicesList.reload()},onUpdatePeers:function(e){this.setState({peers:e})},render:function(){var e=this,t=this.props.pydio,r=this.state,i=r.peers,n=r.peerFilter,a=r.filter,s=r.inputFilter,o=void 0===s?"":s,l=function(e){return t.MessageHash["ajxp_admin.services."+e]||e},d=p().createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"}},p().createElement("div",{style:{width:150,marginRight:8},className:"media-small-hide"},p().createElement(M,{variant:"compact",fullWidth:!0,value:o,onChange:function(t,r){return e.setState({inputFilter:r})},hintText:l("text-filter.hint")})),i.length>0&&p().createElement("div",{style:{width:150,marginRight:8},className:"media-small-hide"},p().createElement(N,{fullWidth:!0,variant:"compact",underlineStyle:{display:"none"},value:n,onChange:this.onPeerFilterChange},p().createElement(g.MenuItem,{value:"",primaryText:l("peerfilter.title")}),i.map((function(e){return p().createElement(g.MenuItem,{value:e,primaryText:e})})))),p().createElement("div",{style:{width:150},className:"media-small-hide"},p().createElement(N,{fullWidth:!0,variant:"compact",underlineStyle:{display:"none"},value:a,onChange:this.onFilterChange},p().createElement(g.MenuItem,{value:"",primaryText:l("filter.nofilter")}),p().createElement(g.MenuItem,{value:"STARTED",primaryText:l("filter.started")}),p().createElement(g.MenuItem,{value:"STOPPED",primaryText:l("filter.stopped")})))),c=this.props.toolsAbsolute;return p().createElement("div",{className:"main-layout-nav-to-stack workspaces-board"},p().createElement("div",{className:"vertical-layout",style:{width:"100%"}},p().createElement(AdminComponents.Header,{title:c?"":this.context.getMessage("172","settings"),icon:c?"":"mdi mdi-access-point-network",legend:this.context.getMessage("173","settings"),centerContent:d,reloadAction:this.reloadList.bind(this),style:c?{position:"absolute",top:0,right:0}:null}),p().createElement(E,{ref:"servicesList",pydio:t,className:"layout-fill",style:{paddingBottom:16},dataModel:this.props.dataModel,rootNode:this.props.rootNode,currentNode:this.props.rootNode,filter:a,peerFilter:n,inputFilter:o,onUpdatePeers:this.onUpdatePeers.bind(this)})))}});window.AdminServices=t})();