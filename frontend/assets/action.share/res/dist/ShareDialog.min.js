(()=>{"use strict";var e={164:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,o,i){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(r)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(a[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);r&&a[u[0]]||(void 0!==i&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=i),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),o&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=o):u[4]="".concat(o)),t.push(u))}},t}},259:e=>{e.exports=function(e){return e[1]}},624:(e,t,n)=>{n.d(t,{Z:()=>s});var r=n(259),o=n.n(r),i=n(164),a=n.n(i)()(o());a.push([e.id,'div.user-badge.share-dialog {\n  border-bottom: 1px solid var(--md-sys-color-field-underline-idle);\n  clear: both;\n  font-size: 14px;\n  margin-left: 10px;\n  margin-right: 10px;\n  padding-top: 1px;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  line-height: 20px;\n}\ndiv.user-badge.share-dialog .user-badge-label {\n  flex: 1;\n  font-size: 14px;\n  font-weight: 500;\n  padding: 9px 0;\n  line-height: 25px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\ndiv.user-badge.share-dialog:last-of-type {\n  border-bottom: 0;\n}\ndiv.user-badge.share-dialog span.icon-ellipsis-vertical.mui-font-icon {\n  color: #6F6F6F;\n  font-size: 18px;\n}\ndiv.user-badge.share-dialog .avatar {\n  background-color: #4aceb0;\n  border-radius: 50%;\n  color: white;\n  display: inline-block;\n  font-size: 17px;\n  height: 24px;\n  width: 24px;\n  margin: 5px 14px 7px 7px;\n  padding: 2px;\n  text-align: center;\n}\ndiv.user-badge.share-dialog img {\n  background-color: #4aceb0;\n  border-radius: 50%;\n  color: white;\n  display: inline-block;\n  font-size: 17px;\n  height: 24px;\n  margin: 5px 14px 7px -44px;\n  padding: 6px;\n  text-align: center;\n  width: 24px;\n}\ndiv.user-badge.share-dialog div.user-badge-menu-box {\n  font-size: 13px;\n  position: relative;\n}\ndiv.user-badge.share-dialog div.user-badge-menu-box div.mui-menu.mui-visible {\n  box-shadow: 0 0 5px rgba(0, 0, 0, 0.43);\n  position: absolute;\n  right: 0;\n  top: 0;\n  width: 200px;\n  z-index: 120;\n}\ndiv.user-badge.share-dialog div.user-badge-menu-box div.mui-menu span.icon-check {\n  float: right;\n  font-size: 16px;\n  margin-top: 15px;\n}\ndiv.user-badge.share-dialog span.user-badge-rights-container {\n  float: right;\n  padding: 11px;\n  color: gray;\n  font-size: 11px;\n  line-height: 25px;\n}\ndiv.user-badge.share-dialog span.user-badge-rights-container input[name="write"] {\n  margin-left: 28px;\n}\ndiv#share-form-users {\n  margin-top: 0 !important;\n}\n',""]);const s=a},962:e=>{var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var i={},a=[],s=0;s<e.length;s++){var l=e[s],c=r.base?l[0]+r.base:l[0],u=i[c]||0,p="".concat(c," ").concat(u);i[c]=u+1;var f=n(p),d={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==f)t[f].references++,t[f].updater(d);else{var y=o(d,r);r.byIndex=s,t.splice(s,0,{identifier:p,updater:y,references:1})}a.push(p)}return a}function o(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,o){var i=r(e=e||[],o=o||{});return function(e){e=e||[];for(var a=0;a<i.length;a++){var s=n(i[a]);t[s].references--}for(var l=r(e,o),c=0;c<i.length;c++){var u=n(i[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}i=l}}},978:e=>{var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},728:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},840:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},932:e=>{e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,o&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},208:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},566:e=>{e.exports=require("create-react-class")},455:e=>{e.exports=require("material-ui")},173:e=>{e.exports=require("material-ui/styles")},580:e=>{e.exports=require("prop-types")},757:e=>{e.exports=require("pydio")},689:e=>{e.exports=require("react")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={id:r,exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nc=void 0;var r={};(()=>{n.r(r),n.d(r,{CellCard:()=>Mt,CompositeDialog:()=>qo,CreateCellDialog:()=>We,EditCellDialog:()=>mt,InfoPanel:()=>No,LinkModel:()=>Ft,ShareHelper:()=>Pe,ShareView:()=>fi,ShareViewModal:()=>di,SimpleLinkCard:()=>lo});var e=n(689),t=n.n(e),o=n(580),i=n.n(o),a=n(757),s=n.n(a),l=n(455),c=n(173);function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function p(){return p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},p.apply(this,arguments)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function y(e){return y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},y(e)}var h=n(580),m=n(689);function g(e){var t=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(s,t);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=y(o);if(i){var a=y(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==u(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),a.apply(this,arguments)}return n=s,(r=[{key:"render",value:function(){var t=this.context,n={messages:t.messages,getMessage:t.getMessage,isReadonly:t.isReadonly};return m.createElement(e,p({},this.props,n))}}])&&f(n.prototype,r),s}(m.Component);return t.contextTypes={messages:h.object,getMessage:h.func,isReadonly:h.func},t}function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t){return w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},w(e,t)}function O(e){return O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},O(e)}var E=n(580),k=n(455),P=k.MenuItem,S=k.IconMenu,j=k.IconButton,x=Pydio.requireLib("components").SharedAvatar,R=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=O(o);if(i){var a=O(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==b(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),a.apply(this,arguments)}return n=s,(r=[{key:"renderMenu",value:function(){if(!this.props.menus||!this.props.menus.length)return null;var e=this.props.menus.map((function(e){var n;return e.checked&&(n=t().createElement("span",{className:"mdi mdi-check"})),t().createElement(P,{primaryText:e.text,onClick:e.callback,rightIcon:n})}));return t().createElement(S,{iconButtonElement:t().createElement(j,{style:{width:30,height:30,padding:5},iconStyle:{fontSize:18},iconClassName:"mdi mdi-dots-vertical"}),anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"},desktop:!0},e)}},{key:"render",value:function(){var e=this.props,n=e.type,r=e.avatarUser,o=this.renderMenu(),i=this.props.boxes;return t().createElement("div",{className:"share-dialog user-badge user-type-"+this.props.type},t().createElement(x,{size:28,type:n,idmObject:r,style:{margin:"5px 14px 7px 7px"}}),t().createElement("span",{className:"user-badge-label"},this.props.label),o,i)}}])&&v(n.prototype,r),s}(e.Component);function _(e){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(e)}function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){I(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t){return T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},T(e,t)}function D(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e){return A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},A(e)}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}R.propTypes={label:E.string,avatar:E.string,type:E.string,menus:E.object};var U=n(580),N=n(689),B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,i=A(r);if(o){var a=A(this).constructor;e=Reflect.construct(i,arguments,a)}else e=i.apply(this,arguments);return t=this,!(n=e)||"object"!==_(n)&&"function"!=typeof n?D(t):n});function a(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return I(D(e=i.call.apply(i,[this].concat(n))),"onRemove",(function(){e.props.onUserObjectRemove(e.props.cellAcl.RoleId)})),I(D(e),"onInvite",(function(){var t={},n=PydioUsers.User.fromIdmUser(e.props.cellAcl.User);t[n.getId()]=n,e.props.sendInvitations(t)})),I(D(e),"onUpdateRight",(function(t,n){e.props.onUserObjectUpdateRight(e.props.cellAcl.RoleId,t,n)})),e}return t=a,(n=[{key:"render",value:function(){var e,t,n=this,r=this.props,o=r.cellAcl,i=r.pydio,a=[],s=o.User?"user":o.Group?"group":"team";if(o.User&&o.User.Login===i.user.id)return null;switch("group"!==s&&this.props.sendInvitations&&a.push({text:this.props.getMessage("45"),callback:this.onInvite}),this.props.isReadonly()||this.props.readonly||a.push({text:this.props.getMessage("257",""),callback:this.onRemove}),s){case"user":e=o.User.Attributes.displayName||o.User.Login,t=o.User;break;case"group":e=o.Group.Attributes?o.Group.Attributes.displayName||o.Group.GroupLabel:o.Group.Uuid;break;case"team":e=o.Role?o.Role.Label:"No role found";break;default:e=o.RoleId}var c=!1,u=!1;o.Actions.map((function(e){"read"===e.Name&&(c=!0),"write"===e.Name&&(u=!0)}));var p=this.props.isReadonly()||this.props.readonly,f={display:"flex",width:70};a.length||(f=M(M({},f),{},{marginRight:48}));var d=N.createElement("span",{style:f},N.createElement(l.Checkbox,{disabled:p,checked:c,onCheck:function(e,t){n.onUpdateRight("read",t)}}),N.createElement(l.Checkbox,{disabled:p,checked:u,onCheck:function(e,t){n.onUpdateRight("write",t)}}));return N.createElement(R,{label:e,avatarUser:t,type:s,menus:a,boxes:d})}}])&&C(t.prototype,n),a}(N.Component);function q(e){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q(e)}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function H(e,t){return H=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},H(e,t)}function z(e){return z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},z(e)}I(B,"propTypes",{cellAcl:U.object.isRequired,sendInvitations:U.func,onUserObjectRemove:U.func.isRequired,onUserObjectUpdateRight:U.func.isRequired}),B=g(B);var V=n(580),W=n(689).Component,Y=n(455).IconButton,G=n(173).muiThemeable,X=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&H(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,i=z(r);if(o){var a=z(this).constructor;e=Reflect.construct(i,arguments,a)}else e=i.apply(this,arguments);return t=this,!(n=e)||"object"!==q(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),i.apply(this,arguments)}return t=a,(n=[{key:"render",value:function(){var e=this.props.muiTheme.palette,t=this.props,n=t.destructive,r=t.disabled,o=n?e.mui3.error:e.mui3.primary,i={root:{borderRadius:"50%",border:"1px solid "+o,backgroundColor:"transparent",width:36,height:36,padding:"8px 6px",margin:"0 6px",zIndex:0,opacity:r?.5:1},icon:{color:o,fontSize:20,lineHeight:"20px"}},a=this.props,s=a.tooltip,l=a.messageId,c=a.getMessage,u=a.messageCoreNamespace;return l&&c&&(s=this.props.getMessage(l,u||void 0)),React.createElement(Y,{style:i.root,iconStyle:i.icon,onClick:this.props.callback||this.props.onClick,iconClassName:this.props.mdiIcon?"mdi mdi-"+this.props.mdiIcon:this.props.iconClassName,tooltip:s,disabled:r,tooltipPosition:this.props.tooltipPosition})}}])&&F(t.prototype,n),a}(W);X.propTypes={callback:V.func,onClick:V.func,mdiIcon:V.string,messageId:V.string},X=g(X);const Q=X=G()(X);function K(e){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(e)}function Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function J(e,t){return J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},J(e,t)}function $(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ee(e){return ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ee(e)}function te(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ne=s().requireLib("components").UsersCompleter,re=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=ee(o);if(i){var a=ee(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==K(n)&&"function"!=typeof n?$(t):n});function s(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return te($(e=a.call.apply(a,[this].concat(n))),"sendInvitationToAllUsers",(function(){var t=e.props,n=t.cellAcls,r=t.pydio,o=[];Object.keys(n).map((function(e){var t=n[e];if((!t.User||t.User.Login!==r.user.id)&&t.User){var i=PydioUsers.User.fromIdmUser(t.User);o[i.getId()]=i}})),e.props.sendInvitations(o)})),te($(e),"clearAllUsers",(function(){Object.keys(e.props.cellAcls).map((function(t){e.props.onUserObjectRemove(t)}))})),te($(e),"valueSelected",(function(t){t.IdmUser?e.props.onUserObjectAdd(t.IdmUser):e.props.onUserObjectAdd(t.IdmRole)})),e}return n=s,(r=[{key:"render",value:function(){var e=this,n=this.props,r=n.cellAcls,o=n.pydio,i=n.completerStyle,a=n.muiTheme,s=o.getPluginConfigs("core.auth"),l=0,c=[];Object.keys(r).map((function(n){var i=r[n];i.User&&i.User.Login===o.user.id||(l++,c.push(t().createElement(B,{cellAcl:i,key:l,pydio:e.props.pydio,readonly:e.props.readonly,sendInvitations:e.props.sendInvitations,onUserObjectRemove:e.props.onUserObjectRemove,onUserObjectUpdateRight:e.props.onUserObjectUpdateRight})))}));var u,p,f=[],d=Object.keys(this.props.cellAcls).length;if(!d||this.props.isReadonly()||this.props.readonly||f.push(t().createElement(Q,{key:"clear",callback:this.clearAllUsers,tooltipPosition:"top-center",mdiIcon:"account-minus",messageId:"180"})),d&&this.props.sendInvitations&&f.push(t().createElement(Q,{key:"invite",callback:this.sendInvitationToAllUsers,tooltipPosition:"top-center",mdiIcon:"email-outline",messageId:"45"})),this.props.saveSelectionAsTeam&&d>1&&!this.props.isReadonly()&&!this.props.readonly&&f.push(t().createElement(Q,{key:"team",callback:this.props.saveSelectionAsTeam,mdiIcon:"account-multiple-plus",tooltipPosition:"top-center",messageId:"509",messageCoreNamespace:!0})),this.props.withActionLinks&&(f=this.props.withActionLinks(f)),c.length){var y="rgba(0,0,0,.33)";"mui3"===a.userTheme&&(y=a.palette.mui3.outline),u=t().createElement("div",{style:{display:"flex",marginBottom:-8,marginTop:-8,color:y,fontSize:12}},t().createElement("div",{style:{flex:1}}),t().createElement("div",{style:{width:43,textAlign:"center",overflow:"hidden",textOverflow:"ellipsis"}},this.props.getMessage("361","")),t().createElement("div",{style:{width:43,textAlign:"center",overflow:"hidden",textOverflow:"ellipsis"}},this.props.getMessage("181")),t().createElement("div",{style:{width:6}}))}if(!this.props.isReadonly()&&!this.props.readonly){var h=Object.values(r).map((function(e){return e.User?e.User.Login:e.Group?e.Group.Uuid:e.Role?e.Role.Uuid:null})).filter((function(e){return!!e})),m=s.get("USER_CREATE_USERS");p=t().createElement(ne,{className:"share-form-users",fieldLabel:this.props.getMessage(m?"34":"34b"),onValueSelected:this.valueSelected,pydio:this.props.pydio,showAddressBook:!0,usersFrom:"local",excludes:h,existingOnly:!m})}return t().createElement("div",null,t().createElement("div",{style:i||{margin:"0 8px 16px"}},p),u,t().createElement("div",null,c),!c.length&&t().createElement("div",{style:{color:a.palette.mui3["on-surface-variant"],fontWeight:500,margin:"0 10px"}},this.props.getMessage("182")),c.length>0&&t().createElement("div",{style:{textAlign:"center",marginTop:10,marginBottom:10}},f))}}])&&Z(n.prototype,r),s}(t().Component);te(re,"propTypes",{pydio:i().instanceOf(s()),cellAcls:i().object,saveSelectionAsTeam:i().func,sendInvitations:i().func,showTitle:i().bool,onUserObjectAdd:i().func.isRequired,onUserObjectRemove:i().func.isRequired,onUserObjectUpdateRight:i().func.isRequired}),re=g((0,c.muiThemeable)()(re));const oe=require("pydio/model/data-model");var ie=n.n(oe);function ae(e){return ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ae(e)}function se(e){return function(e){if(Array.isArray(e))return le(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return le(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?le(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function le(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ue(e,t){return ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ue(e,t)}function pe(e){return pe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},pe(e)}var fe=s().requireLib("components").FoldersTree,de=s().requireLib("hoc").ThemedContainers.Popover,ye=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ue(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=pe(o);if(i){var a=pe(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==ae(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function s(e){var t,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=a.call(this,e);var r=e.pydio.user,o=[];r.getRepositoriesList().forEach((function(e){if("gateway"===e.getAccessType()){if(e.getId()===r.activeRepository){if("shared"===e.getOwner())return;n=e}o.push(e)}}));var i,l,c=o.filter((function(e){return!e.getOwner()})),u=o.filter((function(e){return e.getOwner()}));if((l=c.length&&u.length?[].concat(se(c),["DIVIDER"],se(u)):[].concat(se(c),se(u))).length){n||(n=l[0]);var p=(i=ie().RemoteDataModelFactory({tmp_repository_id:n.getId()})).getRootNode();p.getMetadata().set("repository_id",n.getId()),p.load(i.getAjxpNodeProvider())}return t.state={dataModel:i,open:!1,availableWs:l,crtWs:n},t}return n=s,(r=[{key:"switchWorkspace",value:function(e){var t=ie().RemoteDataModelFactory({tmp_repository_id:e.getId()}),n=t.getRootNode();n.getMetadata().set("repository_id",e.getId()),n.load(t.getAjxpNodeProvider()),this.setState({crtWs:e,dataModel:t})}},{key:"handleTouchTap",value:function(e){e.preventDefault(),this.setState({open:!0,anchorEl:e.currentTarget})}},{key:"handleRequestClose",value:function(){this.setState({open:!1})}},{key:"onValidateNode",value:function(){var e=this.state,t=e.node,n=e.crtWs;this.props.model.addRootNode(t,n.getId()),this.handleRequestClose()}},{key:"onNodeSelected",value:function(e){var t=this.state.dataModel;e.load(t.getAjxpNodeProvider()),this.setState({node:e})}},{key:"renderNodeLine",value:function(e){var n=this.props.model;return t().createElement(l.ListItem,{disabled:!0,leftIcon:t().createElement(l.FontIcon,{style:{fontSize:20,margin:"14px 12px"},className:"mdi mdi-"+("LEAF"===e.Type?"file-outline":"folder-outline")}),primaryText:n.getNodeLabelInContext(e),innerDivStyle:{paddingLeft:52,fontSize:14,fontWeight:500},rightIconButton:t().createElement(l.IconButton,{onClick:function(){n.removeRootNode(e.Uuid)},iconClassName:"mdi mdi-delete",tooltip:"Remove",iconStyle:{color:"var(--md-sys-color-primary)"}})})}},{key:"render",value:function(){var e,n=this,r=this.props,o=r.model,i=r.muiTheme,a=r.mode,s=r.pydio,c=function(e){return s.MessageHash["share_center."+e]},u=o.getRootNodes()||[],p=[];u.map((function(e){p.push(n.renderNodeLine(e)),p.push(t().createElement(l.Divider,{inset:!1}))})),p.pop(),u.length||"edit"!==a||(e=t().createElement("div",{style:{fontStyle:"italic",padding:20,textAlign:"center"}},c(280)));var f=t().createElement(l.RaisedButton,{label:c(282),onClick:this.handleTouchTap.bind(this),primary:"edit"===a,secondary:"edit"!==a,style:{marginBottom:10,width:"100%"},icon:t().createElement(l.FontIcon,{className:"mdi mdi-folder-plus",style:{fontSize:20,marginTop:-4}})}),d=this.state,y=d.node,h=d.availableWs,m=d.crtWs;return t().createElement("div",null,t().createElement(l.List,null,p),e,f,t().createElement(de,{open:this.state.open,anchorEl:this.state.anchorEl,anchorOrigin:{horizontal:"left",vertical:"bottom"},targetOrigin:{horizontal:"left",vertical:"top"},onRequestClose:this.handleRequestClose.bind(this)},t().createElement("div",{style:{width:372,height:300,display:"flex",flexDirection:"column"}},t().createElement(l.DropDownMenu,{style:{height:54},value:m,onChange:function(e,t,r){n.switchWorkspace(r)}},h.map((function(e){return"DIVIDER"===e?t().createElement(l.Divider,null):t().createElement(l.MenuItem,{value:e,primaryText:e.getLabel()})}))),t().createElement(l.Divider,null),t().createElement("div",{style:{marginLeft:-26,flex:"1",overflowY:"auto",fontSize:15}},t().createElement(fe,{pydio:this.props.pydio,dataModel:this.state.dataModel,onNodeSelected:this.onNodeSelected.bind(this),showRoot:!1,draggable:!1})),t().createElement(l.Divider,null),t().createElement("div",{style:{display:"flex",padding:"4px 16px",alignItems:"center",fontSize:15,background:"var(--md-sys-color-surface-5)"}},t().createElement("div",{style:{flex:1,opacity:y&&y.getPath()?1:.5}},y&&y.getPath()||c(283)),t().createElement(l.IconButton,{iconStyle:{color:i.palette.primary1Color},disabled:!y,iconClassName:"mdi mdi-plus-circle-outline",onClick:this.onValidateNode.bind(this)})))))}}])&&ce(n.prototype,r),s}(t().Component);ye=(0,c.muiThemeable)()(ye);const he=require("pydio/model/cell");var me=n.n(he);const ge=require("pydio/util/xml");var be=n.n(ge);const ve=require("pydio/http/api");var we=n.n(ve);const Oe=require("cells-sdk");function Ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ke=s().requireLib("boot").moment,Pe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"mailerSupported",value:function(e){return e.Parameters.get("validMailer")}},{key:"getAuthorizations",value:function(){var e=s().getInstance(),t=e.getPluginConfigs("action.share"),n={folder_public_link:t.get("ENABLE_FOLDER_PUBLIC_LINK"),folder_workspaces:t.get("ENABLE_FOLDER_INTERNAL_SHARING"),file_public_link:t.get("ENABLE_FILE_PUBLIC_LINK"),file_workspaces:t.get("ENABLE_FILE_INTERNAL_SHARING"),editable_hash:t.get("HASH_USER_EDITABLE"),hash_min_length:t.get("HASH_MIN_LENGTH")||6,password_mandatory:!1,max_expiration:t.get("FILE_MAX_EXPIRATION"),max_downloads:t.get("FILE_MAX_DOWNLOAD"),cells_max_expiration:t.get("CELLS_MAX_EXPIRATION")},r=t.get("SHARE_FORCE_PASSWORD");return r&&(n.password_mandatory=!0),n.password_placeholder=r?e.MessageHash["share_center.176"]:e.MessageHash["share_center.148"],n}},{key:"buildPublicUrl",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.Parameters;if(n)return"..."+r.get("PUBLIC_BASEURI")+"/"+t.LinkHash;if(t.LinkUrl&&t.LinkUrl.match(new RegExp("^http://|^https://")))return t.LinkUrl;var o=e.getFrontendUrl();return"".concat(o.protocol,"//").concat(o.host)+r.get("PUBLIC_BASEURI")+"/"+t.LinkHash}},{key:"nodeHasEditor",value:function(e,t){if(!t.getMetadata().has("mime_has_preview_editor")){var n=e.Registry.findEditorsForMime(t.getAjxpMime()),r=(n=n.filter((function(e){return"editor.browser"!==e.id&&"editor.other"!==e.id}))).filter((function(e){return e.canWrite}));t.getMetadata().set("mime_has_preview_editor",n.length>0),t.getMetadata().set("mime_has_writeable_editor",r.length>0)}return{preview:t.getMetadata().get("mime_has_preview_editor"),writeable:t.getMetadata().get("mime_has_writeable_editor")}}},{key:"compileLayoutData",value:function(t,n){var r,o,i=n.getNode();if(i.isLeaf()?(o=i.getAjxpMime(),r=be().XPathSelectNodes(t.getXmlRegistry(),"//template[contains(@name, 'unique_preview_')]")):r=be().XPathSelectNodes(t.getXmlRegistry(),"//template[contains(@name, 'minisite_')]"),!r.length)return[];if(1===r.length)return[{LAYOUT_NAME:r[0].getAttribute("element"),LAYOUT_LABEL:""}];var a=t.Parameters.get("theme"),s=[];return r.map((function(n){var r=n.getAttribute("theme");if(!r||r===a){var l=n.getAttribute("element"),c=n.getAttribute("name"),u=n.getAttribute("label");o&&"unique_preview_file"===c&&!e.nodeHasEditor(t,i).preview||(u?MessageHash[u]&&(u=MessageHash[u]):u=n.getAttribute("name"),s[c]=l,s.push({LAYOUT_NAME:c,LAYOUT_ELEMENT:l,LAYOUT_LABEL:u}))}})),s}},{key:"forceMailerOldSchool",value:function(){return n.g.pydio.getPluginConfigs("action.share").get("EMAIL_INVITE_EXTERNAL")}},{key:"qrcodeEnabled",value:function(){return n.g.pydio.getPluginConfigs("action.share").get("CREATE_QRCODE")}},{key:"sendCellInvitation",value:function(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},i=e.prepareEmail(t,null,n),a=i.templateId,l=i.templateData,c=new Oe.MailerMail,u=new Oe.MailerServiceApi(we().getRestClient());c.To=[];var p=0;Object.keys(r).map((function(e){var t=r[e],n=new Oe.MailerUser;return t.IdmUser&&t.IdmUser.Login&&t.IdmUser.Attributes&&(t.IdmUser.Attributes.hasEmail||t.IdmUser.Attributes.email)?(n.Uuid=t.IdmUser.Login,c.To.push(n)):p++,n}));var f=s().getInstance().MessageHash;if(c.To.length){c.TemplateId=a,c.TemplateData=l,u.send(c).then((function(){o()}));var d=f["core.mailer.1"].replace("%s",c.To.length);p>0&&(d+=" "+f["core.mailer.entries.ignored"]),s().getInstance().UI.displayMessage("SUCCESS",d)}else s().getInstance().UI.displayMessage("ERROR",f["core.mailer.entries.ignored"])}},{key:"prepareEmail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r={},o="",i=pydio.user;if(i.getPreference("displayName")?r.Inviter=i.getPreference("displayName"):r.Inviter=i.id,t){var a=t.getLink();if(e.isLeaf()?(o="PublicFile",r.FileName=a.Label||e.getLabel()):(o="PublicFolder",r.FolderName=a.Label||e.getLabel()),r.LinkPath="/public/"+a.LinkHash,a.MaxDownloads&&(r.MaxDownloads=a.MaxDownloads+""),a.AccessEnd){var l=ke(new Date(1e3*a.AccessEnd));r.Expire=l.format("LL")}}else{o="Cell",r.Cell=n.getLabel();var c=s().getInstance().user.getRepositoriesList().get(n.cell.Uuid);c&&c.getSlug()&&(r.LinkPath="/ws-"+c.getSlug())}return{templateId:o,templateData:r,message:"",linkModel:t}}}],null&&Ee(t.prototype,null),r&&Ee(t,r),e}();function Se(e){return Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Se(e)}function je(){return je=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},je.apply(this,arguments)}function xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(n),!0).forEach((function(t){Te(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Le(e,t){return Le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Le(e,t)}function Me(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ce(e){return Ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ce(e)}function Te(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var De=s().requireLib("hoc"),Ae=De.ModernTextField,Ie=De.DatePicker,Ue=De.ThemedModernStyles,Ne=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Le(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=Ce(o);if(i){var a=Ce(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==Se(n)&&"function"!=typeof n?Me(t):n});function s(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Te(Me(e=a.call.apply(a,[this].concat(n))),"formatDate",(function(t){return e.props.pydio.MessageHash.date_format.split(" ").shift().replace("Y",t.getFullYear()).replace("m",t.getMonth()+1).replace("d",t.getDate())})),e}return n=s,(r=[{key:"render",value:function(){var e,n,r,o,i=this.props,a=i.pydio,s=i.model,c=i.muiTheme,u=i.labelFocus,p=i.labelEnter,f=i.createLabels,d=i.style,y=function(e){return a.MessageHash["share_center."+e]},h=Ue(c);if(s&&s.cell){var m=Pe.getAuthorizations();m.cells_max_expiration&&(n=new Date(1e3*(Math.round(new Date/1e3)+60*parseInt(m.cells_max_expiration)*60*24))),r=function(e,t){if(null===t)s.cell.AccessEnd="-1";else{var n=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());s.cell.AccessEnd=Math.floor(n/1e3)}s.notifyDirty()},s.cell.AccessEnd&&parseInt(s.cell.AccessEnd)>0&&(e=new Date(1e3*parseInt(s.cell.AccessEnd)),o=t().createElement(l.IconButton,{iconStyle:{color:"var(--md-sys-color-secondary)"},style:{position:"absolute",right:0,bottom:0,zIndex:1},iconClassName:"mdi mdi-close-circle",onClick:function(){r(null,null)}}))}return t().createElement("div",{style:Re({padding:"0 8px"},d)},t().createElement(Ae,{floatingLabelText:y(f?276:267),value:s.getLabel(),onChange:function(e,t){s.setLabel(t)},fullWidth:!0,variant:"v2",focusOnMount:u,onKeyPress:function(e){p&&"Enter"===e.key&&s.getLabel()&&p()}}),t().createElement(Ae,{floatingLabelText:y(f?277:268),value:s.getDescription(),onChange:function(e,t){s.setDescription(t)},fullWidth:!0,variant:"v2"}),t().createElement("div",{style:{position:"relative"}},t().createElement(Ie,je({ref:"expirationDate",key:"start",value:e,minDate:new Date,maxDate:n,autoOk:!0,onChange:r,showYearSelector:!0,floatingLabelText:y("21"),mode:"landscape",formatDate:this.formatDate,fullWidth:!0},h.textFieldV2,{style:{flex:1},textFieldStyle:Re(Re({},h.textFieldV2.style),{},{flex:1})})),o))}}])&&_e(n.prototype,r),s}(e.Component);function Be(e){return Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Be(e)}function qe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Fe(e,t){return Fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Fe(e,t)}function He(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ze(e){return ze=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ze(e)}function Ve(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Ne=g((0,c.muiThemeable)()(Ne));var We=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fe(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=ze(o);if(i){var a=ze(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==Be(n)&&"function"!=typeof n?He(t):n});function s(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ve(He(e=a.call.apply(a,[this].concat(n))),"state",{step:"users",model:new(me()),saving:!1}),Ve(He(e),"submit",(function(){var t=e.state.model;e.setState({saving:!0}),t.save().then((function(t){e.props.onDismiss(),e.setState({saving:!1})})).catch((function(t){pydio.UI.displayMessage("ERROR",t.message),e.setState({saving:!1})}))})),Ve(He(e),"m",(function(t){return e.props.pydio.MessageHash["share_center."+t]})),Ve(He(e),"computeSummaryString",(function(){var t,n=e.state.model,r=0,o=0,i=0,a=[],s=n.getAcls();return Object.keys(s).map((function(e){var t=s[e];t.Group?o++:t.Role?i++:r++})),r&&a.push(r+" "+e.m(270)),o&&a.push(o+" "+e.m(271)),i&&a.push(i+" "+e.m(272)),t=3===a.length?a[0]+", "+a[1]+e.m(274)+a[3]:0===a.length?e.m(273):a.join(e.m(274)),e.m(269).replace("%USERS",t)})),e}return n=s,r=[{key:"getChildContext",value:function(){var e=this.props.pydio.MessageHash;return{messages:e,getMessage:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"share_center";try{return e[n+(n?".":"")+t]||t}catch(e){return t}},isReadonly:function(){return!1}.bind(this)}}},{key:"componentDidMount",value:function(){var e=this;this.state.model.observe("update",(function(){e.forceUpdate()}))}},{key:"componentWillUnmount",value:function(){this.state.model.stopObserving("update")}},{key:"render",value:function(){var e,n=this,r=[],o="20px",i=this.props,a=i.pydio,s=i.muiTheme,c=this.state,u=c.step,p=c.model,f=c.saving,d=a.MessageHash[418];return"users"!==u&&(d=p.getLabel()),"users"===u?(e=t().createElement("div",null,t().createElement("div",null,this.m(275)),t().createElement(Ne,{pydio:a,model:p,style:{padding:0},muiTheme:s,labelFocus:!0,labelEnter:function(){return n.submit()},createLabels:!0})),p.getLabel()&&(r.push(t().createElement(l.FlatButton,{key:"quick",primary:!0,disabled:!p.getLabel()||f,label:this.m("cells.create.advanced"),onClick:function(){n.setState({step:"data"})}})),r.push(t().createElement("span",{style:{display:"inline-block",margin:"0  10px",fontSize:14,fontWeight:500,color:"#9E9E9E"}},this.m("cells.create.buttons.separator")))),r.push(t().createElement(l.RaisedButton,{key:"next1",disabled:!p.getLabel()||f,primary:!0,label:this.m(279),onClick:function(){n.submit()}}))):"data"===u?(e=t().createElement("div",null,t().createElement("h5",{style:{marginTop:-10,padding:"0 10px"}},this.m(278)),t().createElement(re,{pydio:a,cellAcls:p.getAcls(),excludes:[a.user.id],onUserObjectAdd:p.addUser.bind(p),onUserObjectRemove:p.removeUser.bind(p),onUserObjectUpdateRight:p.updateUserRight.bind(p)})),o="10px",r.push(t().createElement(l.FlatButton,{key:"prev1",primary:!1,label:a.MessageHash[304],onClick:function(){n.setState({step:"users"})}})),r.push(t().createElement(l.FlatButton,{key:"next2",primary:!0,label:a.MessageHash[179],onClick:function(){return n.setState({step:"label"})}}))):(e=t().createElement("div",null,t().createElement("h5",{style:{marginTop:-10}},this.m("cells.create.title.fill.folders")),t().createElement("div",{style:{color:"var(--md-sys-color-outline)",paddingTop:10}},this.computeSummaryString()),t().createElement("div",{style:{paddingTop:16}},t().createElement(ye,{pydio:a,model:p}))),r.push(t().createElement(l.FlatButton,{key:"prev2",primary:!1,label:a.MessageHash[304],onClick:function(){n.setState({step:"data"})}})),r.push(t().createElement(l.RaisedButton,{key:"submit",disabled:f,primary:!0,label:this.m(279),onClick:this.submit.bind(this)}))),t().createElement("div",{style:{width:380,fontSize:13,display:"flex",flexDirection:"column",minHeight:300}},t().createElement("div",{style:{display:"flex",alignItems:"center",paddingLeft:20}},t().createElement(l.FontIcon,{className:"icomoon-cells-full-plus"}),t().createElement("div",{style:{padding:20,fontSize:22}},d)),t().createElement("div",{style:{padding:"20px "+o+" 10px",flex:1}},e),t().createElement("div",{style:{padding:"12px 16px",display:"flex",alignItems:"center",justifyContent:"flex-end"}},r))}}],r&&qe(n.prototype,r),s}(t().Component);function Ye(e){return Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ye(e)}function Ge(e){return function(e){if(Array.isArray(e))return Xe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Xe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xe(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Qe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ke(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qe(Object(n),!0).forEach((function(t){Ze(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ze(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Je(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function et(e,t,n){return t&&$e(e.prototype,t),n&&$e(e,n),e}function tt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nt(e,t)}function nt(e,t){return nt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},nt(e,t)}function rt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r,o,i=ot(e);if(t){var a=ot(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return r=this,!(o=n)||"object"!==Ye(o)&&"function"!=typeof o?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r):o}}function ot(e){return ot=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ot(e)}Ve(We,"childContextTypes",{messages:i().object,getMessage:i().func,isReadonly:i().func}),We=(0,c.muiThemeable)()(We);var it=function(e){tt(r,e);var n=rt(r);function r(){return Je(this,r),n.apply(this,arguments)}return et(r,[{key:"render",value:function(){var e=this.props,n=e.tabs,r=e.active,o=e.onChange,i=e.style,a=e.muiTheme,s=a.palette.mui3["on-surface-variant"],c=a.palette.mui3.primary;return t().createElement("div",{style:Ke({display:"flex"},i)},n.map((function(e){var n=e.Value===r,i=e.Label;return e.Icon&&(i=t().createElement("span",null,t().createElement("span",{className:e.Icon,style:{marginLeft:-5}})," ",e.Label)),t().createElement(l.FlatButton,{label:i,onClick:function(){o(e.Value)},primary:n,style:{flex:1,height:46,lineHeight:"46px",borderRadius:0,borderBottom:"3px solid "+(n?c:"transparent")},labelStyle:{textTransform:"none",fontSize:13,paddingLeft:8,paddingRight:8,color:n?c:s}})})))}}]),r}(t().Component);it=(0,c.muiThemeable)()(it);var at=function(e){tt(n,e);var t=rt(n);function n(){return Je(this,n),t.apply(this,arguments)}return et(n,[{key:"render",value:function(){var e=this.props,t=e.tabs,n=e.active,r=null;return t.map((function(e){e.Value===n&&(r=e.Component)})),r}}]),n}(t().Component),st=function(e){tt(r,e);var n=rt(r);function r(e){var t;return Je(this,r),(t=n.call(this,e)).state={left:e.tabs.left.length?e.tabs.left[0].Value:"",right:e.tabs.right.length?e.tabs.right[0].Value:""},e.defaultLeft&&(t.state.left=e.defaultLeft),e.defaultRight&&(t.state.right=e.defaultRight),t}return et(r,[{key:"componentWillReceiveProps",value:function(e){!this.props.defaultLeft&&e.defaultLeft?this.setState({left:e.defaultLeft}):!this.state.left&&e.tabs.left.length&&this.setState({left:e.tabs.left[0].Value}),!this.props.defaultRight&&e.defaultRight?this.setState({right:e.defaultRight}):!this.state.right&&e.tabs.right.length&&this.setState({right:e.tabs.right[0].Value})}},{key:"render",value:function(){var e=this,n=this.props,r=n.tabs,o=n.header,i=n.onSaveAction,a=n.onCloseAction,s=n.onRevertAction,c=n.saveEnabled,u=n.style,p=n.pydio,f=n.editorOneColumn,d=this.state,y=d.left,h=d.right;if(f){var m=[].concat(Ge(r.left),Ge(r.right)),g=m.filter((function(e){return e.AlwaysLast}));return g.length&&(m=[].concat(Ge(m.filter((function(e){return!e.AlwaysLast}))),Ge(g))),m.length&&0===m.filter((function(e){return e.Value===y})).length&&(y=m[0].Value),t().createElement("div",{style:Ke({display:"flex",flexDirection:"column",height:"100%"},u)},t().createElement("div",{style:{display:"flex",alignItems:"flex-start"}},t().createElement("div",{style:{flex:1,padding:10}},o),t().createElement("div",{style:{paddingTop:8,paddingRight:10}},t().createElement(l.IconButton,{iconClassName:"mdi mdi-close",primary:!0,tooltip:p.MessageHash[86],onClick:a}))),t().createElement("div",{style:{display:"flex"}},t().createElement(it,{tabs:m,active:y,style:{flex:1,padding:"0 16px"},onChange:function(t){e.setState({left:t})}})),t().createElement(l.Divider,{style:{flexShrink:0,marginRight:16,marginLeft:16}}),t().createElement("div",{style:{display:"flex",flex:1,overflow:"hidden"}},t().createElement("div",{style:Ke({overflowY:"auto",width:"100%",height:"100%"},r.leftStyle)},t().createElement(at,{tabs:m,active:y}))),t().createElement(l.Divider,{style:{flexShrink:0,marginRight:16,marginLeft:16}}),t().createElement("div",{style:{padding:10,display:"flex",alignItems:"center",justifyContent:"flex-end"}},t().createElement(l.FlatButton,{disabled:!c,label:p.MessageHash[628],onClick:s,style:{marginLeft:10}}),t().createElement(l.RaisedButton,{disabled:!c,label:p.MessageHash[53],onClick:i})))}return r.left&&r.left.length&&0===r.left.filter((function(e){return e.Value===y})).length&&(y=r.left[0].Value),r.right&&r.right.length&&0===r.right.filter((function(e){return e.Value===y})).length&&(h=r.right[0].Value),t().createElement("div",{style:Ke({display:"flex",flexDirection:"column",height:"100%"},u)},t().createElement("div",{style:{display:"flex",alignItems:"center",padding:10,paddingBottom:0}},t().createElement("div",{style:{flex:1,alignItems:"center",paddingRight:20}},o),t().createElement(l.RaisedButton,{disabled:!c,primary:!0,label:p.MessageHash[53],onClick:i}),t().createElement(l.FlatButton,{disabled:!c,label:p.MessageHash[628],onClick:s,style:{marginLeft:10}}),t().createElement(l.IconButton,{iconClassName:"mdi mdi-close",tooltip:p.MessageHash[86],onClick:a,style:{marginLeft:10}})),t().createElement("div",{style:{display:"flex"}},t().createElement(it,{tabs:r.left,active:y,style:{flex:1,margin:"0 16px"},onChange:function(t){e.setState({left:t})}}),t().createElement(it,{tabs:r.right,active:h,style:{flex:1,margin:"0 16px"},onChange:function(t){e.setState({right:t})}})),t().createElement(l.Divider,{style:{flexShrink:0,display:"none"}}),t().createElement("div",{style:{display:"flex",flex:1,overflow:"hidden",padding:"0 5px 5px"}},t().createElement(l.Paper,{zDepth:1,style:Ke({overflowY:"auto",width:"50%",margin:"0 5px 5px",border:"1px solid #e0e0e0",borderRadius:5},r.leftStyle)},t().createElement(at,{tabs:r.left,active:y})),t().createElement(l.Paper,{zDepth:1,style:Ke({overflowY:"auto",width:"50%",margin:"0 5px 5px",border:"1px solid #e0e0e0",borderRadius:5},r.rightStyle)},t().createElement(at,{tabs:r.right,active:h}))))}}]),r}(t().Component);function lt(e){return lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lt(e)}function ct(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ut(e,t){return ut=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ut(e,t)}function pt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ft(e){return ft=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ft(e)}function dt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var yt=n(689),ht=s().requireLib("components").ResourcePoliciesPanel,mt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ut(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,i=ft(r);if(o){var a=ft(this).constructor;e=Reflect.construct(i,arguments,a)}else e=i.apply(this,arguments);return t=this,!(n=e)||"object"!==lt(n)&&"function"!=typeof n?pt(t):n});function a(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return dt(pt(e=i.call.apply(i,[this].concat(n))),"submit",(function(){var t=e.props,n=t.model,r=t.pydio,o=n.hasDirtyRootNodes();n.save().then((function(t){e.forceUpdate(),o&&n.getUuid()===r.user.getActiveRepository()&&(r.goTo("/"),r.fireContextRefresh())})).catch((function(e){r.UI.displayMessage("ERROR",e.message)}))})),e}return t=a,n=[{key:"getChildContext",value:function(){var e=this.props.pydio.MessageHash;return{messages:e,getMessage:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"share_center";try{return e[n+(n?".":"")+t]||t}catch(e){return t}},isReadonly:function(){return!1}}}},{key:"render",value:function(){var e=this.props,t=e.pydio,n=e.model,r=e.sendInvitations,o=function(e){return t.MessageHash["share_center."+e]},i={leftStyle:{padding:10},rightStyle:{padding:10},left:[{Label:o(54),Value:"users",Component:yt.createElement(re,{pydio:t,cellAcls:n.getAcls(),excludes:[t.user.id],sendInvitations:r,onUserObjectAdd:n.addUser.bind(n),onUserObjectRemove:n.removeUser.bind(n),onUserObjectUpdateRight:n.updateUserRight.bind(n)})},{Label:o("35"),Value:"base",Component:yt.createElement(Ne,{pydio:t,model:n})},{Label:o(253),Value:"permissions",AlwaysLast:!0,Component:yt.createElement(ht,{pydio:t,resourceType:"cell",description:o("cell.visibility.advanced"),resourceId:n.getUuid(),style:{margin:-10},skipTitle:!0,onSavePolicies:function(){},readonly:!1,cellAcls:n.getAcls()})}],right:[{Label:o(249),Value:"content",Component:yt.createElement(ye,{pydio:t,model:n,mode:"edit"})}]};return yt.createElement(st,{pydio:t,tabs:i,header:yt.createElement("div",{style:{fontSize:22,lineHeight:"26px",padding:6}},n.getLabel()),editorOneColumn:this.props.editorOneColumn,saveEnabled:n.isDirty(),onSaveAction:this.submit.bind(this),onCloseAction:this.props.onDismiss,onRevertAction:function(){n.revertChanges()}})}}],n&&ct(t.prototype,n),a}(yt.Component);dt(mt,"childContextTypes",{messages:i().object,getMessage:i().func,isReadonly:i().func});const gt=require("pydio/http/resources-manager");var bt=n.n(gt);function vt(e){return vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vt(e)}function wt(){return wt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},wt.apply(this,arguments)}function Ot(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Et(e,t){return Et=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Et(e,t)}function kt(e){return kt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},kt(e)}var Pt=s().requireLib("boot").moment,St=s().requireLib("components"),jt=St.GenericCard,xt=St.GenericLine,Rt=St.Mui3CardLine,_t=St.QuotaUsageLine,Lt=St.SharedUsersStack,Mt=function(n){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Et(e,t)}(c,n);var r,o,i,a,s=(i=c,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=kt(i);if(a){var o=kt(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==vt(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function c(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=s.call(this,e)).state={edit:!1,model:new(me()),loading:!0},t._observer=function(){t.forceUpdate()},bt().loadClass("PydioActivityStreams").then((function(e){t.setState({asLib:e})})),bt().loadClass("PydioCoreActions").then((function(e){t.setState({coreActionsLib:e})}));var n=t.props.rootNode;return n&&(n.getMetadata().has("virtual_root")?n.isLoaded()?(t.state.rootNodes=[],n.getChildren().forEach((function(e){return t.state.rootNodes.push(e)}))):(n.observe("loaded",(function(){var e=[];n.getChildren().forEach((function(t){return e.push(t)})),t.setState({rootNodes:e})})),n.load()):t.state.rootNodes=[n]),t}return r=c,(o=[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.pydio,r=t.cellId;n.user.activeRepository===r?n.user.getActiveRepositoryAsCell().then((function(t){t?(e.setState({model:t,loading:!1}),t.observe("update",e._observer)):e.setState({loading:!1})})):(this.state.model.observe("update",(function(){e.setState({loading:!1}),e.forceUpdate()})),this.state.model.load(this.props.cellId))}},{key:"componentWillUnmount",value:function(){this.state.model.stopObserving("update",this._observer)}},{key:"usersInvitations",value:function(e){Pe.sendCellInvitation(this.props.node,this.state.model,e)}},{key:"render",value:function(){var n,r=this,o=this.props,i=o.mode,a=o.pydio,s=o.editorOneColumn,c=o.genericFlex,u=o.muiTheme,p=this.state,f=p.edit,d=p.model,y=p.asLib,h=p.coreActionsLib,m=p.rootNodes,g=p.loading,b=function(e){return a.MessageHash["share_center."+e]},v={width:400,minHeight:270};if(f)v=s?{width:400,height:500}:{width:700,height:500},n=t().createElement(mt,wt({},this.props,{model:d,sendInvitations:this.usersInvitations.bind(this),editorOneColumn:s}));else if(d){var w,O,E,k=d.getRootNodes().map((function(e){return d.getNodeLabelInContext(e)})).join(", ");k||(k=d.getRootNodes().length+" item(s)"),"infoPanel"!==i&&(E=[],d.getUuid()!==a.user.activeRepository&&E.push(t().createElement(l.MenuItem,{primaryText:b(246),onClick:function(){a.triggerRepositoryChange(d.getUuid()),r.props.onDismiss()}})),d.isEditable()&&(w=function(){d.deleteCell().then((function(e){r.props.onDismiss()}))},O=function(){r.setState({edit:!0}),r.props.onHeightChange&&r.props.onHeightChange(500)},E.push(t().createElement(l.MenuItem,{primaryText:b(247),onClick:function(){return r.setState({edit:!0})}})),E.push(t().createElement(l.MenuItem,{primaryText:b(248),onClick:w}))));var P,S,j,x=[],R=[],_=[];if(m&&!g){m.forEach((function(e){e.getMetadata().get("ws_quota")&&_.push(t().createElement(_t,{mui3:"infoPanel"!==i,node:e}))})),m.length>1?R.push(a.MessageHash["share_center.cell.folder-root.multiple"].replace("%d",m.length)):R.push(a.MessageHash["share_center.cell.folder-root.single"]);var L=Object.keys(d.getAcls()).length;L>1?R.push(a.MessageHash["share_center.cell.participant.multiple"].replace("%d",L)):R.push(a.MessageHash["share_center.cell.participant.single"]),x.push(R.join(", "))}if(!g&&d.cell&&d.cell.AccessEnd){var M=new Date(1e3*parseInt(d.cell.AccessEnd)),C=M<new Date;j=t().createElement(xt,{iconClassName:C?"mdi mdi-alert-outline":"mdi mdi-calendar",iconStyle:C?{color:"var(--md-sys-color-error)"}:{},legend:b(C?"21b":"21"),data:Pt(M).calendar()}),x.push(b(C?"21b":"21")+" "+Pt(M).calendar())}if(y&&h&&m&&!g){var T,D=y.WatchSelector,A=y.WatchSelectorMui3,I=h.BookmarkButton,U=h.MaskWsButton;T="mui3"===u.userTheme?t().createElement(A,{pydio:a,nodes:m,fullWidth:!1}):t().createElement(D,{pydio:a,nodes:m,fullWidth:!0}),P=t().createElement(Rt,{legend:a.MessageHash["meta.watch.selector.legend"+("mui3"===u.userTheme?".mui":"")],data:T,dataStyle:{marginTop:6}}),S=[t().createElement(U,{pydio:a,workspaceId:d.getUuid(),style:{width:40,height:40,padding:8},iconStyle:{color:"var(--md-sys-color-primary)"}}),t().createElement(I,{pydio:a,nodes:m,styles:{style:{width:40,height:40,padding:8},iconStyle:{color:"var(--md-sys-color-primary)"}}})]}if(n=t().createElement(jt,{pydio:a,title:d.getLabel(),onDismissAction:this.props.onDismiss,otherActions:S,onDeleteAction:w,deleteTooltip:a.MessageHash["share_center.248"],onEditAction:O,editTooltip:a.MessageHash["share_center.247"],headerSmall:"infoPanel"===i,genericFlex:c,mui3:!0,topLeftAvatar:"infoPanel"!==i&&t().createElement(Lt,{size:40,acls:d.getAcls()})},"infoPanel"!==i&&t().createElement(e.Fragment,null,t().createElement(Rt,{legend:d.getDescription(),data:t().createElement("div",null,x.map((function(e){return t().createElement("div",null,e)})))}),P||t().createElement(xt,{placeHolder:!0,placeHolderReady:!g})),"infoPanel"===i&&t().createElement(e.Fragment,null,!g&&t().createElement(xt,{iconClassName:"mdi mdi-account-multiple",legend:"Participants",data:t().createElement(Lt,{size:30,acls:d.getAcls()})}),!g&&d.getDescription()&&t().createElement(xt,{iconClassName:"mdi mdi-information",legend:b(145),data:d.getDescription()}),t().createElement(xt,{iconClassName:"mdi mdi-folder-multiple-outline",legend:b(249),data:k,placeHolder:!0,placeHolderReady:!g}),j,_)),"infoPanel"===i)return n}return t().createElement("div",{style:v},n)}}])&&Ot(r.prototype,o),c}(t().Component);Mt=(0,c.muiThemeable)()(Mt);const Ct=require("pydio/lang/observable");var Tt=n.n(Ct);const Dt=require("pydio/util/pass");var At=n.n(Dt);function It(e){return It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},It(e)}function Ut(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Nt(e,t){return Nt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Nt(e,t)}function Bt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qt(e){return qt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},qt(e)}var Ft=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Nt(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,i=qt(r);if(o){var a=qt(this).constructor;e=Reflect.construct(i,arguments,a)}else e=i.apply(this,arguments);return t=this,!(n=e)||"object"!==It(n)&&"function"!=typeof n?Bt(t):n});function a(){var e,t,n,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),r=void 0,(n="dirty")in(t=Bt(e=i.call(this)))?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,e.link=new Oe.RestShareLink,e.link.Permissions=[Oe.RestShareLinkAccessType.constructFromObject("Preview"),Oe.RestShareLinkAccessType.constructFromObject("Download")],e.link.Policies=[],e.link.PoliciesContextEditable=!0,e.link.RootNodes=[],e.ValidPassword=!0,e.loadError=null,e}return t=a,(n=[{key:"hasError",value:function(){return this.loadError}},{key:"isEditable",value:function(){return this.link.PoliciesContextEditable}},{key:"isDirty",value:function(){return this.dirty}},{key:"getLinkUuid",value:function(){return this.link.Uuid}},{key:"getLink",value:function(){return this.link}},{key:"getPublicUrl",value:function(){return Pe.buildPublicUrl(s().getInstance(),this.link)}},{key:"updateLink",value:function(e){this.link=e,this.notifyDirty()}},{key:"notifyDirty",value:function(){this.dirty=!0,this.notify("update")}},{key:"revertChanges",value:function(){this.originalLink&&(this.link=this.clone(this.originalLink),this.dirty=!1,this.updatePassword=this.createPassword=null,this.ValidPassword=!0,this.notify("update"))}},{key:"hasPermission",value:function(e){return this.link.Permissions.filter((function(t){return t===e})).length>0}},{key:"isExpired",value:function(){return!!(this.link.MaxDownloads&&parseInt(this.link.CurrentDownloads)>=parseInt(this.link.MaxDownloads))||(this.link.AccessEnd,!1)}},{key:"load",value:function(e){var t=this;return new Oe.ShareServiceApi(we().getRestClient()).getShareLink(e).then((function(e){t.link=e,t.link.Permissions||(t.link.Permissions=[]),t.link.Policies||(t.link.Policies=[]),t.link.RootNodes||(t.link.RootNodes=[]),t.originalLink=t.clone(t.link),t.notify("update")})).catch((function(e){t.loadError=e,t.notify("update")}))}},{key:"setCreatePassword",value:function(e){var t=this;e?At().checkPasswordStrength(e,(function(e,n){t.ValidPassword=e,t.ValidPasswordMessage=n})):this.ValidPassword=!0,this.createPassword=e,this.link.PasswordRequired=!0,this.notifyDirty()}},{key:"setUpdatePassword",value:function(e){var t=this;e?At().checkPasswordStrength(e,(function(e,n){t.ValidPassword=e,t.ValidPasswordMessage=n})):this.ValidPassword=!0,this.updatePassword=e,this.notifyDirty()}},{key:"setCustomLink",value:function(e){this.customLink=e}},{key:"save",value:function(){var e=this;if(!this.ValidPassword)throw new Error(this.ValidPasswordMessage);var t=new Oe.ShareServiceApi(we().getRestClient()),n=new Oe.RestPutShareLinkRequest;this.createPassword?(n.PasswordEnabled=!0,n.CreatePassword=this.createPassword):this.updatePassword?(n.PasswordEnabled=!0,this.link.PasswordRequired?n.UpdatePassword=this.updatePassword:n.CreatePassword=this.updatePassword):n.PasswordEnabled=this.link.PasswordRequired;var r=Pe.getAuthorizations();if(r.password_mandatory&&!n.PasswordEnabled)throw new Error(s().getMessages()["share_center.175"]);return parseInt(r.max_downloads)>0&&!parseInt(this.link.MaxDownloads)&&(this.link.MaxDownloads=""+parseInt(r.max_downloads),this.notify("update")),parseInt(r.max_expiration)>0&&!parseInt(this.link.AccessEnd)&&(this.link.AccessEnd=""+(Math.round(new Date/1e3)+60*parseInt(r.max_expiration)*60*24),this.notify("update")),this.customLink&&this.customLink!==this.link.LinkHash&&(n.UpdateCustomHash=this.customLink),n.ShareLink=this.link,t.putShareLink(n).then((function(t){e.link=t,e.dirty=!1,e.originalLink=e.clone(e.link),e.updatePassword=e.createPassword=e.customLink=null,e.ValidPassword=!0,e.notify("update"),e.notify("save")})).catch((function(e){var t=e.Detail||e.message||e;s().getInstance().UI.displayMessage("ERROR",t)}))}},{key:"deleteLink",value:function(e){var t=this;return new Oe.ShareServiceApi(we().getRestClient()).deleteShareLink(this.link.Uuid).then((function(n){t.link=e,t.dirty=!1,t.updatePassword=t.createPassword=t.customLink=null,t.notify("update"),t.notify("delete")})).catch((function(e){var t=e.Detail||e.message||e;pydio.UI.displayMessage("ERROR",t)}))}},{key:"clone",value:function(e){return Oe.RestShareLink.constructFromObject(JSON.parse(JSON.stringify(e)))}}])&&Ut(t.prototype,n),a}(Tt());function Ht(e){return Ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ht(e)}function zt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Vt(e,t,n){return Vt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Gt(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},Vt(e,t,n||e)}function Wt(e,t){return Wt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Wt(e,t)}function Yt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Gt(e){return Gt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Gt(e)}function Xt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Qt=s().requireLib("boot").moment,Kt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Wt(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,i=Gt(r);if(o){var a=Gt(this).constructor;e=Reflect.construct(i,arguments,a)}else e=i.apply(this,arguments);return t=this,!(n=e)||"object"!==Ht(n)&&"function"!=typeof n?Yt(t):n});function a(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),Xt(Yt(e=i.call(this)),"cells",void 0),Xt(Yt(e),"links",void 0),Xt(Yt(e),"edit",void 0),Xt(Yt(e),"node",void 0),Xt(Yt(e),"saving",void 0),e.cells=[],e.links=[],e.edit=t,e}return t=a,n=[{key:"emptyLink",value:function(e){var t,n=this,r=new Ft,o=new Oe.TreeNode,i=Pe.getAuthorizations();o.Uuid=e.getMetadata().get("uuid"),r.getLink().Label=e.getLabel(),r.getLink().Description=pydio.MessageHash["share_center.257"].replace("%s",Qt(new Date).format("YYYY/MM/DD")),r.getLink().RootNodes.push(o);var a=[Oe.RestShareLinkAccessType.constructFromObject("Download")];return e.isLeaf()?(t="pydio_unique_dl",Pe.nodeHasEditor(pydio,e).preview&&!i.max_downloads?(t="pydio_unique_strip",a.push(Oe.RestShareLinkAccessType.constructFromObject("Preview"))):i.max_downloads>0&&(r.getLink().MaxDownloads=i.max_downloads)):(t="pydio_shared_folder",a.push(Oe.RestShareLinkAccessType.constructFromObject("Preview"))),r.getLink().ViewTemplateName=t,r.getLink().Permissions=a,i.max_expiration&&(r.getLink().AccessEnd=""+(Math.round(new Date/1e3)+60*parseInt(i.max_expiration)*60*24)),r.observe("update",(function(){n.notify("update")})),r.observe("save",(function(){n.updateUnderlyingNode()})),r}},{key:"createEmptyCell",value:function(){var e=this,t=new(me())(!0);t.setLabel(this.node.getLabel()),t.addRootNode(this.node),t.observe("update",(function(){e.notify("update")})),t.dirty=!1,this.cells.push(t),this.notify("update")}},{key:"addToExistingCell",value:function(e){var t=this,n=new(me())(!0);n.observe("update",(function(){t.notify("update")})),n.load(e).then((function(){n.addRootNode(t.node)}));var r=this.cells.filter((function(e){return!e.getUuid()}));r.length&&this.removeNewCell(r[0]),this.cells.push(n)}},{key:"updateUnderlyingNode",value:function(){this.skipUpdateUnderlyingNode||s().getInstance().getContextHolder().requireNodeReload(this.node)}},{key:"deleteLink",value:function(e){var t=this;return e.deleteLink(this.emptyLink(this.node).getLink()).then((function(e){t.updateUnderlyingNode()}))}},{key:"getNode",value:function(){return this.node}},{key:"load",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.node=e,this.cells=[],this.links=[],e.getMetadata().get("pydio_shares")&&JSON.parse(e.getMetadata().get("pydio_shares")).map((function(e){if(3===e.Scope){var n=new Ft;n.observe("update",(function(){t.notify("update")})),n.observe("save",(function(){t.updateUnderlyingNode()})),n.load(e.UUID),t.links.push(n)}else if(2===e.Scope){var r=new(me());r.observe("update",(function(){t.notify("update")})),r.load(e.UUID),t.cells.push(r)}})),this.edit&&!this.links.length&&this.links.push(this.emptyLink(e)),this.edit&&this.canCreateCells()&&!this.cells.length&&this.createEmptyCell(),n&&this.node.observe("node_replaced",(function(){t.load(t.node,!1)}))}},{key:"loadUniqueLink",value:function(e,t){var n=this;this.node=t;var r=new Ft;return r.observe("update",(function(){n.notify("update")})),r.load(e),this.links.push(r),r}},{key:"canCreateCells",value:function(){if(!this.node)return!1;var e=Pe.getAuthorizations(),t=this.node.isLeaf();return t&&e.file_workspaces||!t&&e.folder_workspaces}},{key:"save",value:function(){var e=this;this.saving=!0,this.notify("update");var t=[];this.cells.map((function(e){e.isDirty()&&t.push(e.save())})),this.links.map((function(e){e.isDirty()&&t.push(e.save())})),Promise.all(t).then((function(){var t=e.node.getMetadata().get("uuid");e.cells=e.cells.filter((function(e){return e.hasRootNode(t)})),e.updateUnderlyingNode(),e.saving=!1})).catch((function(t){e.updateUnderlyingNode(),e.saving=!1}))}},{key:"deleteAll",value:function(){var e=this.node.getMetadata().get("uuid"),t=[];return this.cells.map((function(n){n.removeRootNode(e),t.push(n.save())})),this.links.map((function(e){t.push(e.deleteLink())})),Promise.all(t)}},{key:"removeNewCell",value:function(e){this.cells=this.cells.filter((function(t){return t!==e})),this.notify("update")}},{key:"revertChanges",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.cells=this.cells.filter((function(e){return e.getUuid()})),this.cells.map((function(e){e.isDirty()&&e.revertChanges()})),this.links.map((function(e){e.isDirty()&&e.revertChanges()})),!this.cells.length&&e&&this.canCreateCells()&&this.createEmptyCell(),this.notify("update")}},{key:"isDirty",value:function(){return!this.saving&&this.cells.filter((function(e){return e.isDirty()})).length||this.links.filter((function(e){return e.isDirty()})).length}},{key:"stopObserving",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.cells.map((function(e){e.stopObserving("update")})),this.links.map((function(e){e.stopObserving("update")})),Vt(Gt(a.prototype),"stopObserving",this).call(this,e,t)}},{key:"getCells",value:function(){if(this.node){var e=this.node.getMetadata().get("uuid");return this.cells.filter((function(t){return t.hasRootNode(e)}))}return this.cells}},{key:"getLinks",value:function(){return this.links}}],n&&zt(t.prototype,n),a}(Tt());const Zt=require("qrcode.react");var Jt=n.n(Zt);const $t=require("clipboard");var en=n.n($t);const tn=require("pydio/util/path");var nn=n.n(tn);const rn=require("pydio/util/lang");var on=n.n(rn);function an(e){return an="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},an(e)}function sn(){return sn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},sn.apply(this,arguments)}function ln(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function cn(e,t){return cn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},cn(e,t)}function un(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pn(e){return pn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},pn(e)}function fn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var dn=s().requireLib("hoc").ThemedModernStyles,yn=s().requireLib("boot").Tooltip,hn=function(r){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&cn(e,t)}(u,r);var o,i,a,s,c=(a=u,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=pn(a);if(s){var o=pn(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==an(n)&&"function"!=typeof n?un(t):n});function u(t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),fn(un(r=c.call(this,t)),"state",{editLink:!1,copyMessage:"",showQRCode:!1}),fn(un(r),"toggleEditMode",(function(){var e=r.props,t=e.linkModel,n=e.pydio,o=e.getMessage,i=r.state,a=i.editLink,s=i.customLink;if(a&&s){var l=Pe.getAuthorizations();if(l.hash_min_length&&s.length<l.hash_min_length)return void n.UI.displayMessage("ERROR",o("223").replace("%s",l.hash_min_length));t.setCustomLink(s),t.save()}r.setState({editLink:!a,customLink:void 0})})),fn(un(r),"changeLink",(function(e){var t=e.target.value;t=on().computeStringSlug(t),r.setState({customLink:t})})),fn(un(r),"clearCopyMessage",(function(){setTimeout(function(){this.setState({copyMessage:""})}.bind(un(r)),5e3)})),fn(un(r),"attachClipboard",(function(){var e=r.props,t=e.linkModel,o=e.pydio,i=e.getMessage;r.detachClipboard(),r.copyButton.current&&(r._clip=new(en())(r.copyButton.current,{text:function(e){return Pe.buildPublicUrl(o,t.getLink())}.bind(un(r))}),r._clip.on("success",function(){var e=this;this.setState({copyMessage:i("192")},(function(){return e.clearCopyMessage()}))}.bind(un(r))),r._clip.on("error",function(){var e,t=this;e=0===n.g.navigator.platform.indexOf("Mac")?i("144"):i("143"),this.publicLinkField.current.focus(),this.setState({copyMessage:e},(function(){return t.clearCopyMessage()}))}.bind(un(r))))})),fn(un(r),"detachClipboard",(function(){r._clip&&r._clip.destroy()})),fn(un(r),"openMailer",(function(){r.props.showMailer(r.props.linkModel)})),fn(un(r),"toggleQRCode",(function(){r.setState({showQRCode:!r.state.showQRCode})})),r.copyButton=(0,e.createRef)(),r.publicLinkField=(0,e.createRef)(),bt().loadClass("PydioActivityStreams").then((function(e){r.setState({asLib:e})})),r}return o=u,(i=[{key:"componentDidUpdate",value:function(e,t){this.attachClipboard()}},{key:"componentDidMount",value:function(){this.attachClipboard()}},{key:"componentWillUnmount",value:function(){this.detachClipboard()}},{key:"confirmDisable",value:function(){var e=this.props,t=e.onDisableLink,n=e.getMessage;confirm(n("dialog.link.confirm.remove"))&&t()}},{key:"render",value:function(){var e=this,n=this.props,r=n.linkModel,o=n.compositeModel,i=n.pydio,a=n.getMessage,s=n.muiTheme,c=Pe.buildPublicUrl(i,r.getLink()),u=Pe.getAuthorizations(),p=this.props.editAllowed&&u.editable_hash&&!this.props.isReadonly()&&r.isEditable(),f=this.state,d=f.editLink,y=f.customLink;if(d&&p){var h=void 0===y?r.getLink().LinkHash:y,m=void 0!==y&&y.length<u.hash_min_length,g=m&&s.palette.mui3&&s.palette.mui3.error;return t().createElement("div",null,t().createElement("div",{style:{display:"flex",alignItems:"center",padding:6,borderRadius:2}},t().createElement("span",{style:{fontSize:16,display:"inline-block",maxWidth:160,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},nn().getDirname(c)+"/ "),t().createElement(l.TextField,{style:{flex:1,marginRight:10,marginLeft:10},autoFocus:!0,onChange:this.changeLink,value:h,errorText:m?" ":null}),t().createElement(Q,{mdiIcon:"check",callback:function(){return e.toggleEditMode()},disabled:m})),t().createElement("div",{style:{textAlign:"center",fontSize:13,paddingTop:10,color:g}},m?a("223").replace("%s",u.hash_min_length):a("194")))}var b,v=this.state,w=v.copyMessage,O=v.linkTooltip,E=v.asLib,k=[],P=this.props.muiTheme,S=t().createElement("div",{key:"copy",ref:this.copyButton,style:{position:"absolute",right:0,bottom:7,width:30,height:30,padding:4,backgroundColor:"transparent",fontSize:16,cursor:"pointer"},onMouseOver:function(){e.setState({linkTooltip:!0})},onMouseOut:function(){e.setState({linkTooltip:!1})}},t().createElement(yn,{label:w||a("191"),horizontalPosition:"left",verticalPosition:"bottom",show:O}),t().createElement("span",{className:"copy-link-button mdi mdi-content-copy",style:{color:P.palette.mui3.primary}}));if(this.props.showMailer&&k.push(t().createElement(Q,{key:"outline",callback:this.openMailer,mdiIcon:"email-outline",messageId:"45"})),p&&k.push(t().createElement(Q,{key:"pencil",callback:this.toggleEditMode,mdiIcon:"pencil",messageId:"193"})),Pe.qrcodeEnabled()&&k.push(t().createElement(Q,{key:"qrcode",callback:this.toggleQRCode,mdiIcon:"qrcode",messageId:"94"})),E){var j=E.WatchSelectorMui3;k.push(t().createElement(j,{animatedButton:!0,pydio:i,nodes:[o.getNode()],fullWidth:!1,readPermissionOnly:!r.hasPermission("Upload")}))}return this.props.onDisableLink&&k.push(t().createElement(Q,{key:"delete",destructive:!0,callback:function(){return e.confirmDisable()},mdiIcon:"link-off",messageId:"link.disable"})),k=k.length?t().createElement("div",{style:{display:"flex",marginTop:10}},t().createElement("span",{style:{flex:1}}),k,t().createElement("span",{style:{flex:1}})):null,b=this.state.showQRCode?t().createElement(l.Paper,{zDepth:1,style:{width:120,paddingTop:10,overflow:"hidden",margin:"0 auto",height:120,textAlign:"center"}},t().createElement(Jt(),{size:100,value:c,level:"Q"})):t().createElement(l.Paper,{zDepth:0,style:{width:120,overflow:"hidden",margin:"0 auto",height:0,textAlign:"center"}}),t().createElement("div",{className:"public-link-container"},t().createElement("div",{style:{marginTop:-8,position:"relative"}},t().createElement(l.TextField,sn({floatingLabelText:a("link.floatingLabel"),floatingLabelFixed:!0,type:"text",name:"Link",ref:this.publicLinkField,value:c,onFocus:function(e){e.target.select()},fullWidth:!0},dn(P).textFieldV2)),S),k,b)}}])&&ln(o.prototype,i),u}(t().Component);function mn(e){return mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mn(e)}function gn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function bn(e,t){return bn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},bn(e,t)}function vn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wn(e){return wn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},wn(e)}function On(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function En(e,t,n){var r,o=[];return t.hasPermission("Preview")&&o.push(n("72")),t.hasPermission("Download")&&o.push(n("73")),t.hasPermission("Upload")&&(e.getNode().isLeaf()?o.push(n("74b")):o.push(n("74"))),o.length&&(r=o.join(", ").toLowerCase()),{title:n("71"),legend:r}}fn(hn,"propTypes",{linkModel:i().instanceOf(Ft),editAllowed:i().bool,onChange:i().func,showMailer:i().func}),hn=g(hn=(0,c.muiThemeable)()(hn));var kn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bn(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=wn(o);if(i){var a=wn(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==mn(n)&&"function"!=typeof n?vn(t):n});function s(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return On(vn(e=a.call.apply(a,[this].concat(n))),"changePermission",(function(t){var n=t.target.name,r=t.target.checked,o=e.props,i=o.compositeModel,a=o.linkModel,s=a.getLink();if(r?s.Permissions.push(Oe.RestShareLinkAccessType.constructFromObject(n)):s.Permissions=s.Permissions.filter((function(e){return e!==n})),i.getNode().isLeaf()){var l=Pe.getAuthorizations().max_downloads;a.hasPermission("Preview")?(s.ViewTemplateName="pydio_unique_strip",s.MaxDownloads=0):(s.ViewTemplateName="pydio_unique_dl",l&&!s.MaxDownloads&&(s.MaxDownloads=l))}e.props.linkModel.updateLink(s)})),e}return n=s,(r=[{key:"render",value:function(){var e=this.props,n=e.linkModel,r=e.compositeModel,o=e.pydio,i=r.getNode(),a=[],s=Pe.getAuthorizations();if(i.isLeaf()){var c=Pe.nodeHasEditor(o,i),u=c.preview,p=c.writeable;a.push({NAME:"Download",LABEL:this.props.getMessage("73"),DISABLED:!u||!n.hasPermission("Preview")}),u&&!s.max_downloads&&(a.push({NAME:"Preview",LABEL:this.props.getMessage("72"),DISABLED:!n.hasPermission("Download")}),n.hasPermission("Preview")&&p&&a.push({NAME:"Upload",LABEL:this.props.getMessage("74b")}))}else a.push({NAME:"Preview",LABEL:this.props.getMessage("72"),DISABLED:!n.hasPermission("Upload")}),a.push({NAME:"Download",LABEL:this.props.getMessage("73")}),a.push({NAME:"Upload",LABEL:this.props.getMessage("74")});return t().createElement("div",null,a.map(function(e){return t().createElement(l.Checkbox,{key:e.NAME,disabled:e.DISABLED||this.props.isReadonly()||!n.isEditable(),type:"checkbox",name:e.NAME,label:e.LABEL,onCheck:this.changePermission,checked:n.hasPermission(e.NAME),labelStyle:{whiteSpace:"nowrap"},style:{margin:"10px 0"}})}.bind(this)),void 0)}}])&&gn(n.prototype,r),s}(t().Component);On(kn,"propTypes",{linkModel:i().instanceOf(Ft),style:i().object}),kn=g(kn);const Pn=require("react-dom");var Sn=n.n(Pn);function jn(e){return jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jn(e)}function xn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Rn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xn(Object(n),!0).forEach((function(t){_n(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ln(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Mn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Cn(e,t,n){return t&&Mn(e.prototype,t),n&&Mn(e,n),e}function Tn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Dn(e,t)}function Dn(e,t){return Dn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Dn(e,t)}function An(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r,o,i=In(e);if(t){var a=In(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return r=this,!(o=n)||"object"!==jn(o)&&"function"!=typeof o?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r):o}}function In(e){return In=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},In(e)}var Un=function(e){Tn(o,e);var r=An(o);function o(e){var t;return Ln(this,o),(t=r.call(this,e)).state={copyMessage:""},t}return Cn(o,[{key:"componentDidMount",value:function(){this._clip&&this._clip.destroy(),this._button&&(this._clip=new(en())(this._button,{text:function(e){return this.props.link}.bind(this)}),this._clip.on("success",function(){this.setState({copyMessage:this.props.getMessage("192")},this.clearCopyMessage)}.bind(this)),this._clip.on("error",function(){var e;e=0===n.g.navigator.platform.indexOf("Mac")?this.props.getMessage("144"):this.props.getMessage("share_center.143"),this.setState({copyMessage:e},this.clearCopyMessage)}.bind(this)))}},{key:"componentWillUnmount",value:function(){this._clip&&this._clip.destroy()}},{key:"clearCopyMessage",value:function(){setTimeout(function(){this.setState({copyMessage:""})}.bind(this),5e3)}},{key:"render",value:function(){var e=this,n=this.props,r=n.targetUser,o=n.link;return t().createElement("div",{style:{display:"flex"}},t().createElement("div",{style:{flex:1}},r.Display,t().createElement(l.IconButton,{pydio:this.props.pydio,ref:function(t){e._button=Sn().findDOMNode(t)},iconClassName:"mdi mdi-link",tooltip:this.state.copyMessage||o,iconStyle:{fontSize:13,lineHeight:"17px"},style:{width:34,height:34,padding:6}})),t().createElement("div",{style:{width:40,textAlign:"center"}},r.DownloadCount))}}]),o}(t().Component),Nn=function(e){Tn(r,e);var n=An(r);function r(e,t){var o;return Ln(this,r),(o=n.call(this,e,t)).state={open:!1},o}return Cn(r,[{key:"render",value:function(){var e,n=this,r=this.props.linkModel,o=r.getLink();o.TargetUsers&&(e=o.TargetUsers);var i=Object.keys(e).map((function(n){var o=r.getPublicUrl()+"?u="+n;return t().createElement(Un,{targetUser:e[n],link:o})}));if(!i.length)return null;var a={borderBottom:this.state.open?"1px solid #757575":"",color:"rgba(0, 0, 0, 0.36)"};return t().createElement("div",{style:{lineHeight:"34px",padding:"4px 10px 4px",fontSize:14,backgroundColor:"#fafafa",borderRadius:2}},t().createElement("div",{style:Rn({display:"flex"},a)},t().createElement("div",{style:{flex:1}},this.props.getMessage("245").replace("%s",i.length)," ",t().createElement("span",{className:"mdi mdi-chevron-"+(this.state.open?"up":"down"),style:{cursor:"pointer"},onClick:function(){n.setState({open:!n.state.open})}})),this.state.open&&t().createElement("div",{style:{width:40,textAlign:"center"}},"#DL")),this.state.open&&t().createElement("div",null,i))}}]),r}(t().Component);function Bn(e){return Bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bn(e)}function qn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qn(Object(n),!0).forEach((function(t){Gn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Hn(){return Hn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Hn.apply(this,arguments)}function zn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Vn(e,t){return Vn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Vn(e,t)}function Wn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Yn(e){return Yn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Yn(e)}function Gn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Nn.propTypes={linkModel:i().instanceOf(Ft)},Nn=g(Nn),Un=g(Un);var Xn=s().requireLib("form").ValidPassword,Qn=s().requireLib("hoc"),Kn=Qn.ThemedContainers.Popover,Zn=Qn.ModernTextField,Jn=Qn.ThemedModernStyles,$n=Qn.DatePicker,er=s().requireLib("boot").moment,tr={iconButton:{style:{width:40,height:40,padding:6},iconStyle:{color:"rgba(0,0,0,.5)",fontSize:20}},leftIcon:{margin:"0 16px 0 4px",color:"#757575"}},nr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Vn(e,t)}(c,e);var n,r,o,i,a=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=Yn(o);if(i){var a=Yn(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==Bn(n)&&"function"!=typeof n?Wn(t):n});function c(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return Gn(Wn(e=a.call.apply(a,[this].concat(r))),"state",{}),Gn(Wn(e),"updateDLExpirationField",(function(t){var n=t.currentTarget.value;parseInt(n)<0&&(n=-parseInt(n));var r=e.props.linkModel,o=r.getLink();o.MaxDownloads=n,r.updateLink(o)})),Gn(Wn(e),"updateDaysExpirationField",(function(t,n){n||(n=t.currentTarget.getValue());var r=e.props.linkModel,o=r.getLink();o.AccessEnd=n,r.updateLink(o)})),Gn(Wn(e),"onDateChange",(function(t,n){var r=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate());e.updateDaysExpirationField(t,Math.floor(r/1e3)+"")})),Gn(Wn(e),"resetPassword",(function(){var t=e.props.linkModel;t.setUpdatePassword(""),t.getLink().PasswordRequired=!1,t.notifyDirty()})),Gn(Wn(e),"setUpdatingPassword",(function(t){At().checkPasswordStrength(t,(function(n,r){e.setState({updatingPassword:t,updatingPasswordValid:n})}))})),Gn(Wn(e),"changePassword",(function(){var t=e.props.linkModel,n=e.state.updatingPassword;t.setUpdatePassword(n),e.setState({pwPop:!1,updatingPassword:"",updatingPasswordValid:!1}),t.notifyDirty()})),Gn(Wn(e),"updatePassword",(function(t,n){var r=e.props.linkModel;e.state.validPasswordStatus?e.setState({invalidPassword:null,invalid:!1},(function(){r.setUpdatePassword(t)})):e.setState({invalidPassword:t,invalid:!0})})),Gn(Wn(e),"resetDownloads",(function(){if(window.confirm(e.props.getMessage("106"))){var t=e.props.linkModel;t.getLink().CurrentDownloads="0",t.notifyDirty()}})),Gn(Wn(e),"resetExpiration",(function(){var t=e.props.linkModel;t.getLink().AccessEnd="0",t.notifyDirty()})),Gn(Wn(e),"renderPasswordContainer",(function(){var n,r,o,i=e.props.linkModel,a=i.getLink(),c=Pe.getAuthorizations();return a.PasswordRequired?(e.props.isReadonly()||!i.isEditable()||c.password_mandatory||(r=t().createElement(l.IconButton,Hn({iconClassName:"mdi mdi-close-circle",onClick:e.resetPassword,tooltip:e.props.getMessage("174")},tr.iconButton))),!e.props.isReadonly()&&i.isEditable()&&(o=t().createElement("div",null,t().createElement(l.IconButton,Hn({iconClassName:"mdi mdi-pencil",onClick:function(t){e.setState({pwPop:!0,pwAnchor:t.currentTarget})},tooltip:e.props.getMessage("181")},tr.iconButton)),t().createElement(Kn,{open:e.state.pwPop,anchorEl:e.state.pwAnchor,anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"},onRequestClose:function(){e.setState({pwPop:!1})}},t().createElement("div",{style:{width:380,padding:8}},t().createElement(Xn,{name:"update",ref:"pwdUpdate",attributes:{label:e.props.getMessage("23")},value:e.state.updatingPassword?e.state.updatingPassword:"",onChange:function(t){e.setUpdatingPassword(t)},onValidStatusChange:function(t){return e.setState({updatingPasswordDiffer:!t})},variant:"v2"}),t().createElement("div",{style:{paddingTop:20,textAlign:"right"}},t().createElement(l.FlatButton,{label:s().getMessages()[54],onClick:function(){e.setState({pwPop:!1,updatingPassword:""})}}),t().createElement(l.FlatButton,{style:{minWidth:60},label:s().getMessages()[48],onClick:function(){e.changePassword()},disabled:!e.state.updatingPassword||!e.state.updatingPasswordValid||e.state.updatingPasswordDiffer})))))),n=t().createElement(Zn,{floatingLabelText:e.props.getMessage("23"),disabled:!0,value:"********",fullWidth:!0,variant:"v2"})):!e.props.isReadonly()&&i.isEditable()&&(n=t().createElement(Xn,{name:"share-password",ref:"pwd",attributes:{label:e.props.getMessage("23")},value:e.state.invalidPassword?e.state.invalidPassword:i.updatePassword,onChange:e.updatePassword.bind(Wn(e)),onValidStatusChange:function(t){e.setState({validPasswordStatus:t})},variant:"v2"})),n?t().createElement("div",{className:"password-container",style:{display:"flex",alignItems:"baseline",width:"100%",position:"relative"}},t().createElement("div",{style:{width:"100%",display:"inline-block"}},n),(r||o)&&t().createElement("div",{style:{position:"absolute",right:0,bottom:0,display:"flex"}},o,r)):null})),Gn(Wn(e),"formatDate",(function(t){return e.props.getMessage("date_format","").split(" ").shift().replace("Y",t.getFullYear()).replace("m",t.getMonth()+1).replace("d",t.getDate())})),e}return n=c,(r=[{key:"render",value:function(){var e,n,r,o,i=this.props,a=i.linkModel,s=i.muiTheme,c=a.getLink(),u=this.renderPasswordContainer(),p=a.hasPermission("Download")&&!a.hasPermission("Preview")&&!a.hasPermission("Upload"),f=parseInt(c.MaxDownloads),d=parseInt(c.AccessEnd),y=!1,h=!1,m=new Date,g=Pe.getAuthorizations();if(parseInt(g.max_expiration)>0&&(r=new Date).setDate(m.getDate()+parseInt(g.max_expiration)),parseInt(g.max_downloads)>0&&(f=Math.max(1,Math.min(f,parseInt(g.max_downloads)))),d&&(d<0&&(y=!0),n=new Date(1e3*d),parseInt(g.max_expiration)||(e=t().createElement(l.IconButton,{iconStyle:tr.iconButton.iconStyle,style:Fn(Fn({},tr.iconButton.style),{},{position:"absolute",right:0,bottom:0,zIndex:1}),iconClassName:"mdi mdi-close-circle",onClick:this.resetExpiration.bind(this)}))),f){var b,v=parseInt(c.CurrentDownloads)||0;v&&(b=t().createElement("a",{style:{cursor:"pointer"},onClick:this.resetDownloads.bind(this),title:this.props.getMessage("17")},"(",this.props.getMessage("16"),")"),v>=f&&(h=!0)),o=t().createElement("span",{className:"dlCounterString"},v+"/"+f," ",b)}var w={fontSize:13,fontWeight:500,color:s.palette.mui3["on-surface-variant"]},O=Jn(s);return t().createElement("div",null,u,t().createElement("div",{style:{display:"flex",alignItems:"baseline",position:"relative"},className:y?"limit-block-expired":null},t().createElement($n,Hn({ref:"expirationDate",key:"start",value:n,minDate:new Date,maxDate:r,autoOk:!0,disabled:this.props.isReadonly()||!a.isEditable(),onChange:this.onDateChange,showYearSelector:!0,floatingLabelText:this.props.getMessage(y?"21b":"21"),mode:"landscape",formatDate:this.formatDate,fullWidth:!0},O.textFieldV2,{style:{flex:1},textFieldStyle:Fn(Fn({},O.textFieldV2.style),{},{flex:1})})),e),t().createElement("div",{style:{alignItems:"baseline",display:p?"flex":"none",position:"relative"},className:h?"limit-block-expired":null},t().createElement(Zn,{type:"number",disabled:this.props.isReadonly()||!a.isEditable(),floatingLabelText:this.props.getMessage(h?"22b":"22"),value:f>0?f:"",onChange:this.updateDLExpirationField,fullWidth:!0,style:{flex:1},variant:"v2"}),t().createElement("span",{style:Fn({position:"absolute",right:10,top:14},w)},o)))}}])&&zn(n.prototype,r),c}(t().Component);function rr(e){return rr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rr(e)}function or(){return or=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},or.apply(this,arguments)}function ir(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ar(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ir(Object(n),!0).forEach((function(t){sr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ir(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function sr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function lr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function cr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ur(e,t,n){return t&&cr(e.prototype,t),n&&cr(e,n),e}function pr(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fr(e,t)}function fr(e,t){return fr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},fr(e,t)}function dr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r,o,i=hr(e);if(t){var a=hr(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return r=this,!(o=n)||"object"!==rr(o)&&"function"!=typeof o?yr(r):o}}function yr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hr(e){return hr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},hr(e)}Gn(nr,"propTypes",{linkModel:i().instanceOf(Ft).isRequired,style:i().object}),nr=g((0,c.muiThemeable)()(nr));var mr=s().requireLib("form").ValidPassword,gr=s().requireLib("hoc").ThemedModernStyles,br=function(e){pr(r,e);var n=dr(r);function r(e){var t;return lr(this,r),(t=n.call(this,e)).state={active:!!e.active},t}return ur(r,[{key:"render",value:function(){var e=this,n=this.props,r=n.title,o=n.legend,i=n.children,a=this.state.active,s={title:{cursor:"pointer",fontSize:15,padding:16,paddingBottom:a?8:16,display:"flex",alignItems:"center",fontWeight:a?500:null},legend:{opacity:.4,fontSize:12,fontWeight:500,fontStyle:"italic"},content:{padding:"0 16px 8px"},chevron:{fontSize:24,color:"rgba(0,0,0,.3)",transition:"transform 250ms ease",transform:a?"rotate(90deg)":""}};return t().createElement(t().Fragment,null,t().createElement("div",{style:ar({},s.title),onClick:function(){e.setState({active:!a})}},t().createElement("span",{style:{flex:1}},r,o&&t().createElement("span",{style:s.legend}," - ",o)),t().createElement("span",{className:"mdi mdi-chevron-right",style:s.chevron})),a&&t().createElement("div",{style:ar({},s.content)},i))}}]),r}(t().Component),vr=function(e){pr(r,e);var n=dr(r);function r(){var e;lr(this,r);for(var t=arguments.length,o=new Array(t),i=0;i<t;i++)o[i]=arguments[i];return sr(yr(e=n.call.apply(n,[this].concat(o))),"state",{showTemporaryPassword:!1,temporaryPassword:null,saving:!1}),sr(yr(e),"toggleLink",(function(){var t=e.props,n=t.linkModel;t.pydio,e.state.showTemporaryPassword?e.setState({showTemporaryPassword:!1,temporaryPassword:null}):!n.getLinkUuid()&&Pe.getAuthorizations().password_mandatory?e.setState({showTemporaryPassword:!0,temporaryPassword:""}):(e.setState({saving:!0}),n.getLinkUuid()?e.props.compositeModel.deleteLink(n).catch((function(){e.setState({saving:!1})})).then((function(){e.setState({saving:!1})})):n.save().catch((function(){e.setState({saving:!1})})).then((function(){e.setState({saving:!1})})))})),sr(yr(e),"updateTemporaryPassword",(function(t,n){void 0===t&&(t=n.currentTarget.getValue()),e.setState({temporaryPassword:t})})),sr(yr(e),"enableLinkWithPassword",(function(){var t=e.props.linkModel;if(e.state.temporaryPasswordState){t.setCreatePassword(e.state.temporaryPassword);try{t.save()}catch(t){e.props.pydio.UI.displayMessage("ERROR",t.message)}e.setState({showTemporaryPassword:!1,temporaryPassword:null})}else e.props.pydio.UI.displayMessage("ERROR","Invalid Password")})),e}return ur(r,[{key:"render",value:function(){var e,n,r,o=this,i=this.props,a=i.linkModel,s=i.pydio,c=i.compositeModel,u=i.toggleOnly,p=i.additionalPanes,f=i.muiTheme,d=this.state,y=d.showTemporaryPassword,h=d.temporaryPassword,m=d.saving,g=Pe.getAuthorizations(),b=c.getNode().isLeaf(),v=b&&g.file_public_link||!b&&g.folder_public_link,w={fontSize:13,fontWeight:500,color:f.palette.mui3["on-surface-variant"],padding:8,paddingTop:0};return a.getLinkUuid()?(this.props.isReadonly()||m||!a.isEditable()||!a.getLinkUuid()&&!v||(r=function(){return o.toggleLink()}),n=t().createElement(hn,{pydio:s,linkModel:a,compositeModel:c,showMailer:this.props.showMailer,editAllowed:g.editable_hash&&a.isEditable(),onDisableLink:r,key:"public-link"}),e=[t().createElement(l.Divider,null),t().createElement(br,En(c,a,this.props.getMessage),t().createElement(kn,{compositeModel:c,linkModel:a,pydio:s,key:"public-perm"}))],a.getLink().TargetUsers&&(e.push(t().createElement(l.Divider,null)),e.push(t().createElement(Nn,{linkModel:a,pydio:s}))),e.push(t().createElement(l.Divider,null)),e.push(t().createElement(br,function(e,n,r){r("link.secure.title");var o,i,a=[],s=n.getLink();if(s.AccessEnd&&0!==parseInt(s.AccessEnd)){var l=new Date(1e3*parseInt(s.AccessEnd)),c=new Date,u=r("link.secure.expires");l<c&&(u=r("link.secure.expired"),o=t().createElement("span",{className:"mdi mdi-alert"})),a.push(u+" "+er(l).fromNow())}return s.PasswordRequired&&a.push(r("link.secure.hasPassword")),s.MaxDownloads>0&&a.push(r("link.secure.maxdownloads").replace("%d",s.MaxDownloads)),a.length&&(i=t().createElement(t().Fragment,null,o,a.join(", "))),{title:r("link.secure.title"),legend:i}}(0,a,this.props.getMessage),t().createElement(nr,{pydio:s,linkModel:a}))),p&&p.forEach((function(n){e.push(t().createElement(l.Divider,null)),e.push(t().createElement(br,{title:n.title,legend:n.legend},n.content))}))):n=y?t().createElement("div",null,t().createElement("div",{className:"section-legend",style:{marginTop:20}},this.props.getMessage("215")),t().createElement("div",{style:{width:"100%"}},t().createElement(mr,{attributes:{label:this.props.getMessage("23")},value:h,onChange:this.updateTemporaryPassword.bind(this),onValidStatusChange:function(e){return o.setState({temporaryPasswordState:e})},variant:"v2"})),t().createElement("div",{style:{textAlign:"center",marginTop:20}},t().createElement(l.RaisedButton,{label:this.props.getMessage("92"),secondary:!0,onClick:this.enableLinkWithPassword.bind(this),disabled:!this.state.temporaryPasswordState}))):v?t().createElement("div",{style:w},this.props.getMessage("190")):t().createElement("div",{style:w},this.props.getMessage(b?"225":"226")),t().createElement("div",{style:this.props.style},!(a.getLinkUuid()||y)&&t().createElement("div",{style:{padding:16}},t().createElement(l.Toggle,or({disabled:this.props.isReadonly()||m||!a.isEditable()||!a.getLinkUuid()&&!v,onToggle:this.toggleLink,toggled:a.getLinkUuid()||y,label:this.props.getMessage("189")},gr(f).toggleFieldV2))),m&&t().createElement("div",{style:{width:"100%",height:300,display:"flex",alignItems:"center",justifyContent:"center"}},t().createElement(l.CircularProgress,null)),!u&&!m&&t().createElement("div",{style:{padding:16}},n),!u&&!m&&e)}}]),r}(t().Component);function wr(e){return wr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wr(e)}function Or(){return Or=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Or.apply(this,arguments)}function Er(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function kr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Er(Object(n),!0).forEach((function(t){Pr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Er(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Pr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Sr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function jr(e,t){return jr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},jr(e,t)}function xr(e){return xr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},xr(e)}sr(vr,"propTypes",{linkModel:i().instanceOf(Ft),compositeModel:i().instanceOf(Kt),pydio:i().instanceOf(s()),authorizations:i().object,showMailer:i().func}),vr=g((0,c.muiThemeable)()(vr));var Rr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&jr(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=xr(o);if(i){var a=xr(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==wr(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={mailerData:null},t}return n=s,r=[{key:"componentWillReceiveProps",value:function(e){var t=this,n=e.subject,r=e.message,o=(e.users,e.linkModel),i=e.templateId;if(e.templateData,n||i){if(Pe.forceMailerOldSchool()){var a=encodeURIComponent(n);return void(location.href="mailto:custom-email@domain.com?Subject="+a+"&Body="+r)}bt().loadClass("PydioMailer").then((function(n){t.setState({mailerData:kr(kr({},e),{},{enableIdentification:o&&o.getLink().TargetUsers,identifiedOnly:o&&o.getLink().RestrictToTargetUsers,crippleIdentificationKeys:!0}),MailerPanel:n.Pane})}))}else this.setState({mailerData:null})}},{key:"toggleMailerData",value:function(e){this.setState({mailerData:kr(kr({},this.state.mailerData),e)})}},{key:"dismissMailer",value:function(){this.props.onDismiss()}},{key:"mailerProcessPost",value:function(e,t,n,r,o,i){var a=this.state.mailerData,s=a.crippleIdentificationKeys,l=a.identifiedOnly,c=a.linkModel,u=c.getLink();u.TargetUsers||(u.TargetUsers={}),u.RestrictToTargetUsers=l;var p={};Object.keys(t).forEach((function(e){var n=s?Math.random().toString(36).substring(7):e;u.TargetUsers[n]=Oe.RestShareLinkTargetUser.constructFromObject({Display:t[e].getLabel(),DownloadCount:0}),p[n]=e})),c.updateLink(u),c.save().then((function(){var t=new e,o=c.getPublicUrl(),a=new RegExp(o,"g");Object.keys(p).forEach((function(e){var i=o+"?u="+e,s=r.replace(a,i);t.addTarget(p[e],n,s)})),t.post((function(e){i(e)}))}))}},{key:"getMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"share_center";return this.props.pydio.MessageHash[t+(t?".":"")+e]}},{key:"render",value:function(){var e=this.state,n=e.mailerData,r=e.MailerPanel;if(!n)return null;var o=this.props.muiTheme;return t().createElement(r,Or({},n,{onDismiss:this.dismissMailer.bind(this),overlay:!0,className:"share-center-mailer",panelTitle:this.props.pydio.MessageHash["share_center.45"],additionalPaneTop:void 0,processPost:n.enableIdentification?this.mailerProcessPost.bind(this):null,style:{width:420,margin:"0 auto",background:o.palette.mui3["surface-3"]}}))}}],r&&Sr(n.prototype,r),s}(t().Component);function _r(e){return _r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_r(e)}function Lr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Mr(e,t){return Mr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Mr(e,t)}function Cr(e){return Cr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Cr(e)}Rr=(0,c.muiThemeable)()(Rr);var Tr=s().requireLib("hoc").ModernSelectField,Dr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mr(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=Cr(o);if(i){var a=Cr(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==_r(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),a.apply(this,arguments)}return n=s,(r=[{key:"onDropDownChange",value:function(e,t,n){var r=this.props.linkModel;r.getLink().ViewTemplateName=n,r.notifyDirty()}},{key:"render",value:function(){var e,n=this.props,r=n.linkModel,o=n.hideTitle,i=n.muiTheme,a=r.getLink().ViewTemplateName,s=this.props.layoutData.map((function(n){return a&&n.LAYOUT_ELEMENT===a&&(e=n.LAYOUT_LABEL),a||e||(a=n.LAYOUT_ELEMENT,e=n.LAYOUT_LABEL),t().createElement(l.MenuItem,{key:n.LAYOUT_ELEMENT,value:n.LAYOUT_ELEMENT,primaryText:n.LAYOUT_LABEL})})),c={fontSize:13,fontWeight:500,color:i.palette.mui3["on-surface-variant"]};return t().createElement("div",{style:this.props.style},!o&&t().createElement("div",{style:c},this.props.getMessage("151")),t().createElement(Tr,{variant:"v2",fullWidth:!0,value:a,onChange:this.onDropDownChange.bind(this),disabled:this.props.isReadonly()||this.props.readonly||!r.isEditable(),floatingLabelText:this.props.getMessage("151")},s))}}])&&Lr(n.prototype,r),s}(t().Component);Dr.PropTypes={linkModel:i().instanceOf(Ft)};const Ar=Dr=g((0,c.muiThemeable)()(Dr)),Ir=require("pydio/http/policies");var Ur=n.n(Ir);function Nr(e){return Nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nr(e)}function Br(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function qr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Fr(e,t){return Fr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Fr(e,t)}function Hr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zr(e){return zr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},zr(e)}function Vr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Wr=s().requireLib("components").ResourcePoliciesPanel,Yr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fr(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=zr(o);if(i){var a=zr(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==Nr(n)&&"function"!=typeof n?Hr(t):n});function s(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Vr(Hr(e=a.call.apply(a,[this].concat(n))),"onSavePolicies",(function(t){var n=e.props,r=n.linkModel,o=(n.pydio,r.getLink().UserLogin);Ur().loadPolicies("user",o).then((function(n){if(n.length){var r=n[0].Resource,i=e.diffPolicies(n,t,r);Ur().savePolicies("user",o,i)}}))})),Vr(Hr(e),"diffPolicies",(function(e,t,n){var r=[];return e.map((function(e){var n=e.Action+"///"+e.Subject;t.remove[n]||r.push(e)})),Object.keys(t.add).map((function(e){var t,o,i=new Oe.ServiceResourcePolicy,a=(t=e.split("///"),o=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,o)||function(e,t){if(e){if("string"==typeof e)return Br(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Br(e,t):void 0}}(t,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=a[0],l=a[1];i.Resource=n,i.Effect=Oe.ServiceResourcePolicyPolicyEffect.constructFromObject("allow"),i.Subject=l,i.Action=s,r.push(i)})),r})),e}return n=s,(r=[{key:"render",value:function(){var e=this.props,n=e.linkModel,r=e.pydio,o=[];o["user:"+n.getLink().UserLogin]=!0;var i={READ:o,WRITE:o};return t().createElement("div",{style:this.props.style},n.getLink().Uuid&&t().createElement(Wr,{pydio:r,resourceType:"link",description:this.props.getMessage("link.visibility.advanced"),resourceId:n.getLink().Uuid,skipTitle:!0,onSavePolicies:this.onSavePolicies.bind(this),subjectsDisabled:i,subjectsHidden:o,readonly:this.props.isReadonly()||!n.isEditable(),ref:"policies"}))}}])&&qr(n.prototype,r),s}(t().Component);Yr.PropTypes={pydio:i().instanceOf(s()).isRequired,linkModel:i().instanceOf(Ft).isRequired};const Gr=Yr=g(Yr);function Xr(e){return Xr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xr(e)}function Qr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Kr(e,t){return Kr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Kr(e,t)}function Zr(e){return Zr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Zr(e)}var Jr=s().requireLib("hoc").ModernTextField,$r=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Kr(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=Zr(o);if(i){var a=Zr(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==Xr(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),a.apply(this,arguments)}return n=s,(r=[{key:"render",value:function(){var e,n=this.props,r=n.pydio,o=n.model,i=n.linkModel,a=n.style,s=n.showLayout,l=function(e){return r.MessageHash["share_center."+e]},c=i.getLink(),u=Pe.compileLayoutData(r,o);return s&&u.length>1&&(e=t().createElement(Ar,{linkModel:i,pydio:r,layoutData:u,hideTitle:!0})),t().createElement("div",{style:a},t().createElement(Jr,{variant:"v2",floatingLabelText:l(265),value:c.Label,onChange:function(e,t){c.Label=t,i.updateLink(c)},fullWidth:!0}),t().createElement(Jr,{variant:"v2",floatingLabelText:l(266),value:c.Description,onChange:function(e,t){c.Description=t,i.updateLink(c)},fullWidth:!0}),e)}}])&&Qr(n.prototype,r),s}(t().Component);function eo(e){return eo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},eo(e)}function to(){return to=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},to.apply(this,arguments)}function no(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ro(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?no(Object(n),!0).forEach((function(t){oo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):no(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function oo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function io(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ao(e,t){return ao=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ao(e,t)}function so(e){return so=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},so(e)}($r=g($r)).PropTypes={pydio:i().instanceOf(s()),linkModel:i().instanceOf(Ft)},n(757).requireLib("boot").ThemeModifier;var lo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ao(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=so(o);if(i){var a=so(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==eo(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),e.editorOneColumn=!0,t=a.call(this,e);var n=new Kt(!0);return n.skipUpdateUnderlyingNode=!0,t.state={mode:t.props.mode||"view",model:n},t}return n=s,(r=[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.node,r=t.linkUuid,o=t.onRemoveLink,i=this.state.model;i.observe("update",(function(){e.forceUpdate()})),i.loadUniqueLink(r,n).observeOnce("delete",(function(){o&&o()}))}},{key:"componentWillUnmount",value:function(){this.state.model.stopObserving("update")}},{key:"componentWillReceiveProps",value:function(e){e.LinkUuid&&e.LinkUuid!==this.props.LinkUuid&&this.state.model.loadUniqueLink(e.LinkUuid,e.node)}},{key:"linkInvitation",value:function(e){try{var t=Pe.prepareEmail(this.props.node,e);this.setState({mailerData:ro(ro({},t),{},{users:[],linkModel:e})})}catch(e){alert(e.message)}}},{key:"dismissMailer",value:function(){this.setState({mailerData:null})}},{key:"submit",value:function(){var e=this.state.model;try{e.getLinks().length&&e.getLinks()[0].save()}catch(e){this.props.pydio.UI.displayMessage("ERROR",e.message)}}},{key:"render",value:function(){var e,n,r=this.props,o=r.node,i=r.pydio,a=r.editorOneColumn,s=this.state,l=s.model,c=s.mailerData,u=function(e){return i.MessageHash["share_center."+e]};l.getLinks().length&&(e=l.getLinks()[0]),n=e&&e.getLinkUuid()&&e.isEditable()?t().createElement("div",null,t().createElement(Rr,to({},c,{pydio:i,onDismiss:this.dismissMailer.bind(this)})),t().createElement($r,{pydio:i,linkModel:e,model:l})):t().createElement("div",{style:{fontSize:24,padding:"26px 10px 0 ",lineHeight:"26px"}},t().createElement(Rr,to({},c,{pydio:i,onDismiss:this.dismissMailer.bind(this)})),u(256).replace("%s",o.getLabel()));var p={left:[],right:[],leftStyle:{padding:0}},f=l.getLinks();return e&&(p.left.push({Label:u(251),Value:"public-link",Component:t().createElement(vr,{pydio:i,compositeModel:l,linkModel:f[0],showMailer:Pe.mailerSupported(i)?this.linkInvitation.bind(this):null})}),e.getLinkUuid()&&p.left.push({Label:u(253),Value:"link-visibility",Component:t().createElement(Gr,{pydio:i,linkModel:f[0]}),AlwaysLast:!0})),t().createElement(st,{tabs:p,pydio:i,header:n,saveEnabled:l.isDirty(),onSaveAction:this.submit.bind(this),onCloseAction:this.props.onDismiss,onRevertAction:function(){l.revertChanges()},editorOneColumn:a,style:{width:"100%",height:null,flex:1,minHeight:550,color:"rgba(0,0,0,.83)",fontSize:13}})}}])&&io(n.prototype,r),s}(t().Component);function co(e){return co="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},co(e)}function uo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function po(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?uo(Object(n),!0).forEach((function(t){fo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function fo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function yo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ho(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function mo(e,t){return mo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},mo(e,t)}function go(e){return go=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},go(e)}var bo=s().requireLib("hoc").ThemedContainers.Popover,vo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mo(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=go(o);if(i){var a=go(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==co(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=a.call(this,e);var n=null;return 0===e.compositeModel.getCells().length&&(n="NEWCELL"),t.state={edit:n},t}return n=s,(r=[{key:"addToCellsMenuItems",value:function(e){var n,r,o,i=this,a=[],s=this.props,c=s.pydio,u=s.compositeModel,p=u.getCells().map((function(e){return e.getUuid()}));return 0===p.filter((function(e){return!e})).length&&(a.push(t().createElement(l.MenuItem,{primaryText:e("cell.add.new"),onClick:function(){i.setState({addMenuOpen:!1}),u.createEmptyCell()},leftIcon:t().createElement(l.FontIcon,{className:"icomoon-cells-full-plus"})})),n=!0),c.user.getRepositoriesList().forEach((function(e){"shared"===e.getOwner()&&-1===p.indexOf(e.getId())&&(a.push(t().createElement(l.MenuItem,{primaryText:e.getLabel(),onClick:function(){i.setState({addMenuOpen:!1}),u.addToExistingCell(e.getId())},leftIcon:t().createElement(l.FontIcon,{className:"icomoon-cells"})})),r=!0)})),r&&n?o=e("cell.add.existing-or-new"):r?o=e("cell.add.existing"):n&&(o=e("cell.add.new")),{addItems:a,addLabel:o}}},{key:"removeCurrentNodeFromCell",value:function(e){var t=this.props.compositeModel;0===t.getCells().filter((function(t){return t!==e})).length&&t.createEmptyCell(),e.removeRootNode(t.getNode().getMetadata().get("uuid"))}},{key:"render",value:function(){var e=this,n=this.props,r=n.compositeModel,o=n.pydio,i=n.usersInvitations,a=n.muiTheme,s=(this.state.edit,function(e){return o.MessageHash["share_center."+e]}),c={fontSize:13,fontWeight:500,color:a.palette.mui3["on-surface-variant"],padding:8};if(r.getNode()&&!r.canCreateCells())return t().createElement("div",{style:c},s(r.getNode().isLeaf()?"227":"228"));var u=r.getCells().length>1,p=[];r.getCells().map((function(n){var r=t().createElement("div",{style:{margin:"0 -10px"}},t().createElement(re,{pydio:o,cellAcls:n.getAcls(),excludes:[o.user.id],onUserObjectAdd:n.addUser.bind(n),onUserObjectRemove:n.removeUser.bind(n),onUserObjectUpdateRight:n.updateUserRight.bind(n),sendInvitations:function(e){return i(e,n)},saveSelectionAsTeam:!1,withActionLinks:function(r){return n.isEditable()?[].concat(function(e){if(Array.isArray(e))return yo(e)}(o=r)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(o)||function(e,t){if(e){if("string"==typeof e)return yo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?yo(e,t):void 0}}(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[t().createElement(Q,{mdiIcon:"delete-forever",destructive:!0,messageId:s("cells.remove.node"),tooltipPosition:"top-center",callback:function(){e.removeCurrentNodeFromCell(n)}})]):r;var o},readonly:!n.isEditable(),completerStyle:{margin:"-6px 8px 16px"}}));u?p.push(t().createElement(br,{title:n.getLabel(),legend:n.getAclsSubjects()},r)):p.push(t().createElement("div",{style:{padding:16}},r)),p.push(t().createElement(l.Divider,null))})),p.pop();var f,d=this.addToCellsMenuItems(s),y=d.addItems,h=d.addLabel;if(y.length){var m=this.props.muiTheme;f=t().createElement("span",{id:"share-dialog-addtocell-menu"},t().createElement(l.FlatButton,{iconClassName:"icomoon-cells-full-plus",style:{width:"100%"},iconStyle:{color:m.palette.accent2Color},primary:!0,tooltip:s(263),label:h,tooltipPosition:"bottom-left",onClick:function(t){e.setState({addMenuOpen:!0,addMenuAnchor:t.currentTarget})}}),t().createElement(bo,{open:this.state.addMenuOpen,anchorEl:this.state.addMenuAnchor,onRequestClose:function(){e.setState({addMenuOpen:!1})},anchorOrigin:{horizontal:"left",vertical:"top"},targetOrigin:{horizontal:"left",vertical:"bottom"}},t().createElement(l.Menu,{desktop:!0,listStyle:{paddingTop:0},width:250},t().createElement(l.Subheader,null,h),y)))}return t().createElement("div",{style:po(po({},this.props.style),{},{minHeight:300})},p,f&&t().createElement("div",{style:{position:"absolute",bottom:10,left:10}},f))}}])&&ho(n.prototype,r),s}(t().Component);function wo(e){return wo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wo(e)}function Oo(){return Oo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Oo.apply(this,arguments)}function Eo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ko(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Eo(Object(n),!0).forEach((function(t){Po(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Eo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Po(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function So(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function jo(e,t){return jo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},jo(e,t)}function xo(e){return xo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},xo(e)}vo.PropTypes={pydio:i().instanceOf(s()),compositeModel:i().instanceOf(Kt).isRequired,usersInvitations:i().func},vo=(0,c.muiThemeable)()(vo),n(757).requireLib("boot").ThemeModifier;var Ro=s().requireLib("boot").Tooltip,_o=s().requireLib("components"),Lo=_o.GenericCard,Mo=_o.GenericLine,Co=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&jo(e,t)}(l,e);var r,o,i,a,s=(i=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t,n,r=xo(i);if(a){var o=xo(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return t=this,!(n=e)||"object"!==wo(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=s.call(this,e)).state={mode:t.props.mode||"view",model:new Kt("edit"===t.props.mode)},t}return r=l,(o=[{key:"confirmAndDismiss",value:function(){var e=this.state.model,t=this.props,n=t.pydio,r=t.onDismiss;e.isDirty()&&!confirm(n.MessageHash["share_center.dialog.close.confirm.unsaved"])||r()}},{key:"attachClipboard",value:function(){var e=this.props.pydio,t=function(t){return e.MessageHash["share_center."+t]},r=this.state.model;if(this.detachClipboard(),r.getLinks().length){var o=r.getLinks()[0];o.getLink()&&this.refs["copy-button"]&&(this._clip=new(en())(this.refs["copy-button"],{text:function(t){return Pe.buildPublicUrl(e,o.getLink())}.bind(this)}),this._clip.on("success",function(){var e=this;this.setState({copyMessage:t("192")},(function(){setTimeout((function(){e.setState({copyMessage:null})}),2500)}))}.bind(this)),this._clip.on("error",function(){var e,r=this;e=0===n.g.navigator.platform.indexOf("Mac")?t(144):t(143),this.setState({copyMessage:e},(function(){setTimeout((function(){r.setState({copyMessage:null})}),2500)}))}.bind(this)))}}},{key:"detachClipboard",value:function(){this._clip&&this._clip.destroy()}},{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.node,r=t.mode;this.state.model.observe("update",(function(){e.forceUpdate()})),this.state.model.load(n,"infoPanel"===r),this.attachClipboard()}},{key:"componentWillUnmount",value:function(){this.state.model.stopObserving("update"),this.detachClipboard()}},{key:"componentDidUpdate",value:function(){this.attachClipboard()}},{key:"componentWillReceiveProps",value:function(e){!e.node||e.node===this.props.node&&e.node.getMetadata("pydio_shares")===this.props.node.getMetadata("pydio_shares")||this.state.model.load(e.node,"infoPanel"===e.mode)}},{key:"usersInvitations",value:function(e,t){Pe.sendCellInvitation(this.props.node,t,e)}},{key:"linkInvitation",value:function(e){try{var t=Pe.prepareEmail(this.props.node,e);this.setState({mailerData:ko(ko({},t),{},{users:[],linkModel:e})})}catch(e){alert(e.message)}}},{key:"dismissMailer",value:function(){this.setState({mailerData:null})}},{key:"submit",value:function(){try{this.state.model.save()}catch(e){this.props.pydio.UI.displayMessage("ERROR",e.message)}}},{key:"deleteAllShares",value:function(){var e=this.props.pydio,t=this.state.model;e.UI.openComponentInModal("PydioReactUI","ConfirmDialog",{dialogTitleId:"share_center.composite.deleteAll",message:e.MessageHash["share_center.255"],validCallback:function(){t.stopObserving("update"),t.deleteAll().then((function(e){t.updateUnderlyingNode()}))}})}},{key:"render",value:function(){var e=this,n=this.props,r=n.node,o=n.mode,i=n.pydio,a=n.editorOneColumn,s=n.popoverPanel,l=n.popoverRequestClose,c=n.genericFlex,u=this.state,p=u.model,f=u.mailerData,d=u.linkTooltip,y=u.copyMessage,h=function(e){return i.MessageHash["share_center."+e]};if("edit"===o){var m,g=t().createElement("div",{style:{fontSize:20,padding:10,wordBreak:"break-word",lineHeight:"1.3em"}},t().createElement(Rr,Oo({},f,{pydio:i,onDismiss:this.dismissMailer.bind(this)})),r&&h(256).replace("%s",r.getLabel())+(p.isDirty()?" *":"")),b={left:[],right:[]},v=p.getCells().filter((function(e){return e.getUuid()}));m=v.length>1?h("254c").replace("%d",v.length):1===v.length?h("254d").replace("%s",v[0].getLabel()):h("254b"),b.right.push({Label:m,Value:"cells",Icon:"mdi mdi-account-multiple",Component:t().createElement(vo,{pydio:i,compositeModel:p,usersInvitations:this.usersInvitations.bind(this)})});var w,O=p.getLinks();if(O.length&&(w=O[0]),w){var E=[],k=!1;w.getLinkUuid()&&(k=!0,E.push(ko(ko({},(x=w,{title:h("265"),legend:x.getLink().Label})),{},{content:t().createElement($r,{pydio:i,linkModel:O[0],model:p,showLayout:!0})})),O[0].isEditable()&&E.push({title:h("link.visibility.title"),content:t().createElement(Gr,{pydio:i,linkModel:O[0],style:{margin:-10}})})),b.left.push({Label:h(121)+(k?" ("+h("link.active")+")":""),Value:"public-link",Icon:"mdi mdi-link",Component:t().createElement(vr,{pydio:i,compositeModel:p,linkModel:O[0],showMailer:Pe.mailerSupported(i)?this.linkInvitation.bind(this):null,additionalPanes:E})})}var P=!O.filter((function(e){return e.getLinkUuid()})).length&&v.length>0?"cells":null;return t().createElement(st,{tabs:b,defaultLeft:P,pydio:i,header:g,saveEnabled:p.isDirty(),onSaveAction:this.submit.bind(this),onCloseAction:function(){return e.confirmAndDismiss()},onRevertAction:function(){p.revertChanges(!0)},editorOneColumn:a,style:{width:"100%",height:null,flex:1,minHeight:350,fontSize:13}})}var S=[],j=[];p.getCells().map((function(e){j.push(e.getLabel())}));var x,R=p.getLinks();if(R.length){var _=R[0];if(_.hasError()){var L=_.hasError();S.push(t().createElement(Mo,{iconClassName:"mdi mdi-alert-outline",legend:"Error",data:L.Detail||L.Msg||L}))}else if(_.getLink()&&_.getLink().LinkHash){var M=Pe.buildPublicUrl(i,_.getLink(),"infoPanel"===o);S.push(t().createElement(Mo,{iconClassName:"mdi mdi-link",legend:h(121),style:{overflow:"visible"},dataStyle:{overflow:"visible"},data:t().createElement("div",{ref:"copy-button",style:{cursor:"pointer",position:"relative"},onMouseOver:function(){e.setState({linkTooltip:!0})},onMouseOut:function(){e.setState({linkTooltip:!1})}},t().createElement(Ro,{label:y||h(191),horizontalPosition:"left",verticalPosition:"top",show:d}),M)}))}}return j.length&&S.push(t().createElement(Mo,{iconClassName:"mdi mdi-account-multiple",legend:h(254),data:j.join(", ")})),t().createElement(Lo,{pydio:i,title:i.MessageHash["share_center.50"],onDismissAction:this.props.onDismiss,onDeleteAction:function(){l&&l(),e.deleteAllShares()},onEditAction:function(){l&&l(),i.Controller.fireAction("share-edit-shared")},editTooltip:i.MessageHash["share_center.125"],deleteTooltip:i.MessageHash["share_center.composite.deleteAll"],headerSmall:"infoPanel"===o,popoverPanel:s,popoverRequestClose:l,smallActionsBottom:"infoPanel"===o&&!s,genericFlex:c},S,!S.length&&t().createElement(Mo,{placeHolder:!0}))}}])&&So(r.prototype,o),l}(t().Component),To=["pydio","node","popoverPanel","popoverRequestClose"];function Do(){return Do=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Do.apply(this,arguments)}var Ao=s().requireLib("workspaces"),Io=Ao.InfoPanelCard,Uo=Ao.MultiColumnContext,No=function(n){var r=n.pydio,o=n.node,i=n.popoverPanel,a=n.popoverRequestClose,l=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(n,To),c=((0,e.useContext)(Uo)||{}).currentPin;return o.isRoot()?t().createElement(Io,Do({popoverPanel:i,icon:"icomoon-cells",closedTitle:s().getMessages()["ajax_gui.infopanel.detailcard.cell-info"]},l),t().createElement("div",{style:{padding:0,height:c?"100%":null}},t().createElement(Mt,{cellId:r.user.activeRepository,pydio:r,mode:"infoPanel",popoverPanel:i,genericFlex:c}))):t().createElement(Io,Do({popoverPanel:i,icon:"mdi mdi-share-variant-outline",closedTitle:s().getMessages()["share_center.50"]},l),t().createElement("div",{style:{padding:0,height:c?"100%":null}},t().createElement(Co,{node:o,pydio:r,mode:"infoPanel",popoverPanel:i,popoverRequestClose:a,genericFlex:c})))},Bo=n(689),qo=n(566)({displayName:"CompositeDialog",mixins:[n(757).requireLib("boot").ActionDialogMixin],getDefaultProps:function(){return{dialogTitle:"",dialogIsModal:!0,dialogPadding:!1,dialogSize:"md+"}},propTypes:{pydio:i().instanceOf(s()).isRequired,selection:i().instanceOf(ie()),readonly:i().bool},childContextTypes:{messages:i().object,getMessage:i().func,isReadonly:i().func},getChildContext:function(){var e=this,t=this.props.pydio.MessageHash;return{messages:t,getMessage:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"share_center";try{return t[n+(n?".":"")+e]||e}catch(t){return e}},isReadonly:function(){return e.props.readonly}}},shouldComponentUpdate:function(e,t){return!!this.props.selection.getUniqueNode()},render:function(){var e,t=this.props,n=t.pydio,r=t.selection;return r.getUniqueNode()&&(e=r.getUniqueNode()),Bo.createElement(Co,{editorOneColumn:!0,pydio:n,mode:"edit",node:e,onDismiss:this.props.onDismiss})}}),Fo=n(566),Ho=n.n(Fo);const zo=require("pydio/model/node");var Vo=n.n(zo);function Wo(e){return Wo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wo(e)}function Yo(){return Yo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Yo.apply(this,arguments)}function Go(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Go(Object(n),!0).forEach((function(t){Qo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Go(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Qo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ko(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Zo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Jo(e,t,n){return t&&Zo(e.prototype,t),n&&Zo(e,n),e}function $o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ei(e,t)}function ei(e,t){return ei=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ei(e,t)}function ti(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r,o,i=ni(e);if(t){var a=ni(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return r=this,!(o=n)||"object"!==Wo(o)&&"function"!=typeof o?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r):o}}function ni(e){return ni=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ni(e)}var ri=s().requireLib("boot"),oi=ri.ActionDialogMixin,ii=ri.Loader,ai=s().requireLib("components"),si=ai.ModalAppBar,li=ai.EmptyStateView,ci=s().requireLib("hoc").ModernTextField,ui=n(173).muiThemeable,pi=function(e){$o(r,e);var n=ti(r);function r(){return Ko(this,r),n.apply(this,arguments)}return Jo(r,[{key:"render",value:function(){var e=this.props,n=e.value,r=e.onChange,o=e.muiTheme,i=e.m,a={color:"#616161"},s={color:o.palette.accent1Color},c={marginRight:5};return t().createElement(l.Tabs,{style:{width:360},onChange:function(e){r(null,0,e)},value:n,tabItemContainerStyle:{background:"transparent"}},t().createElement(l.Tab,{label:t().createElement("span",null,t().createElement("span",{style:c,className:"mdi mdi-share-variant"}),i(243)),value:"LINKS",buttonStyle:"LINKS"===n?s:a}),t().createElement(l.Tab,{label:t().createElement("span",null,t().createElement("span",{style:c,className:"icomoon-cells"}),i(254)),value:"CELLS",buttonStyle:"CELLS"===n?s:a}))}}]),r}(t().Component);pi=ui()(pi);var fi=function(e){$o(r,e);var n=ti(r);function r(e){var t;return Ko(this,r),(t=n.call(this,e)).state={resources:[],loading:!1,selectedModel:null,shareType:e.defaultShareType||"LINKS"},t}return Jo(r,[{key:"getChildContext",value:function(){var e=this.props.pydio.MessageHash;return{messages:e,getMessage:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"share_center";try{return e[n+(n?".":"")+t]||t}catch(e){return t}},isReadonly:function(){return!1}.bind(this)}}},{key:"componentDidMount",value:function(){this.load()}},{key:"load",value:function(){var e=this;this.setState({filter:""});var t=new Oe.ShareServiceApi(we().getRestClient()),n=new Oe.RestListSharedResourcesRequest;n.ShareType=Oe.ListSharedResourcesRequestListShareType.constructFromObject(this.state.shareType),this.props.subject?n.Subject=this.props.subject:n.OwnedBySubject=!0,this.setState({loading:!0}),t.listSharedResources(n).then((function(t){e.setState({resources:t.Resources||[],loading:!1})})).catch((function(){e.setState({loading:!1})}))}},{key:"getLongestPath",value:function(e){if(!e.AppearsIn)return{path:e.Path,basename:e.Path};var t={};e.AppearsIn.map((function(e){t[e.Path]=e}));var n=Object.keys(t);n.sort();var r=n[n.length-1],o=nn().getBasename(r);return o||(o=t[r].WsLabel),{path:r,appearsIn:t[r],basename:o}}},{key:"goTo",value:function(e){var t=e.Path,n=e.WsLabel,r=e.WsUuid,o=t.split("/");o.shift();var i=new(Vo())(o.join("/"));i.getMetadata().set("repository_id",r),i.getMetadata().set("repository_label",n),this.props.pydio.goTo(i),this.props.onRequestClose()}},{key:"render",value:function(){var e=this,n=this.state,r=n.loading,o=n.resources,i=n.filter,a=void 0===i?"":i,s=this.props,c=s.pydio,u=s.style,p=function(e){return c.MessageHash["share_center."+e]};o.sort((function(e,t){var n=e.Node.Path,r=t.Node.Path;return n===r?0:n>r?1:-1}));var f=c.Registry.getFilesExtensions();return t().createElement("div",{style:Xo(Xo({},u),{},{display:"flex",flexDirection:"column",overflow:"hidden"})},t().createElement("div",{style:{backgroundColor:"#F5F5F5",borderBottom:"1px solid #EEEEEE",display:"flex",paddingRight:16,paddingTop:3}},t().createElement(pi,{m:p,value:this.state.shareType,onChange:function(t,n,r){e.setState({shareType:r},(function(){e.load()}))}}),t().createElement("span",{style:{flex:1}}),t().createElement("div",{style:{width:150}},t().createElement(ci,{hintText:p("sharelist.quick-filter"),value:a,onChange:function(t,n){e.setState({filter:n})},fullWidth:!0}))),r&&t().createElement(ii,{style:{height:400}}),!r&&0===o.length&&t().createElement(li,{pydio:c,iconClassName:"mdi mdi-share-variant",primaryTextId:p(131),style:{flex:1,height:400,padding:"90px 0",backgroundColor:"transparent"}}),!r&&o.length>0&&t().createElement(l.List,{style:{flex:1,minHeight:400,maxHeight:400,overflowY:"auto",paddingTop:0}},o.map((function(t){var n,r=e.getLongestPath(t.Node),o=r.appearsIn,i=r.basename;if(-1===i.indexOf("."))n="mdi mdi-folder";else{var a=nn().getFileExtension(i);n=f.has(a)?"mdi mdi-"+f.get(a).fontIcon:"mdi mdi-file"}return t.Link&&t.Link.Label&&t.Link.Label!==i&&(i=t.Link.Label+" ("+i+")"),{primaryText:i,secondaryText:t.Link?p(251)+": "+t.Link.Description:p(284).replace("%s",t.Cells.length),icon:n,appearsIn:o}})).filter((function(e){return!a||-1!==e.primaryText.toLowerCase().indexOf(a.toLowerCase())})).map((function(n){var r=n.appearsIn,o=n.icon;return t().createElement(l.ListItem,{primaryText:n.primaryText,secondaryText:n.secondaryText,onClick:function(){r&&e.goTo(r)},disabled:!r,leftIcon:t().createElement(l.FontIcon,{className:o})})}))))}}]),r}(t().Component);fi.childContextTypes={messages:i().object,getMessage:i().func,isReadonly:i().func};var di=Ho()({displayName:"ShareViewModal",mixins:[oi],getDefaultProps:function(){return{dialogTitle:"",dialogSize:"lg",dialogPadding:!1,dialogIsModal:!1,dialogScrollBody:!1}},submit:function(){this.dismiss()},render:function(){var e=this;return t().createElement("div",{style:{width:"100%",display:"flex",flexDirection:"column"}},t().createElement(si,{title:this.props.pydio.MessageHash["share_center.98"],showMenuIconButton:!1,iconClassNameRight:"mdi mdi-close",onRightIconButtonClick:function(){e.dismiss()}}),t().createElement(fi,Yo({},this.props,{style:{width:"100%",flex:1},onRequestClose:function(){e.dismiss()}})))}}),yi=n(962),hi=n.n(yi),mi=n(932),gi=n.n(mi),bi=n(978),vi=n.n(bi),wi=n(840),Oi=n.n(wi),Ei=n(728),ki=n.n(Ei),Pi=n(208),Si=n.n(Pi),ji=n(624),xi={};xi.styleTagTransform=Si(),xi.setAttributes=Oi(),xi.insert=vi().bind(null,"head"),xi.domAPI=gi(),xi.insertStyleElement=ki(),hi()(ji.Z,xi),ji.Z&&ji.Z.locals&&ji.Z.locals})(),window.ShareDialog=r})();