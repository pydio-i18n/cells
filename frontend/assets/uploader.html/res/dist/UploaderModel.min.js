/*! For license information please see UploaderModel.min.js.LICENSE.txt */
(()=>{var t={233:function(t,e){var r,n;function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}void 0===(n="function"==typeof(r=function(){"use strict";var t=function(){this._listeners={}};t.prototype.addEventListener=function(t,e){this._listeners[t]=this._listeners[t]||[],this._listeners[t].indexOf(e)<0&&this._listeners[t].push(e)},t.prototype.removeEventListener=function(t,e){if(this._listeners[t]){var r=this._listeners[t].indexOf(e);r>=0&&this._listeners[t].splice(r,1)}},t.prototype.dispatchEvent=function(t){if(this._listeners[t.type]&&this._listeners[t.type].length)for(var e=this._listeners[t.type].slice(),r=0,n=e.length;r<n;++r)e[r].call(this,t)};var e=function(t){var e=!1;return{next:function(){return e?{done:!0}:(e=!0,{value:t})}}},r=function(t,e,r){this.target=t,this.type=e,this.data=r},n=function(r,n,i){if(t.call(this),"number"!=typeof n||Math.floor(n)!==n||n<1)throw new Error("Invalid concurrency");this._concurrency=n,this._options=i||{},this._options.promise=this._options.promise||Promise,this._iterator=function(t,r){var n,i=o(t);if("object"===i){if("function"==typeof t.next)return t;if("function"==typeof t.then)return e(t)}return"function"===i?"function"==typeof(n=t).constructor&&"GeneratorFunction"===n.constructor.name?t():function(t){return{next:function(){var e=t();return e?{value:e}:{done:!0}}}}(t):e(r.resolve(t))}(r,this._options.promise),this._done=!1,this._size=0,this._promise=null,this._callbacks=null};return(n.prototype=new t).constructor=n,n.prototype.concurrency=function(t){return void 0!==t&&(this._concurrency=t,this.active()&&this._proceed()),this._concurrency},n.prototype.size=function(){return this._size},n.prototype.active=function(){return!!this._promise},n.prototype.promise=function(){return this._promise},n.prototype.start=function(){var t=this,e=this._options.promise;return this._promise=new e((function(e,r){t._callbacks={reject:r,resolve:e},t._proceed()})),this._promise},n.prototype._fireEvent=function(t,e){this.dispatchEvent(new r(this,t,e))},n.prototype._settle=function(t){t?this._callbacks.reject(t):this._callbacks.resolve(),this._promise=null,this._callbacks=null},n.prototype._onPooledPromiseFulfilled=function(t,e){this._size--,this.active()&&(this._fireEvent("fulfilled",{promise:t,result:e}),this._proceed())},n.prototype._onPooledPromiseRejected=function(t,e){this._size--,this.active()&&(this._fireEvent("rejected",{promise:t,error:e}),this._settle(e||new Error("Unknown error")))},n.prototype._trackPromise=function(t){var e=this;t.then((function(r){e._onPooledPromiseFulfilled(t,r)}),(function(r){e._onPooledPromiseRejected(t,r)})).catch((function(t){e._settle(new Error("Promise processing failed: "+t))}))},n.prototype._proceed=function(){if(!this._done){for(var t={done:!1};this._size<this._concurrency&&!(t=this._iterator.next()).done;)this._size++,this._trackPromise(t.value);this._done=null===t||!!t.done}this._done&&0===this._size&&this._settle()},n.PromisePoolEvent=r,n.PromisePool=n,n})?r.apply(e,[]):r)||(t.exports=n)}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n].call(i.exports,i,i.exports,r),i.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};(()=>{"use strict";r.r(n),r.d(n,{Configs:()=>I,FolderItem:()=>et,PartItem:()=>D,Session:()=>ht,Store:()=>wt,UploadItem:()=>V});const t=require("pydio");var e=r.n(t);const o=require("pydio/util/lang");var i=r.n(o);const s=require("pydio/util/path");var a=r.n(s);const u=require("pydio/lang/observable");var c=r.n(u);const l=require("cells-sdk");function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function p(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return h(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function y(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,d(n.key),n)}}function d(t){var e=function(t){if("object"!=f(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=f(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==f(e)?e:e+""}function v(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(v=function(){return!!t})()}function g(t){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},g(t)}function b(t,e){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},b(t,e)}var m=function(t){function r(t,n){var o,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(o=function(t,e,r){return e=g(e),function(t,e){if(e&&("object"==f(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,v()?Reflect.construct(e,r||[],g(t).constructor):e.apply(t,r))}(this,r))._status=r.StatusNew,o._type=t,o._id=Math.random(),o._errorMessage=null;var s=e().getInstance();return o._repositoryId=i?i.getRepositoryId():s.user.activeRepository,o._exists=!1,o._progress=0,o.children={folders:[],files:[],pg:{}},o._targetNode=n,i&&(o._parent=i,t===r.TypeFolder?i.children.folders.push(o):i.children.files.push(o)),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&b(t,e)}(r,t),n=r,o=[{key:"getId",value:function(){return this._id}},{key:"getParent",value:function(){return this._parent}},{key:"getLabel",value:function(){return this._label&&this._label.normalize?this._label.normalize("NFC"):this._label}},{key:"updateTargetNode",value:function(t){this._targetNode=t}},{key:"getTargetNode",value:function(){return this._targetNode}},{key:"updateLabel",value:function(t){this._label=t,this.notify("update_label",t)}},{key:"getFullPath",value:function(){return this._parent.getFullPath()+"/"+this.getLabel()}},{key:"getProgress",value:function(){return this._progress}},{key:"setExists",value:function(){this._exists=!0}},{key:"getExists",value:function(){return this._exists}},{key:"getType",value:function(){return this._type}},{key:"getStatus",value:function(){return this._status}},{key:"setStatus",value:function(t){this._status=t,this.notify("status",t)}},{key:"updateRepositoryId",value:function(t){this._repositoryId=t}},{key:"getRepositoryId",value:function(){return this._repositoryId}},{key:"getErrorMessage",value:function(){return this._errorMessage||""}},{key:"onError",value:function(t){this._errorMessage=t,this.setStatus(r.StatusError)}},{key:"process",value:function(t){this._doProcess(t)}},{key:"abort",value:function(t){this._doAbort&&this._doAbort(t)}},{key:"pause",value:function(){if(this._doPause){var t=this._doPause();this.setStatus(t)}}},{key:"resume",value:function(){this._doResume&&(this._doResume(),this.setStatus(r.StatusLoading))}},{key:"addChild",value:function(t){var e=this;this.children.pg[t.getId()]=0,t.observe("progress",(function(r){e.children.pg[t.getId()]=r,e.recomputeProgress()})),this.notify("child_added")}},{key:"recomputeProgress",value:function(){var t=this,e=Object.keys(this.children.pg).map((function(e){return t.children.pg[e]}));if(e.length){var r=e.reduce((function(t,e){return t+e}));this._progress=r/e.length,this.notify("progress",this._progress)}}},{key:"removeChild",value:function(t){t.abort(),t.walk((function(t){t.abort()}),(function(){return!0}),r.TypeFile);var e=t.getId(),n=this.children.folders.indexOf(t),o=this.children.files.indexOf(t),i=!1;n>-1?(this.children.folders=LangUtils.arrayWithout(this.children.folders,n),i=!0):o>-1&&(this.children.files=LangUtils.arrayWithout(this.children.files,o),i=!0),i&&(t.stopObserving("progress"),delete this.children.pg[e],this.recomputeProgress(),this.notify("children"))}},{key:"getChildren",value:function(){return[].concat(p(this.children.folders),p(this.children.files))}},{key:"walk",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.TypeBoth,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){return!1},i=!1;if(n===r.TypeBoth||n===r.TypeFile)for(var s=this.children.files,a=0;a<s.length;a++){if(o(s[a])){i=!0;break}e(s[a])&&t(s[a])}i||this.children.folders.forEach((function(i){n!==r.TypeFolder&&n!==r.TypeBoth||!e(i)||t(i),o(i)||i.walk(t,e,n,o)}))}},{key:"collectWithLimit",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"both",n=[];return this.walk((function(t){n.push(t)}),e,r,(function(e){return n.length>=t})),n}}],o&&y(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o}(c());function _(t){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_(t)}function S(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,w(n.key),n)}}function w(t){var e=function(t){if("object"!=_(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=_(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==_(e)?e:e+""}m.StatusNew="new",m.StatusAnalyze="analyse",m.StatusFolders="folders",m.StatusLoading="loading",m.StatusLoaded="loaded",m.StatusError="error",m.StatusPause="pause",m.StatusCannotPause="cannot-pause",m.StatusMultiPause="multi-pause",m.TypeFolder="folder",m.TypeFile="file",m.TypeBoth="both";var P=e().requireLib("boot").JobsStore,k=function(){function t(r){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var o=e().getInstance();this.job=new l.JobsJob,this.job.ID="local-upload-task-"+r.getId(),this.job.Owner=o.user.id;var i=function(t){return o.MessageHash["html_uploader.task."+t]||t};this.job.Label=i("label"),this.job.Stoppable=!0;var s=new l.JobsTask;this.task=s,this.job.Tasks=[this.task],this.task.HasProgress=!0,this.task.ID="upload",this.task.Status=l.JobsTaskStatus.constructFromObject("Idle"),this.job.openDetailPane=function(){o.Controller.fireAction("upload")},s._statusObserver=function(t){if(t===m.StatusFolders&&r.getCreateFolders()){n.job.Label=i("status.folders");var e=r.getCreateFolders();s.StatusMessage=e>1?i("message.folder-many").replace("%s",e):i("message.folder-one"),s.Status=l.JobsTaskStatus.constructFromObject("Running")}else if(t===m.StatusAnalyze){n.job.Label=i("status.analyse");var o=r.getChildren().length;s.StatusMessage=o>1?i("message.analyse-many").replace("%s",o):i(1===o?"message.analyse-one":"message.analyse-wait"),s.Status=l.JobsTaskStatus.constructFromObject("Running")}else"ready"===t?(n.job.Label=i("7"),s.StatusMessage=i("status.ready"),s.Status=l.JobsTaskStatus.constructFromObject("Idle")):"paused"===t?(n.job.Label=i("status.paused"),s.Status=l.JobsTaskStatus.constructFromObject("Paused")):"loading"===t&&(n.job.Label=i("status.upload"),s.Status=l.JobsTaskStatus.constructFromObject("Running"));n.notifyMainStore()},s._progressObserver=function(t){n.job.Label=i("status.upload"),s.Progress=t/100,s.Status=l.JobsTaskStatus.constructFromObject("Running"),t>0&&(s.StatusMessage=i("message.upload-progress").replace("%s",Math.ceil(t))),n.notifyMainStore()},r.observe("status",s._statusObserver),r.observe("progress",s._progressObserver),s._statusObserver(r.getStatus()),s._progressObserver(r.getProgress()),P.getInstance().enqueueLocalJob(this.job)}return r=t,o=[{key:"create",value:function(e){return new t(e)}}],(n=[{key:"setIdle",value:function(){1!==this.task.Progress?(this.task.Status=l.JobsTaskStatus.constructFromObject("Idle"),this.task.StatusMessage="",this.notifyMainStore()):P.getInstance().deleteLocalJob(this.job.ID)}},{key:"notifyMainStore",value:function(){1!==this.task.Progress&&(this.task.StartTime=(new Date).getTime()/1e3,this.job.Tasks=[this.task],P.getInstance().enqueueLocalJob(this.job))}}])&&S(r.prototype,n),o&&S(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o}();function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}function E(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,j(n.key),n)}}function j(t){var e=function(t){if("object"!=O(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=O(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==O(e)?e:e+""}function T(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(T=function(){return!!t})()}function x(t){return x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},x(t)}function L(t,e){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},L(t,e)}var I=function(t){function r(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),t=function(t,e,r){return e=x(e),function(t,e){if(e&&("object"==O(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,T()?Reflect.construct(e,r||[],x(t).constructor):e.apply(t,r))}(this,r),e().getInstance().observe("registry_loaded",function(){this._global=null}.bind(t)),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&L(t,e)}(r,t),n=r,o=[{key:"_loadOptions",value:function(){this._global||(this._global=e().getInstance().getPluginConfigs("uploader"))}},{key:"getOptionAsBool",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=this.getOption(t,e,r);return!0===n||"true"===n}},{key:"getOption",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(this._loadOptions(),e){var o=r.getUserPreference(e);if(null!=o)return o}return this._global.has(t)?this._global.get(t):void 0!==n?n:null}},{key:"getAutoStart",value:function(){return this.getOptionAsBool("DEFAULT_AUTO_START","upload_auto_send")}},{key:"getAutoClose",value:function(){return this.getOptionAsBool("DEFAULT_AUTO_CLOSE","upload_auto_close")}},{key:"updateOption",value:function(t,e){arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&(e=e?"true":"false"),r.setUserPreference(t,e),this.notify("change")}},{key:"extensionAllowed",value:function(t){var r=this.getOption("ALLOWED_EXTENSIONS","","");if(r){var n=this.getOption("ALLOWED_EXTENSIONS_READABLE","","");n&&(n=" ("+n+")");var o=a().getFileExtension(t.getLabel());if(-1===r.split(",").indexOf(o))throw new Error(e().getInstance().MessageHash[367]+r+n)}}}],i=[{key:"getInstance",value:function(){return r.__INSTANCE||(r.__INSTANCE=new r),r.__INSTANCE}},{key:"getUserPreference",value:function(t){var r=e().getInstance();return r.user?r.user.getLayoutPreference("Uploaders.Html."+t):null}},{key:"setUserPreference",value:function(t,r){var n=e().getInstance();n&&n.user&&n.user.setLayoutPreference("Uploaders.Html."+t,r)}}],o&&E(n.prototype,o),i&&E(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o,i}(c());function N(t){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},N(t)}function R(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,C(n.key),n)}}function C(t){var e=function(t){if("object"!=N(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=N(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==N(e)?e:e+""}function A(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(A=function(){return!!t})()}function F(t){return F=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},F(t)}function M(t,e){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},M(t,e)}var D=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=function(t,e,r){return e=F(e),function(t,e){if(e&&("object"==N(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,A()?Reflect.construct(e,r||[],F(t).constructor):e.apply(t,r))}(this,e,["part",null,t]))._label="Part "+r,n._retry=0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&M(t,e)}(e,t),r=e,n=[{key:"setRetry",value:function(t){this._retry=t}},{key:"getRetry",value:function(){return this._retry||0}},{key:"setProgress",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._progress=t,this.notify("progress",t),null!==e&&this.notify("bytes",e)}}],n&&R(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(m);const z=require("pydio/http/api");var B=r.n(z);function U(t){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U(t)}function q(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,G(n.key),n)}}function G(t){var e=function(t){if("object"!=U(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=U(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==U(e)?e:e+""}function J(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(J=function(){return!!t})()}function H(){return H="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=W(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},H.apply(null,arguments)}function W(t){return W=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},W(t)}function X(t,e){return X=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},X(t,e)}var V=function(t){function r(t,e){var n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(n=function(t,e,r){return e=W(e),function(t,e){if(e&&("object"==U(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,J()?Reflect.construct(e,r||[],W(t).constructor):e.apply(t,r))}(this,r,["file",e,i]))._file=t,n._status="new",n._userMeta=s,n._label=o?a().getBasename(o):t.name,t.size>B().getMultipartThreshold()&&n.createParts(),i&&i.addChild(n),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&X(t,e)}(r,t),n=r,o=[{key:"createParts",value:function(){var t=B().getMultipartPartSize();this._parts=[];for(var e=0;e<Math.ceil(this._file.size/t);e++)this._parts.push(new D(this,e+1))}},{key:"setRetry",value:function(t){this._retry=t}},{key:"getRetry",value:function(){return this._retry||0}},{key:"onError",value:function(t){var e,n,o;(e=r,n=this,"function"==typeof(o=H(W(1&3?e.prototype:e),"onError",n))?function(t){return o.apply(n,t)}:o)([t]),this._parts&&this._parts.filter((function(t){return t.getStatus()===m.StatusLoading})).forEach((function(e){return e.onError(t)}))}},{key:"getFile",value:function(){return this._file}},{key:"getSize",value:function(){return this._file.size}},{key:"getHumanSize",value:function(){return a().roundFileSize(this._file.size)}},{key:"setProgress",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._progress=t,this.notify("progress",t),null!==e&&this.notify("bytes",e)}},{key:"_parseXHRResponse",value:function(){this.xhr&&this.xhr.responseText&&"OK"!==this.xhr.responseText&&this.onError("Unexpected response: "+this.xhr.responseText)}},{key:"_doProcess",value:function(t){var r=this;this._userAborted=!1;var n=function(){r.setStatus(m.StatusLoaded),r._parseXHRResponse(),t()},o=function(t){if(r._status!==m.StatusError&&t.total){var e=Math.round(100*t.loaded/t.total),n=t.loaded;if(r.setProgress(e,n),r._parts&&t.part&&r._parts[t.part-1]&&t.partLoaded&&t.partTotal){var o=r._parts[t.part-1],i=Math.round(100*t.partLoaded/t.partTotal);if(t.error)o.onError(t.error.message),o.setProgress(0,0);else if(i<100)o.getStatus()!==m.StatusCannotPause&&(o.setStatus(m.StatusLoading),o.setRetry(t.partRetry));else{var s=o.getStatus()===m.StatusCannotPause;o.setStatus(m.StatusLoaded),s&&0===r._parts.filter((function(t){return o.getStatus()===m.StatusCannotPause})).length&&r.setStatus(m.StatusPause)}o.setProgress(i,t.partLoaded)}}},i=e().getMessages(),s=function(e){r.onError(i[210]+": "+e.message),t()},a=function(t){return r.setRetry(t-1),function(e){if(e&&e.indexOf){if(e.indexOf("422")>=0)return void s(new Error(i["html_uploader.status.error.422"]+" (422)"));if(e.indexOf("403")>=0)return void s(new Error(i["html_uploader.status.error.403"]+" (403)"))}r._userAborted?s(e||new Error(i["html_uploader.status.error.aborted"])):t>=2?s(e):window.setTimeout((function(){r.uploadPresigned(n,o,a(++t))}),150*t)}};this.setStatus(m.StatusLoading),addEventListener("unload",(function(){r._status===m.StatusLoading&&(console.error("Page unloaded during upload, try to abort upload!"),r._doAbort())}));try{I.getInstance().extensionAllowed(this)}catch(e){return this.onError(e.message),void t()}a(0)()}},{key:"_doAbort",value:function(t){if(this._status!==m.StatusLoaded){if(this.xhr)try{this._userAborted=!0,this.xhr.abort()}catch(t){}this.setStatus(m.StatusError),this.setProgress(0)}}},{key:"_doPause",value:function(){return this.xhr?this.xhr.pause?(this.xhr.pause(),this._parts&&this._parts.length&&this._parts.filter((function(t){return t.getStatus()===m.StatusLoading})).forEach((function(t){return t.setStatus(m.StatusCannotPause)})),m.StatusMultiPause):m.StatusCannotPause:m.StatusNew}},{key:"_doResume",value:function(){this.xhr&&this.xhr.resume&&this.xhr.resume()}},{key:"uploadPresigned",value:function(t,e,r){var n,o=this;try{n=this.getFullPath()}catch(t){return this.setStatus(m.StatusError),void this.setProgress(0)}this.getSize()<B().getMultipartThreshold()?B().getClient().uploadPresigned(this._file,n,t,r,e,this._userMeta).then((function(t){o.xhr=t})):B().getClient().uploadMultipart(this._file,n,t,r,e,this._userMeta).then((function(t){o.xhr=t}))}}],o&&q(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o}(m);function Y(t){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y(t)}function K(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Q(n.key),n)}}function Q(t){var e=function(t){if("object"!=Y(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Y(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Y(e)?e:e+""}function $(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return($=function(){return!!t})()}function Z(t){return Z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Z(t)}function tt(t,e){return tt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tt(t,e)}var et=function(t){function e(t,r){var n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=function(t,e,r){return e=Z(e),function(t,e){if(e&&("object"==Y(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,$()?Reflect.construct(e,r||[],Z(t).constructor):e.apply(t,r))}(this,e,["folder",r,o]))._new=!0,n._label=a().getBasename(t),n.children.pg[n.getId()]=0,o&&o.addChild(n),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tt(t,e)}(e,t),r=e,(n=[{key:"isNew",value:function(){return this._new}},{key:"setIgnore",value:function(){this.setStatus(m.StatusLoaded),this.children.pg[this.getId()]=100,this.recomputeProgress(),this._new=!1}},{key:"_doProcess",value:function(t){var e=this;if(this._new){var r;try{r=this.getFullPath()}catch(t){return void this.setStatus(m.StatusError)}var n=new l.TreeServiceApi(B().getRestClient()),o=new l.RestCreateNodesRequest,i=new l.TreeNode;i.Path=r,i.Type=l.TreeNodeType.constructFromObject("COLLECTION"),o.Nodes=[i],n.createNodes(o).then((function(r){e.setStatus(m.StatusLoaded),e.children.pg[e.getId()]=100,e.recomputeProgress(),t()}))}else t()}}])&&K(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(m),rt=r(233),nt=r.n(rt);function ot(t){return ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ot(t)}function it(){it=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,s=Object.create(i.prototype),a=new L(n||[]);return o(s,"_invoke",{value:E(t,r,a)}),s}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var p="suspendedStart",h="suspendedYield",y="executing",d="completed",v={};function g(){}function b(){}function m(){}var _={};c(_,s,(function(){return this}));var S=Object.getPrototypeOf,w=S&&S(S(I([])));w&&w!==r&&n.call(w,s)&&(_=w);var P=m.prototype=g.prototype=Object.create(_);function k(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(o,i,s,a){var u=f(t[o],t,i);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==ot(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,s,a)}),(function(t){r("throw",t,s,a)})):e.resolve(l).then((function(t){c.value=t,s(c)}),(function(t){return r("throw",t,s,a)}))}a(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function E(e,r,n){var o=p;return function(i,s){if(o===y)throw Error("Generator is already running");if(o===d){if("throw"===i)throw s;return{value:t,done:!0}}for(n.method=i,n.arg=s;;){var a=n.delegate;if(a){var u=j(a,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var c=f(e,r,n);if("normal"===c.type){if(o=n.done?d:h,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=d,n.method="throw",n.arg=c.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var s=i.arg;return s?s.done?(r[e.resultName]=s.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[s];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ot(e)+" is not iterable")}return b.prototype=m,o(P,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:b,configurable:!0}),b.displayName=c(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,c(t,u,"GeneratorFunction")),t.prototype=Object.create(P),t},e.awrap=function(t){return{__await:t}},k(O.prototype),c(O.prototype,a,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var s=new O(l(t,r,n,o),i);return e.isGeneratorFunction(r)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},k(P),c(P,u,"Generator"),c(P,s,(function(){return this})),c(P,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(x),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],a=s.completion;if("root"===s.tryLoc)return o("end");if(s.tryLoc<=this.prev){var u=n.call(s,"catchLoc"),c=n.call(s,"finallyLoc");if(u&&c){if(this.prev<s.catchLoc)return o(s.catchLoc,!0);if(this.prev<s.finallyLoc)return o(s.finallyLoc)}else if(u){if(this.prev<s.catchLoc)return o(s.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return o(s.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=t,s.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),x(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;x(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function st(t,e,r,n,o,i,s){try{var a=t[i](s),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,o)}function at(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function s(t){st(i,n,o,s,a,"next",t)}function a(t){st(i,n,o,s,a,"throw",t)}s(void 0)}))}}function ut(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ct(n.key),n)}}function ct(t){var e=function(t){if("object"!=ot(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=ot(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ot(e)?e:e+""}function lt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(lt=function(){return!!t})()}function ft(t){return ft=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ft(t)}function pt(t,e){return pt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},pt(t,e)}var ht=function(t){function r(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(n=function(t,e,r){return e=ft(e),function(t,e){if(e&&("object"==ot(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,lt()?Reflect.construct(e,r||[],ft(t).constructor):e.apply(t,r))}(this,r,["/",e]))._repositoryId=t,n._status=m.StatusAnalyze,delete n.children.pg[n.getId()],n._analyzeStatus="",n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pt(t,e)}(r,t),n=r,o=[{key:"getAnalyzeStatus",value:function(){return this._analyzeStatus}},{key:"setAnalyzeStatus",value:function(t){this._analyzeStatus=t,this.notify("status",this._status)}},{key:"setCreateFolders",value:function(t){this._createFoldersStatus=t}},{key:"getCreateFolders",value:function(){return this._createFoldersStatus}},{key:"getFullPath",value:function(){var t=e().getInstance().user.getRepositoriesList();if(!t.has(this._repositoryId))throw new Error("Repository disconnected?");var r=t.get(this._repositoryId).getSlug(),n=this._targetNode.getPath();return(n=i().trimRight(n,"/")).normalize&&(n=n.normalize("NFC")),r+n}},{key:"treeViewFromMaterialPath",value:function(t){var e=[];return Object.keys(t).forEach((function(r){var n=r.split("/");n.shift();var o=e;n.forEach((function(e){var n=o.find((function(t){return t.name===e}));if(n)o=n.children;else{var i={name:e,item:t[r],path:r,children:[]};o.push(i),o=i.children}}))})),e}},{key:"bulkStatSliced",value:function(t,e,r){this.setAnalyzeStatus("checking "+e.length+" items");for(var n=Promise.resolve({Nodes:[]}),o=e.slice(0,r),i=function(){e=e.slice(r);var i=new l.RestGetBulkMetaRequest;i.NodePaths=o,n=n.then((function(e){return t.bulkStatNodes(i).then((function(t){return e.Nodes=e.Nodes.concat(t.Nodes||[]),e}))})),o=e.slice(0,r)};o.length;)i();return n}},{key:"prepare",value:function(t){var r=this;if("overwrite"===t)return this.setStatus("ready"),Promise.resolve();var n=e().getInstance().getPluginConfigs("uploader.html").get("DEFAULT_STAT_SLICES"),o=400;n&&!isNaN(parseInt(n))&&(o=parseInt(n)),this.setStatus(m.StatusAnalyze);var i=new l.TreeServiceApi(B().getRestClient()),s=new l.RestGetBulkMetaRequest;return s.NodePaths=[],this.walk((function(t){s.NodePaths.push(t.getFullPath())}),(function(){return!0}),"both"),new Promise((function(e,n){var u=[];r.bulkStatSliced(i,s.NodePaths,o).then((function(n){if(!n.Nodes||!n.Nodes.length)return r.setStatus("ready"),void e(u);if("alert"===t)return r.setStatus("confirm"),void e();var o,i=function(t){return-1!==n.Nodes.map((function(t){return t.Path})).indexOf(t.getFullPath())};if(o=function(){var t=[];r.walk((function(e){i(e)&&t.push(e)}),(function(){return!0}),"file");var e=new(nt())((function(){if(!t.length)return null;var e=t.pop();return new Promise(function(){var t=at(it().mark((function t(n){var o,i;return it().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.newPath(e.getFullPath());case 2:o=t.sent,i=a().getBasename(o),e.updateLabel(i),r.setAnalyzeStatus("checking "+i),n();case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}),5);return e.start()},"rename-folders"===t){var s=Promise.resolve();r.walk((function(t){s=s.then(at(it().mark((function e(){var n,o;return it().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i(t)){e.next=7;break}return e.next=3,r.newPath(t.getFullPath(),!0);case 3:n=e.sent,o=a().getBasename(n),t.updateLabel(o),r.setAnalyzeStatus("checking "+o);case 7:case"end":return e.stop()}}),e)}))))}),(function(){return!0}),"folder"),s.then((function(){return o()})).then((function(t){r.setStatus("ready"),e(t)}))}else r.walk((function(t){i(t)&&t.setIgnore&&t.setIgnore()}),(function(){return!0}),"folder"),o().then((function(t){r.setStatus("ready"),e(t)}))}))}))}},{key:"newPath",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(){var n=at(it().mark((function n(o){var i,s,a,u,c,l,f;return it().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:i=t,s="",r||(a=t.lastIndexOf("/"),(u=t.lastIndexOf("."))>-1&&a<u&&u>a+1&&(i=t.substring(0,u),s=t.substring(u))),c=t,l=1,f=!0;case 6:if(!f){n.next=14;break}return c=i+"-"+l+s,l++,n.next=11,e.nodeExists(c);case 11:f=n.sent,n.next=6;break;case 14:o(c);case 15:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}())}},{key:"nodeExists",value:function(t){return new Promise((function(e){var r=new l.TreeServiceApi(B().getRestClient()),n=new l.RestGetBulkMetaRequest;n.NodePaths=[t],r.bulkStatNodes(n).then((function(t){t.Nodes&&t.Nodes[0]?e(!0):e(!1)})).catch((function(){return e(!1)}))}))}}],o&&ut(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o}(et);const yt=require("pydio/model/meta-node-provider");var dt=r.n(yt);function vt(t){return vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vt(t)}function gt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,bt(n.key),n)}}function bt(t){var e=function(t){if("object"!=vt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=vt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==vt(e)?e:e+""}function mt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(mt=function(){return!!t})()}function _t(t){return _t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_t(t)}function St(t,e){return St=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},St(t,e)}var wt=function(t){function r(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(t=function(t,e,r){return e=_t(e),function(t,e){if(e&&("object"==vt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,mt()?Reflect.construct(e,r||[],_t(t).constructor):e.apply(t,r))}(this,r))._processing=[],t._sessions=[],t._blacklist=[".ds_store",".pydio"],t._pauseRequired=!1,dt().RegisterLoaderHook("uploads",(function(e){t._sessions.forEach((function(r){t.sessionToNodes(r,e)}))})),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&St(t,e)}(r,t),n=r,o=[{key:"getAutoStart",value:function(){return I.getInstance().getAutoStart()}},{key:"makeStatusString",value:function(t){var r="html_uploader.status."+("file"===t.getType()?"file":"dir")+"."+t.getStatus();return e().getMessages()[r]||r}},{key:"createNode",value:function(t,e){var r=new l.TreeNode;return r.Path=i().trim(e,"/"),r.Type="file"===t.getType()?"LEAF":"COLLECTION",t.getSize&&(r.Size=t.getSize()),r.MTime=Math.round(new Date/1e3),r.MetaStore={"local:entryDescription":'"'+this.makeStatusString(t)+'"',"local:UploadStatus":'"'+t.getStatus()+'"',"local:UploadProgress":t.getProgress()||0},dt().parseTreeNode(r)}},{key:"sessionToNodes",value:function(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===n&&(n=t.getTargetNode());var o=e().getInstance().user.getActiveRepositoryObject(),s=n.getPath();t.walk((function(t){var e=function(t){return(s+"/"+t.getLabel()).replace("//","/")},o=e(t);n.findChildByPath(o)||t.getStatus()===m.StatusLoaded||t.getStatus()===m.StatusError||n.addChild(r.createNode(t,o)),t.observe("update_label",(function(o){var i=r.createNode(t,e(t));n.addChild(i)})),t.observe("progress",(function(o){var i=n.findChildByPath(e(t));i||(i=r.createNode(t,e(t)),n.addChild(i)),"file"===t.getType()&&i.getMetadata().get("local:UploadProgress")!==o&&(i.getMetadata().set("local:entryDescription",r.makeStatusString(t)),i.getMetadata().set("local:UploadStatus",t.getStatus()),i.getMetadata().set("local:UploadProgress",o),i.setMetadata(i.getMetadata(),!0))})),t.observe("status",(function(o){var i=n.findChildByPath(e(t));i&&(o===m.StatusLoaded?(i.getMetadata().delete("local:entryDescription"),i.getMetadata().delete("local:UploadStatus"),i.getMetadata().delete("local:UploadProgress")):(i.getMetadata().set("local:UploadStatus",o),i.getMetadata().set("local:entryDescription",r.makeStatusString(t))),i.setMetadata(i.getMetadata(),!0)),t.getStatus()===m.StatusError&&setTimeout((function(){var r=n.findChildByPath(e(t));r&&r.getParent()&&!r.getMetadata().has("uuid")&&r.getParent().removeChild(r)}),1500)}))}),(function(t){var e=i().trim(o.getSlug()+n.getPath(),"/"),r=a().getDirname(t.getFullPath());return o.getId()===t.getRepositoryId()&&r===e}))}},{key:"pushSession",value:function(t){var e=this;this._sessions.push(t),t.Task=k.create(t),t.observe("update",(function(){e.notify("update")})),t.observe("children",(function(){0===t.getChildren().length&&e.removeSession(t),e.sessionToNodes(t),e.notify("update")})),t.observe("child_added",(function(){e.sessionToNodes(t)})),this.notify("update"),t.observe("status",(function(t){if("ready"===t){var n=e.getAutoStart();!n||e._processing.length||e._pauseRequired?n||r.openUploadDialog():e.processNext()}else"confirm"===t&&r.openUploadDialog(!0)})),this.notify("session_added",t)}},{key:"removeSession",value:function(t){t.Task.setIdle();var e=this._sessions.indexOf(t);this._sessions=i().arrayWithout(this._sessions,e),this.notify("update")}},{key:"log",value:function(){}},{key:"hasQueue",value:function(){var t=0;return this._sessions.forEach((function(e){e.walk((function(){t++}),(function(t){return t.getStatus()===m.StatusNew||t.getStatus()===m.StatusPause||t.getStatus()===m.StatusMultiPause}),"both",(function(){return t>=1}))})),t>0}},{key:"hasErrors",value:function(){var t=0;return this._sessions.forEach((function(e){e.walk((function(){t++}),(function(t){return"error"===t.getStatus()}),"both",(function(){return t>=1}))})),t>0}},{key:"clearAll",value:function(){var t=this;this.clearStatus("new"),this._sessions.forEach((function(e){e.walk((function(t){t.getParent().removeChild(t)})),e.Task.setIdle(),t.removeSession(e)})),this._pauseRequired=!1,this.notify("update")}},{key:"clearStatus",value:function(t){this._sessions.forEach((function(e){e.walk((function(t){t.getParent().removeChild(t)}),(function(e){return e.getStatus()===t}),m.TypeFile),e.walk((function(t){t.getParent().removeChild(t)}),(function(t){var e=0;return t.walk((function(){e++}),(function(){return!0}),m.TypeFile),0===e}),m.TypeFolder)}))}},{key:"monitorProcessing",value:function(t){var e=this;this._processingMonitor||(this._processingMonitor=function(){e.notify("update")}),t.observe("status",this._processingMonitor),this._processing.push(t)}},{key:"unmonitorProcessing",value:function(t){var e=this._processing.indexOf(t);e>-1&&(this._processingMonitor&&t.stopObserving("status",this._processingMonitor),this._processing=i().arrayWithout(this._processing,e))}},{key:"processNext",value:function(){var t=this,e=this.getFolders();if(e.length&&!this._pauseRequired){var n=new l.TreeServiceApi(B().getRestClient()),o=new l.RestCreateNodesRequest;return o.Nodes=[],e.forEach((function(e){var r=new l.TreeNode;r.Path=e.getFullPath(),r.Type=l.TreeNodeType.constructFromObject("COLLECTION"),o.Nodes.push(r),e.setStatus(m.StatusLoading),t.monitorProcessing(e)})),this.notify("update"),void n.createNodes(o).then((function(){e.forEach((function(e){e.setStatus(m.StatusLoaded),e.children.pg[e.getId()]=100,e.recomputeProgress(),t.unmonitorProcessing(e)})),t.processNext(),t.notify("update")})).catch((function(e){t.processNext(),t.notify("update")}))}var i=this.getNexts();i.length&&!this._pauseRequired?(i.forEach((function(e){t.monitorProcessing(e),e.process((function(){t.unmonitorProcessing(e),t.processNext(),t.notify("update")}))})),this.notify("update")):(this.hasErrors()?r.openUploadDialog():I.getInstance().getAutoClose()&&!this._pauseRequired&&this.notify("auto_close"),this.notify("update"))}},{key:"getFolders",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60,e=[];return this._sessions.forEach((function(r){var n=0;r.walk((function(t){e.push(t),n++}),(function(t){return"new"===t.getStatus()&&t.isNew()}),"folder",(function(){return e.length>=t})),r.setCreateFolders(n),r.setStatus(n?m.StatusFolders:m.StatusLoading)})),e}},{key:"getNexts",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,e=[];if(this._sessions.forEach((function(t){t.walk((function(t){e.push(t)}),(function(t){return"new"===t.getStatus()&&t.isNew()}),"folder",(function(){return e.length>=1}))})),e.length)return[e.shift()];var r=[],n=this._processing.length;return this._sessions.forEach((function(e){var o=0;e.walk((function(t){r.push(t),o++}),(function(t){return"new"===t.getStatus()||"pause"===t.getStatus()}),"file",(function(){return r.length>=t-n})),0===o&&0===n&&e.Task.setIdle()})),r}},{key:"stopOrRemoveItem",value:function(t){t.abort(),this.unmonitorProcessing(t),this.notify("update")}},{key:"getSessions",value:function(){return this._sessions}},{key:"isRunning",value:function(){return this._processing.filter((function(t){return t.getStatus()===m.StatusLoading})).length>0}},{key:"pause",value:function(){this._pauseRequired=!0,this._processing.forEach((function(t){return t.pause()})),this.notify("update")}},{key:"resume",value:function(){this._pauseRequired=!1,this._sessions.forEach((function(t){return t.setStatus("ready")})),this._processing.forEach((function(t){return t.resume()})),this.notify("update"),this.processNext()}},{key:"handleFolderPickerResult",value:function(t,r){var n=this,o=I.getInstance().getOption("DEFAULT_EXISTING","upload_existing"),i=new ht(e().getInstance().user.activeRepository,r);this.pushSession(i);for(var s={},u=0;u<t.length;u++){var c=t[u],l="/"+a().getBasename(c.name);if(t[u].webkitRelativePath){l="/"+t[u].webkitRelativePath;var f=a().getDirname(l);"/"!==f&&(s[a().getDirname(f)]="FOLDER"),s[f]="FOLDER"}s[l]=c}var p=i.treeViewFromMaterialPath(s),h=function(t,e){t.forEach((function(t){if("FOLDER"===t.item){var o=new et(t.path,r,e);h(t.children,o)}else-1===n._blacklist.indexOf(a().getBasename(t.path).toLowerCase())&&new V(t.item,r,t.path,e)}))};h(p,i),i.prepare(o).catch((function(t){}))}},{key:"handleDropEventResults",value:function(t,r,n){var o=this,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=I.getInstance().getOption("DEFAULT_EXISTING","upload_existing"),c=new ht(s||e().getInstance().user.activeRepository,n);this.pushSession(c);var l=function(t){return!(i&&!i(t))&&-1===o._blacklist.indexOf(a().getBasename(t).toLowerCase())};if(n&&n.isLeaf()&&n.getMetadata().has("local:dropFunc"))n.getMetadata().get("local:dropFunc")("native",c,t,r,n).then((function(){c.prepare(u).then((function(){o.notify("update")})).catch((function(t){o.notify("update")}))})).catch((function(t){o.removeSession(c),console.error(t)}));else if(t&&t.length&&(t[0].getAsEntry||t[0].webkitGetAsEntry)){for(var f=console?console.log:function(t){alert(t)},p=t.length,h=[],y=function(){var e;if(t[d].kind&&"file"!==t[d].kind)return 1;(e=t[0].getAsEntry?t[d].getAsEntry():t[d].webkitGetAsEntry()).isFile?h.push(new Promise((function(t,r){e.file((function(e){var r;e.size>0&&l(e.name)&&(r=new V(e,n,null,c)),t(r)}),(function(){r(),f()}))}))):e.isDirectory&&(e.folderItem=new et(e.fullPath,n,c),h.push(o.recurseDirectory(e,(function(t){var e=t.fullPath;return new Promise((function(r,o){t.file((function(o){var i;o.size>0&&l(o.name)&&(i=new V(o,n,e,t.parentItem)),r(i)}),(function(t){o(t),f()}))}))}),(function(t){return l(t.fullPath)&&(t.folderItem=new et(t.fullPath,n,t.parentItem)),Promise.resolve(t.folderItem)}),f)))},d=0;d<p;d++)y();Promise.all(h).then((function(){return c.prepare(u).then((function(){o.notify("update")}))})).catch((function(t){o.notify("update")}))}else{for(var v=0;v<r.length;v++){if(0===r[v].size)return void alert(e().getInstance().MessageHash["html_uploader.no-folders-support"]);if(!l(r[v].name))return;new V(r[v],n,null,c)}c.prepare(u).then((function(){o.notify("update")})).catch((function(t){o.notify("update")}))}}},{key:"recurseDirectory",value:function(t,e,r,n){var o=this;return new Promise((function(n){o.dirEntries(t).then((function(t){var o=[];t.forEach((function(t){t.parent&&t.parent.folderItem&&(t.parentItem=t.parent.folderItem),t.isDirectory?o.push(r(t)):o.push(e(t))})),Promise.all(o).then((function(){n()}))}))}))}},{key:"dirEntries",value:function(t){var e=this,r=t.createReader(),n=[];return new Promise((function(o,i){var s=function(){r.readEntries((function(r){if(r.length)n=n.concat((a=r,Array.prototype.slice.call(a||[],0))),s();else{var i=[];n.forEach((function(r){r.parent=t,r.isDirectory&&i.push(e.dirEntries(r).then((function(t){n=n.concat(t)})))})),i.length?Promise.all(i).then((function(){o(n)})):o(n)}var a}),(function(t){i(t)}))};s()}))}}],s=[{key:"openUploadDialog",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?e().getInstance().getController().fireAction("upload",{confirmDialog:!0}):e().getInstance().getController().fireAction("upload")}},{key:"getInstance",value:function(){return r.__INSTANCE||(r.__INSTANCE=new r),r.__INSTANCE}}],o&&gt(n.prototype,o),s&&gt(n,s),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o,s}(c())})(),window.UploaderModel=n})();